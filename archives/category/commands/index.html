<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>about NetApp   &raquo; commands</title>

<link rel="stylesheet" href="../../../wp-content/themes/fluid-blue/style.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../wp-content/themes/fluid-blue/print.css" type="text/css" media="print" />
<link rel="alternate" type="application/rss+xml" title="about NetApp RSS Feed" href="../../../feed" />
<link rel="pingback" href="../../../xmlrpc.php.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 2.6" />

</head>

<body>
<div id="page">
<div id="header">
	<div id="headertitle">
		<h1><a href="../../../index.html" title="about NetApp: Системы хранения данных как предмет разговора">about NetApp</a></h1>
		<p>Системы хранения данных как предмет разговора</p>
	</div> 
	<!-- Search box (If you prefer having search form as a sidebar widget, remove this block) -->
	<div class="search">
		<form method="get" id="searchform" action="../../../index.html">
<input type="text" size="20" name="s" id="s" value="Поиск..."  onblur="if(this.value=='') this.value='Поиск...';" onfocus="if(this.value=='Поиск...') this.value='';"/>
</form>
	</div> 
	<!-- Search ends here-->
		
</div>

<div id="navbar">
<ul id="nav">
	<li><a href="../../../index.html">Home</a></li>
	<li class="page_item page-item-153"><a href="../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul>
</div>
<div id="wrapper">

	<div id="content">

	
			<p>Archive for the &#8216;commands&#8217; Category.</p>

 				
		<div class="navigation">
			<div class="alignleft"><a href="page/2.html">&laquo; Previous Entries</a></div>
			<div class="alignright"></div>
		</div>

						
			<div class="post" id="post-1408">
				<h2 class="posttitle"><a href="../../1408/trackback.html" rel="bookmark" title="Permanent Link to Как начать новую жизнь с Clustered Data ONTAP и FCP">Как начать новую жизнь с Clustered Data ONTAP и FCP</a></h2>
				<div class="postmetadata">22 Октябрь 2014, 16:15 <!-- от  --></div>
				<div class="postentry">
					<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><br />
<html><br />
<head><br />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"><br />
  <meta http-equiv="Content-Style-Type" content="text/css"><br />
  <title></title><br />
  <meta name="Generator" content="Cocoa HTML Writer"><br />
  <meta name="CocoaVersion" content="1265.21"></p>
<style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Helvetica Light'; min-height: 16.0px}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Helvetica Light'}
    span.Apple-tab-span {white-space:pre}
  </style>
<p></head><br />
<body></p>
<p class="p1">
<p class="p1">
<p class="p2">Всем привет ! :)</p>
<p class="p2">Сегодня мы рассмотрим в подробностях процесс настройки SAN на cDOT с подключением к Cisco MDS.</p>
<p class="p1">
<p class="p2">Как вы знаете из документации, Clustered Data ONTAP требует использования NPIV при работе с Fiber Channel. NPIV расшифровывается как N-Port ID Virtualization, и мы не будем путать эту аббревиатуру с NPV (N-Port Virtualization). Это две разные вещи, хоть и гуглятся бок о бок ;)</p>
<p class="p2">NetApp использует NPIV для того, чтобы абстрагироваться от используемого железа на пути от FC HBA до клиентского оборудования. Поскольку мы используем логические интерфейсы – LIF – мы можем не только создавать несколько логических портов на одном физическом порту HBA, но и использовать для них разные WWPN.<span class="Apple-converted-space"> </span></p>
<p class="p2">Это особенно удобно при создании зон, FC-зоны создаются с использованием WWPN логических интерфейсов, а подлежащие «железные» порты могут меняться в любой момент.<span class="Apple-converted-space"> </span></p>
<p class="p2">Например, возьмем двухнодовый кластер FAS6250, на каждой голове которого мы используем 2 FC-адаптера:</p>
<p class="p1">
<p class="p2">netapp_clus::*&gt; fcp adapter show -fields fc-wwnn,fc-wwpn<span class="Apple-converted-space"> </span></p>
<p class="p2">node <span class="Apple-converted-space">                </span>adapter fc-wwnn <span class="Apple-converted-space">                          </span>fc-wwpn <span class="Apple-converted-space">                 </span></p>
<p class="p2">&#8212;&#8212;&#8212;- <span class="Apple-converted-space">          </span>&#8212;&#8212;- <span class="Apple-converted-space">  </span>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; <span class="Apple-converted-space">        </span>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; <span class="Apple-converted-space"> </span></p>
<p class="p2">netapp_clus-01 2a <span class="Apple-converted-space">        </span>50:0a:09:80:89:4c:bc:6d<span class="Apple-converted-space">  </span>50:0a:09:81:89:4c:bc:6d<span class="Apple-converted-space">   </span></p>
<p class="p1">
<p class="p2">netapp_clus-01 2b <span class="Apple-converted-space">        </span>50:0a:09:80:89:4c:bc:6d<span class="Apple-converted-space">  </span>50:0a:09:82:89:4c:bc:6d <span class="Apple-converted-space"> </span></p>
<p class="p2">netapp_clus-02 2a <span class="Apple-converted-space">        </span>50:0a:09:80:8f:ab:bd:cd<span class="Apple-converted-space">  </span>50:0a:09:81:8f:ab:bd:cd<span class="Apple-converted-space">   </span></p>
<p class="p2">netapp_clus-02 2b <span class="Apple-converted-space">        </span>50:0a:09:80:8f:ab:bd:cd<span class="Apple-converted-space">  </span>50:0a:09:82:8f:ab:bd:cd <span class="Apple-converted-space"> </span></p>
<p class="p1">
<p class="p2">Мы видим, что адреса портов на LIF’ах отличаются от адресов на физических портах:</p>
<p class="p1">
<p class="p2">netapp_clus::&gt; net int show -vserver vs1<span class="Apple-converted-space">   </span></p>
<p class="p2">(network interface show)<span class="Apple-converted-space">             </span></p>
<p class="p2">Vserver<span class="Apple-converted-space">  </span>Logical <span class="Apple-converted-space">                        </span>Status <span class="Apple-converted-space">        </span>Network<span class="Apple-converted-space">                    </span>Current <span class="Apple-converted-space">            </span>Current<span class="Apple-converted-space">  </span>Is<span class="Apple-converted-space">     </span></p>
<p class="p2"><span class="Apple-converted-space">             </span>Interface <span class="Apple-converted-space">                  </span>Admin/Oper Address/Mask <span class="Apple-converted-space">              </span>Node<span class="Apple-converted-space">                </span>Port <span class="Apple-converted-space">      </span>Home<span class="Apple-converted-space"> </span></p>
<p class="p2">&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;<span class="Apple-converted-space"> </span></p>
<p class="p2">vs1 <span class="Apple-converted-space">       </span></p>
<p class="p2"><span class="Apple-converted-space">             </span>netapp_clus-01_fc_lif_1 up/up<span class="Apple-converted-space">    </span>20:04:00:a0:98:21:30:55 netapp_clus-01<span class="Apple-converted-space">    </span>2a<span class="Apple-converted-space">      </span>true<span class="Apple-converted-space">             </span></p>
<p class="p2"><span class="Apple-converted-space">             </span>netapp_clus-01_fc_lif_2 up/up<span class="Apple-converted-space">    </span>20:05:00:a0:98:21:30:55 netapp_clus-01<span class="Apple-converted-space">    </span>2b<span class="Apple-converted-space">      </span>true</p>
<p class="p2"><span class="Apple-converted-space">             </span>netapp_clus-02_fc_lif_1 up/up<span class="Apple-converted-space">    </span>20:06:00:a0:98:21:30:55 netapp_clus-02<span class="Apple-converted-space">    </span>2a<span class="Apple-converted-space">      </span>true<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">             </span>netapp_clus-02_fc_lif_2 up/up<span class="Apple-converted-space">    </span>20:07:00:a0:98:21:30:55 netapp_clus-02<span class="Apple-converted-space">    </span>2b<span class="Apple-converted-space">      </span>true</p>
<p class="p1">
<p class="p2">В этом логе отображена конфигурация Vserver’а, на котором поднято 4 LIF’а. Они привязаны к физическим портам и имеют собственные виртуальные WWPN. Если в будущем нам потребуется заменить карточку HBA в слоте 2, идентификаторы портов на LIF’ах при этом не изменятся, и нам не придется переделывать зоны.</p>
<p class="p1">
<p class="p2">Переходим к следующему звену нашей сети - FC-свитчам. В данном проекте мы используем Cisco Nexus 5020, и для работы с cDOT нам понадобится включить на нем NPIV.</p>
<p class="p1">
<p class="p2">nxs5020-vcloud1# conf t</p>
<p class="p2">nxs5020-vcloud1(config)# feature npiv</p>
<p class="p2">Проверяем себя на адекватность:</p>
<p class="p2">nxs5020-vcloud1# show feature | i npiv<span class="Apple-converted-space"> </span></p>
<p class="p2">npiv<span class="Apple-converted-space">                  </span>1 <span class="Apple-converted-space">        </span>enabled</p>
<p class="p1">
<p class="p2">Проверяем, что у нас настроены VSAN’ы zoneset’ы и зоны</p>
<p class="p2">В этом примере мы используем VSAN 101, и у нас настроен<span class="Apple-converted-space">  </span>один zoneset, с одной zone.<span class="Apple-converted-space"> </span></p>
<p class="p1">
<p class="p2">Пример настройки zoneset:</p>
<p class="p2">nxs5020-vcloud1# show zoneset brief vsan 101<span class="Apple-converted-space"> </span></p>
<p class="p2">zoneset name test-zoneset vsan 101<span class="Apple-converted-space">   </span></p>
<p class="p2"><span class="Apple-converted-space">  </span>zone test-zone</p>
<p class="p1">
<p class="p2">Пример настройки zone:</p>
<p class="p2">nxs5020-vcloud1# show zone vsan 101<span class="Apple-converted-space"> </span></p>
<p class="p2">zone name test-zone vsan 101<span class="Apple-converted-space">   </span></p>
<p class="p2"><span class="Apple-converted-space">  </span>fcalias name esxtest-1-vmhba2 vsan 101<span class="Apple-converted-space">     </span></p>
<p class="p2"><span class="Apple-converted-space">  </span>pwwn 20:00:00:25:b5:00:00:1a <span class="Apple-converted-space">     </span></p>
<p class="p2"><span class="Apple-converted-space">  </span>fcalias name netapp_clus-01_fc_lif_2 vsan 101<span class="Apple-converted-space">     </span></p>
<p class="p2"><span class="Apple-converted-space">  </span>pwwn 20:05:00:a0:98:21:30:55</p>
<p class="p1">
<p class="p2">Для простоты чтения конфига, алиасы в этом примере названы так же, как и интерфейсы на Vserver.</p>
<p class="p1">
<p class="p2">Теперь, когда у нас настроены свитчи и есть связность между СХД и серверами, нам осталось настроить LUN’ы и отдать их хостам.<span class="Apple-converted-space"> </span></p>
<p class="p2">Для этого нужно:</p>
<p class="p2">•<span class="Apple-tab-span">	</span>создать initiator group</p>
<p class="p2">•<span class="Apple-tab-span">	</span>добавить WWPN’ы хостов в эту группу</p>
<p class="p2">•<span class="Apple-tab-span">	</span>Создать LUN</p>
<p class="p2">•<span class="Apple-tab-span">	</span>Привязать LUN к этой igroup.</p>
<p class="p2">При создании igroup нам нужно правильно указать тип ОС. Это, в частности, поможет системе правильно использовать ALUA.<span class="Apple-converted-space"> </span></p>
<p class="p2">netapp_clus::&gt; igroup create -vserver vs1 -igroup esxtest_fcp_igrp<span class="Apple-converted-space">  </span>-protocol fcp -ostype vmware</p>
<p class="p2">После этого мы можем добавить в группу наши инициаторы:</p>
<p class="p2">netapp_clus::&gt; igroup add -vserver vs1<span class="Apple-converted-space">  </span>-igroup esxtest_fcp_igrp –initiator 20:00:00:25:b5:00:00:1a</p>
<p class="p2">?? в результате мы получаем настроенную igroup:</p>
<p class="p2">netapp_clus::&gt; igroup show -vserver vs1<span class="Apple-converted-space"> </span></p>
<p class="p2">Vserver <span class="Apple-converted-space">  </span>Igroup<span class="Apple-converted-space">              </span>Protocol<span class="Apple-converted-space">  </span>OS Type <span class="Apple-converted-space">  </span>Initiators<span class="Apple-converted-space"> </span></p>
<p class="p2">&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;<span class="Apple-converted-space"> </span></p>
<p class="p2">vs1 <span class="Apple-converted-space">      </span>esxtest_fcp_igrp<span class="Apple-converted-space">  </span>fcp <span class="Apple-converted-space">        </span>vmware<span class="Apple-converted-space">    </span>20:00:00:25:b5:00:00:1a</p>
<p class="p1">
<p class="p2">Осталось совсем немного – создать LUN (обязательно правильно указать тип ОС, иначе мы обеспечим себе потенциальную потерю производительности):</p>
<p class="p2">netapp_clus::&gt; lun create -vserver vs1 -path /vol/fcp/test -size 250g -ostype vmware</p>
<p class="p2">Привязать его к igroup:</p>
<p class="p2">netapp_clus::&gt; lun map -vserver vs1 -path /vol/fcp/test -igroup esxtest_fcp_igrp</p>
<p class="p1">
<p class="p2">?? проверить, что мы нигде не ошиблись:</p>
<p class="p1">
<p class="p2">netapp_clus::&gt; lun show -vserver vs1<span class="Apple-converted-space"> </span></p>
<p class="p2">Vserver <span class="Apple-converted-space">  </span>Path <span class="Apple-converted-space">                          </span>State <span class="Apple-converted-space">  </span>Mapped <span class="Apple-converted-space">  </span>Type <span class="Apple-converted-space">          </span>Size<span class="Apple-converted-space"> </span></p>
<p class="p2">&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;<span class="Apple-converted-space"> </span></p>
<p class="p2">vs1 <span class="Apple-converted-space">        </span>/vol/fcp/test<span class="Apple-converted-space">                </span>online<span class="Apple-converted-space">  </span>mapped <span class="Apple-converted-space">  </span>vmware<span class="Apple-converted-space">      </span>250GB</p>
<p class="p1">
<p class="p2">netapp_clus::&gt; lun mapped show -vserver vs1<span class="Apple-converted-space"> </span></p>
<p class="p2">Vserver<span class="Apple-converted-space">    </span>Path <span class="Apple-converted-space">                    </span>Igroup<span class="Apple-converted-space">                </span>LUN ID<span class="Apple-converted-space">  </span>Protocol<span class="Apple-converted-space"> </span></p>
<p class="p2">&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;<span class="Apple-converted-space"> </span></p>
<p class="p2">vs1<span class="Apple-converted-space">          </span>/vol/fcp/test<span class="Apple-converted-space">          </span>esxtest_fcp_igrp<span class="Apple-converted-space">  </span>0<span class="Apple-converted-space">          </span>fcp</p>
<p class="p1">
<p class="p2">Вот и все ! Новый LUN готов к использованию нашим ESX-хостом.</p>
<p class="p1">
<p></body><br />
</html></p>
				</div>
		
				<div class="postmetadata">
										Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>,  <a href="../howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../1408/trackback.html#comments" title="Комментарий к записи Как начать новую жизнь с Clustered Data ONTAP и FCP">Комментарии (5)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1313">
				<h2 class="posttitle"><a href="../../1313/trackback.html" rel="bookmark" title="Permanent Link to pktt: встроенный сборщик ethernet dump">pktt: встроенный сборщик ethernet dump</a></h2>
				<div class="postmetadata">16 Декабрь 2013, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Внутри Data ONTAP зачастую находится много полезных штук, к сожалению, часто малоизвестных &#8220;рядовому админу&#8221;, особенное если &#8220;все и так работает&#8221;.<br />
Одна из таких архиполезных для траблшутинга сети штук - встроенный сборщик дампа пакетов на сетевом интерфейсе. Особенно полезно то, что формат собираемого дампа позволяет напрямую открывать его в популярнейшем инструменте анализа дампов - Wireshark.<br />
Если вы настроили CHAP authentification в iSCSI, и <em>что-то пошло не так</em>, или <em>что-то странное творится</em> при доступе к файлам по SMB, то лучший способ - собрать дамп и посмотреть что происходит в сети на стороне стораджа.</p>
<p>Для этого выясним сперва, на каком интерфейсе нас будет интересовать ethernet-трафик.</p>
<p><code>netapp> ifconfig -a</p>
<p>e0a: flags=0xe48867<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500<br />
inet 10.10.10.140 netmask 0xffffff00 broadcast 10.10.10.255<br />
ether 00:0c:29:89:3f:3c (auto-1000t-fd-up) flowcontrol full<br />
e0b: flags=0xe08866<BROADCAST,RUNNING,MULTICAST> mtu 1500<br />
ether 00:0c:29:89:3f:46 (auto-1000t-fd-up) flowcontrol full<br />
e0c: flags=0xe08866<BROADCAST,RUNNING,MULTICAST> mtu 1500<br />
ether 00:0c:29:89:3f:50 (auto-1000t-fd-up) flowcontrol full<br />
e0d: flags=0xe08866<BROADCAST,RUNNING,MULTICAST> mtu 1500<br />
ether 00:0c:29:89:3f:5a (auto-1000t-fd-up) flowcontrol full<br />
lo: flags=0&#215;1b48049<UP,LOOPBACK,RUNNING,MULTICAST,TCPCKSUM> mtu 9188<br />
inet 127.0.0.1 netmask 0xff000000 broadcast 127.0.0.1<br />
losk: flags=0&#215;40a400c9<UP,LOOPBACK,RUNNING> mtu 9188<br />
inet 127.0.20.1 netmask 0xff000000 broadcast 127.0.20.1</code></p>
<p>Запустим команду pktt, указав ей собирать дамп на заданном интерфейсе, и маркировать файл дампа датой сбора.</p>
<p><code>netapp> pktt start e0a -d /etc/log<br />
e0a: started packet trace</code></p>
<p><code>netapp> pktt status<br />
e0a: Packet tracing enabled; packets truncated at 1514 bytes.<br />
e0a: Trace buffer utilization = 2% of 1048320 bytes, 258 packets<br />
e0a: 0 bytes written to file /etc/log/e0a_20131108_173928.trc<br />
e0a: Currently tracing to file /etc/log/e0a_20131108_173928.trc<br />
e0a: 258 packets seen; 0 packets dropped; 24936 total bytes seen</code></p>
<p><code>lo: Packet tracing enabled; packets truncated at 1514 bytes.<br />
lo: Trace buffer utilization = 99% of 130816 bytes, 1011 packets<br />
lo: 1387 packets seen; 0 packets dropped; 160568 total bytes seen</code></p>
<p><code>losk: Packet tracing enabled; packets truncated at 1514 bytes.<br />
losk: Trace buffer utilization = 99% of 130816 bytes, 282 packets<br />
losk: 40901 packets seen; 0 packets dropped; 21761277 total bytes seen</code></p>
<p>Когда нужный интервал сбора пройден, остановим pktt. </p>
<p><code>netapp> pktt stop e0a<br />
e0a: Tracing stopped and packet trace buffers released.<br />
Fri Nov  8 17:42:25 EST [sim81:cmds.pktt.write.info:info]: pktt: 280 packets seen, 0 dropped, 32046 bytes written to /etc/log/e0a_20131108_173928.trc.</code></p>
<p>У нас по заданному пути окажется файл с дампом, который мы можем скопировать на машину с Wireshark.</p>
<p><a href="/pics//pktt02.jpg"><img src="/pics//pktt02.jpg" alt="" title="pktt02" width="443" height="186" class="alignnone size-full wp-image-1315" /></a></p>
<p>Теперь откроем файл .trc, прямо в Wirrshark, и приступим к знакомому процессу разбора в этом замечательном инструменте.</p>
<p><a href="/pics//pktt03.jpg"><img src="/pics//pktt03-300x167.jpg" alt="" title="pktt03" width="300" height="167" class="alignnone size-medium wp-image-1314" /></a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../tag/pktt.html" rel="tag">pktt</a>, <a href="../../tag/tools.html" rel="tag">tools</a><br />					Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>,  <a href="../utilities/index.html" title="Просмотреть все записи в рубрике &laquo;utilities&raquo;" rel="category tag">utilities</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../1313/trackback.html#respond" title="Комментарий к записи pktt: встроенный сборщик ethernet dump">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1265">
				<h2 class="posttitle"><a href="../../1265/trackback.html" rel="bookmark" title="Permanent Link to Соответствие команд 7-mode и C-mode">Соответствие команд 7-mode и C-mode</a></h2>
				<div class="postmetadata">1 Июль 2013, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Если вам в скором времени предстоит переход на Clustered Data ONTAP, или если вы админ системы хранения, хорошо знакомый с Data ONTAP 7-mode, которому предстоит администрировать Cluster-mode, то рекомендую посмотреть документ, недавно опубликованный в библиотеке NetApp:</p>
<p><strong>Clustered Data ONTAP® 8.2</strong>    <br />Command Map for 7-Mode Administrators</p>
<p>В нем в таблицу собраны команды Cluster-mode, соответствующие, по выполняемым действиям, командам 7-mode. То есть если вы знаете как, допустим, создать том на aggregate в 7-mode, и не знаете какой командой это делается в Clustered ONTAP, то вот этот документ вам поможет.</p>
<p>Брать можно здесь: <a href="https://library.netapp.com/ecm/ecm_download_file/ECMP1196780">https://library.netapp.com/ecm/ecm_download_file/ECMP1196780</a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../tag/7-mode.html" rel="tag">7-mode</a>, <a href="../../tag/c-mode.html" rel="tag">c-mode</a>, <a href="../../tag/cluster/index.html" rel="tag">cluster</a>, <a href="../../tag/cluster-mode/index.html" rel="tag">cluster-mode</a>, <a href="../../tag/clustered-ontap.html" rel="tag">clustered ontap</a>, <a href="../../tag/netapp/index.html" rel="tag">netapp</a><br />					Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>,  <a href="../howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../1265/trackback.html#respond" title="Комментарий к записи Соответствие команд 7-mode и C-mode">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-919">
				<h2 class="posttitle"><a href="../../919/trackback.html" rel="bookmark" title="Permanent Link to Замена диска на конкретный из spare">Замена диска на конкретный из spare</a></h2>
				<div class="postmetadata">6 Июнь 2011, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Хотя в подавляющем большинстве случаев это и не является необходимым в практике администратора, однако в Data ONTAP имеется механизм принудительного “вывода из строя” и замены диска на конкретный диск из spare.</p>
<p>Для принудительного назначения диска “вышедшим из строя” можно использовать команду </p>
<p><code>&gt; disk fail &lt;disk.name&gt;</code></p>
<p><strong>ОСТОРОЖНО!</strong> Эта команда относительно легко доступна, а вот “обратная” ей disk unfail требует повышенного уровня привилегий, <strike>и доступна только джедаям от третьего уровня и выше</strike>. Помеченный как fail диск становится для системы на самом деле fail, и никакие “вынуть-вставить” его от этого состояния не лечат!</p>
<p>Эта команда не позволяет назначить на замену конкретный spare. Если же стоит задача именно корректно заменить один конкретный диск на конкретный другой из блока spare, то следует применить команду </p>
<p><code>&gt; disk replace start [-f] disk.name sparedsik.name</code></p>
<p>Эта команда инициирует процесс Rapid RAID Recovery, при котором, напоминаю, считывается все доступное содержимое непосредственно со “сбойного” диска, а не восстанавливается из parity, как при “обычном” RAID Recovery, что гораздо быстрее и меньше нагружает систему, а все что считать таким образом не удалось уже восстанавливается традиционным способом.</p>
<p>После завершения RAID Recovery назначенный для замены диск заменяется на указанный из spare, а сам, в свою очередь, передается в блок spare.</p>
<p>Отменить начавшуюся процедуру замены можно командой </p>
<p><code>&gt; disk replace stop disk.name</code></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../tag/commands/index.html" rel="tag">commands</a>, <a href="../../tag/disk.html" rel="tag">disk</a>, <a href="../../tag/netapp/index.html" rel="tag">netapp</a><br />					Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../919/trackback.html#respond" title="Комментарий к записи Замена диска на конкретный из spare">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-822">
				<h2 class="posttitle"><a href="../../822/trackback.html" rel="bookmark" title="Permanent Link to fpolicy &ndash; простая блокировка файлов по расширению в NAS">fpolicy &ndash; простая блокировка файлов по расширению в NAS</a></h2>
				<div class="postmetadata">21 Февраль 2011, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Если вы используете систему NetApp как NAS, то есть как файловое хранилище по протоколу CIFS, то вы можете настроить в ней несложную блокировку нежелательных файлов по расширению (это конечно не сработает при смене расширения, но уже само по себе хоть что-то). Механизм этот назывется <strong>fpolicy</strong> и описан <a href="http://now.netapp.com/NOW/knowledge/docs/ontap/rel801/html/ontap/filesag/GUID-0DAD7887-2918-47A3-A8AE-70D3F5308C73.html">в документации</a>.</p>
<p><code>filer&gt; fpolicy create Media screen      <br />File policy Media created successfully.       <br />filer&gt; fpolicy ext inc set Media .mp3       <br />filer&gt; fpolicy monitor set Media -p cifs -f create,rename       <br />filer&gt; fpolicy options Media required on       <br />filer&gt; fpolicy enable Media -f       <br />Thu Feb 10 14:12:52 CST [hounas04: fpolicy.fscreen.enable:info]: FPOLICY: File policy Media (file screening) is enabled.       <br />File policy Media (file screening) is enabled.       <br />filer&gt;</code></p>
<p>Не забудьте также отдельно включить fpolicy в целом, установив соответствующую опцию системных настроек</p>
<p><code>filer&gt; options fpolicy.enable on</code></p>
<p>Далее можно посмотреть на установленные параметры и статистику работы.</p>
<p><code>filer&gt; fpolicy show Media</code>
<p>File policy Media (file screening) is enabled.</p>
<p>No file policy servers are registered with the filer.</p>
<p>Operations monitored:      <br />File create,File rename       <br />Above operations are monitored for CIFS only</p>
<p>List of extensions to screen:      <br />.MP3</p>
<p>List of extensions not to screen:      <br />Extensions-not-to-screen list is empty.</p>
<p>Number of requests screened&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; :&#160; 0      <br />Number of screen failures&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; :&#160; 0       <br />Number of requests blocked locally&#160;&#160; :&#160; 0</p></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../tag/fpolicy.html" rel="tag">fpolicy</a>, <a href="../../tag/nas.html" rel="tag">nas</a>, <a href="../../tag/netapp/index.html" rel="tag">netapp</a><br />					Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>,  <a href="../howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../822/trackback.html#comments" title="Комментарий к записи fpolicy &ndash; простая блокировка файлов по расширению в NAS">Комментарии (9)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-799">
				<h2 class="posttitle"><a href="../../799/trackback.html" rel="bookmark" title="Permanent Link to Долгожданный EMC Celerron грядет :)">Долгожданный EMC Celerron грядет :)</a></h2>
				<div class="postmetadata">13 Январь 2011, 13:15 <!-- от  --></div>
				<div class="postentry">
					<p>Продукт, о котором долго говорили, результат скрещения <strike>жабы с мотоциклом</strike> Celerra и CLARiiON, настоящего (<em>еще более настоящего</em>;) Unified Storage от EMC, базирующегося на файловой системе <strike>shenanigan-ского</strike> блочного стораджа – VNX.</p>
<p>Да уж, давайте, давайте, заждались (потирает ручонки), наконец-то посоревнуемся за пользователей всерьез, без глупого лечилова про “<em>настоящий fibre channel</em>”.</p>
<p>??сточник: <a href="http://www.theregister.co.uk/2011/01/04/emc_vnx_unified_storage/">http://www.theregister.co.uk/2011/01/04/emc_vnx_unified_storage/</a></p>
<p>Подробности, по всей видимости - 18.01.</p>
<p>PS. ??нтересно, съест ли свою шляпу Чак Холлис? ;)</p>
<p>UPD: Подробности нашлись на <a href="http://searchstorage.techtarget.com.au/news/2240030675/FULL-DETAILS-EMCs-new-VNX-and-VNXe-range">SearchStorage</a></p>
<p>UPD: Да, вернулся в эфир чуть раньше, сначала предполагал запостить это 17, в понедельник, накануне официального анонса, но так как прошла утечка, и народ в интернетах загомонил, решил не ждать, да и вам интереснее.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../tag/emc/index.html" rel="tag">emc</a>, <a href="../../tag/vnx.html" rel="tag">vnx</a><br />					Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>,  <a href="../justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;" rel="category tag">justread</a>,  <a href="../review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;" rel="category tag">review</a>,  <a href="../news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;" rel="category tag">новости</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../799/trackback.html#comments" title="Комментарий к записи Долгожданный EMC Celerron грядет :)">Комментарии (8)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-773">
				<h2 class="posttitle"><a href="../../773/trackback.html" rel="bookmark" title="Permanent Link to Команда lock">Команда lock</a></h2>
				<div class="postmetadata">29 Ноябрь 2010, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Продолжим нашу серию про не слишком известные, но полезные команды, “в записную книжку админа”. На очереди у нас уже однажды упоминавшаяся команда lock. </p>
<p>Напомню вкратце. В системе совместного доступа, какой является NAS, для того, чтобы обеспечить отсутствие конфликтов доступа, используется метод так называемого “локирования” доступа к файлу.&#160; Это необходимо для предотвращения возможности одновременной, но неснхронизированной записи в один и тот же файл от разных клиентов, не знающих о том, что сосед тоже решил изменить тот же самый файл, уже открытый одним клиентом. Для предотвращения такой ситуации, первый открывший файл клиент получает исключительные права на запись в файл (локирует файл на запись), остальные же – только на чтение, до тех пор, пока первый клиент не закончит записи в файл.   <br />Возможно два типа локирования, так называемый <em>file lock</em>, при котором ограничивается доступ на запись в файл целиком для всех, кроме залокировавшего файл на запись клиента, и <em>byte range lock</em>, при котором ограничивается запись к определенному участку файла.</p>
<p>С помощью команды <strong>lock status</strong> можно посмотреть, какой хост и какой пользователь локировал тот или иной файл на NAS-системе.</p>
<p><code>fas1&gt;&#160; lock status –p cifs –h&#160; </code><em>(показывает локи сортированные по имени хоста)</em><code>      <br /><font style="background-color: #ffffa0">CIFS host=172.18.2.107(VUSER01-VPC)</font> owner=administrator state=GRANTED mode=Read-       <br />denyN oplock=None fsid=0&#215;0e1d66f7 fileid=0&#215;000000d3       <br />path=\word.doc(/vol/vol0/share1/word.doc) </code>    <br />&#160; <br /><code>fas1&gt; lock status –p cifs –o </code><em>(показывает локи, сортированные по пользователю или владельцу)</em><code>      <br /><font style="background-color: #ffffa0">CIFS owner=root</font> host=10.34.17.49(PC002-XP) pid=65279 offset=2147483539 len=1       <br />excl=yes state=GRANTED fsid=0&#215;0e1d66f7 fileid=0&#215;000000d3       <br />path=\word.doc(/vol/vol0/share1/word.doc) </code></p>
<p>Снять же ненужное (например ошибочно “зависшее”) локирование можно командой:</p>
<p><code>fas1&gt; lock break -f file [-o owner -h host] [-p proto] </code></p>
<p>Обратите внимание, что, хотя команда lock break –f и поддерживается, но при использовании NFS v4 ее применение не рекомендуется, по причине ряда ненужных побочных эффектов снятия локирования таким образом.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../tag/commands/index.html" rel="tag">commands</a>, <a href="../../tag/lock.html" rel="tag">lock</a>, <a href="../../tag/netapp/index.html" rel="tag">netapp</a><br />					Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../773/trackback.html#respond" title="Комментарий к записи Команда lock">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-647">
				<h2 class="posttitle"><a href="../../647/trackback.html" rel="bookmark" title="Permanent Link to Дисконтный код от NetApp на VMworld 2010">Дисконтный код от NetApp на VMworld 2010</a></h2>
				<div class="postmetadata">30 Июль 2010, 10:21 <!-- от  --></div>
				<div class="postentry">
					<p>В <a href="http://blogs.netapp.com/virtualstorageguy/2010/07/netapp-providing-discounted-vmware-conference-passes.html">блоге Vaughan Stewart</a>-а, “главного блоггера NetApp по VMware” найдена полезная информация. NetApp предлагает специальный скидочный код для покупки full conference pass for individuals для VMworld в San Francisco, а также VMworld в Copenhagen. С дисконтом NetApp цена снижается с $1745 до $1495 (USD) и с € 1150 до € 950 (Euro).</p>
<p>??спользовать код можно при регистрации на <a href="http://www.vmworld.com/registration.jspa?sponsorCode=NAPP">VMworld</a> по следующему адресу:</p>
<p><a href="http://www.vmworld.com/registration.jspa?sponsorCode=NAPP">http://www.vmworld.com/registration.jspa?sponsorCode=NAPP</a></p>
<p>Просто введите один из этих кодов при завершении покупки билета:</p>
<p>San Francisco code: <strong>NETAPP_EB_US2010</strong>    <br />Copenhagen code: <strong>NETAPP_EB_EMEA2010</strong></p>
<p>Дополнение: Как пишет <a href="http://twitter.com/that1guynick/">Nick Howell</a>, дисконт NetApp работает и “задним числом”, то есть, если вы уже приобрели билет за полную цену, вы можете получить вашу скидку, послав запрос по email: VMworld2010Registration@vmware-events.com.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../tag/vmware/index.html" rel="tag">vmware</a>, <a href="../../tag/vmworld2010.html" rel="tag">vmworld2010</a><br />					Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>,  <a href="../justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;" rel="category tag">justread</a>,  <a href="../review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;" rel="category tag">review</a>,  <a href="../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>,  <a href="../whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;" rel="category tag">whoisho</a>,  <a href="../news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;" rel="category tag">новости</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../647/trackback.html#respond" title="Комментарий к записи Дисконтный код от NetApp на VMworld 2010">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-637">
				<h2 class="posttitle"><a href="../../637/trackback.html" rel="bookmark" title="Permanent Link to Что есть что в выводе команды snap list?">Что есть что в выводе команды snap list?</a></h2>
				<div class="postmetadata">26 Июль 2010, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>??ногда приходится сталкиваться с неполным пониманием того, что именно и как выводится в команде <strong>snap list</strong>.</p>
<p>Давайте на примерах разберем “что есть что”, где и как.</p>
<p>У нас есть том vol1 на 100G, практически пустой.</p>
<p><code>fas3020a&gt; df -h vol1      <br />Filesystem&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; total&#160;&#160;&#160;&#160;&#160;&#160; used&#160;&#160;&#160;&#160;&#160; avail capacity&#160; Mounted on       <br />/vol/vol1/&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 80GB&#160;&#160;&#160;&#160;&#160;&#160; 17MB&#160;&#160;&#160;&#160;&#160;&#160; 79GB&#160;&#160;&#160;&#160;&#160;&#160; 0%&#160; /vol/vol1/       <br />/vol/vol1/.snapshot&#160;&#160;&#160;&#160;&#160; 20GB&#160;&#160;&#160;&#160;&#160;&#160; 61MB&#160;&#160;&#160;&#160;&#160;&#160; 19GB&#160;&#160;&#160;&#160;&#160;&#160; 0%&#160; /vol/vol1/.snapshot       <br />&#160; <br />fas3020a&gt; snap list vol1       <br />Volume vol1       <br />working&#8230;       <br />&#160; <br />&#160; %/used&#160;&#160;&#160;&#160;&#160;&#160; %/total&#160; date&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; name       <br />&#8212;&#8212;&#8212;-&#160; &#8212;&#8212;&#8212;-&#160; &#8212;&#8212;&#8212;&#8212;&#160; &#8212;&#8212;&#8211;       <br />31% (31%)&#160;&#160;&#160; 0% ( 0%)&#160; Mar 08 00:00&#160; nightly.0       <br />47% (29%)&#160;&#160;&#160; 0% ( 0%)&#160; Mar 07 20:00&#160; hourly.0       <br />57% (32%)&#160;&#160;&#160; 0% ( 0%)&#160; Mar 07 16:00&#160; hourly.1       <br />64% (29%)&#160;&#160;&#160; 0% ( 0%)&#160; Mar 07 12:00&#160; hourly.2       <br />69% (32%)&#160;&#160;&#160; 0% ( 0%)&#160; Mar 07 08:00&#160; hourly.3       <br />73% (29%)&#160;&#160;&#160; 0% ( 0%)&#160; Mar 07 00:01&#160; nightly.1       <br />76% (30%)&#160;&#160;&#160; 0% ( 0%)&#160; Mar 06 20:00&#160; hourly.4       <br />78% (31%)&#160;&#160;&#160; 0% ( 0%)&#160; Mar 06 16:00&#160; hourly.5 </code></p>
<p>В этом выводе, колонка <strong>%/used</strong> показывает объем, занятый снэпшотами, деленный на количество использованных в настоящий момент блоков на томе, независимо от того, заняты ли они в активной файловой системе, или снэпшотах. Первое число – накопительная сумма для всех показанных снэпшотов. Второе число (в скобках) – только для конкретного снэпшота.</p>
<p>Снэпшоты тома vol1 занимают 78% всех занятых на томе блоков, каждый из снэпшотов занимает примерно 29-32% занятых блоков.</p>
<p>Колонка <strong>%/total</strong> показывает объем занятый снэпшотами, деленный на общий объем диска. Он включает в себя пространство для данных, плюс snapshot reserve, то есть все использованные и свободные блоки тома. На томе 100GB занято примерно 61MB в снэпшотах, что составляет менее 1% общего объема (поэтому значение – 0).    <br />Значение (в скобках) вычисляется аналогично вышеприведенному для %/used.</p>
<p>Давайте посмотрим, как все изменится, если мы уменьшим размер тома vol1 со 100GB до 1GB.</p>
<p><code>fas3020a&gt; df -h vol1      <br />Filesystem&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; total&#160;&#160;&#160;&#160;&#160;&#160; used&#160;&#160;&#160;&#160;&#160; avail capacity&#160; Mounted on       <br />/vol/vol1/&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 819MB&#160;&#160;&#160;&#160;&#160;&#160; 17MB&#160;&#160;&#160;&#160;&#160; 801MB&#160;&#160;&#160;&#160;&#160;&#160; 2%&#160; /vol/vol1/       <br />/vol/vol1/.snapshot&#160;&#160;&#160;&#160; 204MB&#160;&#160;&#160;&#160;&#160;&#160; 61MB&#160;&#160;&#160;&#160;&#160; 143MB&#160;&#160;&#160;&#160;&#160; 30%&#160; /vol/vol1/.snapshot</code> </p>
<p><code>fas3020a&gt; snap list vol1    <br />Volume vol1     <br />working&#8230;     <br />&#160; <br />&#160; %/used&#160;&#160;&#160;&#160;&#160;&#160; %/total&#160; date&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; name     <br />&#8212;&#8212;&#8212;-&#160; &#8212;&#8212;&#8212;-&#160; &#8212;&#8212;&#8212;&#8212;&#160; &#8212;&#8212;&#8211;     <br />31% (31%)&#160;&#160;&#160; 1% ( 1%)&#160; Mar 08 00:00&#160; nightly.0     <br />47% (29%)&#160;&#160;&#160; 1% ( 1%)&#160; Mar 07 20:00&#160; hourly.0     <br />57% (32%)&#160;&#160;&#160; 2% ( 1%)&#160; Mar 07 16:00&#160; hourly.1     <br />64% (29%)&#160;&#160;&#160; 3% ( 1%)&#160; Mar 07 12:00&#160; hourly.2     <br />69% (32%)&#160;&#160;&#160; 4% ( 1%)&#160; Mar 07 08:00&#160; hourly.3     <br />73% (29%)&#160;&#160;&#160; 4% ( 1%)&#160; Mar 07 00:01&#160; nightly.1     <br />76% (30%)&#160;&#160;&#160; 5% ( 1%)&#160; Mar 06 20:00&#160; hourly.4     <br />78% (31%)&#160;&#160;&#160; 6% ( 1%)&#160; Mar 06 16:00&#160; hourly.5     </code>
</p>
<p>Теперь мы видим, что снэпшоты заняли большее относительное пространство на томе в целом (%/total), то есть занятых <em>??</em> пустых, но процент блоков в снэпшотах, относительно всех <em>только</em> занятых блоков на томе (%/used) остался неизменным.</p>
<p>Как всем этим полагается правильно пользоваться?</p>
<p>Величины %/used и %/total полезны при оценке того, насколько правильно выбрана величина snapshot reserve. Нехватка резерва приводит к тому, что снэпшоты <a href="../../341/trackback.html">“вылезают” за пределы резерва</a>, и начинают занимать место в пространстве данных. Когда команда df показывает величину заняости диска больше 100% – это как раз такой случай: снэпшоты переполнили пространство резерва и начали заполнять пространство собственно данных. Это не страшно, особенно если для тома работает autogrow (и есть место на aggregate) или autodelete (и вы можете безболезненно удалить некоторые старые снэпшоты), но, тем не менее, этого следует избегать для более однозначной организации данных.</p>
<p> Когда вы решаете удалить тот или иной снэпшот, рекомендуется пользоваться командой <strong>snap delta</strong> или <strong>snap reclaimable</strong>, чтобы выбрать наиболее эффективный с точки зрения освобождения места снэпшот.     <br />Число после точки в имени снэпшота увеличивается со взятием нового снэпшота. Например, сли вы берете снэпшот каждый час, то hourly.1 взятый в 9 утра, станет hourly.5 в 13:00. Также это работает и в случае daily- или weekly-снэпшотов.     <br />Обратите внимание, что снэпшоты с явно заданным именем (то есть <strong>не</strong> те, что создаются по расписанию), а также снэпшоты, созданные SnapMirror и SnapVault не изменяют своего имени при создании новых.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../tag/commands/index.html" rel="tag">commands</a>, <a href="../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../tag/snapshots.html" rel="tag">snapshots</a><br />					Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>,  <a href="../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../637/trackback.html#respond" title="Комментарий к записи Что есть что в выводе команды snap list?">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-610">
				<h2 class="posttitle"><a href="../../610/trackback.html" rel="bookmark" title="Permanent Link to Полезные команды: aggr show_space">Полезные команды: aggr show_space</a></h2>
				<div class="postmetadata">1 Июль 2010, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Продолжим понемногу рассказ о полезных в работе админа системы хранения командах Data ONTAP.</p>
<p>Часто бывает полезно проанализировать состояние и занятость пространства на дисках системы хранения, и если для томов у нас есть вездесущий df, то на уровне aggregate это може быть не столь простым.    <br />Для <code>df</code> есть ключ, показывающий занятость места на уровне aggregate, но не столь удобно и зрелищно:</p>
<p><code>fas1&gt; df -Ah aggr_vm      <br />Aggregate&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; total&#160;&#160;&#160;&#160;&#160;&#160; used&#160;&#160;&#160;&#160;&#160; avail capacity       <br />aggr_vm&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 454GB&#160;&#160;&#160;&#160;&#160;&#160; 31GB&#160;&#160;&#160;&#160;&#160; 422GB&#160;&#160;&#160;&#160;&#160;&#160; 7%       <br />aggr_vm/.snapshot&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 23GB&#160;&#160;&#160;&#160; 2547MB&#160;&#160;&#160;&#160;&#160;&#160; 21GB&#160;&#160;&#160;&#160;&#160; 10% </code></p>
<p>Другая доступная нам для обзора состояния на уровне aggregate - это команда <code>aggr show_space</code></p>
<p><code>fas1&gt; aggr show_space –h aggr_vm      <br />&#160; Aggregate &#8216;aggr_vm&#8217;       <br />&#160; Total space&#160;&#160;&#160; WAFL reserve&#160;&#160;&#160; Snap reserve&#160;&#160;&#160; Usable space&#160;&#160; BSR NVLOG&#160;&#160;&#160; A-SIS       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; 531GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 53GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 23GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 454GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0KB&#160;&#160;&#160;&#160; 79MB       <br />Space allocated to volumes in the aggregate       <br />Volume&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Allocated&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Used&#160;&#160;&#160;&#160;&#160;&#160; Guarantee       <br />esx_swap&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 3103MB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 391MB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; none       <br />vm_align&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 16GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 16GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; none       <br />p1newDataStore&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 6190MB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 6073MB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; none       <br />misc&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5817MB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 248MB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; none       <br />Aggregate&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Allocated&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Used&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Avail       <br />Total space&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 31GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 22GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 422GB       <br />Snap reserve&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 23GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2547MB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 21GB       <br />WAFL reserve&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 53GB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5851MB&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 47GB&#160; </code></p>
<p>Как видите, тут уже видно гораздо больше деталей.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../tag/commands/index.html" rel="tag">commands</a>, <a href="../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../tag/useful.html" rel="tag">useful</a><br />					Раздел: <a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../610/trackback.html#respond" title="Комментарий к записи Полезные команды: aggr show_space">Комментарий</a>									 </div>
			</div>
	
		
		<div class="navigation">
			<div class="alignleft"><a href="page/2.html">&laquo; Previous Entries</a></div>
			<div class="alignright"></div>
		</div>
		
	
	</div>
	<div id="sidebar">
		<ul>
			
			
			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Автор</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			<li class="pagenav"><h2>Страницы</h2><ul><li class="page_item page-item-153"><a href="../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul></li>
			<li><h2>Рубрики</h2>
				<ul>
					<li class="cat-item cat-item-89 current-cat"><a href="index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;">commands</a>
</li>
	<li class="cat-item cat-item-37"><a href="../howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;">howto</a>
</li>
	<li class="cat-item cat-item-52"><a href="../justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;">justread</a>
</li>
	<li class="cat-item cat-item-51"><a href="../review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;">review</a>
</li>
	<li class="cat-item cat-item-3"><a href="../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;">techtalk</a>
</li>
	<li class="cat-item cat-item-71"><a href="../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;">tricks</a>
</li>
	<li class="cat-item cat-item-95"><a href="../utilities/index.html" title="Просмотреть все записи в рубрике &laquo;utilities&raquo;">utilities</a>
</li>
	<li class="cat-item cat-item-44"><a href="../whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;">whoisho</a>
</li>
	<li class="cat-item cat-item-1"><a href="../news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;">новости</a>
</li>
	<li class="cat-item cat-item-387"><a href="../opros.html" title="Просмотреть все записи в рубрике &laquo;опрос&raquo;">опрос</a>
</li>
	<li class="cat-item cat-item-8"><a href="../translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;">переводы</a>
</li>
	<li class="cat-item cat-item-40"><a href="../citaty/index.html" title="Просмотреть все записи в рубрике &laquo;цитаты&raquo;">цитаты</a>
</li>
				</ul>
			</li>

			<li><h2>Архивы</h2>
				<ul>
					<li><a href='../../date/2018/01.html' title='Январь 2018'>Январь 2018</a></li>
	<li><a href='../../date/2015/10.html' title='Октябрь 2015'>Октябрь 2015</a></li>
	<li><a href='../../date/2015/04.html' title='Апрель 2015'>Апрель 2015</a></li>
	<li><a href='../../date/2015/03.html' title='Март 2015'>Март 2015</a></li>
	<li><a href='../../date/2015/01.html' title='Январь 2015'>Январь 2015</a></li>
	<li><a href='../../date/2014/12.html' title='Декабрь 2014'>Декабрь 2014</a></li>
	<li><a href='../../date/2014/11.html' title='Ноябрь 2014'>Ноябрь 2014</a></li>
	<li><a href='../../date/2014/10.html' title='Октябрь 2014'>Октябрь 2014</a></li>
	<li><a href='../../date/2014/09.html' title='Сентябрь 2014'>Сентябрь 2014</a></li>
	<li><a href='../../date/2014/08.html' title='Август 2014'>Август 2014</a></li>
	<li><a href='../../date/2014/07.html' title='Июль 2014'>Июль 2014</a></li>
	<li><a href='../../date/2014/06.html' title='Июнь 2014'>Июнь 2014</a></li>
	<li><a href='../../date/2014/05.html' title='Май 2014'>Май 2014</a></li>
	<li><a href='../../date/2014/04.html' title='Апрель 2014'>Апрель 2014</a></li>
	<li><a href='../../date/2014/03.html' title='Март 2014'>Март 2014</a></li>
	<li><a href='../../date/2014/02.html' title='Февраль 2014'>Февраль 2014</a></li>
	<li><a href='../../date/2014/01.html' title='Январь 2014'>Январь 2014</a></li>
	<li><a href='../../date/2013/12.html' title='Декабрь 2013'>Декабрь 2013</a></li>
	<li><a href='../../date/2013/11.html' title='Ноябрь 2013'>Ноябрь 2013</a></li>
	<li><a href='../../date/2013/10.html' title='Октябрь 2013'>Октябрь 2013</a></li>
	<li><a href='../../date/2013/09.html' title='Сентябрь 2013'>Сентябрь 2013</a></li>
	<li><a href='../../date/2013/08.html' title='Август 2013'>Август 2013</a></li>
	<li><a href='../../date/2013/07.html' title='Июль 2013'>Июль 2013</a></li>
	<li><a href='../../date/2013/06.html' title='Июнь 2013'>Июнь 2013</a></li>
	<li><a href='../../date/2013/05.html' title='Май 2013'>Май 2013</a></li>
	<li><a href='../../date/2013/04.html' title='Апрель 2013'>Апрель 2013</a></li>
	<li><a href='../../date/2013/03.html' title='Март 2013'>Март 2013</a></li>
	<li><a href='../../date/2013/02.html' title='Февраль 2013'>Февраль 2013</a></li>
	<li><a href='../../date/2013/01.html' title='Январь 2013'>Январь 2013</a></li>
	<li><a href='../../date/2012/12.html' title='Декабрь 2012'>Декабрь 2012</a></li>
	<li><a href='../../date/2012/11.html' title='Ноябрь 2012'>Ноябрь 2012</a></li>
	<li><a href='../../date/2012/10.html' title='Октябрь 2012'>Октябрь 2012</a></li>
	<li><a href='../../date/2012/09.html' title='Сентябрь 2012'>Сентябрь 2012</a></li>
	<li><a href='../../date/2012/08.html' title='Август 2012'>Август 2012</a></li>
	<li><a href='../../date/2012/07.html' title='Июль 2012'>Июль 2012</a></li>
	<li><a href='../../date/2012/06.html' title='Июнь 2012'>Июнь 2012</a></li>
	<li><a href='../../date/2012/05.html' title='Май 2012'>Май 2012</a></li>
	<li><a href='../../date/2012/04.html' title='Апрель 2012'>Апрель 2012</a></li>
	<li><a href='../../date/2012/03.html' title='Март 2012'>Март 2012</a></li>
	<li><a href='../../date/2012/02.html' title='Февраль 2012'>Февраль 2012</a></li>
	<li><a href='../../date/2012/01.html' title='Январь 2012'>Январь 2012</a></li>
	<li><a href='../../date/2011/12.html' title='Декабрь 2011'>Декабрь 2011</a></li>
	<li><a href='../../date/2011/11.html' title='Ноябрь 2011'>Ноябрь 2011</a></li>
	<li><a href='../../date/2011/10/index.html' title='Октябрь 2011'>Октябрь 2011</a></li>
	<li><a href='../../date/2011/09/index.html' title='Сентябрь 2011'>Сентябрь 2011</a></li>
	<li><a href='../../date/2011/08.html' title='Август 2011'>Август 2011</a></li>
	<li><a href='../../date/2011/07/index.html' title='Июль 2011'>Июль 2011</a></li>
	<li><a href='../../date/2011/06/index.html' title='Июнь 2011'>Июнь 2011</a></li>
	<li><a href='../../date/2011/05/index.html' title='Май 2011'>Май 2011</a></li>
	<li><a href='../../date/2011/04/index.html' title='Апрель 2011'>Апрель 2011</a></li>
	<li><a href='../../date/2011/03/index.html' title='Март 2011'>Март 2011</a></li>
	<li><a href='../../date/2011/02.html' title='Февраль 2011'>Февраль 2011</a></li>
	<li><a href='../../date/2011/01.html' title='Январь 2011'>Январь 2011</a></li>
	<li><a href='../../date/2010/12.html' title='Декабрь 2010'>Декабрь 2010</a></li>
	<li><a href='../../date/2010/11/index.html' title='Ноябрь 2010'>Ноябрь 2010</a></li>
	<li><a href='../../date/2010/10/index.html' title='Октябрь 2010'>Октябрь 2010</a></li>
	<li><a href='../../date/2010/09/index.html' title='Сентябрь 2010'>Сентябрь 2010</a></li>
	<li><a href='../../date/2010/08.html' title='Август 2010'>Август 2010</a></li>
	<li><a href='../../date/2010/07/index.html' title='Июль 2010'>Июль 2010</a></li>
	<li><a href='../../date/2010/06.html' title='Июнь 2010'>Июнь 2010</a></li>
	<li><a href='../../date/2010/05.html' title='Май 2010'>Май 2010</a></li>
	<li><a href='../../date/2010/04/index.html' title='Апрель 2010'>Апрель 2010</a></li>
	<li><a href='../../date/2010/03/index.html' title='Март 2010'>Март 2010</a></li>
	<li><a href='../../date/2010/02.html' title='Февраль 2010'>Февраль 2010</a></li>
	<li><a href='../../date/2010/01.html' title='Январь 2010'>Январь 2010</a></li>
	<li><a href='../../date/2009/12/index.html' title='Декабрь 2009'>Декабрь 2009</a></li>
	<li><a href='../../date/2009/11/index.html' title='Ноябрь 2009'>Ноябрь 2009</a></li>
	<li><a href='../../date/2009/10.html' title='Октябрь 2009'>Октябрь 2009</a></li>
	<li><a href='../../date/2009/09.html' title='Сентябрь 2009'>Сентябрь 2009</a></li>
	<li><a href='../../date/2009/08/index.html' title='Август 2009'>Август 2009</a></li>
	<li><a href='../../date/2009/07/index.html' title='Июль 2009'>Июль 2009</a></li>
	<li><a href='../../date/2009/06.html' title='Июнь 2009'>Июнь 2009</a></li>
	<li><a href='../../date/2009/05.html' title='Май 2009'>Май 2009</a></li>
	<li><a href='../../date/2009/04.html' title='Апрель 2009'>Апрель 2009</a></li>
	<li><a href='../../date/2009/03.html' title='Март 2009'>Март 2009</a></li>
	<li><a href='../../date/2009/02.html' title='Февраль 2009'>Февраль 2009</a></li>
	<li><a href='../../date/2009/01.html' title='Январь 2009'>Январь 2009</a></li>
	<li><a href='../../date/2008/12.html' title='Декабрь 2008'>Декабрь 2008</a></li>
	<li><a href='../../date/2008/11.html' title='Ноябрь 2008'>Ноябрь 2008</a></li>
	<li><a href='../../date/2008/10.html' title='Октябрь 2008'>Октябрь 2008</a></li>
	<li><a href='../../date/2008/09.html' title='Сентябрь 2008'>Сентябрь 2008</a></li>
	<li><a href='../../date/2008/08.html' title='Август 2008'>Август 2008</a></li>
	<li><a href='../../date/2008/03.html' title='Март 2008'>Март 2008</a></li>
	<li><a href='../../date/2008/02.html' title='Февраль 2008'>Февраль 2008</a></li>
	<li><a href='../../date/2007/12.html' title='Декабрь 2007'>Декабрь 2007</a></li>
	<li><a href='../../date/2007/11.html' title='Ноябрь 2007'>Ноябрь 2007</a></li>
	<li><a href='../../date/2007/10.html' title='Октябрь 2007'>Октябрь 2007</a></li>
	<li><a href='../../date/2007/09.html' title='Сентябрь 2007'>Сентябрь 2007</a></li>
	<li><a href='../../date/2007/08.html' title='Август 2007'>Август 2007</a></li>
	<li><a href='../../date/2007/07/index.html' title='Июль 2007'>Июль 2007</a></li>
	<li><a href='../../date/2007/06.html' title='Июнь 2007'>Июнь 2007</a></li>
	<li><a href='../../date/2007/05.html' title='Май 2007'>Май 2007</a></li>
				</ul>
			</li>

			
					</ul>
	</div>

</div> <!-- wrapper -->
<div id="footer">
	<a href="../../../feed">Entries (RSS)</a> and <a href="../../../comments/feed">Comments (RSS)</a>. Valid <a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional"><abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a> and <a href="http://jigsaw.w3.org/css-validator/check/referer"><abbr title="Cascading Style Sheets">CSS</abbr></a>.<br />
	Powered by <a href="http://wordpress.org/" title="Powered by WordPress.">WordPress</a> and <a href="http://srinig.com/wordpress/themes/fluid-blue/">Fluid Blue theme</a>.<br />
	<!-- 17 queries. 0.098 seconds. -->
	</div>
</div> <!-- page -->
</body>
</html>
