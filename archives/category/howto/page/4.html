<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>about NetApp   &raquo; howto</title>

<link rel="stylesheet" href="../../../../wp-content/themes/fluid-blue/style.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../wp-content/themes/fluid-blue/print.css" type="text/css" media="print" />
<link rel="alternate" type="application/rss+xml" title="about NetApp RSS Feed" href="../../../../feed" />
<link rel="pingback" href="../../../../xmlrpc.php.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 2.6" />

</head>

<body>
<div id="page">
<div id="header">
	<div id="headertitle">
		<h1><a href="../../../../index.html" title="about NetApp: Системы хранения данных как предмет разговора">about NetApp</a></h1>
		<p>Системы хранения данных как предмет разговора</p>
	</div> 
	<!-- Search box (If you prefer having search form as a sidebar widget, remove this block) -->
	<div class="search">
		<form method="get" id="searchform" action="../../../../index.html">
<input type="text" size="20" name="s" id="s" value="Поиск..."  onblur="if(this.value=='') this.value='Поиск...';" onfocus="if(this.value=='Поиск...') this.value='';"/>
</form>
	</div> 
	<!-- Search ends here-->
		
</div>

<div id="navbar">
<ul id="nav">
	<li><a href="../../../../index.html">Home</a></li>
	<li class="page_item page-item-153"><a href="../../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul>
</div>
<div id="wrapper">

	<div id="content">

	
			<p>Archive for the &#8216;howto&#8217; Category.</p>

 				
		<div class="navigation">
			<div class="alignleft"><a href="5.html">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="3.html">Next Entries &raquo;</a></div>
		</div>

						
			<div class="post" id="post-1151">
				<h2 class="posttitle"><a href="../../../1151/trackback.html" rel="bookmark" title="Permanent Link to VMware и использование NFS: часть 1">VMware и использование NFS: часть 1</a></h2>
				<div class="postmetadata">7 Май 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Как вы знаете, я убежденный сторонник того, что системы хранения NetApp – это лучший выбор для использования в среде серверной и десктопной вируализации. А для самой этой виртуализации – использование протокола NFS, который для систем NetApp, более чем родной, в свою очередь, лучший способ подключить дисковое хранилище. Со мной согласны <a href="../../../992/trackback.html">уже 36% пользователей систем виртуализации</a> (согласно отчету Forrester за май прошлого года), причем процент использования NFS растет, и уже превысил процент использования iSCSI (23%) на этих задачах.</p>
<p>Я уже не раз писал в этом блоге про различные аспекты использования NFS (посмотрите старые статьи по <a href="../../../tag/nfs/index.html">тегу NFS</a>), и даже переводил на этут тему Best Practices (про <a href="../../../632/trackback.html">Ethernet Storage</a> вообще и <a href="../../../591/trackback.html">про VMware</a> в частности), однако все это были разрозненные публикации “к случаю”. Мне захотелось собрать основные темы вопроса в одном месте, и обсудить их, наконец, “раз и навсегда”, или пока тема не изменилась значительно.</p>
<p>Но для начала несколько вводных слов, для тех, только что подключился к блогу.</p>
<p><strong>NFS</strong> (Network File System) – это протокол “сетевой файловой системы” разработанной компанией Sun в глубокой исторически-компьютерной древности, и предназначенный для доступа к данным в файлах по сети, в том числе для совместного доступа к ним от нескольких клиентов. NFS, вследствие своей сравнительной простоты реализации, стал очень популярным в UNIX-мире, где работу по NFS поддерживают практически любые OS. Несмотря на то, что сегодня “файловой системой” обычно принято называть нечто иное, за протоколом доступа к файлам по сети, NFS, исторически закрепилось название “файловая система”.&#160; С момента своего изобретения, NFS прошел большой путь, и на сегодня достиг версии 4.2, обретя множество важных на сегодня возможностей, таких как использование не только UDP, как первоначально в исходной версии протокола, но и TCP (в v3), улучшенные технологии разграничения доступа и безопасности (v4), поддержка распределенных кластерных и объектных хранилищ (v4.1) и различные методы offload-а (v4.2).</p>
<p>К сожалению, за NFS водится два своеобразных недостатка. Во-первых, он так и не появился в OS семейства Windows (если не считать крайне проблемной реализации, вышедшей в составе продуктов MS Services for UNIX) и остался “чужим и непонятным” для win-админов. ?? второе, но более важное, не все его реализации “одинаково полезны”. Многие пользователи, познакомившиеся с NFS через имеющую кучу проблем с производительностью и стабильностью, широкораспространенной реализацией в Vanilla Linux, считают, что “весь NFS такой, глючный, тормозной, для продакшна не пригодный”. А это не так.</p>
<p>В третьих, наконец, вокруг NFS, и особенностей его работы, циркулирует множество различных недопониманий, вдобавок помноженных на специфики реализаций и долгий исторический путь от версии к версии. Вот разбором этих недопониманий мы и займемся для начала. Напомню, я не стану обнимать необъятное, и сосредоточусь только лишь на использовании NFS в VMware.</p>
<p>А теперь <strong>о достоинствах</strong>. Во-первых следует отметить сравнительную простоту использования NFS. Его <strong>использование не требует внедрения и освоения сложной, особенно для новичка, FC-инфраструктуры</strong>, непростых процессов настроек зонинга, или разбирательства с iSCSI. ??спользовать NFS для доступа к датастору также просто и тем, что <strong>гранулярность хранения при этом равна файлу VMDK, а не целиком датастору</strong>, как в случае блочных протоколов. Датастор NFS это обычная монтируемая на хост сетевая “шара” с файлами дисков виртуальных машин и их конфигами. Это, в свою очередь, облегчает, например, резервное копирование и восстановление, так как единицей копирования и восстановления является простой файл, отдельный виртуальный диск отдельной виртуальной машины. Нельзя сбрасывать со счетов и то, что при использовании NFS <strong>вы “автоматически” получаете thin provisioning</strong>, а <strong>дедупликация высвобождает вам пространство непосредственно на уровень датастора</strong>, оно становится доступно непосредственно администратору и пользователям VM, а не на уровень стораджа, как в случае использования LUN-а. Это все также выглядит крайне привлекательно с точки зрения использования виртуальной инфраструктуры.</p>
<p>Наконец, используя датастор по NFS, <strong>вы не ограничены лимитом в 2TB</strong>, даже с VMFS ранее 5, а это очень полезно, например, если вам приходится администрировать большое количество сравнительно слабонагруженных вводом-выводом машин. ??х всех можно поместить на один большой датастор, бэкапить, и управлять которым гораздо проще, чем десятком разрозненных VMFS LUN-ов по 2TB(-512bytes) каждый.</p>
<p>Кроме того, <strong>вы можете свободно не только увеличивать, но и уменьшать датастор</strong>. Это может быть очень полезной возможностью для динамичной инфраструтуры, с большим количеством разнородных VM, таких как, например, среды облачных провайдеров, где VM постоянно создаются и&#160; удаляются, и данный конкретный датастор, для размещения этих VM, может не только расти, но и, часто, уменьшаться.</p>
<p>Однако, какие у нас имеются минусы?</p>
<p>Ну, во-первых, это <strong>невозможность использовать RDM</strong> (Raw-device mapping), который может понадобиться, например, для реализации кластера MS Cluster Service, если вы его хотите использовать. <strong>С NFS нельзя загрузиться</strong> (по крайней мере простым и обычным способом, типа boot-from-SAN). <strong>??спользование NFS сопряжено с некоторым увеличением нагрузки на сторадж</strong>, так как ряд операций, которые, в случае блочного SAN, реализуются на стороне хоста, в случае NFS поддерживатся стораджем. Это всяческие блокировки, разграничение доступа, и так далее. Однако, практика показывает, что <a href="http://media.netapp.com/documents/tr-3808.pdf">оверхед отражается на производительности крайне незначительно</a>.</p>
<p>Большим плюсом использования NFS на стораджах NetApp является то, что выбор NFS там не диктует вам “жесткого выбора” для вашей инфраструктуры в целом. Если вам понадобится также и блочный протокол для RDM, или для крайне критичной даже к <em>возможному</em> 10-15% падению производительности виртуальной машины, вы можете использовать для нее iSCSI или даже FCP, все на том же сторадже, параллельно с NFS, и всеми его плюсами, для основного датастора.</p>
<p>В следующем посте этой серии мы перейдемь к разбирательству основных недопониманий и мифов, которые имеются вокруг использования NFS в VMware.</p>
<p>Рекомендуется также почитать по теме:</p>
<ul>
<li>VMware: <a href="http://vmware.com/files/pdf/VMware_NFS_BestPractices_WP_EN.pdf">Best Practices for running VMware vSphere on Network Attached Storage</a></li>
<li>NetApp (RU): <a href="http://netwell.ru/docs/netapp/TR-3749_Rus_NetApp_VMware_vSphere_v5.0/tr-3749_rus_netapp_vmware_vsphere_v5.0.pdf">Руководство по наилучшим способам использования систем NetApp        <br />с VMware vSphere</a></li>
<li>NetApp (RU): <a href="http://www.netwell.ru/docs/netapp/tr-3839_vmware_nfs.pdf">??спользование NFS в VMware</a></li>
<li>NetApp (RU): <a href="http://www.netwell.ru/docs/netapp/rus_tr-3802_ethernet_storage_bp.pdf">Ethernet для систем хранения: наилучшие методы</a></li>
<li>NetApp (EN): <a href="http://media.netapp.com/documents/tr-3880.pdf">tr-3880 CLI Configuration Processes for NetApp and VMware vSphere.pdf</a></li>
<li>NetApp (EN): <a href="http://media.netapp.com/documents/tr-3697.pdf">tr-3697 Multiprotocol Performance Test of VMware ESX 3.5 on NetApp</a></li>
<li>NetApp (EN): <a href="http://media.netapp.com/documents/tr-3808.pdf">tr-3808 VMware vSphere 4.1 and ESX 3.5 Multiprotocol Performance Comparison Using FC iSCSI and NFS</a></li>
</ul>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/nfs/index.html" rel="tag">nfs</a>, <a href="../../../tag/vmware/index.html" rel="tag">vmware</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>,  <a href="../../whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;" rel="category tag">whoisho</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1151/trackback.html#comments" title="Комментарий к записи VMware и использование NFS: часть 1">Комментарии (10)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1132">
				<h2 class="posttitle"><a href="../../../1132/trackback.html" rel="bookmark" title="Permanent Link to Запускаем новую систему хранения. Часть 2.">Запускаем новую систему хранения. Часть 2.</a></h2>
				<div class="postmetadata">26 Март 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Что-то как-то не получилось у меня опубликовать вторую часть &quot;на следующей неделе&quot;, как я было пообещал в конце <a href="../../../916/trackback.html">части первой</a>. Так получилось, что я понял, что статья получается объемной, многие вещи требуют &quot;экскурса и дискурса&quot;, а объяснить на пальцах понятно их не получается. Но когда я начал регулярно находить в поиске запросы &quot;запускаем новую систему хранения часть 2 site:blog.aboutnetapp.ru&quot;, я понял, что тянуть дальше нельзя.</p>
<p>Посему, вот вам вторая, а еще, может быть, даже и третья далее часть.</p>
<p>Остановились мы в прошлый раз на процедуре начального запуска. Железка поставлена в стойку, ей задан IP для конфигурирования, и проведена самая первая, базовая настройка только полученной системы, к ней уже можно подключиться с помощью System Manager, через веб-интерфейс, или же простой консолью по COM-порту или телнетом по сети.</p>
<p>Далее нам надо сконфигурировать собственно объем хранения. ?? тут есть некоторая сложность, о которой я сейчас попробую в общих чертах рассказать.</p>
<p>Я уже писал в этом блоге об одной особенности двухконтроллерных систем хранения NetApp, особенности, с которой часто сталкиваются начинающие, особенно если ранее он не имели дела с такими системами, и с такой организацией дисков.</p>
<p>Дело в том, что системы хранения NetApp в двухконтроллерной конфигурации High Available Cluster (HA-cluster, в дальнейшем) используют модель работы &quot;share nothing&quot;, и, согласно ей, не используют диски совместно. Каждый из двух контроллеров системы хранения <strong>должен</strong> владеть своим набором дисков. То есть имеющееся количество дисков <strong>должно</strong> быть между ними поделено (поровну или нет - об этом далее). Доступ к дискам возможен только через владеющий ими контроллер, и никак иначе.</p>
<p>Конечно, в случае выхода из строя контроллера, как и полагается для HA-кластера, второй, выживший контроллер, перехватит на себя диски вышедшего из строя, но только в случае неработоспособности, выхода из строя контроллера. Когда контроллер работает нормально, то доступ к дискам, &quot;приписанным&quot; к нему, осуществляется <strong>только через работающий контроллер-владелец</strong> . Это необходимо для правильного диспетчерирования запросов чтения и записи данных с дисков.</p>
<p>Да, обратившись к &quot;не тому&quot; контроллеру вы, конечно, можете получить данные с дисков, приписанных другому контроллеру, но для этого &quot;ваш&quot; контроллер должен обратиться к &quot;тому&quot; контроллеру, чтобы он прочел и передал &quot;этому&quot; запрошенные данные по внутренней шине, а потом &quot;этот&quot; отдаст их вам. Это <a href="../../../971/trackback.html">неоптимальный путь доступа</a>, о котором сторадж вам сообщит в логах, и который иногда встречается при неправильной настройке, и о том, что с этим делать и как исправить я уже писал в блоге ранее.</p>
<p>Так что, в общем случае, вы можете вообразить себе двухконтроллерную систему NetApp как <strong>два</strong> отдельных (пусть и связанных) файловых сервера NAS, например, каждый со своим набором ресурсов, каждый со своим IP-адресом, по которому происходит обращение, и так далее. В случае SAN это также происходит сходным образом.</p>
<p>??з этого следует, что, по сути, в случае двухконтроллерного NetApp FAS2020 вы получаете не одну систему хранения на 12 дисков, а <strong>две на 6 дисков каждая</strong> (или 3 и 9 дисков, или 5 и 7 дисков, но всегда две). ?? это довольно существенный момент, который требует осознания. Более того, нельзя отдать одному контроллеру все 12 дисков (это можно в случае одноконтроллерной системы, но не двухконтроллерной, в которой второй контроллер <strong>требует</strong> наличия хотя бы одной RAID-группы минимального размера (2 диска в RAID-4) и хотя бы одного hotspare, так как на этой группе он должен записать свои собственные конфигурационные данные, иначе он не сможет загрузиться, просто не с чего.</p>
<p>Тему с разбиением дисков по контроллерам, и выбором между равным и неравным разбиением дисков я уже <a href="../../../321/trackback.html">затрагивал в этом блоге</a>, поэтому интересующихся отошлю к более ранним статьям.</p>
<p>Сейчас же мы перейдем к конфигурированию.</p>
<p>??так, мы, руководствуясь частью первой установили систему физически и провели первое включение. Теперь, если вы посмотрите на видимые системе диски, вы увидите, что каждому контроллеру доступен свой набор дисков. Скорее всего вы получите с завода систему, сконфгурированую в виде 5 дисков доступных одному контроллеру и 7 - другому (по крайней мере я видел именно такой вариант поставки FAS2020A).</p>
<p>Если вы читаете этот блог давно, то уже знаете, что такое у NetApp так называемый <a href="../../../709/trackback.html">aggregate</a>. Это структура, в которую включаются физические диски, приписанные одному контроллеру, и которая объединяет RAID-группы, к созданию которых администратор системы хранения не имеет непосредственного доступа. Поверх структуры aggregate уже располагаются непосредственно тома (volumes типа FlexVol), на томах qtrees и в них, или непосредственно на томах - LUN-ы, если вы используете NetApp как SAN-сторадж, или же network shares, если используете его как NAS. В общем яйцо в утке, утка в зайце, заяц в сундуке :)</p>
<p>Но в основе всего - aggregate. Несмотря на то, что в системах NetApp осталась legacy-возможность использовать &quot;классические&quot; RAID, это осталось &quot;для совместимости&quot;, и нет совсем никаких причин этим пользоваться сегодня.</p>
<p>Будем пользоваться FlexVol и aggregates.</p>
<p>Два основных преимущества aggregate и его использования заключается, во-первых, что при этом операции ввода-вывода распределяются равномерно по всем входящим в него дискам, даже если вы используете маленький том на несколько десятков мегабайт, или несколько таких томов, то все они будут физически &quot;размазаны&quot; по всем дискам aggregate, с соответствующим положительным эффектом на их быстродействие. ??, во-вторых, он позволяет создавать тома произвольного размера, отвязавшись от размеров физических дисков и RAID-групп.</p>
<p>??з пункта 1 следует естественный вывод, делать как можно большие аггрегейты, из максимально доступного количества дисков. </p>
<p>В некоторых руководствах NetApp, ориентированных, прежде всего, на большие системы с сотнями дисков, вы можете встретить рекомендации создавать более одного aggregate, например выделять на отдельный aggregate так называемый root volume, на котором находится директория /etc внутренней файловой системы и ее настройки, а также создавать отдельные aggregate для сильно различных видов паттерна нагрузки (например отделять базу данных, с обычно random read/write access, от ее логов, с sequental write), но это рекомендации, повторюсь, для &quot;хайэнда&quot;, для систем с сотнями дисков, когда эти рекомендации действительно дают заметный эффект. Если вы запускаете систему с количеством дисков в пределах пары десятков, безусловно наилучшим выбором будет помещать все диски в один большой aggregate, где будут находиться все тома пользователя, включая и root vol. Дробя диски по нескольким aggregates при небольшом количестве этих дисков, следуя рекомендациям для &quot;старших&quot; систем, вы скорее ухудшите ситуацию, уменьшив количество дисков, по которым удастся размазать ввод-вывод, чем улучшите его изолируя трафики.</p>
<p>Поэтому решим использовать один aggregate на контроллер (соответственно, два на кластерную пару, по одному на каждый контроллер). Поскольку вы систему уже запустили, этот aggregate у вас уже создан, на нем помещен системой root volume.</p>
<p>Обычно он называется aggr0, и я предлагаю, если у вас остались невключенные в него диски, добавить их в него командой aggr add (диски). Сделайте то же самое на втором контроллере.</p>
<p>Сейчас структура данных на вашей системе хранения выглядит так:</p>
<p>Обычно том vol0, в котором по умолчанию располагается root vol и директория /etc с настройками внутренней OS Data ONTAP делается с большим запасом. Если вам жалко места, то можете безопасно уменьшить размеры тома vol0, например для различных версий Data ONTAP и разных систем рекомендуется его размер от 10GB для FAS2020, 16GB для FAS2040 (для Data ONTAP 7.x), и до 250GB для старших систем под версией 8.х OS Data ONTAP.</p>
<p>На root vol, кроме настроек, также хранятся прошивки полок и дисков, обновляемые автоматически, а также должно быть место для аварийного сброса kernel dump в случае каких-то нештатных ситуаций.</p>
<p>Все же остальное место на aggregate, за вычетом примерно 10%, которые рекомендуется не занимать для облегчения жизни внутренних процессов и правильной и беспроблемной работы, например, фонового оптимизатора структур WAFL, можно использовать под хранения ваших данных в одном или нескольких томах. Хотя размер тома можно задать и сразу, во многих случаях имеет смысл настроить его на автоматическое увеличение, тогда том будет автоматически расти, по мере заполнения его данными, пока хватит места на хранящем его aggregate, а свободное место не будет заниматься на &quot;хранение нулей&quot;, если вы можете отдать его более нуждающимся задачам. Эта настройка называется space reservation (none или file), а возможность автоматического роста тома - volume autogrowth, которую можно задать с желаемым шагом приращения.</p>
<p>Нельзя сказать, что я открыл вам все серветы и тайны конфигурирования NetApp, но, с имеющимся базисом и дружа с документацией, вы уже сможете самостоятельно запустить систему хранения.</p>
<p>А в следующей части мы рассмотрим как создавать сетевые ресурсы для NAS и LUN-ы для SAN.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/aggregate.html" rel="tag">aggregate</a>, <a href="../../../tag/configure.html" rel="tag">configure</a>, <a href="../../../tag/install.html" rel="tag">install</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/setup.html" rel="tag">setup</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1132/trackback.html#comments" title="Комментарий к записи Запускаем новую систему хранения. Часть 2.">Комментарии (7)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1131">
				<h2 class="posttitle"><a href="../../../1131/trackback.html" rel="bookmark" title="Permanent Link to Как изменить пороги для уведомлений SNMP о заполненности тома?">Как изменить пороги для уведомлений SNMP о заполненности тома?</a></h2>
				<div class="postmetadata">22 Март 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>По умолчанию, Data&#160; ONTAP генерирует уведомление (trap) в SNMP, а также записывает сообщение в логах, когда заполненность тома превышает пороговую величину. По умолчанию существует два порога: “Nearly Full” и “Full”. Первый по умолчанию установлен на значение 95%, а второй – на 98% от емкости тома.</p>
<p>Вы можете изменить эти значения, или же вовсе выключить их. Например, иногда это бывает полезным, если у вас на томе располагается один space-reserved SAN LUN, и он занимает практически все пространство тома, но не растет, поэтому уведомление о том, что ваш том “всегда полон” не несет полезной информации, а только загромождает логи.</p>
<p>Для того, чтобы именить значения порогов на нужные вам, надо сделать следующее:</p>
<p>Войдем в режим повышенных привилегий:</p>
<p><code>netapp&gt; priv set advanced      <br />netapp*&gt;</code></p>
<p><strong>Будьте внимательны, в режиме повышенных привилегий вам становятся доступны некоторые команды, потенциально способные серьезно повредить данные! </strong>Нахождение в повышенному уровне привилегий индицирут звездочка в системном “промпте”.</p>
<p>Установим нужные нам значения. Например, пусть это будут 85% и 99%. <strong>Помните, что баловаться с системным реестром в Data ONTAP также опасно, как и с реестром Windows!</strong></p>
<p><code>netapp*&gt; registry set options.thresholds.fsFull 99      <br />netapp*&gt; registry set options.thresholds.fsNearlyFull 85</code></p>
<p>Можно и вовсе выключить эти уведомления, задав заведомо недостижмый уровень заполнения, больше 100%, например – 101%</p>
<p><code>netapp*&gt; registry set options.thresholds.fsFull 101      <br />netapp*&gt; registry set options.thresholds.fsNearlyFull 101</code></p>
<p>Обратите внимание, что парамеры fsFull и fsNearlyFull – чувствительны к регистру.</p>
<p>Проверим, что все установилось так, как мы хотели:</p>
<p><code>netapp*&gt; registry walk options.thresholds </code></p>
<p>Вернемся в стандартный уровень привилегий:</p>
<p><code>netapp*&gt; priv set      <br />netapp&gt;</code></p>
<p>Готово. Теперь Data ONTAP будет генерировать SNMP traps о заполнении тома по достижении заданных нами величин (или не генерировать их вовсе, если мы их установили на 101%).</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/registry.html" rel="tag">registry</a>, <a href="../../../tag/snmp.html" rel="tag">snmp</a>, <a href="../../../tag/threshold.html" rel="tag">threshold</a>, <a href="../../../tag/trap.html" rel="tag">trap</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1131/trackback.html#comments" title="Комментарий к записи Как изменить пороги для уведомлений SNMP о заполненности тома?">1 комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1117">
				<h2 class="posttitle"><a href="../../../1117/trackback.html" rel="bookmark" title="Permanent Link to Снэпшоты в DOT8.x Cluster-mode">Снэпшоты в DOT8.x Cluster-mode</a></h2>
				<div class="postmetadata">9 Февраль 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Также как и в Data ONTAP 7-mode, в Cluster-mode с версии 8.1 есть снэпшоты. Сохранились все привычные пользователям NetApp команды snap reserve, snap sched, snap list, но добавилось несколько новых команд и возможностей.</p>
<p><img src="https://communities.netapp.com/servlet/JiveServlet/showImage/38-7858-14445/fig1.PNG" /></p>
<p>Также добавились некоторые дополнительные опции в некоторых командах</p>
<p><img src="https://communities.netapp.com/servlet/JiveServlet/showImage/38-7858-14446/fig2.PNG" /></p>
<p>Также есть изменения и в способе задания распсания снэпшотов. Если раньше это делалось командой snap sched, указывалост имя тома и задавались интервалы в формате cron, то новый механизм использует политики (policy), которые управляются командами add-schedule, modify-schedule и remove-schedule. Для создания же новой политики взятия снэпшотов воспользуйтесь командой snap policy create.</p>
<p><img src="https://communities.netapp.com/servlet/JiveServlet/showImage/38-7858-14447/fig3.PNG" /></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/81.html" rel="tag">8.1</a>, <a href="../../../tag/cluster-mode/index.html" rel="tag">cluster-mode</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/snapshots.html" rel="tag">snapshots</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;" rel="category tag">review</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1117/trackback.html#respond" title="Комментарий к записи Снэпшоты в DOT8.x Cluster-mode">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1116">
				<h2 class="posttitle"><a href="../../../1116/trackback.html" rel="bookmark" title="Permanent Link to ??звлечение данных о Busy Spindles из вывода stats">??звлечение данных о Busy Spindles из вывода stats</a></h2>
				<div class="postmetadata">2 Февраль 2012, 10:31 <!-- от  --></div>
				<div class="postentry">
					<p>Я уже упоминал, что в Data ONTAP есть очень полезная команда stats, с помошью котрой можно вывести массу информации о работе системы. К сожалению, формат вывода ее “человеконечитаемый”, в большинстве случаев, поэтому для того, чтобы извлечь из ее вывода что-нибудь полезное, приходится предпринять некоторые усилия.</p>
<p>Так, например, довольно интересной задачей яляется поиск и вывод так наываемых busy spindles, или физических дисков, нагрузка по вводу-выводу на которые превышает норму по аггрегейту. Такое случается иногда при несбалансированности aggregate, например, чаще всего, при добавении дисков, которые, в ряде случаев, могут потребовать “рестрайпинга данных”.</p>
<p>В community.netapp.com я увидел интересную строчку для использования в скрипте вывода такой информации:</p>
<p><code>watch -n 3 &quot;ssh NetAppHost stats show disk:\*:disk_busy | awk '{FS=\&quot;:\&quot;; print \$1 \&quot; \&quot; \$2 \&quot; \&quot; \$3 \&quot; \&quot; \$13}'| sed 's/%//g' | awk '\$4&gt;40{print}'&quot;</code></p>
<p>Можете воспользоваться, кому интересно, и расскажите как работает.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/stats.html" rel="tag">stats</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1116/trackback.html#comments" title="Комментарий к записи ??звлечение данных о Busy Spindles из вывода stats">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1102">
				<h2 class="posttitle"><a href="../../../1102/trackback.html" rel="bookmark" title="Permanent Link to Как добавить &ldquo;дисков&rdquo; в Data ONTAP Simulator 8?">Как добавить &ldquo;дисков&rdquo; в Data ONTAP Simulator 8?</a></h2>
				<div class="postmetadata">22 Декабрь 2011, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Когда вы поставили и запустили симулятор Data ONTAP 8, вы увидите, что он идет с 28 (2х14) “дисками”, размером 1GB. Этого в общем вполне достаточно для большинства целей использования, однако, если вам потребуется больше дисков, вы можете увеличить их количество (но не размер!) до 56 штук. Обратите внимание, что вы не можете увеличить размер дисков, он для симулятора не может превышать 1GB. Ну… например чтобы не было соблазна устраивать из не предназначенного для этого симулятора бесплатный “виртуальный сторадж” ;). Как говорил один большой друг СССР – “Doverjai no proverjai!” ;)</p>
<p>Но сперва стоит немного остановится на некоторых деталях.</p>
<p>В отличие от Data ONTAP 7, в версии 8 появился специальный user-mode shell (консоль админа, несмотря на внешнюю схожесть, шеллом как таковым не является). Он доступен для специального, отключенного в целях безопасности, пользователя diaguser.</p>
<p>Мы рассмотрим добавление дисков только для симулятора 7-Mode. Для Cluster-mode это возможно также, но чтобы не удлиннять пост я его опущу (если кому-то понадобится процедура для Cluster-mode Simulator – напишите).</p>
<p>??так, начнем с того, что разблокируем diaguser, от имени которого в шелле мы проделаем операции добавления:</p>
<p><code>priv set advanced      <br />useradmin diaguser unlock       <br />useradmin diaguser password</code></p>
<p>Теперь зайдем с systemshell этм пользователем:</p>
<p><code>systemshell      <br />login: diag       <br />password: &lt;password&gt;</code></p>
<p>Далее нам придется поправить некий глюк, допущенный при сборке утилиты управления “дисками”. Добавим символьные линки на стандартные библиотеки, а то утилита не сможет их найти:</p>
<p><code>cd /lib      <br />sudo mount -u -o rw /       <br />sudo ln -s libc.so.6 libc.so.7       <br />sudo mount -u -o ro /</code></p>
<p>Установим переменную пути:</p>
<p><code>setenv PATH &quot;${PATH}:/sim/bin&quot;      <br />echo $PATH</code></p>
<p>?? перейдем в директорию эмулированных устройств</p>
<p><code>cd /sim/dev      <br />ls ,disks/</code></p>
<p>Тут вы увидите уже созданные 28 дисков. К ним мы сейчас добавим еще 28. ??мена уже существующих файлов-дисков начинаются с v1 и v2, что означает, что они “подключены” к адаптерам v1 и v2. У нас есть еще два неиспользованных адаптера (v3 и v4), к каждому из которых мы “подключим” по 14 дисков (это похоже на то, как подключаются обычные FC-полки к адаптерам отдельной FC-“петлей”, каждая полка на 14 дисков на свой адаптер).</p>
<p>Для этого воспользуемся утилитой makedisk.main:</p>
<p><code>makedisks.main -h      <br />sudo makedisks.main -n 14 -t 23 -a 2       <br />sudo makedisks.main -n 14 -t 23 -a 3       <br />ls ,disks/</code></p>
<p>Первая команда печатает пояснение по доступным ключам. Две другие создают по 14 дисков    <br />(-n 14) с типом диска 23 (-t 23) на адаптерах 2 и 3 (-a 2 и -a 3). Симулятор Data ONTAP 8.0.1 поддерживает конструктивно только диски размером 1GB и менее. Даже если вы видите в подсказке команды диски большего размера, воздержитесь от соблазна попробовать добавить их в симулятор. С виртуальными дисками размером больше 1GB Data ONTAP упадет в panic при перезагрузке, и вам придется устанавливать симулятор заново.</p>
<p>Ну вот и все, что необходимо было сделать в шелле. Вернемся “по своим следам” из шелла в обычную админскую консоль, выйдя из шелла и запретив diaguser, перезагрузим симулятор и он увидит новые диски:</p>
<p><code>exit      <br />useradmin diaguser lock       <br />priv set admin       <br />reboot</span></code></p>
<p>После перезагрузки необходимо назначить ownership новым дискам:</p>
<p><code>disk show -n      <br />disk assign all       <br />disk show -v</code></p>
<p>Теперь у вас в симуляторе 56 “дисков” по 1GB каждый. Они уже zeroed, и вы можете непосредственно добавить их в нужный вам aggregate.</p>
<p>??сходный текст был взят тут: <a href="https://communities.netapp.com/docs/DOC-9579">https://communities.netapp.com/docs/DOC-9579</a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/801.html" rel="tag">8.0.1</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/simulator.html" rel="tag">simulator</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1102/trackback.html#comments" title="Комментарий к записи Как добавить &ldquo;дисков&rdquo; в Data ONTAP Simulator 8?">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1100">
				<h2 class="posttitle"><a href="../../../1100/trackback.html" rel="bookmark" title="Permanent Link to Data ONTAP Simulator 8.0.1: Как изменить SystemID/SerialNo?">Data ONTAP Simulator 8.0.1: Как изменить SystemID/SerialNo?</a></h2>
				<div class="postmetadata">19 Декабрь 2011, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>В ряде случаев, например когда вы планируете использовать несколько установленных симуляторов, подключенных в Operations Manager, необходимо задать каждому из этих симуляторов индивидуальный SystemID и Serial Number. В будущем в NetApp обещают генерировать при установке произвольный номер, а пока все симуляторы идут с одним. Поэтому нужно проделать небольшой трюк.</p>
<p>При начальной загрузке прервите ее и войдите в SIMLOADER.</p>
<p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="sim801_serial_change_1" border="0" alt="sim801_serial_change_1" src="/pics/Data-ONTAP-Simulator-8---SystemIDSerialN_9393/sim801_serial_change_1.png" width="725" height="503" /></p>
<p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="sim801_serial_change_2" border="0" alt="sim801_serial_change_2" src="/pics/Data-ONTAP-Simulator-8---SystemIDSerialN_9393/sim801_serial_change_2.png" width="729" height="503" /></p>
<p>Выполните там две следующие команды:</p>
<p><code>SIMLOADER&gt; set bootarg.nvram.sysid=1111111101</code>    <br /><code>SIMLOADER&gt; set SYS_SERIAL_NUM=1111111101</code></p>
<p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="sim801_serial_change_3" border="0" alt="sim801_serial_change_3" src="/pics/Data-ONTAP-Simulator-8---SystemIDSerialN_9393/sim801_serial_change_3.png" width="725" height="503" /></p>
<p>SystemID это 10-значное число. Последние две цифры должны быть уникальны в пределах Cluster-mode кластера для того, чтобы обеспечить уникальность UID дисков. Таким образом первые 8 цифр определяют кластер, а последние 2 – ноду в этом кластере. Впрочем, если вы используете симулятор только как 7-mode, вам это не важно, назначьте туда любое 10-циферное число.</p>
<p>Дайте команду:</p>
<p><code>SIMLOADER&gt; boot</code></p>
<p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="sim801_serial_change_4" border="0" alt="sim801_serial_change_4" src="/pics/Data-ONTAP-Simulator-8---SystemIDSerialN_9393/sim801_serial_change_4_3.png" width="727" height="501" /></p>
<p>Войдите в Boot Menu нажатием Ctrl-C и выберите там Maintenance mode boot</p>
<p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="sim801_serial_change_6" border="0" alt="sim801_serial_change_6" src="/pics/Data-ONTAP-Simulator-8---SystemIDSerialN_9393/sim801_serial_change_6.png" width="727" height="504" /></p>
<p>Переназначьте диски на новый SystemID, если вы уже назначили их ранее контроллеру на его прежний SystemID. Если вы делаете описываемую процедуру при самом первом старте, то переназначать диски еще не нужно, назначьте из обычным образом.</p>
<p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="sim801_serial_change_7" border="0" alt="sim801_serial_change_7" src="/pics/Data-ONTAP-Simulator-8---SystemIDSerialN_9393/sim801_serial_change_7.png" width="728" height="502" /></p>
<p>UPD: Приведенный метод, к сожалению, <strong>НЕ РАБОТАЕТ </strong>для Simulator версии <strong>8.1</strong>, он работает только для <strong>8.0.1</strong></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/801.html" rel="tag">8.0.1</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/simulator.html" rel="tag">simulator</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1100/trackback.html#comments" title="Комментарий к записи Data ONTAP Simulator 8.0.1: Как изменить SystemID/SerialNo?">1 комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1099">
				<h2 class="posttitle"><a href="../../../1099/trackback.html" rel="bookmark" title="Permanent Link to Настраиваем Data Ontap Simulator 8">Настраиваем Data Ontap Simulator 8</a></h2>
				<div class="postmetadata">12 Декабрь 2011, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>В предыдущей статье я показал, как поставить виртуальную машину, в виде которой сейчас идет симулятор 8.0.1 на сервер VMware ESX. А сейчас попробуем начать с ним работу.</p>
<p>Как я уже рассказывал в предыдущем посте, <a href="../../../40/trackback.html">Data Ontap Simulator</a> это виртуальная машина, в которой работает версия Data ONTAP 8 для выполнения в среде VM. Data ONTAP 8 базируется на OS FreeBSD, однако, вопреки распространенному (ошибочному) мнению, <a href="../../../12/trackback.html">Data ONTAP 8 это НЕ FreeBSD</a>. Это даже не программа под FreeBSD. Это самостоятельная OS, которая использует FreeBSD как загрузчик своего kernel space code, а также использует некоторые ее ресурсы, например driver model, и драйвера оборудования. Ситуация была примерно та же, что с гипервизором VMware ESX-не-i, если вы помните, там сперва грузился RedHat, под которым затем запускался как модуль собственно ESX, который уже Linux не являлся. ??менно этим объясняется то, что мы в прошлой статье создали VM типа “FreeBSD 64-bit”, действительно, сперва VM загружается с использованием loader FreeBSD, а затем использует ее драйверную модель для внешних устройств.</p>
<p>Симулятор, как я уже рассказывал выше, это полноценная версия Data ONTAP, за некоторым исключением: установлено ограничение по поддерживаемой емкости, не работает протокол FC (но работает iSCSI) и, в настоящий момент, реализована только одноконтроллерная конфигурация. Но для экспериментов и обучения этого будет вполне достаточно.</p>
<p>Давайте, для начала, отключим на симуляторе <a href="http://habrahabr.ru/company/netapp/blog/111916/">Autosupport</a>. Симулятор это экспериментальная площадка, и лучше будет не беспокоить поддержку NetApp странными сообщениями, которые будет при наших экспериментах посылать”в центр” служба Autosupport. Войдя в консоль даем команду:</p>
<p><code>options autosupport.enable off</code></p>
<p>Штатным образом Simulator приходит с набором из 28 “как-бы дисков” размером 1GB (как я уже сказал, для экспериментов этого объема достаточно). ??значально, только 3 диска назначены (assigned) контроллеру, и на них создан root volume на RAID-DP. Остальные диски помечены как unassigned. Назначим оставшиеся диски нашему симулятору:</p>
<p><code>disk assign all</code></p>
<p>Теперь добавим ключи-лицензии. Эти ключи предназначены только для симулятора, и не будут работать на физической системе. Можно установить только то, что используется на вашей продакшн-системе, или поставить дополнительные лицензии, чтобы посмотреть “что это и как работает”, или же просто все, и экспериментировать со всеми возможными фичами.</p>
<ul>
<li>a_sis MTVVGAF </li>
<li>cifs DZDACHD </li>
<li>disk_sanitization PZKEAZL </li>
<li>http NAZOMKC </li>
<li>flex_clone ANLEAZL </li>
<li>iscsi BSLRLTG </li>
<li>multistore NQBYFJJ </li>
<li>nearstore_option ELNRLTG </li>
<li>nfs BQOEAZL </li>
<li>smdomino RKBAFSN </li>
<li>smsql HNGEAZL </li>
<li>snapmanagerexchange BCJEAZL </li>
<li>snapmirror DFVXFJJ </li>
<li>snapmirror_sync XJQIVFK </li>
<li>snaprestore DNDCBQH </li>
<li>snapvalidator JQAACHD </li>
<li>sv_linux_pri ZYICXLC </li>
<li>sv_ontap_pri PVOIVFK </li>
<li>sv_ontap_sec PDXMQMI </li>
<li>sv_unix_pri RQAYBFE </li>
<li>sv_windows_ofm_pri ZOFNMID </li>
<li>sv_windows_pri ZOPRKAM </li>
<li>syncmirror_local RIQTKCL </li>
</ul>
<p>Лицензионный ключ – это 7 заглавных букв после имени функции. Для того, чтобы ввести лицензионный ключ дайте команду:</p>
<p><code>license add XXXXXXX</code></p>
<p>Допустим, мы решили оставить 3 уже назначенных диска в отдельном root aggregate (так рекомендуется по ряду причин), однако если ваша реальная система мала, то вам, возможно, не захочется терять эти 3 диска и их IOPS-ы, тогда возможен вариант с единым общим aggregate, не выделенным под root volume, а общим с пользовательстими данными. Тогда вам нужно будет создать из имеющихся дисков новый aggregate, перенести root volume на него, затем удалить старый том и aggregate, и освободившиеся 3 диска добавить к созданному вами “большому” aggregate. Как это сделать я уже <a href="../../../922/trackback.html">писал в блоге ранее</a>.</p>
<p>Если же мы собираемся оставить 3 диска root vol в отдельном aggregate, то просто создавайте новый aggregate на оставшихся 25 дисках. Однако тут имеет смысле сделать небольшие изменения в опциях системы. Дело в том, что размер RAID-группы по умолчанию в Data ONTAP равен 16 дискам (а максимальный для дисков FC, SAS и виртуальных дисков симулятора – 28). Если вы создаете большой единый aggregate на всех 25 дисках, то, при установленном размере RAID-группы равной 16, он создастся так:</p>
<p>Сперва будет взято 16 дисков, из которых 2 будут RAID-DP parity и dparity, а остальные 14 будут data в RAID-группе rg0. Затем на оставшихся будет создана вторая RAID-группа (rg1), из оставшихся 9 дисков, которые, в свою очередь, станут двумя parity и 7 data. В дальнейшем, если в aggregate добавляются новые диски они добавляются в “неполную” RAID-группу, пока она не достигнет заданного в опциях размера в 16 дисков, а следующие создадут еще одну новую “неполную” группу.</p>
<p>Логично было бы, особенно на небольшом числе дисков, не полагаться на такую автоматику, а самостоятельно расчитать и создать RAID-группы, по возможности равного размера. То есть, с точки зрения порядка, аккуратности (да и производительности) вариант 12+12+1 hot spare будет лучше, чем 16+8+1hs. А в нашем случае мы поступим еще лучше, мы просто увеличим заданный размер RAID-группы до максимума (28), или, хотя бы до 25. Тогда все наши диски поместятся в одну группу. Дадим в консоли команду:</p>
<p><code>aggr options aggr1 raidsize 28</code></p>
<p>Теперь добавим оставшиеся unassigned диски в созданный aggr0</p>
<p><code>aggr add aggr1 24</code></p>
<p>Мы оставим один диск под spare, это требование Data ONTAP. Для того, чтобы в логах не валились сообщения о нехватке spares, проверьте значение опции:</p>
<p><code>options raid.min_spare_count 1</code></p>
<p>Здесь 1 – количество spare для данного контроллера. Одного будет вполне достаточно, а при количестве дисков более 16 поставить 0 система не даст.</p>
<p>??меет смысл также уменьшить резерв под snapshots уровня aggregate. Что это я уже тоже писал в блоге, есл вкратце и в двух словах – это вам не надо, это для Metrocluster, синхронной репликации, и может помочь для ремонта сильно поврежденной WAFL. Если у вас этого всег нет, то можете этот резерв убрать и выключить расписание создания их. </p>
<p><code>snap reserve -A aggr1 0      <br />snap sched -A aggr1 0</code></p>
<p>Отдельно отмечу, это ТОЛЬКО для специальных, внутренних снэпшотов уровня aggregate, на обычные и привычные пользовательские снэпшоты уровня volume и файлов это не влияет, они буду работать по-прежнему, и вы по-прежнему сможете их использовать.</p>
<p>Вот теперь все готово к созданию томов и экспериментам. Можете начать из консоли, или же подключить к симулятору System Manager, если вам в GUI привычнее. Симулятор, повторюсь, работает и ведет себя идентично реальной системе хранения (за вычетом FC, SnapLock и ограничения по объему хранения). К нему можно подключить любой софтовый продукт (System/Operations/Protection/Provision Manager, SnapManager, VSC), настроить на него репликацию, использовать его как получатель (secondary) или источник (primary) для SnapVault, и так далее.</p>
<p>В основу этого поста легла статья <a href="http://mtellin.com/2011/01/03/getting-started-with-the-netapp-ontap-8-0-1-simulator/">http://mtellin.com/2011/01/03/getting-started-with-the-netapp-ontap-8-0-1-simulator/</a>.</p>
<p>В следующей статье я покажу, как можно добавить диски симулятору, сверх предустановленных 28, а также добавить serial console или изменить предустановленный серийный номер и SystemID, если вы планируете использовать несколько разных симуляторов в одной сети.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/801.html" rel="tag">8.0.1</a>, <a href="../../../tag/howto/index.html" rel="tag">howto</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/simulator.html" rel="tag">simulator</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1099/trackback.html#comments" title="Комментарий к записи Настраиваем Data Ontap Simulator 8">Комментарии (3)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1098">
				<h2 class="posttitle"><a href="../../../1098/trackback.html" rel="bookmark" title="Permanent Link to Как поставить Data ONTAP Simulator v8 на VMware">Как поставить Data ONTAP Simulator v8 на VMware</a></h2>
				<div class="postmetadata">5 Декабрь 2011, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Я уже рассказывал в этом блоге про то, <a href="../../../40/trackback.html">что такое Data ONTAP Simulator</a>, и чем он полезен, не только когда у вас нет “живой” системы хранения NetApp под руками, но даже, причем в большей степени, когда она у вас есть. На таком симуляторе можно упражняться “на кошечках”, можно проверять какие-то свои идеи, ставить эксперименты, отлаживать какие-то решения (не на продакшновом же сторадже это проделывать?), наконец учиться и обучать новичков.</p>
<p>Однако, как вы знаете, Data ONTAP 8 отличается от DOT7 довольно прилично. Была изменена платформа, на которой выполняется код собственно NetApp. В результате теперь по другому выглядит и Симулятор. Если раньше, для версии 7, это была программа под Linux, то Симулятор под Data ONTAP v8 это самостоятельный образ виртуальной машины, который можно запустить из под, например, VMware Player, или установить ее как VM в ESX.</p>
<p>Вот как раз этому варианту и посвящена эта статья, которую в оригинале я подсмотрел на <a href="http://mtellin.com/2010/03/12/use-ontap-8-0-7-mode-simulator-on-esx/">http://mtellin.com/2010/03/12/use-ontap-8-0-7-mode-simulator-on-esx/</a></p>
<p>   <a href="../../../1098/trackback.html#more-1098" class="more-link"><small>Continue reading &#8216;Как поставить Data ONTAP Simulator v8 на VMware&#8217; &raquo;</small></a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/801.html" rel="tag">8.0.1</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/simulator.html" rel="tag">simulator</a>, <a href="../../../tag/vmware/index.html" rel="tag">vmware</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1098/trackback.html#comments" title="Комментарий к записи Как поставить Data ONTAP Simulator v8 на VMware">Комментарии (3)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1084">
				<h2 class="posttitle"><a href="../../../1084/trackback.html" rel="bookmark" title="Permanent Link to Как передать диск в системе от одного контроллера другому">Как передать диск в системе от одного контроллера другому</a></h2>
				<div class="postmetadata">3 Ноябрь 2011, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Как вы знаете, каждый контроллер в HA-паре системы хранения NetApp владеет собственным набором дисков. Когда-то, много лет назад, еще до систем серии 3000, использовался так называемый hardware ownership, при котором привязка к контроллеру происходила “физически”, на уровне полки и петли FCAL. Начиная с 3020 в системах NetApp применяется так называмый sowtware ownership, при котором владелец диска назначается согласно WWN этого диска, и появилась возможность более гибко назначать владельца и разделять диски между контроллерами. Например, можно даже имея одну дисковую полку произвольно назначить диски из нее разным контроллерам.</p>
<p>??ногда же возникает задача перераспределить диски, например передать часть дисков от одного контроллера-владельца другому.</p>
<p>Как это сделать показывает статья в Knowledge Base</p>
<p><em>KB ID: 1011998 Version: 3.0 Published date: 01/13/2011 </em></p>
<p><strong>Описание</strong></p>
<p>Приведенная процедура смены контроллера-владельца диска применима к любой системе, поддерживающей software-based ownership (на сегодняшний день все выпускаемые системы используют software-based ownership).</p>
<p><strong>Процедура</strong></p>
<p>В разбираемом примере, FilerA владеет spare-диском, который мы хотим передать контроллеру FilerB.</p>
<p>1. Получим Disk ID   </p>
<p><code>FilerA&gt; vol status -s    <br />
Spare disks    <br />
RAID Disk Device HA SHELF BAY CHAN Pool Type RPM Used (MB/blks) Phys (MB/blks)    <br />
&#8212;&#8212;&#8212; &#8212;&#8212; &#8212;&#8212;&#8212;&#8212;- &#8212;- &#8212;- &#8212;- &#8212;&#8211; &#8212;&#8212;&#8212;&#8212;&#8211; &#8212;&#8212;&#8212;&#8212;&#8211;    <br />
Spare disks for block or zoned checksum traditional volumes or aggregates    <br />
spare 0b.22 0b 1 6 FC:B - FCAL 10000 68000/139264000 69536/142410400</code></p>
<p>2. Перейдем в режим повышенных привилегий (advanced mode)   </p>
<p><code>FilerA*&gt; priv set advanced    <br />
Warning: These advanced commands are potentially dangerous; use them only when directed to do so by NetApp personnel.</code></p>
<p>3. Удалим текущего владельца диска   </p>
<p><code>FilerA*&gt; disk remove_ownership 0b.22    <br />
Volumes must be taken offline. Are all impacted volumes offline(y/n)?? yes    <br />
FilerA*&gt; Sat Jan 14 17:46:42 GMT [FilerA: raid.config.spare.disk.missing:info]: Spare Disk 0b.22 Shelf 1 Bay 6 [NETAPP X272_HJURE073F10 NA14] S/N [xxxxxx] is missing.</code></p>
<p><strong>Внимание:</strong></p>
<ul>
<li>Команду <code>disk remove_ownership</code> можно дать сразу на группу дисков, разделив их имена пробелами, <code>disk remove_ownership 6c.64 6c.65 6c.66</code> снимет владельца со всех перечисленных дисков.</li>
<li>В случае систем серии 30&#215;0, проверьте установку опции <code>options disk.auto_assign</code>. Если она установлена в <strong>on</strong>, то когда вы снимете владельца с дисков, система автоматически назначит их назад. По этой причине убедитесь, что перед началом операции эта опция установлена в <strong>off</strong>. Можно ее включить назад, после передачи диска контроллеру.</li>
<li>Сообщение <code>volumes must be taken offline</code> это предохранительная мера, вы должны подтвердить, что не удаляете диск с данными из активного тома/aggregate. В данном примере мы перемещаем spare-диск, а не диск, уже назначенный в RAID. </li>
</ul>
<p>4. Подключаемся к контроллеру FilerB и переходим в advanced mode   </p>
<p><code>FilerB*&gt; priv set advanced    <br />
Warning: These advanced commands are potentially dangerous; use    <br />
them only when directed to do so by NetApp    <br />
personnel.</code></p>
<p>5. Назначаем нового владельца   </p>
<p><code>FilerB*&gt; disk assign 0b.22    <br />
Sat Jan 14 17:47:32 GMT [FilerB: diskown.changingOwner:info]: changing ownership for disk 0b.22 (S/N xxxxxx) from unowned (ID -1) to FilerB (ID xxxxxx)</code></p>
<p>6. Проверяем, что диск теперь spare у нового контроллера   </p>
<p><code>FilerB*&gt; vol status -s    <br />
Spare disks    <br />
RAID Disk Device HA SHELF BAY CHAN Pool Type RPM Used (MB/blks) Phys (MB/blks)    <br />
&#8212;&#8212;&#8212; &#8212;&#8212; &#8212;&#8212;&#8212;&#8212;- &#8212;- &#8212;- &#8212;- &#8212;&#8211; &#8212;&#8212;&#8212;&#8212;&#8211; &#8212;&#8212;&#8212;&#8212;&#8211;    <br />
Spare disks for block or zoned checksum traditional volumes or aggregates    <br />
spare 0b.22 0b 1 8 FC:B - FCAL 10000 68000/139264000 69536/142410400</code></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/disk-ownership.html" rel="tag">disk ownership</a>, <a href="../../../tag/howto/index.html" rel="tag">howto</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1084/trackback.html#comments" title="Комментарий к записи Как передать диск в системе от одного контроллера другому">Комментарии (7)</a>									 </div>
			</div>
	
		
		<div class="navigation">
			<div class="alignleft"><a href="5.html">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="3.html">Next Entries &raquo;</a></div>
		</div>
		
	
	</div>
	<div id="sidebar">
		<ul>
			
			
			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Автор</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			<li class="pagenav"><h2>Страницы</h2><ul><li class="page_item page-item-153"><a href="../../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul></li>
			<li><h2>Рубрики</h2>
				<ul>
					<li class="cat-item cat-item-89"><a href="../../commands/index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;">commands</a>
</li>
	<li class="cat-item cat-item-37 current-cat"><a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;">howto</a>
</li>
	<li class="cat-item cat-item-52"><a href="../../justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;">justread</a>
</li>
	<li class="cat-item cat-item-51"><a href="../../review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;">review</a>
</li>
	<li class="cat-item cat-item-3"><a href="../../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;">techtalk</a>
</li>
	<li class="cat-item cat-item-71"><a href="../../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;">tricks</a>
</li>
	<li class="cat-item cat-item-95"><a href="../../utilities/index.html" title="Просмотреть все записи в рубрике &laquo;utilities&raquo;">utilities</a>
</li>
	<li class="cat-item cat-item-44"><a href="../../whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;">whoisho</a>
</li>
	<li class="cat-item cat-item-1"><a href="../../news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;">новости</a>
</li>
	<li class="cat-item cat-item-387"><a href="../../opros.html" title="Просмотреть все записи в рубрике &laquo;опрос&raquo;">опрос</a>
</li>
	<li class="cat-item cat-item-8"><a href="../../translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;">переводы</a>
</li>
	<li class="cat-item cat-item-40"><a href="../../citaty/index.html" title="Просмотреть все записи в рубрике &laquo;цитаты&raquo;">цитаты</a>
</li>
				</ul>
			</li>

			<li><h2>Архивы</h2>
				<ul>
					<li><a href='../../../date/2018/01.html' title='Январь 2018'>Январь 2018</a></li>
	<li><a href='../../../date/2015/10.html' title='Октябрь 2015'>Октябрь 2015</a></li>
	<li><a href='../../../date/2015/04.html' title='Апрель 2015'>Апрель 2015</a></li>
	<li><a href='../../../date/2015/03.html' title='Март 2015'>Март 2015</a></li>
	<li><a href='../../../date/2015/01.html' title='Январь 2015'>Январь 2015</a></li>
	<li><a href='../../../date/2014/12.html' title='Декабрь 2014'>Декабрь 2014</a></li>
	<li><a href='../../../date/2014/11.html' title='Ноябрь 2014'>Ноябрь 2014</a></li>
	<li><a href='../../../date/2014/10.html' title='Октябрь 2014'>Октябрь 2014</a></li>
	<li><a href='../../../date/2014/09.html' title='Сентябрь 2014'>Сентябрь 2014</a></li>
	<li><a href='../../../date/2014/08.html' title='Август 2014'>Август 2014</a></li>
	<li><a href='../../../date/2014/07.html' title='Июль 2014'>Июль 2014</a></li>
	<li><a href='../../../date/2014/06.html' title='Июнь 2014'>Июнь 2014</a></li>
	<li><a href='../../../date/2014/05.html' title='Май 2014'>Май 2014</a></li>
	<li><a href='../../../date/2014/04.html' title='Апрель 2014'>Апрель 2014</a></li>
	<li><a href='../../../date/2014/03.html' title='Март 2014'>Март 2014</a></li>
	<li><a href='../../../date/2014/02.html' title='Февраль 2014'>Февраль 2014</a></li>
	<li><a href='../../../date/2014/01.html' title='Январь 2014'>Январь 2014</a></li>
	<li><a href='../../../date/2013/12.html' title='Декабрь 2013'>Декабрь 2013</a></li>
	<li><a href='../../../date/2013/11.html' title='Ноябрь 2013'>Ноябрь 2013</a></li>
	<li><a href='../../../date/2013/10.html' title='Октябрь 2013'>Октябрь 2013</a></li>
	<li><a href='../../../date/2013/09.html' title='Сентябрь 2013'>Сентябрь 2013</a></li>
	<li><a href='../../../date/2013/08.html' title='Август 2013'>Август 2013</a></li>
	<li><a href='../../../date/2013/07.html' title='Июль 2013'>Июль 2013</a></li>
	<li><a href='../../../date/2013/06.html' title='Июнь 2013'>Июнь 2013</a></li>
	<li><a href='../../../date/2013/05.html' title='Май 2013'>Май 2013</a></li>
	<li><a href='../../../date/2013/04.html' title='Апрель 2013'>Апрель 2013</a></li>
	<li><a href='../../../date/2013/03.html' title='Март 2013'>Март 2013</a></li>
	<li><a href='../../../date/2013/02.html' title='Февраль 2013'>Февраль 2013</a></li>
	<li><a href='../../../date/2013/01.html' title='Январь 2013'>Январь 2013</a></li>
	<li><a href='../../../date/2012/12.html' title='Декабрь 2012'>Декабрь 2012</a></li>
	<li><a href='../../../date/2012/11.html' title='Ноябрь 2012'>Ноябрь 2012</a></li>
	<li><a href='../../../date/2012/10.html' title='Октябрь 2012'>Октябрь 2012</a></li>
	<li><a href='../../../date/2012/09.html' title='Сентябрь 2012'>Сентябрь 2012</a></li>
	<li><a href='../../../date/2012/08.html' title='Август 2012'>Август 2012</a></li>
	<li><a href='../../../date/2012/07.html' title='Июль 2012'>Июль 2012</a></li>
	<li><a href='../../../date/2012/06.html' title='Июнь 2012'>Июнь 2012</a></li>
	<li><a href='../../../date/2012/05.html' title='Май 2012'>Май 2012</a></li>
	<li><a href='../../../date/2012/04.html' title='Апрель 2012'>Апрель 2012</a></li>
	<li><a href='../../../date/2012/03.html' title='Март 2012'>Март 2012</a></li>
	<li><a href='../../../date/2012/02.html' title='Февраль 2012'>Февраль 2012</a></li>
	<li><a href='../../../date/2012/01.html' title='Январь 2012'>Январь 2012</a></li>
	<li><a href='../../../date/2011/12.html' title='Декабрь 2011'>Декабрь 2011</a></li>
	<li><a href='../../../date/2011/11.html' title='Ноябрь 2011'>Ноябрь 2011</a></li>
	<li><a href='../../../date/2011/10/index.html' title='Октябрь 2011'>Октябрь 2011</a></li>
	<li><a href='../../../date/2011/09/index.html' title='Сентябрь 2011'>Сентябрь 2011</a></li>
	<li><a href='../../../date/2011/08.html' title='Август 2011'>Август 2011</a></li>
	<li><a href='../../../date/2011/07/index.html' title='Июль 2011'>Июль 2011</a></li>
	<li><a href='../../../date/2011/06/index.html' title='Июнь 2011'>Июнь 2011</a></li>
	<li><a href='../../../date/2011/05/index.html' title='Май 2011'>Май 2011</a></li>
	<li><a href='../../../date/2011/04/index.html' title='Апрель 2011'>Апрель 2011</a></li>
	<li><a href='../../../date/2011/03/index.html' title='Март 2011'>Март 2011</a></li>
	<li><a href='../../../date/2011/02.html' title='Февраль 2011'>Февраль 2011</a></li>
	<li><a href='../../../date/2011/01.html' title='Январь 2011'>Январь 2011</a></li>
	<li><a href='../../../date/2010/12.html' title='Декабрь 2010'>Декабрь 2010</a></li>
	<li><a href='../../../date/2010/11/index.html' title='Ноябрь 2010'>Ноябрь 2010</a></li>
	<li><a href='../../../date/2010/10/index.html' title='Октябрь 2010'>Октябрь 2010</a></li>
	<li><a href='../../../date/2010/09/index.html' title='Сентябрь 2010'>Сентябрь 2010</a></li>
	<li><a href='../../../date/2010/08.html' title='Август 2010'>Август 2010</a></li>
	<li><a href='../../../date/2010/07/index.html' title='Июль 2010'>Июль 2010</a></li>
	<li><a href='../../../date/2010/06.html' title='Июнь 2010'>Июнь 2010</a></li>
	<li><a href='../../../date/2010/05.html' title='Май 2010'>Май 2010</a></li>
	<li><a href='../../../date/2010/04/index.html' title='Апрель 2010'>Апрель 2010</a></li>
	<li><a href='../../../date/2010/03/index.html' title='Март 2010'>Март 2010</a></li>
	<li><a href='../../../date/2010/02.html' title='Февраль 2010'>Февраль 2010</a></li>
	<li><a href='../../../date/2010/01.html' title='Январь 2010'>Январь 2010</a></li>
	<li><a href='../../../date/2009/12/index.html' title='Декабрь 2009'>Декабрь 2009</a></li>
	<li><a href='../../../date/2009/11/index.html' title='Ноябрь 2009'>Ноябрь 2009</a></li>
	<li><a href='../../../date/2009/10.html' title='Октябрь 2009'>Октябрь 2009</a></li>
	<li><a href='../../../date/2009/09.html' title='Сентябрь 2009'>Сентябрь 2009</a></li>
	<li><a href='../../../date/2009/08/index.html' title='Август 2009'>Август 2009</a></li>
	<li><a href='../../../date/2009/07/index.html' title='Июль 2009'>Июль 2009</a></li>
	<li><a href='../../../date/2009/06.html' title='Июнь 2009'>Июнь 2009</a></li>
	<li><a href='../../../date/2009/05.html' title='Май 2009'>Май 2009</a></li>
	<li><a href='../../../date/2009/04.html' title='Апрель 2009'>Апрель 2009</a></li>
	<li><a href='../../../date/2009/03.html' title='Март 2009'>Март 2009</a></li>
	<li><a href='../../../date/2009/02.html' title='Февраль 2009'>Февраль 2009</a></li>
	<li><a href='../../../date/2009/01.html' title='Январь 2009'>Январь 2009</a></li>
	<li><a href='../../../date/2008/12.html' title='Декабрь 2008'>Декабрь 2008</a></li>
	<li><a href='../../../date/2008/11.html' title='Ноябрь 2008'>Ноябрь 2008</a></li>
	<li><a href='../../../date/2008/10.html' title='Октябрь 2008'>Октябрь 2008</a></li>
	<li><a href='../../../date/2008/09.html' title='Сентябрь 2008'>Сентябрь 2008</a></li>
	<li><a href='../../../date/2008/08.html' title='Август 2008'>Август 2008</a></li>
	<li><a href='../../../date/2008/03.html' title='Март 2008'>Март 2008</a></li>
	<li><a href='../../../date/2008/02.html' title='Февраль 2008'>Февраль 2008</a></li>
	<li><a href='../../../date/2007/12.html' title='Декабрь 2007'>Декабрь 2007</a></li>
	<li><a href='../../../date/2007/11.html' title='Ноябрь 2007'>Ноябрь 2007</a></li>
	<li><a href='../../../date/2007/10.html' title='Октябрь 2007'>Октябрь 2007</a></li>
	<li><a href='../../../date/2007/09.html' title='Сентябрь 2007'>Сентябрь 2007</a></li>
	<li><a href='../../../date/2007/08.html' title='Август 2007'>Август 2007</a></li>
	<li><a href='../../../date/2007/07/index.html' title='Июль 2007'>Июль 2007</a></li>
	<li><a href='../../../date/2007/06.html' title='Июнь 2007'>Июнь 2007</a></li>
	<li><a href='../../../date/2007/05.html' title='Май 2007'>Май 2007</a></li>
				</ul>
			</li>

			
					</ul>
	</div>

</div> <!-- wrapper -->
<div id="footer">
	<a href="../../../../feed">Entries (RSS)</a> and <a href="../../../../comments/feed">Comments (RSS)</a>. Valid <a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional"><abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a> and <a href="http://jigsaw.w3.org/css-validator/check/referer"><abbr title="Cascading Style Sheets">CSS</abbr></a>.<br />
	Powered by <a href="http://wordpress.org/" title="Powered by WordPress.">WordPress</a> and <a href="http://srinig.com/wordpress/themes/fluid-blue/">Fluid Blue theme</a>.<br />
	<!-- 15 queries. 0.104 seconds. -->
	</div>
</div> <!-- page -->
</body>
</html>
