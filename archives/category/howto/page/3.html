<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>about NetApp   &raquo; howto</title>

<link rel="stylesheet" href="../../../../wp-content/themes/fluid-blue/style.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../wp-content/themes/fluid-blue/print.css" type="text/css" media="print" />
<link rel="alternate" type="application/rss+xml" title="about NetApp RSS Feed" href="../../../../feed" />
<link rel="pingback" href="../../../../xmlrpc.php.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 2.6" />

</head>

<body>
<div id="page">
<div id="header">
	<div id="headertitle">
		<h1><a href="../../../../index.html" title="about NetApp: Системы хранения данных как предмет разговора">about NetApp</a></h1>
		<p>Системы хранения данных как предмет разговора</p>
	</div> 
	<!-- Search box (If you prefer having search form as a sidebar widget, remove this block) -->
	<div class="search">
		<form method="get" id="searchform" action="../../../../index.html">
<input type="text" size="20" name="s" id="s" value="Поиск..."  onblur="if(this.value=='') this.value='Поиск...';" onfocus="if(this.value=='Поиск...') this.value='';"/>
</form>
	</div> 
	<!-- Search ends here-->
		
</div>

<div id="navbar">
<ul id="nav">
	<li><a href="../../../../index.html">Home</a></li>
	<li class="page_item page-item-153"><a href="../../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul>
</div>
<div id="wrapper">

	<div id="content">

	
			<p>Archive for the &#8216;howto&#8217; Category.</p>

 				
		<div class="navigation">
			<div class="alignleft"><a href="4.html">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="2.html">Next Entries &raquo;</a></div>
		</div>

						
			<div class="post" id="post-1223">
				<h2 class="posttitle"><a href="../../../1223/trackback.html" rel="bookmark" title="Permanent Link to Замена &ldquo;головы&rdquo; в сторадже: LUN serial">Замена &ldquo;головы&rdquo; в сторадже: LUN serial</a></h2>
				<div class="postmetadata">18 Октябрь 2012, 7:00 <!-- от  --></div>
				<div class="postentry">
					<p>В <a href="../../../1220/trackback.html">статье ранее</a> я показал, как, в принципе, просто меняется контроллер на системе хранения NetApp, причем остаются на дисках доступными, без процедур миграции, все пользовательские данные, а сама процедура замены, и сопряженный с ней даунтайм, при хорошей подготовке и сноровке, можно завершить в течение буквально 20 минут. Однако в процедуре есть одна тонкость.</p>
<p>Если у вас на сторадже используются SAN LUN-ы, то при замене “головы”, а если более точно, то при замене NVRAM (при замене контроллера обычно с ним также меняется и NVRAM (NVMEM), установленная внутри) у этих LUN изменится их SerialID. В ряде случаев это может озадачить использующие их хосты (например Windows Cluster изменяет при этом их signatures, и не может после поднять в онлайн). Поэтому было бы правильно, после замены контроллера, и до возвращения LUN-ов использующим их системам, вернуть им старые SerialID.</p>
<p>Если у вас LUN-ов всего несколько, то это можно сделать и вручную (главное не забыть). Но если их много, то встает вопрос автоматизации.</p>
<p>На сайте <a href="https://communities.netapp.com/">communities.netapp.com</a> было найдено несколько вариантов такого скрипта. <a href="https://communities.netapp.com/docs/DOC-2369">На Perl,</a> <a href="https://communities.netapp.com/docs/DOC-1754">на VBS</a>, и в виде <a href="https://communities.netapp.com/docs/DOC-19112">скрипта PowerShell</a>.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/lun.html" rel="tag">lun</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/tricks/index.html" rel="tag">tricks</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1223/trackback.html#comments" title="Комментарий к записи Замена &ldquo;головы&rdquo; в сторадже: LUN serial">Комментарии (7)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1220">
				<h2 class="posttitle"><a href="../../../1220/trackback.html" rel="bookmark" title="Permanent Link to Замена &ldquo;головы&rdquo; в сторадже: disk ownership change">Замена &ldquo;головы&rdquo; в сторадже: disk ownership change</a></h2>
				<div class="postmetadata">8 Октябрь 2012, 11:11 <!-- от  --></div>
				<div class="postentry">
					<p>Вы уже наверняка знаете, что, в принципе, замена контроллера на установленной системе хранения NetApp процедура довольно несложная. Так как все контроллеры, всех семейств, используют одну и ту же OS Data ONTAP, отличаясь только&#160; внутренним аппаратным устройством, а индивидуальные настройки контроллера системы (файловая система /etc, если кто понимает UNIX-style) находится отдельно от контроллера, на дисках дисковых полок, то вообще говоря замена контроллера на новый, даже другой системы, сводится к простому перетыканию кабелей, после чего новый контроллер с OS внутри подмонтирует свои индивидуальные настройки и поднимется с сохранением настроек и данных на дисках. Но следует не забыть про software ownership. Дело в том, что в этой схеме, ныне общепринятой, диски “приписаны” к определенному контроллеру по его SystemID (а не по подключенным портам, как было когда-то, во времена FAS3020 и старше). Соответственно, чтобы старые диски увиделись новым контроллером нужно на них записи их владельца поменять на нового. делается это из Maintenance mode:</p>
<p><code>
<p>=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2012.10.08 09:26:06 =~=~=~=~=~=~=~=~=~=~=~=      <br />login as: root       <br /><a href="mailto:root@192.168.99.161's">root@192.168.99.161&#8217;s</a> password:       <br />=== OEMCLP v1.0.0 BMC v1.3 ===       <br />bmc shell -&gt; system power cycle       <br />This will cause a dirty shutdown of your appliance. Continue? [y/N] y       <br />bmc shell -&gt;       <br />bmc shell -&gt; system console       <br />Press ^G to enter BMC command shell</p>
<p>AMI BIOS8 Modular BIOS      <br />Copyright (C) 1985-2009,&#160; American Megatrends, Inc. All Rights Reserved       <br />Portions Copyright (C) 2009 NetApp, Inc. All Rights Reserved       <br />BIOS Version 6.1       <br />+++++++++++++++++++++++++++++++++++</p>
<p>Boot Loader version 2.1      <br />Copyright (C) 2000-2003 Broadcom Corporation.       <br />Portions Copyright (C) 2002-2008 NetApp</p>
<p>4096MB RAM installed      <br />CPU Type: Intel(R) Xeon(R) CPU&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; @ 1.66GHz</p>
<p>Starting AUTOBOOT press Ctrl-C to abort&#8230;      <br />Loading X86/freebsd/image2/kernel:..0&#215;200000/7916668 0&#215;98cc7c/708860 0xa3a000/573440 Entry at 0&#215;00248390       <br />Loading X86/freebsd/image2/platform.ko:0xac6000/380544 0xb23000/28000 0xb29d60/109976       <br />Starting program at 0&#215;00248390       <br />NetApp Data ONTAP 8.1.1 7-ModeCopyright (C) 1992-2012 NetApp.       <br />All rights reserved.       <br />md1.uzip: 26368 x 16384 blocksmd2.uzip: 3584 x 16384 blocks</p>
<p>*******************************      <br />*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; *       <br />* Press Ctrl-C for Boot Menu. *       <br />*&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; *       <br />*******************************       <br />^C</p>
<p>Boot Menu will be available.</p>
<p>Please choose one of the following:</p>
<p>(1) Normal Boot.      <br />(2) Boot without /etc/rc.       <br />(3) Change password.       <br />(4) Clean configuration and initialize all disks.       <br />(5) Maintenance mode boot.       <br />(6) Update flash from backup config.       <br />(7) Install new software first.       <br />(8) Reboot node.       <br />Selection (1-8)? 5</p>
<p>You have selected the maintenance boot option:      <br />the system has booted in maintenance mode allowing the       <br />following operations to be performed:</p>
<p>?&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; disk&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />key_manager&#160;&#160;&#160;&#160;&#160;&#160; fcadmin&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />fcstat&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sasadmin&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />sasstat&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; acpadmin&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />halt&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; help&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />ifconfig&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; raid_config&#160;&#160;&#160;&#160;&#160;&#160; <br />storage&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sesdiag&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />sysconfig&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vmservices&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />version&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vol&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />aggr&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; sldiag&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />dumpblock&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; environment&#160;&#160;&#160;&#160;&#160;&#160; <br />systemshell&#160;&#160;&#160;&#160;&#160;&#160; vol_db&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />led_on&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; led_off&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />sata&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; acorn&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />stsb&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; scsi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />nv8&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; disk_list&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />fctest&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; disktest&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />diskcopy&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vsa&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />xortest&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; disk_mung&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>
<p>Type &quot;help &lt;command&gt;&quot; for more details.</p>
<p>In a High Availablity configuration, you MUST ensure that the      <br />partner node is (and remains) down, or that takeover is manually       <br />disabled on the partner node, because High Availability       <br />software is not started or fully enabled in Maintenance mode.</p>
<p>FAILURE TO DO SO CAN RESULT IN YOUR FILESYSTEMS BEING DESTROYED</p>
<p>NOTE: It is okay to use &#8217;show/status&#8217; sub-commands such as      <br />&#8216;disk show or aggr status&#8217; in Maintenance mode while the partner is up       <br />Continue with boot?Please answer yes or no.       <br />Continue with boot? yes</p>
<p>*&gt; disk ?      <br />usage: disk &lt;options&gt;</p>
<p>Options are:&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; assign {&lt;disk_name&gt; | all | [-T &lt;storage type&gt; | -shelf &lt;shelf name&gt;] [-n &lt;count&gt;] | auto} [-p &lt;pool&gt;] [-o &lt;ownername&gt;] [-s &lt;sysid&gt;] [-c block|zoned] [-f] - assign a disk to a filer or all unowned disks by specifying &quot;all&quot;&#160; or &lt;count&gt; number of unowned disks       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; ddr_label {repair | print | delete | dumpraw | modify [-c] -o &lt;offset&gt; -v &lt;value&gt; | start_scan | pause_scan | resume_scan | error_scan} [-d all | &lt;disk_list&gt;]       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; encrypt { lock | rekey | destroy | sanitize | show } - perform tasks specific to self-encrypting disks       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; power_cycle [ -f ] { [-d &lt;disk_list&gt;] | [ -c &lt;channel_name&gt; [ -s &lt;shelf_number&gt; ] ] } - power-cycle one or more disks       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <strong>reassign</strong> {-o &lt;old_name&gt; | -s &lt;old_sysid&gt;} [-n &lt;new_name&gt;] [-d &lt;new_sysid&gt;] - reassign disks from old filer       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; remove_ownership [&lt;disk_name&gt; | all | -s &lt;sysid&gt;] [-f] - revert/remove disk ownership       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; sanown_stats {start| stop| show }- collect sanown event stats       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; show [-o &lt;ownername&gt; | -s &lt;sysid&gt; | -n | -v | -a]&#160; - lists disks and owners       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; unfail [-s] &lt;disk_name&gt;&#160;&#160;&#160;&#160; - unfail a disk&#160; (-s&#160; not valid in maintenance mode)       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; upgrade_ownership&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; - upgrade disks to new ownership scheme</p>
<p>*&gt;</p>
<p>*&gt; disk reassign -s xxxxxxxxxxx -d yyyyyyyyyyy</p>
<p>Partner node must not be in Takeover mode during disk reassignment      <br />from maintenance mode.       <br />Serious problems could result!!       <br />Are you sure partner is NOT in takeover mode (y/n)? n</p>
<p>*&gt; halt      </p>
<p>Oct 08 01:34:22 [localhost:kern.cli.cmd:debug]: Command line input: the command is &#8216;halt&#8217;. The full command line is &#8216;halt&#8217;. </p>
<p>Uptime: 6m54sSystem halting&#8230; </p>
</p>
<p></code></p>
<p>Выше я прервал переназначение disk ownership, сама же эта процедура делается довольно быстро, и если нигде не ошибиться, и все иметь подготовленным и смонтированным, то можно уложить процедуру замены контроллера системы хранения в 15-20 минут.</p>
<p>Впрочем, если вы используете NetApp как SAN-устройство, и храните на нем LUN-ы, есть еще одна тонкость, связанная со сменой serial id этих LUN при замене NVRAM (отдельно, или в составе контроллера целиком), о которой поговорим в четверг.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/change.html" rel="tag">change</a>, <a href="../../../tag/disk-ownership.html" rel="tag">disk ownership</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/ownership.html" rel="tag">ownership</a>, <a href="../../../tag/upgrade.html" rel="tag">upgrade</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1220/trackback.html#comments" title="Комментарий к записи Замена &ldquo;головы&rdquo; в сторадже: disk ownership change">Комментарии (11)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1219">
				<h2 class="posttitle"><a href="../../../1219/trackback.html" rel="bookmark" title="Permanent Link to Радикальное ускорение работы NetApp System Manager 2.x">Радикальное ускорение работы NetApp System Manager 2.x</a></h2>
				<div class="postmetadata">5 Октябрь 2012, 17:38 <!-- от  --></div>
				<div class="postentry">
					<p>Если вы, как и я ранее, мучаетесь от совершенно запредельно ннизкой скорости работы NetApp System Manager 2.x, основного ныне инструмента администрирования NetApp, то радикально ускорить его поможет вам способ, порекомендованный в нашем форуме (если вы еще не там – настоятельно приглашаю, ссылка в шапке блога):</p>
<p>По видимому причина тормозов – в крайне кривом разрешении хостнейма в IP в Java при работе через DNS, поэтому добавьте соответствие имен контроллеров и их IP в локальный файл hosts. Таким доисторическим приемом вы, на глаз, в десятки раз увеличите скорость работы, открытия панелей и их обновления.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/system-manager.html" rel="tag">system manager</a>, <a href="../../../tag/tricks/index.html" rel="tag">tricks</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1219/trackback.html#comments" title="Комментарий к записи Радикальное ускорение работы NetApp System Manager 2.x">Комментарии (13)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1215">
				<h2 class="posttitle"><a href="../../../1215/trackback.html" rel="bookmark" title="Permanent Link to Data ONTAP 8.1.x 7-mode Cookbook">Data ONTAP 8.1.x 7-mode Cookbook</a></h2>
				<div class="postmetadata">1 Октябрь 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>В этом блоге я уже как-то <a href="../../../718/trackback.html">рассказывал </a>про прекрасный документ, под названием Data ONTAP Cookbook. Словом &#8220;Cookbook&#8221;, или, по русски, &#8220;поваренной книгой&#8221; обычно в IT называют сборники &#8220;рецептов&#8221;, как сделать то-то и то-то. Крайне полезные документы с пошаговыми инструкциями &#8220;как&#8221;: настроить экспорты NFS и поддержку для NFSv4, изменить размеры тома, провести траблшутинг проблем подключения клиента по CIFS, настроить репликацию между системами, включить и настроить компрессию, настроить BMC или RLM, подключить LUN по iSCSI, и так далее.<br />
Раньше подобный Cookbook был выпущен <a href="https://communities.netapp.com/docs/DOC-8121">для Data ONTAP 7.x</a>, и многие им пользовались, как &#8220;настольной книгой админа&#8221;, а вот теперь у нас есть и версия <a href="https://communities.netapp.com/docs/DOC-8121">для Data ONTAP 8.x 7-mode</a>.</p>
<p>Если вы по каким-то этическим причинам не имеете логина на communities.netapp.com, необходимого для скачивания оттуда кукбуков по приведенным выше ссылкам, то можете взять версию на момент публикации отсюда:<br />
<a href="https://www.box.com/s/jdvkjmtqns1i5xuhnaxc">https://www.box.com/s/jdvkjmtqns1i5xuhnaxc</a><br />
<a href="https://www.box.com/s/qzxdsyc0g3fi4znlrf8a">https://www.box.com/s/qzxdsyc0g3fi4znlrf8a</a></p>
<p>Ну и, пользуясь случаем, напоминаю, что NetApp Innovation 2012 в Москве - послезавтра!</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/cookbook.html" rel="tag">cookbook</a>, <a href="../../../tag/howto/index.html" rel="tag">howto</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1215/trackback.html#comments" title="Комментарий к записи Data ONTAP 8.1.x 7-mode Cookbook">1 комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1207">
				<h2 class="posttitle"><a href="../../../1207/trackback.html" rel="bookmark" title="Permanent Link to Загрузка серверов на Linux с NFS">Загрузка серверов на Linux с NFS</a></h2>
				<div class="postmetadata">13 Сентябрь 2012, 11:00 <!-- от  --></div>
				<div class="postentry">
					<p>Некоторое время назад попал на глаза любопытный текст, рассказывающий как можно организовать загрузку серверов с RedHat Server (в общем случае – любого Linux) с сервера NFS (в нашем случае, понятно, с NetApp FAS). В практике описавшего человека речь шла о загрузке большой кластерной вычислительной фермы, но, вероятно, такая возможность подойдет и во множестве других случаев.</p>
<p>По поводу бездисковой загрузки, как я заметил, существует также довольно много странных предубеждений и заблуждений. Например, считается, что только по FC, и только с помощью поддерживающих это HBA можно осуществить бездисковую загрузку сервера. Однако это не совсем так. Конечно, с помощью FC это сделать достаточно просто, и я даже <a href="../../../1004/trackback.html">писал на эту тему статью в блоге</a>, с рядом типсов и триксов. Однако кроме загрузки по FC есть и другие варианты. Можно загрузиться по iSCSI, если у вас есть iSCSI HBA с BIOS и режимом загрузки в нем. Но даже и без HBA с BIOS это сделать можно, что и показывает рассматриваемый пример.</p>
<p>Сегодня практически любой современный сервер умеет делать загрузку netboot с помощью PXE – Pre-boot eXecution Environment. С его помощью мы сможем, в том числе, осуществить полноценную загрузку бездисковых серверов с NFS-сервера, без какого-либо FC, а дальше уже вольны использовать все возможности сервера Linux и системы хранения NetApp.</p>
<p>Преимущества такой загрузки, кроме очевидной экономии на локальных дисках:</p>
<ul>
<li>Развертывание новых серверов, особенно когда их счет идет на десятки или даже сотни, становится тривиальным.</li>
<li>Отсутствие внутреннего жесткого диска делает проблему замены сервера, например в случае выхода из строя, предельно простой. Сервер с унифицированным “железом” грузится из загрузочного образа, в котором находятся все identities.</li>
<li>Очень простой становится и процедура Disaster Recovery. Устанавливаем репликацию SnapMirror между двумя сайтами, в случае проблем на основном сайте переносите или устанавливаете новые сервера (или VM) на резервном сайте, правите MAC на TFTP boot server, чтобы не исправлять этот параметр в бут-образах, и сервера грузятся также, и с тем же содержимым, что и на старом сайте.</li>
<li>Нет проблем с повреждениями локальной файловой системы. Никакх fsck. Для сервера его “файловая система” – WAFL на сторадже, отдаваемая по NFS, а WAFL крайне устойчива к повреждениям, так как это транзакционная файловая система.</li>
<li>Можно использовать FlexClone. Тома ваших OS и загрузочные образы это идеально подходящий случай для использования FlexClone, экономия пространства будет великолепная, а эффективность работы, в том числе за счет повышения эффективности кэширования – очень высокая.</li>
<li>Работа с централизованным, легко расширяемым&#160; стораджем решает проблему исчерпания локального места на дисках серверов.</li>
</ul>
<p>Конечно есть и ряд недостатков (решаемых):</p>
<ul>
<li>TFTP-сервер и DHCP становятся критичными ресурсами, и могут даже стать “точкой отказа”, если вы не позаботитесь о их резервировании. Например можно поднять tftp-server непосредственно на NetApp FAS (options tftp.enable on и установить том для .rootdir), а для возможности работать с несколькими dhcpd, на разных машинах, можно использовать опцию next-server в файле конфигурации dhcpd.conf на загружающемся сервере.</li>
<li>Сетевые интерфейсы иногда могут иметь разные имена. ??з этой ситуации можно выйти, предусмотрев возможность переименовывать в скрипте имена udev, приводя их к единообразному виду. В приведенном документе показан способ этого решения.</li>
</ul>
<p>Подробный документ how-to по загрузке сервера Linux с NFS-шары по TFTP, со всеми полезными настройками и скриптами можно взять здесь:</p>
<p><a class="j-attachment-icon" href="https://communities.netapp.com/servlet/JiveServlet/download/38-37219/RHEL%206.2%20NFS%20Boot%20installation.docx"><u><font color="#0066cc">RHEL 6.2 NFS Boot installation.docx</font></u></a> (63.4 K) </p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/boot.html" rel="tag">boot</a>, <a href="../../../tag/diskless.html" rel="tag">diskless</a>, <a href="../../../tag/linux.html" rel="tag">linux</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/netboot.html" rel="tag">netboot</a>, <a href="../../../tag/nfs/index.html" rel="tag">nfs</a>, <a href="../../../tag/pxe.html" rel="tag">pxe</a>, <a href="../../../tag/rhel.html" rel="tag">rhel</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1207/trackback.html#comments" title="Комментарий к записи Загрузка серверов на Linux с NFS">1 комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1178">
				<h2 class="posttitle"><a href="../../../1178/trackback.html" rel="bookmark" title="Permanent Link to Настройка SNMP v3 для DFM/OnCommand Core">Настройка SNMP v3 для DFM/OnCommand Core</a></h2>
				<div class="postmetadata">9 Июль 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Как вы знаете, в состав ПО для стораджа, которое доступно вам для новых систем NetApp, входит полезный инструмент наблюдения, управления, диагностики и <em>рисования красивых графиков</em> –&#160; OnCommand Core 5 (ранее – DFM, Data Fabric Manager). Для его работы необходимо использовать протокол SNMP. NetApp Data ONTAP поддерживает SNMP вплоть до версии 3. Вот как включить и настроить использование аутентифицируемого SNMPv3 для работы с DFM/OnCommand Core.</p>
<p>Начнем с того, что в админской консоли NetApp включим отключенный по умолчанию в сторадже протокол SNMP.</p>
<p><code>&gt; options snmp.enable on</code></p>
<p>Хотя с NetApp и можно работать под root-ом, но тут это такая же “плохая практика” как и в обычном <em>UNIX-like</em>. Поэтому сразу начнем учиться жить “по-правильному”. Воспользуемся имеющимися средсвам RBAC – Role-based Access Control (кстати про использовани RBAC вы можете почитать перевод руководства на сайте Netwell в переводах Best Practices).</p>
<p>Создадим роль (snmpv3role), которой назначим определенную доступную ей функцию (login-snmp). Затем создадим группу, которой присвоим созданную роль с функцией, а затем добавим в эту группу созданного пользователя, которому назначена роль, с присвоенной роли функцией (<em>“…в доме, который построил Джек”</em>). Вот в таком порядке это создается:</p>
<p><code>&gt; useradmin role add snmpv3role -a login-snmp</code></p>
<p><code>&gt; useradmin group add snmpv3group -r snmpv3role</code></p>
<p><code>&gt; useradmin user add snmpv3user -g snmpv3group</code></p>
<p><code>&gt; Enter password:</code></p>
<p>Введем, в заключение процесса, пароль на пользователя snmpv3user. Это будет наш пользователь для операций SNMPv3. Протокол v3 отличается от традиционного и привычного v1 как раз наличием средств аутентификации.</p>
<p>Включим трапы SNMP.</p>
<p><code>&gt; snmp traps enable</code></p>
<p><code>&gt; snmp init 1</code></p>
<p>?? разрешим аутентификацию.</p>
<p><code>&gt; snmp authtrap 1</code></p>
<p>А затем добавим хост, с которого будут происходить обращения к SNMP. В нашем случае это хост с установленным DFM или OnCommand Core 5.0, или же любым другим средством, работающим по SNMP, например собирающем со стораджа статистику. Можно добавить и несколько хостов.</p>
<p><code>&gt; snmp traphost add &lt;DFM server hostname&gt;</code></p>
<p>Укажем расположение стораджа, для административных нужд, чтобы можно было легко его обнаружить и идентифицировать, в случае необходимости.</p>
<p><code>&gt; snmp location &lt;filer location&gt;</code> (если в строке есть пробелы – окружите строку кавычками; snmp location “ДЦ2, комн.5, стойка 8”)</p>
<p>Все готово на стороне стораджа. Переходим на сторону хоста DFM/OnCommand 5.0</p>
<ul>
<li><font color="#0000ff">Если вы настраиваете из GUI, то проследуйте сюда:</font> </li>
</ul>
<p><strong>Control Center tab | Setup | Options | SNMP Trap Listener</strong>. Щелкните Yes для включения листенера и щелкнитеk Update.</p>
<p><strong>Control Center tab | Setup | Network Credentials</strong>.</p>
<p>Если вы использовали SNMPv1, найдите сеть вашего стораджа, которую вы хотите изменить на использование SNMPv3 в списке внизу страницы, и щелкните <strong>Edit</strong> справа.</p>
<p>В <strong>Edit Network Credentials</strong>, выберем <strong>SNMPv3</strong>.</p>
<p>В <strong>SNMPv1 Settings</strong>, убираем все, что указано в этом поле.</p>
<p>В <strong>SNMPv3 Settings</strong>, введем имя пользователя и пароль, созданные выше (snmpv3user) и щелкнем <strong>Update</strong>. НЕ ВВОД??ТЕ ничего в поле <strong>Privacy password</strong>. Это пока не используется, если вы туда что-то напишете, то получите сообщение об ошибке “<em>snmpd:error Encryption not enabled</em>” на стороне стораджа.</p>
<ul>
<li><font color="#0000ff">Если вы настраиваете из командной строки:</font> </li>
</ul>
<p><code>C:\&gt; cd c:\Program Files\Network Appliance\DataFabric\DFM\bin</code></p>
<p><code>&gt; dfm host list</code> (чтобы посмотреть ID стораджа и его IP)</code></p>
<p><code>&gt; dfm host set &lt;storage ip&gt; prefsnmpVersion=3</code></p>
<p><code>&gt; dfm host get -q &lt;ID стораджа, который вы подключаете по v3&gt;</code> (для проверки версии snmp)</p>
<p><code>&gt; dfm host diag &lt;имя хоста стораджа&gt;</code></p>
<p>Вы получите следующий диагностический вывод:</p>
<p><code>SNMP Version in use <strong>SNMPv3</strong></code></p>
<p><code>SNMPv1 <strong>Failed</strong></code> (это правильно)</p>
<p><code>SNMP Community <strong>&lt;пусто&gt;</strong></code> (так и должен быть пустой, см. ниже)</p>
<p><code>SNMPv3 <strong>Passed (297ms)</strong></code></p>
<p><code>SNMPv3 Auth Protocol <strong>MD5</strong></code></p>
<p><code>SNMPv3 Privacy Enabled <strong>No</strong></code> (Так и должно быть, это зарезервировано для будущего использования Privacy password, и сейчас не работает)</p>
<p><code>SNMPv3 Username <strong>root</strong></code> (OK, диагностика использует <code>root</code>, а не нашего созданного <code>snmpv3user</code>)</p>
<p><code>SNMP sysName <strong>&lt;…&gt; </strong></code>(какие-то значения, указанные в настройках)</p>
<p><code>SNMP sysObjectID <strong>&lt;…&gt;</strong></code></p>
<p><code>SNMP productID <strong>&lt;…&gt;</strong></code></p>
<p>&#160;</p>
<p>Диагностика использует выполнение от пользователя root, поэтому мы видим выше упоминание root.</p>
<p>Если вы не очистите строку <em>read only community</em> в DFM GUI, то DFM будет использовать SNMPv1 в том случае, если строка&#160; <em>ro community</em> определена на сторадже. Для ее удаления выполните команду в консоли стораджа:</p>
<p><code>&gt; snmp community delete ro &lt;community ro string&gt;</code></p>
<p>??мейте ввиду, что System Manager v1.x и 2.x пока не поддерживают SNMPv3. Это означает, что если вы отключите использование SNMPv1, у вас перестанет работать функция обнаружения стораджей в сети, однако вы сможете добавить их вручную по IP-адресу (не Discover, а Add, затем введите IP-адрес стораджа, затем щелкните на иконку стрелки вниз, следующей за More, и введите логин и пароль административного аккаунта). Ели вам нужно продолжать использовать System Manager вместе с DFM, то оставьте&#160; строку <em>ro community</em> на сторадже, удалив ее в DFM. DFM будет работать по v3, а System Manager по v1, без аутентификации.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/dfm.html" rel="tag">dfm</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/oncommand.html" rel="tag">oncommand</a>, <a href="../../../tag/snmp.html" rel="tag">snmp</a>, <a href="../../../tag/snmpv3.html" rel="tag">snmpv3</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1178/trackback.html#comments" title="Комментарий к записи Настройка SNMP v3 для DFM/OnCommand Core">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1172">
				<h2 class="posttitle"><a href="../../../1172/trackback.html" rel="bookmark" title="Permanent Link to Про настройку NetApp &ndash; новый блог">Про настройку NetApp &ndash; новый блог</a></h2>
				<div class="postmetadata">28 Июнь 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>К пользующимся у меня тут, судя по вебсатистике, бешеным спросом статьям о начальном запуске и настройке новых систем NetApp (<a href="../../../916/trackback.html">часть 1</a> и <a href="../../../1132/trackback.html">часть 2</a>), в закладки админу добавились в интернете новые тексты:</p>
<h3><a href="http://twistedminds.ru/2012/06/setting-up-fas2040-part-1/">Настройка NetApp FAS – Часть 1</a>&#160;</h3>
<p>(Описание контроллера FAS2040, возврат к заводским настройкам, базовая настройка файлера, настройка BMC, обновление Data ONTAP, NTP сервера).</p>
<h3><a href="http://twistedminds.ru/2012/06/setting-up-netapp-fas-filer-part-2/">Настройка NetApp FAS – Часть 2</a></h3>
<p>&#160;&#160;
<p>(Multimode VIF и его виды, балансировка нагрузки, интерфейсы-партнер в кластере, псевдонимы aka IP Aliasing, flowcontrol и MTU, настройка Static и Dynamic VIF с&#160; коммутатором Cisco Catalyst).</p>
<h3><a href="http://twistedminds.ru/2012/06/setting-up-netapp-filer-part-3/">Настройка NetApp FAS – Часть 3</a></h3>
<p>&#160;&#160;
<p>(disk ownership, raid group, aggregate, volume, qtree, lun).</p>
<h3><a href="http://twistedminds.ru/2012/06/setting-up-netapp-filer-part-4/">Настройка NetApp FAS – Часть 4</a></h3>
<p>&#160;&#160;
<p>(iSCSI, настройка iSCSI, безопасность iSCSI, iSNS)</p>
<p class="title">Все это – в блоге <a href="http://twistedminds.ru">http://twistedminds.ru</a>.</p>
<p class="title">Если вы интересуетесь темой, то сходите, посмотрите, может быть полезно. Автор раскрывает тему в несколько ином ключе, и пишет, например, гораздо больше о сетевых настройках и VIF, о которых я в своих постах “самого начала” не говорил (отчасти намеренно).</p>
<p class="title">Ожидается продолжение. да и вообще заглядывайте туда, интересный ресурс.</p>
<p>UPD: Пока пост отстаивался в “отстойнике”, как это обчно и бывает с написанными мной текстами, автор удвоил количество своих постов на данную тему. Шоназывается “респект”.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/install.html" rel="tag">install</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/network.html" rel="tag">network</a>, <a href="../../../tag/setup.html" rel="tag">setup</a>, <a href="../../../tag/vif.html" rel="tag">vif</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1172/trackback.html#comments" title="Комментарий к записи Про настройку NetApp &ndash; новый блог">1 комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1169">
				<h2 class="posttitle"><a href="../../../1169/trackback.html" rel="bookmark" title="Permanent Link to VMware и использование NFS: часть 3d &ndash; Трафик NFS и балансировка Load Based Teaming">VMware и использование NFS: часть 3d &ndash; Трафик NFS и балансировка Load Based Teaming</a></h2>
				<div class="postmetadata">14 Июнь 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Третья часть серии постов в блоге <a href="http://wahlnetwork.com/">Wahl Network</a>, посвященных вариантам использования NFS в Vmware и организаци балансировки трафика по нескольким физическим путям.</p>
<h2><a href="http://wahlnetwork.com/2012/04/27/nfs-on-vsphere-technical-deep-dive-on-multiple-subnet-storage-traffic/">NFS в vSphere – погружение в детали: часть 3, VMware Load Balancing Teaming</a></h2>
<p>&#160;</p>
<p>В предшествующих трех постах этой серии мы <a href="../../../1164/trackback.html">рассмотрели основные ошибки и заблуждения</a>, связанные с использованием NFS в VMware, а также рассмотрели два варианта построения сети хранерия с использованием NFS - <a href="../../../1165/trackback.html">с единой подсетью</a>, и <a href="../../../1166/trackback.html">с множественными подсетями</a>. Если вы не слишком хорошо знакомы с тем, как NFS работает в vSphere, рекомендую вам начать с чтения этих статей. Выводы, к которым мы пришли, состоят в том, что NFS в vSphere требует использовать множественные подсети, чтобы использовать множественные физические линки к системе хранения, за исключением, когда EtherChannel правильно настроен правильно используется на одной подсети. Однако, даже при использовании static EtherChannel, множественные таргеты на стороне стораджа, и правильно спланированные least significant bits в адресе необходимы для использования более одного физического пути к системе хранения.</p>
<p>   <a href="../../../1169/trackback.html#more-1169" class="more-link"><small>Continue reading &#8216;VMware и использование NFS: часть 3d &ndash; Трафик NFS и балансировка Load Based Teaming&#8217; &raquo;</small></a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/lbt.html" rel="tag">lbt</a>, <a href="../../../tag/load-balancing.html" rel="tag">load balancing</a>, <a href="../../../tag/nas.html" rel="tag">nas</a>, <a href="../../../tag/nfs/index.html" rel="tag">nfs</a>, <a href="../../../tag/vmware/index.html" rel="tag">vmware</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;" rel="category tag">justread</a>,  <a href="../../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>,  <a href="../../translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;" rel="category tag">переводы</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1169/trackback.html#respond" title="Комментарий к записи VMware и использование NFS: часть 3d &ndash; Трафик NFS и балансировка Load Based Teaming">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1165">
				<h2 class="posttitle"><a href="../../../1165/trackback.html" rel="bookmark" title="Permanent Link to VMware и использование NFS: часть 3b &ndash; Трафик NFS в одной подсети">VMware и использование NFS: часть 3b &ndash; Трафик NFS в одной подсети</a></h2>
				<div class="postmetadata">31 Май 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Для рассмотрения вопроса, как работает доступ к стораджу по NFS с хоста ESXi, я снова воспользуюсь серией постов блога <a href="http://wahlnetwork.com">Wahl Network</a>, переводы которых я публикую сегодня и в ближайшие несколько дней. Его автор провел экспериментальную работу, показав то, как работает NFS в сети хранения, когда датасторы и vmkernel расположены в одной общей подсети, в разных подсетях, и рассмотрел вариант использования Load-based teaming, доступный для пользователей версии vSphere уровня Enterprise Plus.</p>
<p>Я надеюсь, что эти статьи ответят на вопрос, как же все же работает NFS в сети хранения vSphere, и как стораджи с использованием этого протокола правильно использовать для VMware vSphere 5.0.</p>
<h2><a href="http://wahlnetwork.com/2012/04/23/nfs-on-vsphere-technical-deep-dive-on-same-subnet-storage-traffic/">NFS в vSphere – погружение в детали: часть 1, порты vmkernel и экспорты NFS в единой общей подсети</a></h2>
<p>Apr 23, 2012 </p>
<h3>Конфигурация</h3>
<p>Для эксперимента, показывающего, как vSphere направляет трафик NFS в одной подсети, я создал тестовый стенд, с использованием 2 серверов NFS (я использовал для этого NetApp Simulator) с каждого их которых выведено по 2 экспорта, суммарно 4 экспорта NFS. Весь трафик направлен в VLAN 5 (это подсеть 10.0.5.0/24 моего стенда) и идет на хост ESXi 5.0 update 1 (build 623860). Хост имеет 2 физических порта-аплинка и 4 порта vmkernel, дающих трафику NFS множество возможны путей. Для того, чтобы создать существенный трафик в сети хранения, я развернул 4 VM с VMware IO analyzer appliance – по одному на каждый экспорт. Это позволит мне быстро создать трафик с виртуальных машин на все экспорты разом.</p>
<p>   <a href="../../../1165/trackback.html#more-1165" class="more-link"><small>Continue reading &#8216;VMware и использование NFS: часть 3b &ndash; Трафик NFS в одной подсети&#8217; &raquo;</small></a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/esx.html" rel="tag">esx</a>, <a href="../../../tag/etherchannel.html" rel="tag">etherchannel</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/nfs/index.html" rel="tag">nfs</a>, <a href="../../../tag/vmware/index.html" rel="tag">vmware</a>, <a href="../../../tag/vsphere/index.html" rel="tag">vsphere</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>,  <a href="../../translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;" rel="category tag">переводы</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1165/trackback.html#respond" title="Комментарий к записи VMware и использование NFS: часть 3b &ndash; Трафик NFS в одной подсети">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1164">
				<h2 class="posttitle"><a href="../../../1164/trackback.html" rel="bookmark" title="Permanent Link to VMware и использование NFS: часть 3а &ndash;Балансировка нагрузки по NFS">VMware и использование NFS: часть 3а &ndash;Балансировка нагрузки по NFS</a></h2>
				<div class="postmetadata">28 Май 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Как вы помните, я обещал остановиться на вопросе как именно правильно настраивать работу NFS по нескольким физическим интерфейсам Ethernet. ??так, отдельный разоблачения заблуждений в отношении multipathing для NFS псто!</p>
<p>Как я уже вкратце показал, широкораспространенное заблуждение, что, использовав NFS, вы будете вынужденно ограничены ровно одним интерфейсом ethernet, так как “NFS не поддерживает multipathing” – не верно. К моему глубокому сожалению, это заблуждение местами поддерживает даже сама VMware, несмотря на то, что метод балансировки с помощью нескольких портов VMkernel и нескольких IP-алиасов описан и рекомендуется в их же Best Practices.</p>
<p>Я уже написал ранее, что принципы работы NFS таковы, что даже пустив трафик Ethernet по нескольким объединенным в etherchannel портам, вы не добьетесь не только равномерной их загрузки, но даже не загрузите порты кроме первого. Это по видимому связано с тем, что NFS образует ровно одну TCP/IP сессию для данной пары IP-адресов “источник-приемник”, и именно ее и пускает по первому же подходящему для этого порту. А одну сессию разбить на несколько интерфейсов нельзя. Видимо именно это явилось источником странного заблуждения, что трафик NFS нельзя распределить по нескольким интерфейсам. Это не так, можно. Но нужна некоторая хитрость, в общем-то очевидная. Нужно создать несколько пар IP “источник-получатель”, в разных подсетях, и их уже распределить по интерфейсам.&#160; Об этом подробнее далее в постах серии.</p>
<p>Впрочем, как вы уже видите, неверно и обратное убеждение. Совсем недостаточно объединить несколько портов в etherchannel (у NetApp он называется VIF или ifgrp), чтобы, автоматически, увеличить пропусную способность получившегося интерфейса в Х-раз.</p>
<p>Давайте разберем некоторые распространенные заблуждения на этот счет:</p>
<p><strong>1. Трафик NFS можно назначить на порт VMkernel также, как мы назначаем его для iSCSI.</strong></p>
<p>Это не так. К сожалению.</p>
<p><img src="http://wahlnetwork.files.wordpress.com/2012/04/virtual-adapter-settings.png" /></p>
<p>Как вы видите на рисунке, в обведенном оранжевой рамкой боксе, можно назначить данный порт для: <em>iSCSI, FT, Management</em> или <em>vMotion</em>. Но не для NFS. Трафик NFS пойдет по первому же порту, принадлежащему подсети IP-получателя. Если порта в подсети IP-получателя трафика нет, то трафик пойдет через порт Management, в направлении его default gateway (предсказуемо), и такого варианта следует всеми силами избегать.</p>
<p><strong>2. Трафик NFS равномерно распределяется по всем аплинкам (физическим vmnic) хоста, используемым для связи с системой хранения.</strong></p>
<p>Увы – нет. Когда ESXi нажодит и выбирает подходящий порт vmkernel (принцип выбора описан выше), следуюшим шагом он выбирает аплинк. Независимо от типа vSwitch, хост vSphere использует конфигурацию portgroup по умолчанию (только с использованием virtual port ID), и, при наличии нескольких активных аплинков в группе, будет выбран только один (первый подходящий) аплинк для трафика NFS к данному примонтированному экспорту. Порты в группе при этом работают на поддержку high availability, то есть при выходе из строя активного порта, трафик перейдет на ранее пассивный порт, но не для load balancing, то есть трафик NFS по портам vmnic в группе не распределяется.</p>
<p><strong>3. Достаточно включить несколько физических портов на стороне стораджа в VIF (etherchannel), и трафик магическим образом распределится по всем им, расширяя полосу пропускания интерфейса в Х-раз.</strong></p>
<p>Тоже, к сожалению, в общем случае, без дополнительных усилий, неверно. При наличии одной TCP/IP сессии NFS с одного IP-источника на один IP-получатель, нельзя “разложить” трафик на несколько портов. Но можно это сделать для нескольких портов, нескольких IP-алиасов для получателя и/или&#160; нескольких портов VMkernel. Тогда, создав, например 4 пары IP в разных подсетях, для четырех eth, можно гораздо более равномено загрузить их работой. Это не столь “магически-автоматически”, но это работает. Без такого разбиения и распределения&#160; etherchannel обеспечивает только отказостоустойчивость (при отказе активного порта, трафик перенаправится в другой, ранее неактивный, в той же группе), но не балансировку нагрузки и не расширение bandwidth.</p>
<p>На стороне хоста ESXi для использования балансировки вам необходимо создать <em>static Etherchannel </em>с <em>IPhash-based teaming policy</em>, и иметь у vmkernel IP уникальный, между другими vmk, так называемый <em><a href="http://en.wikipedia.org/wiki/Least_significant_bit">least significant bit</a></em>.</p>
<p>Если у вас на VMware лицензия Enterprise Plus, и вы используете vSphere Distributed Switch, вы также можете воспользоваться <em>Load-based Teaming</em> для распределения трафика по VLAN или подсетям. При этом вам также понадобятся несколько VLAN или подсетей на VIF стораджа. Подробнее о таком варианте – в одном из следующих постов.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../../tag/etherchannel.html" rel="tag">etherchannel</a>, <a href="../../../tag/netapp/index.html" rel="tag">netapp</a>, <a href="../../../tag/nfs/index.html" rel="tag">nfs</a>, <a href="../../../tag/vif.html" rel="tag">vif</a>, <a href="../../../tag/vmware/index.html" rel="tag">vmware</a><br />					Раздел: <a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../1164/trackback.html#comments" title="Комментарий к записи VMware и использование NFS: часть 3а &ndash;Балансировка нагрузки по NFS">Комментарии (4)</a>									 </div>
			</div>
	
		
		<div class="navigation">
			<div class="alignleft"><a href="4.html">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="2.html">Next Entries &raquo;</a></div>
		</div>
		
	
	</div>
	<div id="sidebar">
		<ul>
			
			
			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Автор</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			<li class="pagenav"><h2>Страницы</h2><ul><li class="page_item page-item-153"><a href="../../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul></li>
			<li><h2>Рубрики</h2>
				<ul>
					<li class="cat-item cat-item-89"><a href="../../commands/index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;">commands</a>
</li>
	<li class="cat-item cat-item-37 current-cat"><a href="../index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;">howto</a>
</li>
	<li class="cat-item cat-item-52"><a href="../../justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;">justread</a>
</li>
	<li class="cat-item cat-item-51"><a href="../../review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;">review</a>
</li>
	<li class="cat-item cat-item-3"><a href="../../techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;">techtalk</a>
</li>
	<li class="cat-item cat-item-71"><a href="../../tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;">tricks</a>
</li>
	<li class="cat-item cat-item-95"><a href="../../utilities/index.html" title="Просмотреть все записи в рубрике &laquo;utilities&raquo;">utilities</a>
</li>
	<li class="cat-item cat-item-44"><a href="../../whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;">whoisho</a>
</li>
	<li class="cat-item cat-item-1"><a href="../../news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;">новости</a>
</li>
	<li class="cat-item cat-item-387"><a href="../../opros.html" title="Просмотреть все записи в рубрике &laquo;опрос&raquo;">опрос</a>
</li>
	<li class="cat-item cat-item-8"><a href="../../translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;">переводы</a>
</li>
	<li class="cat-item cat-item-40"><a href="../../citaty/index.html" title="Просмотреть все записи в рубрике &laquo;цитаты&raquo;">цитаты</a>
</li>
				</ul>
			</li>

			<li><h2>Архивы</h2>
				<ul>
					<li><a href='../../../date/2018/01.html' title='Январь 2018'>Январь 2018</a></li>
	<li><a href='../../../date/2015/10.html' title='Октябрь 2015'>Октябрь 2015</a></li>
	<li><a href='../../../date/2015/04.html' title='Апрель 2015'>Апрель 2015</a></li>
	<li><a href='../../../date/2015/03.html' title='Март 2015'>Март 2015</a></li>
	<li><a href='../../../date/2015/01.html' title='Январь 2015'>Январь 2015</a></li>
	<li><a href='../../../date/2014/12.html' title='Декабрь 2014'>Декабрь 2014</a></li>
	<li><a href='../../../date/2014/11.html' title='Ноябрь 2014'>Ноябрь 2014</a></li>
	<li><a href='../../../date/2014/10.html' title='Октябрь 2014'>Октябрь 2014</a></li>
	<li><a href='../../../date/2014/09.html' title='Сентябрь 2014'>Сентябрь 2014</a></li>
	<li><a href='../../../date/2014/08.html' title='Август 2014'>Август 2014</a></li>
	<li><a href='../../../date/2014/07.html' title='Июль 2014'>Июль 2014</a></li>
	<li><a href='../../../date/2014/06.html' title='Июнь 2014'>Июнь 2014</a></li>
	<li><a href='../../../date/2014/05.html' title='Май 2014'>Май 2014</a></li>
	<li><a href='../../../date/2014/04.html' title='Апрель 2014'>Апрель 2014</a></li>
	<li><a href='../../../date/2014/03.html' title='Март 2014'>Март 2014</a></li>
	<li><a href='../../../date/2014/02.html' title='Февраль 2014'>Февраль 2014</a></li>
	<li><a href='../../../date/2014/01.html' title='Январь 2014'>Январь 2014</a></li>
	<li><a href='../../../date/2013/12.html' title='Декабрь 2013'>Декабрь 2013</a></li>
	<li><a href='../../../date/2013/11.html' title='Ноябрь 2013'>Ноябрь 2013</a></li>
	<li><a href='../../../date/2013/10.html' title='Октябрь 2013'>Октябрь 2013</a></li>
	<li><a href='../../../date/2013/09.html' title='Сентябрь 2013'>Сентябрь 2013</a></li>
	<li><a href='../../../date/2013/08.html' title='Август 2013'>Август 2013</a></li>
	<li><a href='../../../date/2013/07.html' title='Июль 2013'>Июль 2013</a></li>
	<li><a href='../../../date/2013/06.html' title='Июнь 2013'>Июнь 2013</a></li>
	<li><a href='../../../date/2013/05.html' title='Май 2013'>Май 2013</a></li>
	<li><a href='../../../date/2013/04.html' title='Апрель 2013'>Апрель 2013</a></li>
	<li><a href='../../../date/2013/03.html' title='Март 2013'>Март 2013</a></li>
	<li><a href='../../../date/2013/02.html' title='Февраль 2013'>Февраль 2013</a></li>
	<li><a href='../../../date/2013/01.html' title='Январь 2013'>Январь 2013</a></li>
	<li><a href='../../../date/2012/12.html' title='Декабрь 2012'>Декабрь 2012</a></li>
	<li><a href='../../../date/2012/11.html' title='Ноябрь 2012'>Ноябрь 2012</a></li>
	<li><a href='../../../date/2012/10.html' title='Октябрь 2012'>Октябрь 2012</a></li>
	<li><a href='../../../date/2012/09.html' title='Сентябрь 2012'>Сентябрь 2012</a></li>
	<li><a href='../../../date/2012/08.html' title='Август 2012'>Август 2012</a></li>
	<li><a href='../../../date/2012/07.html' title='Июль 2012'>Июль 2012</a></li>
	<li><a href='../../../date/2012/06.html' title='Июнь 2012'>Июнь 2012</a></li>
	<li><a href='../../../date/2012/05.html' title='Май 2012'>Май 2012</a></li>
	<li><a href='../../../date/2012/04.html' title='Апрель 2012'>Апрель 2012</a></li>
	<li><a href='../../../date/2012/03.html' title='Март 2012'>Март 2012</a></li>
	<li><a href='../../../date/2012/02.html' title='Февраль 2012'>Февраль 2012</a></li>
	<li><a href='../../../date/2012/01.html' title='Январь 2012'>Январь 2012</a></li>
	<li><a href='../../../date/2011/12.html' title='Декабрь 2011'>Декабрь 2011</a></li>
	<li><a href='../../../date/2011/11.html' title='Ноябрь 2011'>Ноябрь 2011</a></li>
	<li><a href='../../../date/2011/10/index.html' title='Октябрь 2011'>Октябрь 2011</a></li>
	<li><a href='../../../date/2011/09/index.html' title='Сентябрь 2011'>Сентябрь 2011</a></li>
	<li><a href='../../../date/2011/08.html' title='Август 2011'>Август 2011</a></li>
	<li><a href='../../../date/2011/07/index.html' title='Июль 2011'>Июль 2011</a></li>
	<li><a href='../../../date/2011/06/index.html' title='Июнь 2011'>Июнь 2011</a></li>
	<li><a href='../../../date/2011/05/index.html' title='Май 2011'>Май 2011</a></li>
	<li><a href='../../../date/2011/04/index.html' title='Апрель 2011'>Апрель 2011</a></li>
	<li><a href='../../../date/2011/03/index.html' title='Март 2011'>Март 2011</a></li>
	<li><a href='../../../date/2011/02.html' title='Февраль 2011'>Февраль 2011</a></li>
	<li><a href='../../../date/2011/01.html' title='Январь 2011'>Январь 2011</a></li>
	<li><a href='../../../date/2010/12.html' title='Декабрь 2010'>Декабрь 2010</a></li>
	<li><a href='../../../date/2010/11/index.html' title='Ноябрь 2010'>Ноябрь 2010</a></li>
	<li><a href='../../../date/2010/10/index.html' title='Октябрь 2010'>Октябрь 2010</a></li>
	<li><a href='../../../date/2010/09/index.html' title='Сентябрь 2010'>Сентябрь 2010</a></li>
	<li><a href='../../../date/2010/08.html' title='Август 2010'>Август 2010</a></li>
	<li><a href='../../../date/2010/07/index.html' title='Июль 2010'>Июль 2010</a></li>
	<li><a href='../../../date/2010/06.html' title='Июнь 2010'>Июнь 2010</a></li>
	<li><a href='../../../date/2010/05.html' title='Май 2010'>Май 2010</a></li>
	<li><a href='../../../date/2010/04/index.html' title='Апрель 2010'>Апрель 2010</a></li>
	<li><a href='../../../date/2010/03/index.html' title='Март 2010'>Март 2010</a></li>
	<li><a href='../../../date/2010/02.html' title='Февраль 2010'>Февраль 2010</a></li>
	<li><a href='../../../date/2010/01.html' title='Январь 2010'>Январь 2010</a></li>
	<li><a href='../../../date/2009/12/index.html' title='Декабрь 2009'>Декабрь 2009</a></li>
	<li><a href='../../../date/2009/11/index.html' title='Ноябрь 2009'>Ноябрь 2009</a></li>
	<li><a href='../../../date/2009/10.html' title='Октябрь 2009'>Октябрь 2009</a></li>
	<li><a href='../../../date/2009/09.html' title='Сентябрь 2009'>Сентябрь 2009</a></li>
	<li><a href='../../../date/2009/08/index.html' title='Август 2009'>Август 2009</a></li>
	<li><a href='../../../date/2009/07/index.html' title='Июль 2009'>Июль 2009</a></li>
	<li><a href='../../../date/2009/06.html' title='Июнь 2009'>Июнь 2009</a></li>
	<li><a href='../../../date/2009/05.html' title='Май 2009'>Май 2009</a></li>
	<li><a href='../../../date/2009/04.html' title='Апрель 2009'>Апрель 2009</a></li>
	<li><a href='../../../date/2009/03.html' title='Март 2009'>Март 2009</a></li>
	<li><a href='../../../date/2009/02.html' title='Февраль 2009'>Февраль 2009</a></li>
	<li><a href='../../../date/2009/01.html' title='Январь 2009'>Январь 2009</a></li>
	<li><a href='../../../date/2008/12.html' title='Декабрь 2008'>Декабрь 2008</a></li>
	<li><a href='../../../date/2008/11.html' title='Ноябрь 2008'>Ноябрь 2008</a></li>
	<li><a href='../../../date/2008/10.html' title='Октябрь 2008'>Октябрь 2008</a></li>
	<li><a href='../../../date/2008/09.html' title='Сентябрь 2008'>Сентябрь 2008</a></li>
	<li><a href='../../../date/2008/08.html' title='Август 2008'>Август 2008</a></li>
	<li><a href='../../../date/2008/03.html' title='Март 2008'>Март 2008</a></li>
	<li><a href='../../../date/2008/02.html' title='Февраль 2008'>Февраль 2008</a></li>
	<li><a href='../../../date/2007/12.html' title='Декабрь 2007'>Декабрь 2007</a></li>
	<li><a href='../../../date/2007/11.html' title='Ноябрь 2007'>Ноябрь 2007</a></li>
	<li><a href='../../../date/2007/10.html' title='Октябрь 2007'>Октябрь 2007</a></li>
	<li><a href='../../../date/2007/09.html' title='Сентябрь 2007'>Сентябрь 2007</a></li>
	<li><a href='../../../date/2007/08.html' title='Август 2007'>Август 2007</a></li>
	<li><a href='../../../date/2007/07/index.html' title='Июль 2007'>Июль 2007</a></li>
	<li><a href='../../../date/2007/06.html' title='Июнь 2007'>Июнь 2007</a></li>
	<li><a href='../../../date/2007/05.html' title='Май 2007'>Май 2007</a></li>
				</ul>
			</li>

			
					</ul>
	</div>

</div> <!-- wrapper -->
<div id="footer">
	<a href="../../../../feed">Entries (RSS)</a> and <a href="../../../../comments/feed">Comments (RSS)</a>. Valid <a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional"><abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a> and <a href="http://jigsaw.w3.org/css-validator/check/referer"><abbr title="Cascading Style Sheets">CSS</abbr></a>.<br />
	Powered by <a href="http://wordpress.org/" title="Powered by WordPress.">WordPress</a> and <a href="http://srinig.com/wordpress/themes/fluid-blue/">Fluid Blue theme</a>.<br />
	<!-- 15 queries. 0.098 seconds. -->
	</div>
</div> <!-- page -->
</body>
</html>
