<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>about NetApp   &raquo; compression</title>

<link rel="stylesheet" href="../../wp-content/themes/fluid-blue/style.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../wp-content/themes/fluid-blue/print.css" type="text/css" media="print" />
<link rel="alternate" type="application/rss+xml" title="about NetApp RSS Feed" href="../../feed" />
<link rel="pingback" href="../../xmlrpc.php.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 2.6" />

</head>

<body>
<div id="page">
<div id="header">
	<div id="headertitle">
		<h1><a href="../../index.html" title="about NetApp: Системы хранения данных как предмет разговора">about NetApp</a></h1>
		<p>Системы хранения данных как предмет разговора</p>
	</div> 
	<!-- Search box (If you prefer having search form as a sidebar widget, remove this block) -->
	<div class="search">
		<form method="get" id="searchform" action="../../index.html">
<input type="text" size="20" name="s" id="s" value="Поиск..."  onblur="if(this.value=='') this.value='Поиск...';" onfocus="if(this.value=='Поиск...') this.value='';"/>
</form>
	</div> 
	<!-- Search ends here-->
		
</div>

<div id="navbar">
<ul id="nav">
	<li><a href="../../index.html">Home</a></li>
	<li class="page_item page-item-153"><a href="../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul>
</div>
<div id="wrapper">

	<div id="content">

	
			<p>Posts tagged &#8216;compression&#8217;</p>

	 		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

						
			<div class="post" id="post-1125">
				<h2 class="posttitle"><a href="../1125/trackback.html" rel="bookmark" title="Permanent Link to Компрессия данных в WAFL: Как это работает?">Компрессия данных в WAFL: Как это работает?</a></h2>
				<div class="postmetadata">5 Март 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Я уже рассказывал о том, что, начиная с ONTAP 8.х, и на 64-bit aggregate, у WAFL есть механизм компрессии хранимых на дисках данных. Механизм онлайн-компрессии сравнительно хорошо знаком пользователям, так как, например, давно поддерживается на NTFS. Однако, по моим наблюдениям, используют его не так часто, боясь его заметного влияния на производительность, и большей нагрузки на процессор сервера. Следует, тем не менее, отметить, что для современных процессоров, производительность которых <em>сильно</em> выросла со времен <em>Stacker</em> и <em>MS DiskDrive</em>, такая дополнительная нагрузка на процессор операций запаковки-распаковки весьма незначительна по абсолютной величине, но при этом значительно уменьшает объемы дискового трафика. Например, если компрессия, вдвое уменьшает “футпринт”, то есть хранимый объем данных, то за счет сравнительно небольшого увеличения (проценты, как правило) нагрузки на процессор, мы можем вдвое увеличить производительность чтения-записи, так как объем данных считываемых и записываемых на диск уменьшается, в нашем случае, вдвое, данные попадают на диск и считываются с него всегда уже сжатыми. </p>
<p>Так что влияние компрессии на производительность может быть совсем не столь однозначно отрицательным.</p>
<p>Но любопытно подробнее разобраться с тем, как реализована компрессия у NetApp. Дело в том, что для файловых систем, хранящих данные в фиксированных блоках-“кластерах” файловой системы, компрессия внутри этих кластеров, зачастую, бесполезна. Данные не могут занимать места менее одного блока (для WAFL – 4KB), то есть экономия места внутри блока никак не может быть использована. Сложность вызывает также работа с большим файлами. Например, в случае “обычной” компрессии файла архиватором типа ZIP, и прочими аналогичными, нам, часто, для того, чтобы извлечь, изменить или записать данные в середину большого файла, приходится распаковать и перепаковать его целиком. Это влечет за собой большую затрату времени и занятой памяти RAM. То что годится для оффлайновых архиваторов – не подходит для онлайн-компрессии.</p>
<p>При создании механизма компрессии инженерам NetApp пришлось решить как эти, так и многие другие проблемы.</p>
<p>Первый интересный с точки зрения “техники процесса” момент организации работы компрессии состоит в том, что алгоритм компрессии работает не с “файлом” целиком, а бъет его на фиксированные сегменты, под названием “Compression Groups”. Каждая Compression Group содержит 8 секторов WAFL, размером 4KB, и имеет размер 32K. </p>
<p><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="basics-fig2[1]" border="0" alt="basics-fig2[1]" src="/pics/----WAFL-_96B7/basics-fig21.jpg" width="484" height="169" /></p>
<p>Каждый файл, размещенный на томе, со включенной компрессией, рассматривается алгоритмом компрессии как разбитый на некоторое количество независимо обрабатываемых Compression Groups (CG). Например файл, размером 60KB будет содержать две CG, одну размером 32KB, и одну неполную, размером 28KB. При этом компрессия не применяется к файлам, размерам 8KB и менее.</p>
<p>Каждая CG обрабатывается отдельно, а, при необходимости считывания части файла “из середины”, считывается и распаковывается не весь файл, а только необходимая Compression Group в нем.</p>
<p>Но это еще не все интересное.</p>
<p>Выглядит довольно очевидным решение как-то определять факт невозможности или низкой эффективности сжатия для данных, и данные, которые не жмутся (например JPEG, ZIP, MP3 или AVI) не жать вовсе, сэкономив на этом ресурсы процессора. Ведь в противном случае процессор будет полноценно занят сжатием-разжатием содержимого Compression Groups ради жалких долей процента результата. ??менно так поступили в NetApp. Перед операцией для Compression Group определяется эффективность сжатия, и, если результат получается ниже 25% (менее четверти содержимого группы, то есть менее 8KB, удается высвободить в результате компрессии), то сжатие для данной группы не прозводится вовсе и она записывается неизменной.</p>
<p>Наконец, любопытным решением является разделение операций на онлайновые (inline), то есть производящиеся непосредственно “на лету”, по ходу поступления данных, и постпроцессные (postprocess). Постпроцессный метод уже широко применяется в механизме дедупликации, и позволяет свести к минимуму влияние процесса дедупликации на работу системы и ее производительность.</p>
<p>Несмотря на то, что большинство операций компрессии могут выполнятьcя <em>inlne</em>, в ряде случаев часть операций может оуществляться постпроцессно. Постпроцессная компрессия применяется, в первую очередь, к данным, которые уже лежат на диске, до того, как для содержащего их тома была включена компрессия. Кроме этого, в случае, если инлайновая компрессия не успевает обрабатывать данные, например при большом объеме записей, они также откладываются, записываются несжатыми, и становятся в очередь постпроцессной компрессии.</p>
<p>Постпроцессная компрессия выполняется по тому же расписанию, что и дедупликация, и запускается после выполнения процесса дедупликации для данного тома. Стоит также отметить, что дедупликация и компрессия возможны на одном и том же томе, прекрасно сосуществуют, и не отменяют одна другую. Более того, компрессия после дедупликации вполне возможна. Представьте себе множество виртуальных машин, которые хорошо дедуплицируются, так как содержат одно и то же содержимое, и дедупликация позволит нам хранить не сто виртуальных машин, а одну (и некоторое количество сохраненной “дельты” между этой VM и сотней индивидуальных VM с дедуплицированным нами содержимым) . Но ведь файлы Program Files или пользовательские файлы этого единственного экземпляра, как правило, можно еще и сжать раза в полтора! ?? эта компрессия будет осуществлена над уже дедуплицированным содержимым.</p>
<p>Следует также отметить, что компрессия, так как она осуществляется над фиксированными Compression Groups, не мешает работе дедупликации. Два идентичных и хорошо дедуплицируемых файла, будут разбиты на одинаковое количество Compression Groups, и получившиеся 32KB группы после компрессии останутся по-прежнему идентичными и по прежнему дедуплицируемыми.</p>
<p>Хотя в NetApp предприняли значительные усилия, чтобы повысить эффективность и постараться обеспечить наименьшее влияние на производтельность при работе компрессии, какое-то влияние на производительность (зависящее от множества факторов, как то объемы записей, характер доступа, и так далее) все равно, безусловно, будет иметь место. </p>
<p>Лаборатория NetApp опубликовала следующие оценки производительности для системы FAS6080 (на сегодня это уровень хорошего такого midrange класса FAS3240, пожалуй). Для такой системы были достигнуты показатели работы постпроцессной компрессии на уровне 140MB/s для одного процесса, и 210MB/s максимальной производительности для нескольких процессов одновременно. На загрузке характера файлового сервера, с нагрузкой на процессор не более 50%, задачи inline-компрессии увеличивали нагрузку на менее чем 20% для датасетов, сжимающихся минимум на 50%.</p>
<p>Оценочная эффективность компрессии и дедупликации показывается NetApp для разных наборов данных на следующем графике:</p>
<p><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="basics-fig1[2]" border="0" alt="basics-fig1[2]" src="/pics/----WAFL-_96B7/basics-fig12.jpg" width="600" height="420" /></p>
<p>Я бы хотел также упомянуть, что имеющаяся у партнеров NetApp утилита SSET (Space Savings Estimation Tool) в текущей версии позволяет провести оценку эффекивности дедупликации <strong>??</strong> компрессии на реальных пользовательских данных, вычисляя на них результат работы алгоритма NetApp. Эта утилита запускается на реальных данных пользователя, работая в read-only, и, никак не изменяя и не повреждая эти данные, позволяет оценить результат дедупликации и компрессии даже без использования стораджа NetApp, например до его покупки. Эту утилиту можно просить у партнеров, она имеется для Linux и Windows.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="81-ontap.html" rel="tag">8.1 ontap</a>, <a href="compression.html" rel="tag">compression</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="wafl/index.html" rel="tag">wafl</a><br />					Раздел: <a href="../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../1125/trackback.html#comments" title="Комментарий к записи Компрессия данных в WAFL: Как это работает?">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1077">
				<h2 class="posttitle"><a href="../1077.html" rel="bookmark" title="Permanent Link to Flash Cache/PAM не кэширует WAFL-compressed данные">Flash Cache/PAM не кэширует WAFL-compressed данные</a></h2>
				<div class="postmetadata">31 Октябрь 2011, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Хотел бы обратить внимание тех, кто планирует использование новой возможности на системах хранения NetApp – <em>WAFL online compression</em>, то есть сжатия данных “на лету”, для хранения их на диске в сжатом виде. В настоящий момент блоки, которые были компрессированы таким образом, не кэшируются в Flash Cache / PAM.</p>
<p>Как вы знаете, у NetApp есть сейчас две основных технологии снижения storage footprint, то есть объемов хранения, занимающих физическое дисковое пространство, это давно существующая и хорошо себя зарекомендовавшая во многих случаях <em>дедупликация</em>, и появившаяся сравнительно недавно <em>онлайн-компрессия</em>. Две эти технологии существуют и работают независимо друг от друга, и даже дополняют друг друга. Каждая из них имеет свои предпочтительные области применения. Например, дедупликация хорошо работает для сред виртуализации, где ее эффективность (величина экономии после ее применения) может достигать 70-85% от первоначально занятого на дисках, но в рядя других применений, например для баз данных, ее эффективность (по разным причинам, на которых мы не будем сейчас подробно останавливаться) значительно ниже, часто не более 10-20%. </p>
<p>Напротив, компрессия довольно неплохо уменьшает объем хранения для пользовательских файлов и баз данных (35-50%). Она также сравнительно неплохо работает даже и на <em>уже дедуплицированных данных</em>, что может еще повысить результаты экономии.</p>
<p>Сравнительно неплохая эффективность компрессии на датасетах типа баз, например, может натолкнуть вас на мысль использовать компрессию для ваших баз данных, на системах, которые часто используют Flash Cache для повышения производительности работы. Но тут вот стоит принять во внимание момент, который я вынес в заголовок заметки: Блоки, которые располагаются на томе, с включенной компрессией, и подверглись компрессии, не кэшируются во Flash Cache.</p>
<p>Это диаметральным образом противоположно ситуации с дедупликацией, так как дедуплицированные блоки, напротив, попадают в <em>dedupe-aware</em> кэш, который знает о их дедуплицированности, и умеет ее использовать (например блок, на который на диске имеется десять ссылкок из десяти разных VMDK, будет считан и находиться в кэше не в 10, как в традиционной форме кэширования, а всего в одном экземпляре, что, очевидно, увеличивает эффективную емкость кэша). </p>
<p>Если у вас система с Flash Cache, и вы одновременно собираетесь использовать компрессию для данных – то будьте внимательны. Компрессированные тома в системе с Flash Cache могут иметь значительно отличающуюся от некомпрессированных производительность, за счет того, что с некомпрессированными томами работа будет идти через Flash Cache, а с компрессированными – нет. Эта разница, не слишком заметная для систем без Flash Cache, за счет такого поведения для систем с Flash Cache, может быть неприятным сюрпризом.</p>
<p>Эта особенность работы компрессии описана в новом <strong>TR-3958 Compression and Deduplication for DataONTAP 8.1 operating in 7-Mode</strong> на странице 22: </p>
<p>7.6 PAM AND FLASH CACHE CARDS </p>
<p>In environments with high amounts of shared blocks that are read repeatedly, the PAM or Flash Cache card can significantly reduce the number of disk reads, thus improving the read performance. <font color="#ff0000">The PAM or Flash Cache card does not increase performance of the compression engine or of reading compressed data</font>. The amount of performance improvement with the PAM or Flash Cache card depends on the amount of shared blocks, the access rate, the active dataset size, and the data layout. The PAM or Flash Cache card has provided significant performance improvements in VMware® VDI environments. These advantages are further enhanced when combined with shared block technologies, such as NetApp deduplication or NetApp FlexClone® technology.</p>
<p>Так что обратите внимание на этот момент, и не применять компрессию для томов, производительность которых для вашей задачи критична, и которые вы планируете ускорить с помощью Flash Cache</p>
<p>UPD: Попросили уточнить. По-прежнему кэшируются во Flash Cache НЕсжатые блоки на сжатом томе (например, если эти блоки были исключены из процесса сжатия в результате плохого compression rate на этапе estimate для этих блоков). Но, так как нет механизма управлять тем, какие именно блоки или файлы будут компрессированы на томе, а какие - нет (компрессия назначается на том целиком), то это, в общем, довольно <i>теоретическая</i> поправка, не меняющая моей итоговой рекомендации.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="compression.html" rel="tag">compression</a>, <a href="deduplication/index.html" rel="tag">deduplication</a>, <a href="flash-cache.html" rel="tag">flash cache</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="wafl/index.html" rel="tag">wafl</a><br />					Раздел: <a href="../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<span>Comments Off</span>									 </div>
			</div>
	
						
			<div class="post" id="post-787">
				<h2 class="posttitle"><a href="../787/trackback.html" rel="bookmark" title="Permanent Link to Компрессия или дедупликация?">Компрессия или дедупликация?</a></h2>
				<div class="postmetadata">13 Декабрь 2010, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Появление в арсенале у NetApp такого средства экономии пространства хранения, как онлайн-компрессии данных, в дополнение к уже хорошо знакомому, надеюсь, процессу дедупликации, породило ряд вопросов и замешательство. Что выбрать? Что лучше?</p>
<p>Лучше то, что лучше работает на ваших данных и ваших задачах.</p>
<p>Обратите внимание, что использование дедупликации или компрессии не исключает одно другого. Вы вполне можете использовать <strong>??</strong> дедупликацию <strong>??</strong> компрессию на одном и то же томе. ??ли же выбрать что-то одно. Зависит от вашей задачи и характера даных.</p>
<p>Вот какой рисунок приводит NetApp по поводу эффективности дедупликации и компрессии в одном из своих документов (выше – лучше):</p>
<p><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="dedupe compress-rate" border="0" alt="dedupe compress-rate" src="/pics//dedupecompress-rate.jpg" width="605" height="480" /></p>
<p>Выбор за вами. Напомню, что преимуществом дедупликации является “оффлайновость”, так как процесс дедупликации происходит после фактической записи данных, то дедупликация практически не ухудшает производительности на дедуплицированном томе. В то же время компрессия&#160; “онлайновая”, и сильнее обычного загружает процессор контроллера системы хранения непосредственно во время записи-считывания данных. Преимуществом же онлайн-компрессии является то, что хорошо сжимаемые данные сразу займут на дисках при записи меньше места, в отличие от дедупликации, при которой такое место освободится только после окончания процесса дедупликации (как правило после нескольких часов). Кроме того, часть данных (см. рисунок) может плохо дедуплицироваться, но хорошо сжиматься.</p>
<p>Так или иначе, выбор в ваших руках. Напомню, что и компрессия, и дедупликация могут быть беболезненно отключены и “откачены” в случае обнаружения заметного негативного эффекта использования. Напомню, также, что, как и дедупликация, компрессия для системы хранения NetApp – бесплатна.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="compression.html" rel="tag">compression</a>, <a href="deduplication/index.html" rel="tag">deduplication</a>, <a href="netapp/index.html" rel="tag">netapp</a><br />					Раздел: <a href="../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>,  <a href="../category/whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;" rel="category tag">whoisho</a>&nbsp;&nbsp;|&nbsp;
					<a href="../787/trackback.html#comments" title="Комментарий к записи Компрессия или дедупликация?">Комментарии (7)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-772">
				<h2 class="posttitle"><a href="../772/trackback.html" rel="bookmark" title="Permanent Link to Компрессия на WAFL &ndash; некоторые подробности">Компрессия на WAFL &ndash; некоторые подробности</a></h2>
				<div class="postmetadata">25 Ноябрь 2010, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Как я уже писал раньше, начиная с Data ONTAP 8.0.1, для пользователей систем хранения NetApp становится доступной опция компрессии хранимых на дисках данных. Эта возможность довольно популярна среди современных файловых систем, например она хорошо работает в NTFS. Теперь эта возможность, дополняющая дедупликацию, появилась у NetApp.</p>
<p>Прозрачная онлайн-компрессия происходит в момент, когда файл данных находится в памяти на пути к дискам. После компрессии, сжатый файл записывается на диск, а при считывании – читается сжатым, а затем распаковывается в памяти, и передается запросившему его распакованным. Большим преимуществом такой схемы является то, что все эти процессы являются прозрачными для пользователя и его приложений. Ему не надо заботиться о запаковке и распаковке, он всегда записывает и получает обратно свой исходный файл, всеми операциями по его преобразованию занимается OS.</p>
<p>Преимущество хранения скомпрессированного файла очевидно. В такой форме файлы занимают значительно меньше места на диске. Насколько меньше – зависит от характера данных. Например уже обработанные тем или иным компрессором файлы, а также цифровое видео и аудио, обычно также сжатое тем или иным алгоритмом, уже практически не сжимается. ??сполняемые файлы, например программы, сжимаются примерно на 25-35%. Файлы данных, такие, как документы Word и Excel – обычно на 30-50 процентов.</p>
<p>Недостаток, в принципе, тоже очевиден. Операции запаковки и распаковки больше обычного нагружают процессор системы. Насколько сильно – зависит от характера данных, а также мощности процессоров.</p>
<p>Еще одним неявным преимуществом хранения данных в таком виде, которое часто недооценивается, является, как ни парадоксально, улучшение показателей производительности считывания с дисков для сжатых файлов. Ведь если мы храним файл, сжатый на 50%, то для того, чтобы считать его с дисков (сжатый), нам придется прочесть с этих дисков в память поток байт вдвое меньший, чем для некомпрессированного файла. Лучше, следовательно, могут стать и показатели IOPS системы.    <br />Платим за это мы потенциально большей нагрузкой на процессор, все верно. Однако, в наше время, производительности процессоров на такие несложные, хорошо известные и эффективные алгоритмы, как онлайн-компрессия, хватает с огромным запасом.&#160; Во многих случаях разница в загрузке процессора даже оказывается ниже измеряемого уровня. Пожертвовать ради увеличения дисковой производительности единицами процентов загрузки процессоров, мощность которых непрерывно растет кадый год, по сравнению с показателями в IOPS для дисков, которые застыли и не улучшаются уже довольно давно, бывает вполне неплохим вариантом “обмена”.</p>
<p>Однако реализация онлайн-компрессии связана с необходимостью решения ряда технических проблем. Например, неэффективно было бы компрессировать весь файл целиком, ведь это потребовало бы держать его целиком в памяти, более того, при необходимости изменения данных в середине такого файла, нам пришлось бы считать его в память целиком, разархивировать, изменить запрошенные участки, а затем заархивировать и записать его назад на диски, причем целиком.</p>
<p>Теоретически мы могли бы попробовать архивировать отдельно составляющие файл блоки WAFL размером 4KB, используя компрессию на уровне блоков , но что делать с высвободившемся от такой компрессии местом? WAFL не может работать с местом на таком “субблочном” уровне. Если у нас есть файл, который занимает 3 блока WAFL по 4KB, то еть имеет размер в 12KB, и файл сжимается вдвое, то после компрессии на уровне блоков WAFL мы получим три наполовину пустых блока WAFL, однако свободное место на них (так называемые tail-ы) использовать не получится – субблочное пространство не адресуется в ONTAP, и файл по прежнему будет занимать три блока – 12KB.</p>
<p>Выход – в использовании групповой обработки. Каждый хранимый файл последовательно делится на так называемые compression groups, размером 32KB, то есть состоящие из 8 блоков WAFL, с которыми и производятся неободимые операции. Compression Groups рассматриваются как единый объект воздействия компрессии. Поделенный на такие группы файл считывается только в той части, что необходима. Если нам нужно изменить блок данных в середине, то считывается в память 32KB данных, содержащих данный блок, блок изменяется, и затем группа компресируется и записывается.</p>
<p><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="compression-1" border="0" alt="compression-1" src="/pics//compression-1.jpg" width="400" height="139" /></p>
<p>Любопытно, что перед тем, как компрессировать группу, Data ONTAP проводит “на лету” оценку эффективности компрессии. Если компрессия незначительна (очевидно, что это менее 1/8 размера), то группа записывается в исходном виде. Таким образом, файл сжатого видео, записанный на “сжатый” том, будет записан в “исходном” его состоянии, время и процессор на сжатие явно несжимаемго не тратятся. Оценка же производится для 32KB групп. Если внутри в целом несжимаемого файла обнаружится последовательный блок размером 32KB и более, пригодный для сжатия, он будет сжат обычным образом.</p>
<p>Как обычно, коротко, в вопросах и ответах.</p>
<p>Q: Сколько это стоит?    <br />А: Данная лицензия будет доступна бесплатно, как, например, было и есть с дедупликацией.</p>
<p>Q: Это будет работать только для Data ONTAP 8?    <br />A: Нет, еще какое-то время будет продолжаться развитие ветви “семерки”, и, по предварительным данным, в ней тоже будет доступна компрессия. Если у вас активна подписка на обновление ПО, и вы можете поставить новую версию ONTAP на вашу систему, в ней будет и компрессия. Но вообще говоря, стоит уже задуматься о переходе на Generation 8.</p>
<p>Q: Это вместо дедупликации?    <br />A: Нет, это работает независимо, и может компресировать даже уже дедуплицированные тома! ?? дедупликацию, и компрессию, вы можете использовать независимо, и даже одновременно, на одних и тех же томах.</p>
<p>Q: А если дедупликация уже дедуплицировала, разве остается что-то, что можно еще и сжать?    <br />A: Конечно. Вот, например, описание эксперимента, в котором оценивалась эффектвноссть дедупликации и компрессии: <a href="http://habrahabr.ru/blogs/sysadm/104979/">http://habrahabr.ru/blogs/sysadm/104979/</a>     <br />Кроме этого, представим, что у нас на диске лежит сто одинаковых документов. После дедупликации у нас на диске останутся занятыми только блоки одного экземпляра (и по 99 ссылок на них из других файлов). Но этот единственный файл, в свою очередь также можно скомпрессировать! На дедупликацию и содержимое остальных, дедуплицированных файлов это не повлияет. Они просто будут ссылться на компрессированные блоки.</p>
<p>Q: Когда компрессировать получается лучше, чем дедуплицировать?    <br />A1: Представим себе, что на диске лежит множество файлов, которые уникальны по содержимому. То есть, например, текстовая база документов. Каждый, кто архивировал текстовые файлы знает, что такие файлы хорошо компрессируются. Однако вероятнее всего, в неповторяющихся файлах, дедупликация будет неэффективна. Ведь в таких файлах наверняка нет кусков по 4KB размером, строго идентичных до байта. Любая неидентичность в пределах блока WAFL в 4KB отменяет возможность дедупликации.     <br />A2: Другой вариант, сильно ухудшающий возможности дедупликации – смещение. Даже незначительное смещение в содержимом файлов мешает правильно сработать дедупликации. Но ничуть не ухудшает возможности компрессии.</p>
<p>Q: А что вообще лучше, дедупликация или компрессия?    <br />A: Для разных применений – лучше разное. Что-то лучше дедуплицируется, пример – файлы дисков виртуальных машин, что-то – компрессируется, пример – большинство баз данных, или хоумдиры документов с малым количеством дублирующихся между разными пользователями данных, или бэкапы с переменным смещением, сильно портящие “статистику” дедупликации. Наконец, вы можете компрессировать уже дедуплицированные данные.    <br />Конечно, дедупликация несколько меньше нагружает систему по процессорным ресурсам и почти не влияет на производительность, так как работает, в отличие от компрессии, в “оффлайне”. Но в ряде случаев и нагрузкой компрессии можно пренебречь, а экономия пространства – штука нелишняя. Смотрите по обстановке.</p>
<p>Q: Круто, спасибо!    <br />A: Да на здоровье :)</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="compression.html" rel="tag">compression</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="techtalk/index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../772/trackback.html#comments" title="Комментарий к записи Компрессия на WAFL &ndash; некоторые подробности">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-641">
				<h2 class="posttitle"><a href="../641/trackback.html" rel="bookmark" title="Permanent Link to Компрессия на WAFL?">Компрессия на WAFL?</a></h2>
				<div class="postmetadata">22 Июль 2010, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>В <a href="http://blogs.netapp.com/virtualstorageguy/2010/07/data-deduplication-and-data-compression-in-data-ontap.html">блоге Vaughan Stewart</a> была найдена интресная картинка:</p>
<p><a href="/pics//compression.jpg"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="compression" border="0" alt="compression" src="/pics//compression-thumb.jpg" width="564" height="480" /></a> </p>
<p>Да, это то что вы подумали. Начиная с Data ONTAP 7.3.3 и 8.0.1 на WAFL теперь работает компрессия (лицензия бесплатна, как iSCSI, или дедупликация, например), причем использование компрессии не отменяет и не заменяет, и может использоваться как совместно с дедупликацией, так и по отдельности. Это такая же знакомая и привычная онлайн-компрессия как на NTFS, например.</p>
<p>Компрессия пригодится в случаях, когда на диске лежат различные по содержимому данные, но не слишком дублирующиеся внутри на уровне 4KB-блоков WAFL. Тем не менее содержимое этих файлов вполне может сжиматься классическими LZ-алгоритмами. Например у меня на ноутбуке папка Program Files диска C: сжата почти на 30% от ее, примерно 2GB, объема.   <br />Хороший пример – homedir различных пользователей организации. Хотя в хоумдирах иногда и попадаются идентичные документы и файлы у разных людей, в основном же, как показывает практика, большая часть содержимого хоумдиров достаточно уникальна, и не слишком эффективно дедуплицируется. Однако вполне поддается традиционному zip-like сжатию с неплохими показателями.</p>
<p>Для 7.3.3 компрессия идет как PVR, то есть доступна по запросу, но запланирована как стандартная опция в 8.0.1, которая выйдет этой осенью.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="compression.html" rel="tag">compression</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="wafl/index.html" rel="tag">wafl</a>, <a href="news/index.html" rel="tag">новости</a><br />					Раздел: <a href="../category/news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;" rel="category tag">новости</a>&nbsp;&nbsp;|&nbsp;
					<a href="../641/trackback.html#comments" title="Комментарий к записи Компрессия на WAFL?">Комментарии (4)</a>									 </div>
			</div>
	
		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>
		
	
	</div>
	<div id="sidebar">
		<ul>
			
			
			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Автор</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			<li class="pagenav"><h2>Страницы</h2><ul><li class="page_item page-item-153"><a href="../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul></li>
			<li><h2>Рубрики</h2>
				<ul>
					<li class="cat-item cat-item-89"><a href="../category/commands/index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;">commands</a>
</li>
	<li class="cat-item cat-item-37"><a href="../category/howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;">howto</a>
</li>
	<li class="cat-item cat-item-52"><a href="../category/justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;">justread</a>
</li>
	<li class="cat-item cat-item-51"><a href="../category/review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;">review</a>
</li>
	<li class="cat-item cat-item-3"><a href="../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;">techtalk</a>
</li>
	<li class="cat-item cat-item-71"><a href="../category/tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;">tricks</a>
</li>
	<li class="cat-item cat-item-95"><a href="../category/utilities/index.html" title="Просмотреть все записи в рубрике &laquo;utilities&raquo;">utilities</a>
</li>
	<li class="cat-item cat-item-44"><a href="../category/whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;">whoisho</a>
</li>
	<li class="cat-item cat-item-1"><a href="../category/news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;">новости</a>
</li>
	<li class="cat-item cat-item-387"><a href="../category/opros.html" title="Просмотреть все записи в рубрике &laquo;опрос&raquo;">опрос</a>
</li>
	<li class="cat-item cat-item-8"><a href="../category/translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;">переводы</a>
</li>
	<li class="cat-item cat-item-40"><a href="../category/citaty/index.html" title="Просмотреть все записи в рубрике &laquo;цитаты&raquo;">цитаты</a>
</li>
				</ul>
			</li>

			<li><h2>Архивы</h2>
				<ul>
					<li><a href='../date/2018/01.html' title='Январь 2018'>Январь 2018</a></li>
	<li><a href='../date/2015/10.html' title='Октябрь 2015'>Октябрь 2015</a></li>
	<li><a href='../date/2015/04.html' title='Апрель 2015'>Апрель 2015</a></li>
	<li><a href='../date/2015/03.html' title='Март 2015'>Март 2015</a></li>
	<li><a href='../date/2015/01.html' title='Январь 2015'>Январь 2015</a></li>
	<li><a href='../date/2014/12.html' title='Декабрь 2014'>Декабрь 2014</a></li>
	<li><a href='../date/2014/11.html' title='Ноябрь 2014'>Ноябрь 2014</a></li>
	<li><a href='../date/2014/10.html' title='Октябрь 2014'>Октябрь 2014</a></li>
	<li><a href='../date/2014/09.html' title='Сентябрь 2014'>Сентябрь 2014</a></li>
	<li><a href='../date/2014/08.html' title='Август 2014'>Август 2014</a></li>
	<li><a href='../date/2014/07.html' title='Июль 2014'>Июль 2014</a></li>
	<li><a href='../date/2014/06.html' title='Июнь 2014'>Июнь 2014</a></li>
	<li><a href='../date/2014/05.html' title='Май 2014'>Май 2014</a></li>
	<li><a href='../date/2014/04.html' title='Апрель 2014'>Апрель 2014</a></li>
	<li><a href='../date/2014/03.html' title='Март 2014'>Март 2014</a></li>
	<li><a href='../date/2014/02.html' title='Февраль 2014'>Февраль 2014</a></li>
	<li><a href='../date/2014/01.html' title='Январь 2014'>Январь 2014</a></li>
	<li><a href='../date/2013/12.html' title='Декабрь 2013'>Декабрь 2013</a></li>
	<li><a href='../date/2013/11.html' title='Ноябрь 2013'>Ноябрь 2013</a></li>
	<li><a href='../date/2013/10.html' title='Октябрь 2013'>Октябрь 2013</a></li>
	<li><a href='../date/2013/09.html' title='Сентябрь 2013'>Сентябрь 2013</a></li>
	<li><a href='../date/2013/08.html' title='Август 2013'>Август 2013</a></li>
	<li><a href='../date/2013/07.html' title='Июль 2013'>Июль 2013</a></li>
	<li><a href='../date/2013/06.html' title='Июнь 2013'>Июнь 2013</a></li>
	<li><a href='../date/2013/05.html' title='Май 2013'>Май 2013</a></li>
	<li><a href='../date/2013/04.html' title='Апрель 2013'>Апрель 2013</a></li>
	<li><a href='../date/2013/03.html' title='Март 2013'>Март 2013</a></li>
	<li><a href='../date/2013/02.html' title='Февраль 2013'>Февраль 2013</a></li>
	<li><a href='../date/2013/01.html' title='Январь 2013'>Январь 2013</a></li>
	<li><a href='../date/2012/12.html' title='Декабрь 2012'>Декабрь 2012</a></li>
	<li><a href='../date/2012/11.html' title='Ноябрь 2012'>Ноябрь 2012</a></li>
	<li><a href='../date/2012/10.html' title='Октябрь 2012'>Октябрь 2012</a></li>
	<li><a href='../date/2012/09.html' title='Сентябрь 2012'>Сентябрь 2012</a></li>
	<li><a href='../date/2012/08.html' title='Август 2012'>Август 2012</a></li>
	<li><a href='../date/2012/07.html' title='Июль 2012'>Июль 2012</a></li>
	<li><a href='../date/2012/06.html' title='Июнь 2012'>Июнь 2012</a></li>
	<li><a href='../date/2012/05.html' title='Май 2012'>Май 2012</a></li>
	<li><a href='../date/2012/04.html' title='Апрель 2012'>Апрель 2012</a></li>
	<li><a href='../date/2012/03.html' title='Март 2012'>Март 2012</a></li>
	<li><a href='../date/2012/02.html' title='Февраль 2012'>Февраль 2012</a></li>
	<li><a href='../date/2012/01.html' title='Январь 2012'>Январь 2012</a></li>
	<li><a href='../date/2011/12.html' title='Декабрь 2011'>Декабрь 2011</a></li>
	<li><a href='../date/2011/11.html' title='Ноябрь 2011'>Ноябрь 2011</a></li>
	<li><a href='../date/2011/10/index.html' title='Октябрь 2011'>Октябрь 2011</a></li>
	<li><a href='../date/2011/09/index.html' title='Сентябрь 2011'>Сентябрь 2011</a></li>
	<li><a href='../date/2011/08.html' title='Август 2011'>Август 2011</a></li>
	<li><a href='../date/2011/07/index.html' title='Июль 2011'>Июль 2011</a></li>
	<li><a href='../date/2011/06/index.html' title='Июнь 2011'>Июнь 2011</a></li>
	<li><a href='../date/2011/05/index.html' title='Май 2011'>Май 2011</a></li>
	<li><a href='../date/2011/04/index.html' title='Апрель 2011'>Апрель 2011</a></li>
	<li><a href='../date/2011/03/index.html' title='Март 2011'>Март 2011</a></li>
	<li><a href='../date/2011/02.html' title='Февраль 2011'>Февраль 2011</a></li>
	<li><a href='../date/2011/01.html' title='Январь 2011'>Январь 2011</a></li>
	<li><a href='../date/2010/12.html' title='Декабрь 2010'>Декабрь 2010</a></li>
	<li><a href='../date/2010/11/index.html' title='Ноябрь 2010'>Ноябрь 2010</a></li>
	<li><a href='../date/2010/10/index.html' title='Октябрь 2010'>Октябрь 2010</a></li>
	<li><a href='../date/2010/09/index.html' title='Сентябрь 2010'>Сентябрь 2010</a></li>
	<li><a href='../date/2010/08.html' title='Август 2010'>Август 2010</a></li>
	<li><a href='../date/2010/07/index.html' title='Июль 2010'>Июль 2010</a></li>
	<li><a href='../date/2010/06.html' title='Июнь 2010'>Июнь 2010</a></li>
	<li><a href='../date/2010/05.html' title='Май 2010'>Май 2010</a></li>
	<li><a href='../date/2010/04/index.html' title='Апрель 2010'>Апрель 2010</a></li>
	<li><a href='../date/2010/03/index.html' title='Март 2010'>Март 2010</a></li>
	<li><a href='../date/2010/02.html' title='Февраль 2010'>Февраль 2010</a></li>
	<li><a href='../date/2010/01.html' title='Январь 2010'>Январь 2010</a></li>
	<li><a href='../date/2009/12/index.html' title='Декабрь 2009'>Декабрь 2009</a></li>
	<li><a href='../date/2009/11/index.html' title='Ноябрь 2009'>Ноябрь 2009</a></li>
	<li><a href='../date/2009/10.html' title='Октябрь 2009'>Октябрь 2009</a></li>
	<li><a href='../date/2009/09.html' title='Сентябрь 2009'>Сентябрь 2009</a></li>
	<li><a href='../date/2009/08/index.html' title='Август 2009'>Август 2009</a></li>
	<li><a href='../date/2009/07/index.html' title='Июль 2009'>Июль 2009</a></li>
	<li><a href='../date/2009/06.html' title='Июнь 2009'>Июнь 2009</a></li>
	<li><a href='../date/2009/05.html' title='Май 2009'>Май 2009</a></li>
	<li><a href='../date/2009/04.html' title='Апрель 2009'>Апрель 2009</a></li>
	<li><a href='../date/2009/03.html' title='Март 2009'>Март 2009</a></li>
	<li><a href='../date/2009/02.html' title='Февраль 2009'>Февраль 2009</a></li>
	<li><a href='../date/2009/01.html' title='Январь 2009'>Январь 2009</a></li>
	<li><a href='../date/2008/12.html' title='Декабрь 2008'>Декабрь 2008</a></li>
	<li><a href='../date/2008/11.html' title='Ноябрь 2008'>Ноябрь 2008</a></li>
	<li><a href='../date/2008/10.html' title='Октябрь 2008'>Октябрь 2008</a></li>
	<li><a href='../date/2008/09.html' title='Сентябрь 2008'>Сентябрь 2008</a></li>
	<li><a href='../date/2008/08.html' title='Август 2008'>Август 2008</a></li>
	<li><a href='../date/2008/03.html' title='Март 2008'>Март 2008</a></li>
	<li><a href='../date/2008/02.html' title='Февраль 2008'>Февраль 2008</a></li>
	<li><a href='../date/2007/12.html' title='Декабрь 2007'>Декабрь 2007</a></li>
	<li><a href='../date/2007/11.html' title='Ноябрь 2007'>Ноябрь 2007</a></li>
	<li><a href='../date/2007/10.html' title='Октябрь 2007'>Октябрь 2007</a></li>
	<li><a href='../date/2007/09.html' title='Сентябрь 2007'>Сентябрь 2007</a></li>
	<li><a href='../date/2007/08.html' title='Август 2007'>Август 2007</a></li>
	<li><a href='../date/2007/07/index.html' title='Июль 2007'>Июль 2007</a></li>
	<li><a href='../date/2007/06.html' title='Июнь 2007'>Июнь 2007</a></li>
	<li><a href='../date/2007/05.html' title='Май 2007'>Май 2007</a></li>
				</ul>
			</li>

			
					</ul>
	</div>

</div> <!-- wrapper -->
<div id="footer">
	<a href="../../feed">Entries (RSS)</a> and <a href="../../comments/feed">Comments (RSS)</a>. Valid <a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional"><abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a> and <a href="http://jigsaw.w3.org/css-validator/check/referer"><abbr title="Cascading Style Sheets">CSS</abbr></a>.<br />
	Powered by <a href="http://wordpress.org/" title="Powered by WordPress.">WordPress</a> and <a href="http://srinig.com/wordpress/themes/fluid-blue/">Fluid Blue theme</a>.<br />
	<!-- 15 queries. 0.081 seconds. -->
	</div>
</div> <!-- page -->
</body>
</html>
