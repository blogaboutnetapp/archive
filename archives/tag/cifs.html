<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>about NetApp   &raquo; cifs</title>

<link rel="stylesheet" href="../../wp-content/themes/fluid-blue/style.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../wp-content/themes/fluid-blue/print.css" type="text/css" media="print" />
<link rel="alternate" type="application/rss+xml" title="about NetApp RSS Feed" href="../../feed" />
<link rel="pingback" href="../../xmlrpc.php.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 2.6" />

</head>

<body>
<div id="page">
<div id="header">
	<div id="headertitle">
		<h1><a href="../../index.html" title="about NetApp: Системы хранения данных как предмет разговора">about NetApp</a></h1>
		<p>Системы хранения данных как предмет разговора</p>
	</div> 
	<!-- Search box (If you prefer having search form as a sidebar widget, remove this block) -->
	<div class="search">
		<form method="get" id="searchform" action="../../index.html">
<input type="text" size="20" name="s" id="s" value="Поиск..."  onblur="if(this.value=='') this.value='Поиск...';" onfocus="if(this.value=='Поиск...') this.value='';"/>
</form>
	</div> 
	<!-- Search ends here-->
		
</div>

<div id="navbar">
<ul id="nav">
	<li><a href="../../index.html">Home</a></li>
	<li class="page_item page-item-153"><a href="../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul>
</div>
<div id="wrapper">

	<div id="content">

	
			<p>Posts tagged &#8216;cifs&#8217;</p>

	 		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>

						
			<div class="post" id="post-1255">
				<h2 class="posttitle"><a href="../1255/trackback.html" rel="bookmark" title="Permanent Link to Как переименовать CIFS/SMB-share">Как переименовать CIFS/SMB-share</a></h2>
				<div class="postmetadata">29 Апрель 2013, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Как ни удивительно прозвучит, но в Data ONTAP нет средства переименовать созданную сетевую NAS-шару. Но зато есть возможность задать одному тому более одного имени шары. Таким образом можно сделать (не)хитрый финт: вместо переименования шары, задаем ей новое имя, а старое – удаляем. Это можно сделать руками, если у вас этих шар немного. Но когда их сотни и тысячи, то хочется завести уже какой-то инструмент. ?? вот недавно я в communities.netapp нашел скрипт на Perl, который делает именно это.</p>
<p>
<pre><code>#!/usr/bin/perl -w
##########################################################
# cifs_share_rename
# rename a netapp cifs share
#Michael.S.Denney@gmail.com
$version=1.0;
##########################################################
#TO DO:
use strict;
use warnings;
use Getopt::Long;
use POSIX;
##################Global VARS#################################
use vars qw($version $verbose $debug $filer $share $new_share);
##################Predeclare SUBS#############################
use subs qw(run_cmd);
##############################################################
GetOptions(
          'f=s' =&gt; \$filer,
          'filer=s' =&gt; \$filer,
          's=s' =&gt; \$share,
          'share=s' =&gt; \$share,
          'n=s' =&gt; \$new_share,
          'new_share=s' =&gt; \$new_share,
          'v' =&gt; \$verbose,
          'd' =&gt; \$debug
);
my $t=' ';
print &quot;verbose on\n&quot; if $verbose;
print &quot;debug on\n&quot; if $debug;
$verbose=1 if $debug;
unless ($filer and $share and $new_share) {
   print &quot;Usage: cifs_share_rename -f <filer_name> -s <share_name> -n <new_share_name>\n&quot;;
   print &quot;Usage: cifs_share_rename --filer <filer_name> --share <share_name> --new_share <new_share_name>\n&quot;;
   exit 1 ;
}

my $cmd=&quot;ssh $filer cifs shares $share&quot;;
print &quot;$cmd\n&quot;;
my ($stdout,$stderr)=run_cmd $cmd;
if (@$stderr){
    print &quot;$_\n&quot; foreach (@$stderr);
    exit 1;
}
my $path;my $comment;my $access;my %security;

print &quot;search share=&gt;$share\n&quot;;
foreach (@$stdout){
   print &quot;$_\n&quot; ;
   if (/^\S+\s+(\/vol\/\S+\s+|\/vol\/\S+\/\S+\s+)(.*)?/){
      $path=$1;
      $comment=$2;
   }#end if regex
   if ( /\s+(.+)\s+\/\s+Read/g){
        push @{$security{read}},$1;
   }
   if ( /\s+(.+)\s+\/\s+Change/g){
      push @{$security{change}},$1;
   }
   if ( /\s+(.+)\s+\/\s+Full\sControl/g){
      push @{$security{'full control'}},$1;
   }

}
print &quot;path=&gt;$path\n&quot; if $path;
print &quot;comment=&gt;$comment\n&quot; if $comment;
print &quot;cifs read=&gt;$_ \n&quot; foreach (@{$security{read}});
print &quot;cifs full control=&gt;$_ \n&quot; foreach (@{$security{'full control'}});
print &quot;cifs change=&gt;$_ \n&quot; foreach (@{$security{change}});

$cmd=&quot;$t ssh $filer cifs shares -add $new_share $path -comment \'$comment\'&quot; if ($comment);
$cmd=&quot;$t ssh $filer cifs shares -add $new_share $path&quot; unless ($comment);
print &quot;$cmd\n&quot;;
($stdout,$stderr)=run_cmd $cmd;
if (@$stderr){
    print &quot;$_\n&quot; foreach (@$stderr);
    unless ((grep /MS-DOS/,@$stderr)and @$stderr == 1){
       exit 1;
    }
}
print &quot;$_\n&quot; foreach (@$stdout);

$cmd=&quot;$t ssh $filer cifs access -delete $new_share everyone&quot;;
print &quot;$cmd\n&quot;;
($stdout,$stderr)=run_cmd $cmd;
if (@$stderr){
    print &quot;$_\n&quot; foreach (@$stderr);
    exit 1 unless (grep /successfully modified/,@$stderr);
}
print &quot;$_\n&quot; foreach (@$stdout);

foreach my $type ('read','change','full control'){#type
   print &quot;type=$type\n&quot;;
   foreach (@{$security{$type}}){
      $cmd=&quot;$t ssh $filer cifs access $new_share \'$_\' $type&quot;;
      print &quot;$cmd\n&quot;;
      ($stdout,$stderr)=run_cmd $cmd;
      if (@$stderr){
          print &quot;$_\n&quot; foreach (@$stderr);
          exit 1 unless (grep /successfully modified/,@$stderr);
      }
      print &quot;$_\n&quot; foreach (@$stdout);
   }
}#end foreach type
$cmd=&quot;$t ssh $filer cifs shares -delete $share&quot;;
print &quot;$cmd\n&quot;;
($stdout,$stderr)=run_cmd $cmd;
if (@$stderr){
    print &quot;$_\n&quot; foreach (@$stderr);
    exit 1;
}
print &quot;$_\n&quot; foreach (@$stdout);
##########################################################
sub run_cmd{
##########################################################
   my $cmd=&quot; @_&quot;;
   my $err_file=&quot;/dev/shm/err.$$&quot;;
   $cmd.=&quot; 2&gt;$err_file&quot;;
   my @stdout=qx($cmd);
   chomp @stdout;
   my @stderr;
   if (-s $err_file) { #if the error file has messages
      open ERR,&quot;$err_file&quot;;
      @stderr=(<err>);
      close ERR;
      chomp @stderr;
      #print &quot;$_\n&quot; foreach (@stderr);
   }
   unlink ($err_file);
   return (\@stdout,\@stderr);
}</code></pre></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="cifs.html" rel="tag">cifs</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="rename.html" rel="tag">rename</a>, <a href="script.html" rel="tag">script</a>, <a href="share.html" rel="tag">share</a>, <a href="smb.html" rel="tag">smb</a><br />					Раздел: <a href="../category/howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../category/tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../1255/trackback.html#respond" title="Комментарий к записи Как переименовать CIFS/SMB-share">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1206">
				<h2 class="posttitle"><a href="../1206/trackback.html" rel="bookmark" title="Permanent Link to SMB 3.0">SMB 3.0</a></h2>
				<div class="postmetadata">20 Сентябрь 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Для начала терминологическое вступление. Вокруг файлового протокола Microsoft довольно много путаницы, начнем с ее распутывания.</p>
<ul>
<li><strong>SMB</strong> – <em>“Server Message Block”</em> – первоначальная версия протокола, разработанная еще во времена MS LAN manager 1.0(почти уже никто не застал те времена, и не помнит что это, совсем каменный век IT, середина 80-х). Некоторый отголосок этой аббревиатуры остался в названии опенсорсного продукта SAMBA, реализации файлового протокола SMB путем его реверс-инжиниринга. </li>
<li><strong>CIFS</strong> – (он же SMB-“просто” или SMB 1.0) – <em>“Common Internet File System”</em> – название CIFS появилось, когда Microsoft в 1996 году начала процесс стандартизации уже существовавшего протокола, в качестве RFC в IETF. Процесс стандартизации этот застопорился где-то на начальном этапе, и MS решила не продолжать его, остановившись на проведении в RFC первой версии драфта (сегодня его статус уже expired). Тем не менее название CIFS в индустрии закрепилось, и постепенно почти вытеснило SMB. </li>
<li><strong>SMB 2.0</strong> – протокол, появившийся в Windows Server 2008, Vista, и поддерживающийся в более поздних OS. Microsoft осознала в какой-то момент, что файловый протокол, разработанный в середине 80-х, пусть и весьма совершенный на тот момент, и имеющий возможности постепенного расширения и добавления возможностей на уровне протокола, страшно отстал от современности (ситуация как примерно с Internet Explorer), страдает рядом существенных проблем, которые стали более заметны с годами. ?? вот в компании дошли руки до начала глубокой модернизации протокола SMB. Обратите внимание, что SMB 2.0 уже некорректно называть “CIFS”. <strong><em>CIFS это только SMB 1.0</em></strong>, поэтому постепенно название CIFS будет уходить. Я, в свою очередь, в этом блоге также буду постепенно избавляться от термина “CIFS”. Если мы говорим о новых версиях файлового протокола Microsoft, то мы будем называть его SMB (v2.0, v2.1, v2.2 AKA v3.0). В SMB 2.0 (и последующих его модификациях: 2.1, 2.2) были улучшены многие насущно важные аспекты, мешавшие SMB 1.0. Протокол был значительно упрощен, и, вместе с тем, улучшен. Появилась возможность кэширования и объединения нескольких команд в одну “цепочку”. Улучшилась работа по “длинным” сетям с большими уровнями задержек, что позволили использовать SMB 2.0 даже в географически распределенных локальных сетях, соединенных через WAN и VPN. Улучшилась реакция на кратковременные дисконнекты сети и масштабируемость.       <br />Но работы в группе разработки SMB не стояли на месте, и к выходу Server 2012 была готова новая, еще более глубоко переработанная версия: </li>
<li><strong>SMB 3.0</strong> – это самая новая на сегодня версия файлового протокола Microsoft, с которым компания готова побороться с некоторым вынужденным засилием NFS в файловых системах хранения (NAS). В ее разработке MS буквально скакнула через несколько ступенек, и подготовила крайне интересный и современный продукт, с множеством новинок и хорошим заделом на будущее. Продолжая развитие SMB 2.0, в Microsoft еще более значительно улучшили производительность работы протокола, реализовали такие интересные вещи, как SMBDirect, с использованием RDMA Transport Protocol (Remote DMA, технология, используемая в высокоскоростых сетях, таких как 10G Ethernet и Infiniband) и поддержку многоканального режима, возможность использовать Remote VSS, BranchCache v2, Transparent Failover, шифрования. Немалую роль в популяризации и распространении SMB 3.0 должен сыграть и MS Hyper-V, впервые поддерживающий в его лице файловые протоколы для подключения стораджа. </li>
</ul>
<p>Официально о поддержке, кроме самой Microsoft, уже заявили EMC и NetApp, два крупнейших игрока рынка NAS, а также поддержка SMB 3.0 появится и в открытом проекте SAMBA. Есть надежда, что к этим игрокам, после выхода Server 2012 подтянутся и остальные, уж больно много полезного появилось в новом SMB.</p>
<p>Так, например, SMB 3.0 явственно нацелился не только на традиционный для SMB 1.0/CIFS/SMB 2.0 сегмент канала связи от сервера до конечной клиентской машины, но и на межсерверный коннект (как бы ни звучало это дико и невообразимо для Old Skool: “Между серверами по бэкбону гонять данные? MS SQL? Exchange? По <strike>CIFS</strike> SMB? Да вы шутите!”). Для этого в нем появились средства SMBDirect и multichannel, позволяющие полноценно использовать производительные возможности вплоть до все еще невообразимого многими 40G Ethernet. Например можно объединить на уровне протокола (а не EtherChannel) в мультилинковый “транк” четыре 10G-линка. А использование RDMA (наиболее известным пользователем технологий RDMA является протокол Infiniband, славящийся своей низкой латентностью) и iWARP (я рассказывал о них в <a href="../155/trackback.html">давней заметке</a> в этом блоге) позволит даже выйти по уровню латентности и полосе пропускания для файлового протокола на уровень FC, при этом сохранив все преимущества файлового, а не тупого блочного протокола.</p>
<p>SMB 2.0 поддерживается в системах NetApp уже довольно давно, и требует просто включения соответствующей опции в конфигурации (<code>&gt; options cifs.smb2.enable on</code> и <code>&gt; options cifs.smb2.client.enable on</code>), так что если вы используете в своей сети клиентов не ниже Windows Vista/7, и сервера не ниже Server 2008, то есть смысл включить на сторадже эти опции и перейти целиком на версию протокола SMB 2.0, вы можете получить довольно заметный <a href="http://media.netapp.com/documents/tr-3869.pdf">прирост в производительности</a>.</p>
<p>Поддержка SMB 3.0 в NetApp появится в версии Data ONTAP 8.2, планируемой к выпуску в RC осенью этого года.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="cifs.html" rel="tag">cifs</a>, <a href="microsoft.html" rel="tag">microsoft</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="smb.html" rel="tag">smb</a>, <a href="smb-20.html" rel="tag">smb 2.0</a>, <a href="smb-30.html" rel="tag">smb 3.0</a><br />					Раздел: <a href="../category/justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;" rel="category tag">justread</a>,  <a href="../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../1206/trackback.html#comments" title="Комментарий к записи SMB 3.0">Комментарии (18)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1137">
				<h2 class="posttitle"><a href="../1137/trackback.html" rel="bookmark" title="Permanent Link to WAFL File Folding">WAFL File Folding</a></h2>
				<div class="postmetadata">5 Апрель 2012, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>О любопытной функции внутри Data ONTAP прочитал недавно в блоге <a href="http://www.ntapgeek.com/2012/03/wafl-file-folding-explained.html">ntapgeek</a>. Эта фича называется WAFL File Folding и позволяет экономить место на дисках для файлов, отдаваемых по протоколу CIFS.</p>
<p>Принцип работы File Folding таков. Как вы уже знаете (а кто не знает – <a href="../39/trackback.html">идите и читайте</a>), все перезаписи данных на WAFL осуществляются, согласно конструкции файловой системы, таким образом, что они не меняют собственно содержимого блока данных в файле, а записываются в отдельный свободный блок, куда переставляется “указатель”-inode. Это позволяет быстро и просто делать снэпшоты, так как в WAFL не нужно, как во всех прочих реалиациях снэпшотов, переносить содержимое перезаписывамых блоков в отдельное место. Единожды записанный блок, помещенный в снэпшот, уже никак не будет изменен, так устроена FS.</p>
<p>Однако представим себе такую странную ситуацию, когда обширный файл, с которого у нас взят снэпшот, перезаписывается, целиком или полностью, ровно теми же данными, что уже лежат в нем. Для каждого блока такого файла на диске будет занято по меньшей мере два физческих блока. Один – оригинальный, лежащий запертым в снэпшоте, и второй – измененный, лежащий в пространстве “активной файловой системы”, даже несмотря на то, что содержимое этих блоков совершенно идентичное.</p>
<p>Я теряюсь в догадках, что это за операция такое проделвывает, но факт того, что это сделано именно для CIFS, подсказывает мне, что что-то в CIFS любит перезаписывать целиком файлы, даже, например, при незначительных изменениях в нем. Например, представм, что это какой-нибудь Winword, и в нем большой файл, в котором мы поправили запятую, и нажали “сохранить”. ?? весь этот файл, блок за блоком, перезаписался поверх теми же данными, что были (за исключением этой запятой). Не знаю, возможно кто-то подскажет, о чем тут идет речь.</p>
<p>Так или иначе, в результате такой перезаписи, мы будем иметь на дисках <strong>два</strong> файла, из равного набора блоков, один в снэпшоте, а один в собственно файловой системе, ведь WAFL не видит, что там такое произошло с файлом. Попросили из приложения перезаписать стотыщ блоков – вот вам стотыщ свободных блоков, пишите в них, ведь исходный файл в снэпшоте, блоки его нельзя трогать.</p>
<p>Вот для решения такой проблемы и предназначена малоизвестная фича, под названием WAFL File Folding.</p>
<p>Включают ее командой:</p>
<p><code>&gt; options cifs.snapshot_file_folding.enable on</code></p>
<p>и эта команда делает следующее:</p>
<p>В Data ONTAP начинает работать процесс, который физически сравнивает в перезаписываемых файлах блоки данных с соответствующими блоками в наиболее свежем снэпшоте с этого файла. ?? если блоки оказываются идентичными, то просто указывать вместо таких “псевдоизмененных” и “псевдоперезаписанных” блоков, на блоки в крайнем по времени снэпшоте. Это что-то отдаленно напоминает дедупликацию, но там похожий процесс работает только внутри активной файловой системы, между разными в ней файлами, а тут – между пространством активной файловой системы и пространством самого свежего снэпшота.</p>
<p>Теоретически, как и любой процесс экономии пространства, этот процесс дополнительно нагружает процессор и занимает память задачей попарного сравнения блоков. Однако, если этот процес достигает определенного для него лимита использования RAM, он приостанавливается, и ждет ее освобождения, так что в принципе страшного ничего произойти не должно.</p>
<p>Утверждается, что фича эта тихо живет уже довольно давно, полагаю она была добавлена по заказу какого-нибудь Особо Любимого Клиента и его специфической задачи, и не особенно раскручивается для прочих. Данная опция существует в Data ONTAP вплоть до версии 8.1 в 7-Mode.</p>
<p>Так что если в ващем хранилище CIFS есть сходная проблема с перезаписью, то можете попробовать, по идее это должно экономить какое-то количество пространства на дисках, при использовании снэпшотов. Помните, однако, что это займет сколько-то процессора и памяти, так что включив это обязательно проследите за поведением системы какое-то время.</p>
<p><strong>UPD:</strong> из комментариев к &#8220;зеркалу&#8221; данного поста на <a href="https://communities.netapp.com/groups/netapp-ru">https://communities.netapp.com/groups/netapp-ru</a> (если вы там еще не были - сильно рекомендую сходить и ознакомиться, это форум и сообщество по NetApp, созданное мною на официальном сайте NetApp, чтобы было удобнее вести дискуссии и обсуждения, в формате форума, и так далее. Я туда также зеркалю свои посты отсюда).</p>
<p><em>&#8220;Ну именно офисные приложения word и exel и перезаписывают файлы целиком. При открытии файла на редактирование ms офис создает новый временный файл и работаем в нем, а операция сохранения это удаляем старый, копируем новый. То есть файл всегда пишется целиком. А так как на CIFS разделах делать снепшоты очень удобно (в винде встроены механизмы отслеживания версионности файлов и нет необходимости привлекать администраторов чтоб открыть любой файл из предыдущих версий) то начинает быстро &#8220;распухать&#8221; раздел по них.</p>
<p>Поэтому на томах доступных для CIFS где работают с офисными приложениями и снепшоты делаются по сколько раз в день, что затрудняет возможность проведения дедупликации перед ними, данная опция маст хэв :) &#8220;</em></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="cifs.html" rel="tag">cifs</a>, <a href="folding.html" rel="tag">folding</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="wafl/index.html" rel="tag">wafl</a><br />					Раздел: <a href="../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>,  <a href="../category/tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../1137/trackback.html#comments" title="Комментарий к записи WAFL File Folding">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-1058">
				<h2 class="posttitle"><a href="../1058/trackback.html" rel="bookmark" title="Permanent Link to SMB vs. iSCSI: как дела у Hyper-V? Результаты неожиданны.">SMB vs. iSCSI: как дела у Hyper-V? Результаты неожиданны.</a></h2>
				<div class="postmetadata">5 Октябрь 2011, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Любопытную, и, честно говоря, даже неожиданную для меня тему исследовал блоггер NetApp <em>Lobanov</em>.</p>
<p>Следящие за темой уже знают, что в Hyper-V 3.0 Microsoft объявила, что <a href="http://virtualstorageguy.com/2011/09/20/microsoft-announces-smb-2-2-and-nas-support-for-hyper-v-3-0-in-windows-8/">будет поддерживать работу по NAS протоколу SMBv2.2</a>.</p>
<p>Вы помните, что VMware уже с версии 3.0 активно рекомендует использовать NAS для подключения датасторов виртуальных машин по файловому протоколу NFS, и пользуется&#160; при этом большими преимуществами такого варианта перед “классическим” блочным FC и iSCSI, о чем я уже не раз писал в этом блоге. Однако у Microsoft в ее Hyper-V не было такой возможность в штатном, поддерживаемом порядке, впрочем и пользователи, скорее всего, не особо это требовали. Отчасти это было связано с широко распространенным убеждением, что NAS-протоколы, и уж CIFS/SMB в особенности, вообще не пригодны для производительных применений. ?? если в отношении NFS в VMware эти заблуждения уже более-менее развеяны многочисленными результатами тестов, как NetApp и EMC, так и самой VMware, да и сотнями и тысячами практических реализаций разного масштаба, то в отношении CIFS по прежнему бытует стойкое убеждение в непригодности его ни для чего, кроме “домашних папок” и копирования файлов по сети.</p>
<p>Отчасти это действительно так. CIFS как протокол сетевой файловой системы, значительно сложнее устроен, чем NFS, обладает множеством хитрых возможностей, и, как следствие, заметно большей величиной “оверхеда”, накладных расходов. Кроме того, CIFS (или SMB 1.0) никогда и не ориентировался на такое применение.</p>
<p>Однако первым шагом в сторону переработки и устранения старых родовых болячек NetBIOS и LAN Manager, от которого ведет свою родословную CIFS, был сделан в SMB v2.0, в котором Microsoft показала, что она знает о проблемах, и приняла решение их устранить. С тех пор CIFS/SMB развивается, не слишком шумно, но довольно существенно, а как видимый результат – появление поддержки новой версии, SMB v2.2 в качестве поддерживаемого протокола доступа к датасторам в новой версии Hyper-V.</p>
<p>Однако, пока Windows 8, Hyper-V 3.0 и SMB 2.2 не вышли в релиз, что же может показать в плане производительности обычный SMB2.0, появившийся в Windows Server 2008, и поддерживаемый в Data ONTAP?</p>
<h2><a href="http://communities.netapp.com/community/netapp-blogs/msenviro/blog/2011/09/29/looking-ahead-hyper-v-over-smb-vs-iscsi">Looking ahead Hyper-V over SMB vs. iSCSI</a></h2>
<p>Posted by <a href="http://communities.netapp.com/people/lobanov">lobanov</a> on Sep 29, 2011 10:06:19 AM </p>
<p>В свете грядущих новостей о&#160; <a href="http://communities.netapp.com/community/netapp-blogs/virtualstorageguy/blog/2011/09/20/microsoft-announces-smb-22-and-nas-support-for-hyper-v-30-in-windows-8">поддержке в Hyper-V работы по SMB через версию SMB 2.2</a>, у нас скоро появится новая возможность работать с виртуальными машинами через IP сеть. До сих пор существовала только одна такая возможность, подключая LUN по iSCSI. Очеивдный вопрос, вертящийся у всех на языке, как будут обстоять дела в варианте с SMB с точки зрения эффективности использования системы хранения, управления, и, самое главное, с точки зрения производительности. Для того, чтобы разобраться во всем этом, мы решили провести эксперимент, сравнив эти два варианта подключения, использовав оборудование нашей тестовой лаборатории<a href="http://communities.netapp.com/community/netapp-blogs/msenviro/blog/2011/09/22/getting-ready-for-windows-server-8-part-ii-hyper-v-over-smb">.</a></p>
<p>Для теста использовался один сервер в следующей конфигурации:</p>
<ul>
<li>16 CPU (Dual Socket Quad Core with HyperThreading)</li>
<li>48 GB&#160; RAM</li>
<li>Один 1Gbs Ethernet NIC</li>
<li>Win2K8R2 SP1</li>
</ul>
<p>Один контроллер NetApp FAS6030 под Data ONTAP 8.0.1 работает на один сетевой адаптер Ethernet 1Gbs, на контроллере создано два тома flexvol:</p>
<ul>
<li>“HVoverSMB_CIFS” это CIFS share, смонтированная на хост Hyper-V как symbolic link. </li>
<li>“HVoverSMB_ISCSI” несет один LUN, подключенный к хосту Hyper-V по протоколу iSCSI. </li>
</ul>
<p>Оба тома имеют размер 1TB в режиме Thin-Provisioned, и&#160; LUN на томе для iSCSI также сделан Thin-Provisioned. Таким образом, со стороны хоста Hyper-V мы видим 2TB&#160; usable storage, в то время, как на стороне контроллера пространство на дисках почти не занято.&#160; Мы решили не использовать 10G Ethernet, так как хотели замедлить, для наглядности, время загрузки, и максимально нагрузить сеть в процессе эксперимента.</p>
<p>Мы создали 20 VM на iSCSI LUN, и 20 VM на CIFS Share. Каждая виртуальная машина имела следующую конфигурацию:</p>
<ul>
<li>1 CPU </li>
<li>2 GB RAM</li>
<li>Win2K8R2 SP1 </li>
<li>40GB VHD</li>
</ul>
<p>Оригинальный эталонный шаблон VM был создан с использованием нашей новой техники <a href="http://communities.netapp.com/community/netapp-blogs/msenviro/blog/2011/09/22/getting-ready-for-windows-server-8-part-ii-hyper-v-over-smb">Thick/Thin VHD ,</a> о которой я рассказывал ранее,&#160; а последующие копии с этого шаблона созданы с использованием Sub-Lun cloning, и файлового SIS cloning vпри помощи cmdлетов <em>Start-NaClone</em>, и <em>Copy-NaHostFile</em>. ??тоговый результат 40 VM, и 1.6TB дисков виртуальных машин занимают менее 16GB на контроллере! </p>
<p>Затем мы подвергли получившуюся систему испытанием старым добрым Boot Storm – одновременной загрузкой 20 виртуальных машин каждого типа, и сбором данных о производительности как на хосте Hyper-V, так и на контроллере NetApp. Мы собирали данные производительности Hyper-V при помощи Performance Monitor, обращая внимание, в первую очередь, на CPU и призводительность сетевого адаптера. Контроллер NetApp мониторился с помощью <a href="http://communities.netapp.com/docs/DOC-10354">Get-NaSysStat PowerShell Script</a>. Оба инструмента был настроены на сбор данных каждые 5 секунд.</p>
<p><strong>Результаты</strong></p>
<p><strong>Время загрузки</strong></p>
<p>В обоих тестах загрузка до экрана Logon заняла менее 90 секунд для всех 20 виртуальных машин.&#160; Давайте посмотрим, что в это время происходило на хостах Hyper-V и контроллере NetApp.</p>
<p><strong>Hyper-V-Host Performance</strong></p>
<p>CPU load</p>
<p><a href="/pics//image148.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/pics//image-thumb45.png" width="640" height="140" /></a></p>
<p>&#160;</p>
<p>Network Adapter: BytesReceived/sec</p>
<p><a href="/pics//image149.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/pics//image-thumb46.png" width="640" height="140" /></a></p>
<p>&#160;</p>
<p><strong>NetApp Array Performance</strong></p>
<p>Net_Data_Sent</p>
<p><a href="/pics//image150.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/pics//image-thumb47.png" width="640" height="140" /></a></p>
<p>CPU_Busy</p>
<p><a href="/pics//image152.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/pics//image-thumb48.png" width="640" height="140" /></a></p>
<p>CIFS vs. iSCSI Ops/sec</p>
<p><a href="/pics//image153.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/pics//image-thumb49.png" width="640" height="140" /></a></p>
<p>&#160;</p>
<p>Как вы видите, как со стороны хоста Hyper-V, так и со стороны контроллера NetApp, уровни загрузки CPU, а также производительность сети оказались сравнимыми! Важно отметить, что, в данном случае, мы еще даже не используем SMB2.2, так как работает Server 2008 R2 SP1, а не Server.Next. Если же мы видим равную производительность для текущего поколения софта, запущенного на оборудовании четырехлетней давности, то что же мы получим, когда появится Server.Next?</p>
<p>Но где же вообще разница между протоколами, спросите вы, а что там с latency?</p>
<p>Давайте посмотрим, вот картина на стороне NetApp:</p>
<p><a href="/pics//image154.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="/pics//image-thumb50.png" width="640" height="140" /></a></p>
<p>Неожиданно, не правда-ли?</p>
<p>На первый взгляд, все неплохо, исключая взлет latency до 4ms в самый “разгар шторма”. Но посмотрите на параметр <em>read latency</em> для теста&#160; CIFS. Почему он показывает меньшую latency на идентичной нагрузке? То что мы видим, это преимущества протокола SMB 2.x; Windows использует собственный кэш NTFS для улучшения производительности на чтение, просто посылая на систему хранения меньше избыточных запросов чтения.</p>
<p>&#160;</p>
<p><strong>Величина эффективности использования пространства хранения на NetApp</strong></p>
<p>??спользуя <em>thin-provisioning</em>, <em>single copy rapid provisioning</em>, и дедупликацию, мы получили фантастически высокие результаты для обоих протоколов.</p>
<table border="1" cellspacing="0" cellpadding="2" width="642">
<tbody>
<tr>
<td valign="top" width="117"><strong>??мя</strong></td>
<td valign="top" width="122"><strong>Общий размер</strong></td>
<td valign="top" width="80"><strong>??спользовано</strong></td>
<td valign="top" width="93"><strong>Доступно</strong></td>
<td valign="top" width="105"><strong>Дедупликация</strong></td>
<td valign="top" width="123"><strong>Aggregate</strong></td>
</tr>
<tr>
<td valign="top" width="121">HVoverSMB_CIFS </td>
<td valign="top" width="122">1024.0 GB </td>
<td valign="top" width="80">1%</td>
<td valign="top" width="91">1015.9 GB </td>
<td valign="top" width="108">да</td>
<td valign="top" width="121">aggr0</td>
</tr>
<tr>
<td valign="top" width="123">HVoverSMB_ISCSI</td>
<td valign="top" width="122">1024.0 GB </td>
<td valign="top" width="80">1%</td>
<td valign="top" width="92">1013.7 GB </td>
<td valign="top" width="110">да</td>
<td valign="top" width="125">aggr0</td>
</tr>
</tbody>
</table>
<p>Как вы видите, в обоих случаях величина эффективности использования хранилища сравнима и высока.</p>
<p>&#160;</p>
<p>Так как мы увидели, что производительность и уровень использования системы хранения примерно одинаков, давайте посмотрим на остальные критерии и попытаемся ответить на вопрос, что же лучше.</p>
<p><strong>CIFS</strong></p>
<p><u>За</u>:</p>
<ul>
<li>Одна сетевая папка CIFS на любое число хостов Hyper-V или кластеров Clusters.</li>
<li>Перемещение VM между хостами Hyper-V становится гораздо проще, так как все хосты имеют доступ к одним и тем же VHD. </li>
<li>Значительно более высокий уровень плотности VM на том.</li>
</ul>
<p><u>Против</u>:</p>
<ul>
<li>Конфигурирование прав на CIFS share несколько сложновато, так как требует разобраться со специфическими разрешениями на Share и NTFS, которые требуются для Hyper-V. </li>
<li>В настоящий момент <strong>не поддерживается.</strong></li>
</ul>
<p><strong>iSCSI</strong></p>
<p><u>За</u>: </p>
<ul>
<li>Конфигурирование прав NTFS очевидно.</li>
<li>Поддерживается. </li>
<li>Равная производительность с FCP без необходимости сложного зонирования.</li>
</ul>
<p><u>Против</u>:</p>
<ul>
<li>К LUN-ам не может быть совместного доступа от нескольких хостов и кластеров, без использования WSFC, и CSV.</li>
<li>Перемещение VHD на другой хост Hyper-V требует переконфигурирования системы хранения или копирования файлов VHD по сети.</li>
</ul>
<p>&#160;</p>
<p><strong>Выводы</strong></p>
<p>Результаты теста и их анализ показывают, что сегодня SMB2.0 и iSCSI сравнимы. Оба варианта подключения обеспечивают достаточную эффективность и позволяют работу виртуальных машин по IP-сети. Мы ожидаем, что большинство сложностей с правами и разрешениями будет устранена в Server.Next. Факт неподдерживаемости SMB конечно делает iSCSI однозначным победителем, но, если быть честными, если SMB начнет поддерживаться… следует отдать должное прогрессу в работе SMB. В итоге, мы уже с нетерпением ждем выхода Server.Next, SMB2.2, и Hyper-V 3.0 over SMB, это должно оказаться весьма неплохо!</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="cifs.html" rel="tag">cifs</a>, <a href="hyper-v.html" rel="tag">hyper-v</a>, <a href="iscsi/index.html" rel="tag">iscsi</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="smb.html" rel="tag">smb</a>, <a href="smb-20.html" rel="tag">smb 2.0</a><br />					Раздел: <a href="../category/translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;" rel="category tag">переводы</a>&nbsp;&nbsp;|&nbsp;
					<a href="../1058/trackback.html#comments" title="Комментарий к записи SMB vs. iSCSI: как дела у Hyper-V? Результаты неожиданны.">Комментарии (3)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-555">
				<h2 class="posttitle"><a href="../555/trackback.html" rel="bookmark" title="Permanent Link to NetApp System Analyser for CIFS">NetApp System Analyser for CIFS</a></h2>
				<div class="postmetadata">22 Март 2010, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Продолжая тему контроля пользователей NAS, начатую постом про команду <strong>cifs top</strong>, хочу отметить любопытную утилиту, доступную на сайте NOW: <a href="http://now.netapp.com/NOW/download/tools/ntapsa_cifs/">NetApp System Analyser for CIFS</a></p>
<p>Это автономная утилита под x32 и x64 Windows, помогает контролировать и анализировать загрузку NAS-системы пользователями по протоколу CIFS.</p>
<p><a href="/pics//image33.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="/pics//image-thumb18.png" width="652" height="433" /></a> </p>
<p>Утилита состоит из четырех компонент:</p>
<p><strong>Dashboard:</strong> основная панель, показывающая обзор состояния контроллера системы хранения, таких его параметров, как CPU utilization, объемы трафика, счетчики производительности CIFS и общую информацию по системе.</p>
<p><a href="/pics//image34.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="/pics//image-thumb19.png" width="266" height="368" /></a> </p>
<p><strong>Analyzer:</strong> Создает отчеты и делает рекомендации по вашей ситуации, определяя возможные источники проблем.</p>
<p><a href="/pics//image35.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="/pics//image-thumb20.png" width="321" height="230" /></a> </p>
<p><strong>User Statistics:</strong> Показывает статистику по пользователям,&#160; позволяет оценить кто из пользователей (а также серверов или приложений) и сколько использует ресурсов CIFS.</p>
<p>&#160;</p>
<p><strong>Support Report:</strong> Собирает данные, необходимые для работы NetApp Support, для анализа и устранения проблем, связанных с CIFS. Вывод может быть послан непосредственно в NetApp из самой утилиты, или записан и отослан отдельно.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="cifs.html" rel="tag">cifs</a>, <a href="nas.html" rel="tag">nas</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="tools.html" rel="tag">tools</a><br />					Раздел: <a href="../category/review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;" rel="category tag">review</a>,  <a href="../category/utilities/index.html" title="Просмотреть все записи в рубрике &laquo;utilities&raquo;" rel="category tag">utilities</a>&nbsp;&nbsp;|&nbsp;
					<a href="../555/trackback.html#comments" title="Комментарий к записи NetApp System Analyser for CIFS">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-548">
				<h2 class="posttitle"><a href="../548/trackback.html" rel="bookmark" title="Permanent Link to Полезные команды: cifs top">Полезные команды: cifs top</a></h2>
				<div class="postmetadata">15 Март 2010, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Если с занимающими много места на дисках пользователями NAS можно справиться механизмом квот, то что делать с пользователями, которые используют много, но не места, а системных ресурсов, например загружая систему большим числом операций ввода-вывода?</p>
<p>Прежде всего таких следует найти и оценить загрузку от них. В этом поможет команда <strong>cifs top</strong>.</p>
<p>Для начала нам надо включить системную опцию:</p>
<p><code>fas1&gt; options cifs.per_client_stats.enable on </code></p>
<p>Далее, собрав некоторую статистику, введем команду:</p>
<p><code>fas1&gt; cifs top –n 3 –s w</code> - показать трех самых активных пользователей, отсортировав список по объемам записи</p>
<p><code>&#160;&#160;&#160; ops/s&#160; reads(n, KB/s) writes(n, KB/s) suspect/s&#160;&#160; IP&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Name      <br />&#160;&#160;&#160;&#160; 263 |&#160;&#160;&#160;&#160; 29&#160;&#160; 215 |&#160;&#160;&#160;&#160; 137&#160;&#160; 627 |&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0 | 10.56.10.120 ENGR\varun       <br />&#160;&#160;&#160;&#160; 248 |&#160;&#160;&#160;&#160; 27&#160;&#160; 190 |&#160;&#160;&#160;&#160; 126&#160;&#160; 619 |&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1 | 10.56.10.120 ENGR\jill       <br />&#160;&#160;&#160;&#160; 246 |&#160;&#160;&#160;&#160; 26&#160;&#160; 195 |&#160;&#160;&#160;&#160; 125&#160;&#160; 616 |&#160;&#160;&#160;&#160;&#160;&#160; 19 | 10.56.12.118 MKTG\bob       <br /></code></p>
<p>&#160;</p>
<p>Более подробно о доступных ключах команды можно узнать из встроенной документации и манов.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="cifs.html" rel="tag">cifs</a>, <a href="commands/index.html" rel="tag">commands</a>, <a href="nas.html" rel="tag">nas</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="tipstricks/index.html" rel="tag">tips&amp;tricks</a><br />					Раздел: <a href="../category/commands/index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;" rel="category tag">commands</a>,  <a href="../category/howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;" rel="category tag">howto</a>,  <a href="../category/tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;" rel="category tag">tricks</a>&nbsp;&nbsp;|&nbsp;
					<a href="../548/trackback.html#respond" title="Комментарий к записи Полезные команды: cifs top">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-474">
				<h2 class="posttitle"><a href="../474/trackback.html" rel="bookmark" title="Permanent Link to Поддержка SMB2.0 в протоколе CIFS на NetApp">Поддержка SMB2.0 в протоколе CIFS на NetApp</a></h2>
				<div class="postmetadata">21 Декабрь 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Появившийся на Wndows Vista, а позднее и на Windows Server 2008 протокол SMB2.0, дальнейшая разработка Microsoft своего сетевого протокола, показывает заметное улучшение производительности, однако требует для своей работы пока не слишком распространенных платформ Vista и Server 2008.</p>
<p>Но для тех, кто уже перешел на новые платформы, интересно будет узнать, что SMB2.0 поддерживается в протоколе CIFS в NetApp FAS начиная с версии ONTAP 7.3.1    <br />Для включения SMB2.0 надо изменить значение системной опции <strong>options cifs.smb2.enable</strong></p>
<p>Любопытное исследование, показывающее эффект от перехода на SMB2.0 с Jumbo Frames в гигабитной локальной сети найдено тут:    <br /><a href="http://www.alternativerecursion.info/?p=48">http://www.alternativerecursion.info/?p=48</a></p>
<p><a href="/pics//image24.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/pics//image-thumb12.png" width="789" height="322" /></a></p>
</p>
<p>Пожалуйста, обратите внимание, что SMB2.0 поддерживается <strong>только</strong> в Vista, Windows 7 и Server 2008, включать его при использовании в сети клиентов XP и Server 2003 нельзя.</p>
<p>Официальный документ из технической библиотеки NetApp:    <br /><a class="bn_result_title" href="http://www.netapp.com/us/library/technical-reports/tr-3740.html">SMB 2.0 – Next Generation CIFS protocol in Data ONTAP®</a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="cifs.html" rel="tag">cifs</a>, <a href="nas.html" rel="tag">nas</a>, <a href="netapp/index.html" rel="tag">netapp</a><br />					Раздел: <a href="../category/justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;" rel="category tag">justread</a>,  <a href="../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../474/trackback.html#comments" title="Комментарий к записи Поддержка SMB2.0 в протоколе CIFS на NetApp">1 комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-46">
				<h2 class="posttitle"><a href="../46/trackback.html" rel="bookmark" title="Permanent Link to NFS и CIFS: что выбрать?">NFS и CIFS: что выбрать?</a></h2>
				<div class="postmetadata">10 Сентябрь 2007, 20:37 <!-- от  --></div>
				<div class="postentry">
					<p>Прежде всего выбор NAS-протокола определяется принадлежностью IT-инфраструктуры, использующей NAS-устройство, к одному из двух «царств» - «Windows» или «UNIX».<br />
«Родной» (native) протокол для Windows – CIFS, для UNIX (Linux, Solaris, AIX, FreeBSD и т.п.) – NFS. Конечно, в большинстве OS существует поддержка протоколов соседнего «царства». Так, например, NFS для Windows поставляется в бесплатном ныне продукте MS Services for UNIX 3.5 (SFU, бесплатно скачивается с вебсайта Microsoft) или SAMBA (<a href="http://www.samba.org/">www.samba.org</a>, включен ныне в большинство дистрибутивов UNIX) для поддержки CIFS на UNIX. Но, разумеется, родной протокол для системы почти всегда предпочтительнее, хотя бы просто из соображений минимизации настроек и инсталляций, а значит ошибок администраторов и неожиданных проблем с производительностью.</p>
<h3>Stateless и Stateful протоколы. Что это и чем грозит.</h3>
<p>Протоколы файлового доступа NFS и CIFS, кроме принадлежности к двум «лагерям» UNIX и Windows, различаются также принципиальной разницей способов обращения к данным: т.н. stateless и stateful.<br />
NFS это протокол stateless. Это означает, прежде всего то, что он по своей природе не сохраняет состояние соединения, и каждое обращение к файлу начинается «как с чистого листа». Причиной этого было то, что NFS изначально создавался как протокол доступа к данным по априори ненадежным, «глобальным» сетям. Между обращениям к файлу мог случиться обрыв и восстановление соединения, маршрут к файлу, с точки зрения сети, мог поменяться (что нормальная ситуация для TCP-сети). Все это не должно было оказывать влияния на процесс доступа к данным.<br />
Для правильной обработки таких ситуаций была выбрана так называемая «stateless» модель соединения. При этом каждое обращение делается предполагая, что состояние соединения не сохраняется или не известно. Операция изменения байта в файле производится как «обратиться к файлу – проверить его существование – открыть файл на запись – записать байт – закрыть файл». При этом между операциями файл может исчезнуть, быть вновь создан, переместиться на другое устройство и так далее. С точки зрения протокола NFS это совершенно неважно. Состояние соединения между приложением и его файлом не хранится, и каждое соединение создается заново. Казалось бы излишние усилия и накладные расходы? Однако при общей аскетичности NFS как протокола (а создавался он еще во времена, когда модем на 2400 бод был вполне приемлемым средством доступа к данным), во многих случаях эти дополнительные операции с файлами не слишком обременяют процесс.</p>
<p>CIFS – <em>Common Internet File System</em> - <em>Обобщенная ??нтернетная Файловая Система</em> (также ранее известный как SMB – <em>Server Message Blocks - Блоки Сообщений Сервера</em>) рожден уже в наше время. ??значально он разрабатывался как сетевой протокол, применявшийся в среде системы Microsoft LAN Manager, сперва для DOS, а потом для Windows, как совместная разработка MS и IBM. Унаследовав технологии LAN Manager и его протокол SMB со времен DOS, войдя в новую OS Microsoft Windows и пройдя длинный путь развития, протокол был стандартизирован в 1987 году в IETF (RFC1001, RFC1002, IETF STD 19) под названием CIFS.<br />
Это более сложный, чем NFS, протокол. Его область применения это уже гораздо более надежная LAN. Она позволила выбрать для него во многом более выгодную модель «stateful», при этом соединение будучи открыто, например, подразумевается открытым, его состояние сохраняется в OS, и оно не требует для каждой записи проходить все операции с самого начала: «проверили существование – открыли – записали байт – закрыли». Однако вследствие того, что NFS протокол более простой, и во многих местах даже примитивный (не забудьте, для какой среды он изначально проектировался), зачастую в ряде случаев он, несмотря на все дополнительные «накладные расходы», оказывается более быстродействующим. А для операций, связанных, например, с переподключением хранилища данных в кластерной или иной отказоустойчивой конфигурации, еще и более предпочтительным, за счет того, что изначально предполагает соединение между потребителем данных и его источником ненадежным и способным исчезнуть или измениться в любой миг.</p>
<p>Для использования NFS в среде Windows можно использовать бесплатно распространяемый ныне Microsoft продукт <a href="http://technet.microsoft.com/en-us/interopmigration/bb380242.aspx" target="_blank" title="SFU">MS Services for UNIX (SFU)</a>, в который включен клиент для NFS. Поддержка протокола NFS для среды UNIX же обычно включена по умолчанию во все дистрибутивы.<br />
Поддержка же CIFS в среде UNIX осуществляется через продукт под названием SAMBA, это результат reverse engineering-а сетевого обмена протокола и воссоздания средств использования протокола в независимом свободно распространяемом продукте. Такое непростое и чреватое будущими проблемами совместимости решение было выбрано потому, что, несмотря на свою стандартизацию в IETF, протокол CIFS закрыт и является собственностью Microsoft, что ограничивает его использвание в ряде случаев в продуктах т.н. «свободного программного обеспечения» (GNU). Официально лицензией на его использование владеют в настоящий момент два крупнейших производителя NAS, такие как Network Appliance и EMC. Лишь только они используют полнофункциональный протокол CIFS в своих независимых от MS продуктах. Остальные вынуждены либо использовать SAMBA, либо применять для него версию Windows Storage Server, несущий в себе CIFS по умолчанию.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="cifs.html" rel="tag">cifs</a>, <a href="netapp/index.html" rel="tag">netapp</a>, <a href="nfs/index.html" rel="tag">nfs</a><br />					Раздел: <a href="../category/news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;" rel="category tag">новости</a>&nbsp;&nbsp;|&nbsp;
					<a href="../46/trackback.html#comments" title="Комментарий к записи NFS и CIFS: что выбрать?">Комментарии (3)</a>									 </div>
			</div>
	
		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"></div>
		</div>
		
	
	</div>
	<div id="sidebar">
		<ul>
			
			
			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Автор</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			<li class="pagenav"><h2>Страницы</h2><ul><li class="page_item page-item-153"><a href="../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul></li>
			<li><h2>Рубрики</h2>
				<ul>
					<li class="cat-item cat-item-89"><a href="../category/commands/index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;">commands</a>
</li>
	<li class="cat-item cat-item-37"><a href="../category/howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;">howto</a>
</li>
	<li class="cat-item cat-item-52"><a href="../category/justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;">justread</a>
</li>
	<li class="cat-item cat-item-51"><a href="../category/review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;">review</a>
</li>
	<li class="cat-item cat-item-3"><a href="../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;">techtalk</a>
</li>
	<li class="cat-item cat-item-71"><a href="../category/tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;">tricks</a>
</li>
	<li class="cat-item cat-item-95"><a href="../category/utilities/index.html" title="Просмотреть все записи в рубрике &laquo;utilities&raquo;">utilities</a>
</li>
	<li class="cat-item cat-item-44"><a href="../category/whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;">whoisho</a>
</li>
	<li class="cat-item cat-item-1"><a href="../category/news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;">новости</a>
</li>
	<li class="cat-item cat-item-387"><a href="../category/opros.html" title="Просмотреть все записи в рубрике &laquo;опрос&raquo;">опрос</a>
</li>
	<li class="cat-item cat-item-8"><a href="../category/translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;">переводы</a>
</li>
	<li class="cat-item cat-item-40"><a href="../category/citaty/index.html" title="Просмотреть все записи в рубрике &laquo;цитаты&raquo;">цитаты</a>
</li>
				</ul>
			</li>

			<li><h2>Архивы</h2>
				<ul>
					<li><a href='../date/2018/01.html' title='Январь 2018'>Январь 2018</a></li>
	<li><a href='../date/2015/10.html' title='Октябрь 2015'>Октябрь 2015</a></li>
	<li><a href='../date/2015/04.html' title='Апрель 2015'>Апрель 2015</a></li>
	<li><a href='../date/2015/03.html' title='Март 2015'>Март 2015</a></li>
	<li><a href='../date/2015/01.html' title='Январь 2015'>Январь 2015</a></li>
	<li><a href='../date/2014/12.html' title='Декабрь 2014'>Декабрь 2014</a></li>
	<li><a href='../date/2014/11.html' title='Ноябрь 2014'>Ноябрь 2014</a></li>
	<li><a href='../date/2014/10.html' title='Октябрь 2014'>Октябрь 2014</a></li>
	<li><a href='../date/2014/09.html' title='Сентябрь 2014'>Сентябрь 2014</a></li>
	<li><a href='../date/2014/08.html' title='Август 2014'>Август 2014</a></li>
	<li><a href='../date/2014/07.html' title='Июль 2014'>Июль 2014</a></li>
	<li><a href='../date/2014/06.html' title='Июнь 2014'>Июнь 2014</a></li>
	<li><a href='../date/2014/05.html' title='Май 2014'>Май 2014</a></li>
	<li><a href='../date/2014/04.html' title='Апрель 2014'>Апрель 2014</a></li>
	<li><a href='../date/2014/03.html' title='Март 2014'>Март 2014</a></li>
	<li><a href='../date/2014/02.html' title='Февраль 2014'>Февраль 2014</a></li>
	<li><a href='../date/2014/01.html' title='Январь 2014'>Январь 2014</a></li>
	<li><a href='../date/2013/12.html' title='Декабрь 2013'>Декабрь 2013</a></li>
	<li><a href='../date/2013/11.html' title='Ноябрь 2013'>Ноябрь 2013</a></li>
	<li><a href='../date/2013/10.html' title='Октябрь 2013'>Октябрь 2013</a></li>
	<li><a href='../date/2013/09.html' title='Сентябрь 2013'>Сентябрь 2013</a></li>
	<li><a href='../date/2013/08.html' title='Август 2013'>Август 2013</a></li>
	<li><a href='../date/2013/07.html' title='Июль 2013'>Июль 2013</a></li>
	<li><a href='../date/2013/06.html' title='Июнь 2013'>Июнь 2013</a></li>
	<li><a href='../date/2013/05.html' title='Май 2013'>Май 2013</a></li>
	<li><a href='../date/2013/04.html' title='Апрель 2013'>Апрель 2013</a></li>
	<li><a href='../date/2013/03.html' title='Март 2013'>Март 2013</a></li>
	<li><a href='../date/2013/02.html' title='Февраль 2013'>Февраль 2013</a></li>
	<li><a href='../date/2013/01.html' title='Январь 2013'>Январь 2013</a></li>
	<li><a href='../date/2012/12.html' title='Декабрь 2012'>Декабрь 2012</a></li>
	<li><a href='../date/2012/11.html' title='Ноябрь 2012'>Ноябрь 2012</a></li>
	<li><a href='../date/2012/10.html' title='Октябрь 2012'>Октябрь 2012</a></li>
	<li><a href='../date/2012/09.html' title='Сентябрь 2012'>Сентябрь 2012</a></li>
	<li><a href='../date/2012/08.html' title='Август 2012'>Август 2012</a></li>
	<li><a href='../date/2012/07.html' title='Июль 2012'>Июль 2012</a></li>
	<li><a href='../date/2012/06.html' title='Июнь 2012'>Июнь 2012</a></li>
	<li><a href='../date/2012/05.html' title='Май 2012'>Май 2012</a></li>
	<li><a href='../date/2012/04.html' title='Апрель 2012'>Апрель 2012</a></li>
	<li><a href='../date/2012/03.html' title='Март 2012'>Март 2012</a></li>
	<li><a href='../date/2012/02.html' title='Февраль 2012'>Февраль 2012</a></li>
	<li><a href='../date/2012/01.html' title='Январь 2012'>Январь 2012</a></li>
	<li><a href='../date/2011/12.html' title='Декабрь 2011'>Декабрь 2011</a></li>
	<li><a href='../date/2011/11.html' title='Ноябрь 2011'>Ноябрь 2011</a></li>
	<li><a href='../date/2011/10/index.html' title='Октябрь 2011'>Октябрь 2011</a></li>
	<li><a href='../date/2011/09/index.html' title='Сентябрь 2011'>Сентябрь 2011</a></li>
	<li><a href='../date/2011/08.html' title='Август 2011'>Август 2011</a></li>
	<li><a href='../date/2011/07/index.html' title='Июль 2011'>Июль 2011</a></li>
	<li><a href='../date/2011/06/index.html' title='Июнь 2011'>Июнь 2011</a></li>
	<li><a href='../date/2011/05/index.html' title='Май 2011'>Май 2011</a></li>
	<li><a href='../date/2011/04/index.html' title='Апрель 2011'>Апрель 2011</a></li>
	<li><a href='../date/2011/03/index.html' title='Март 2011'>Март 2011</a></li>
	<li><a href='../date/2011/02.html' title='Февраль 2011'>Февраль 2011</a></li>
	<li><a href='../date/2011/01.html' title='Январь 2011'>Январь 2011</a></li>
	<li><a href='../date/2010/12.html' title='Декабрь 2010'>Декабрь 2010</a></li>
	<li><a href='../date/2010/11/index.html' title='Ноябрь 2010'>Ноябрь 2010</a></li>
	<li><a href='../date/2010/10/index.html' title='Октябрь 2010'>Октябрь 2010</a></li>
	<li><a href='../date/2010/09/index.html' title='Сентябрь 2010'>Сентябрь 2010</a></li>
	<li><a href='../date/2010/08.html' title='Август 2010'>Август 2010</a></li>
	<li><a href='../date/2010/07/index.html' title='Июль 2010'>Июль 2010</a></li>
	<li><a href='../date/2010/06.html' title='Июнь 2010'>Июнь 2010</a></li>
	<li><a href='../date/2010/05.html' title='Май 2010'>Май 2010</a></li>
	<li><a href='../date/2010/04/index.html' title='Апрель 2010'>Апрель 2010</a></li>
	<li><a href='../date/2010/03/index.html' title='Март 2010'>Март 2010</a></li>
	<li><a href='../date/2010/02.html' title='Февраль 2010'>Февраль 2010</a></li>
	<li><a href='../date/2010/01.html' title='Январь 2010'>Январь 2010</a></li>
	<li><a href='../date/2009/12/index.html' title='Декабрь 2009'>Декабрь 2009</a></li>
	<li><a href='../date/2009/11/index.html' title='Ноябрь 2009'>Ноябрь 2009</a></li>
	<li><a href='../date/2009/10.html' title='Октябрь 2009'>Октябрь 2009</a></li>
	<li><a href='../date/2009/09.html' title='Сентябрь 2009'>Сентябрь 2009</a></li>
	<li><a href='../date/2009/08/index.html' title='Август 2009'>Август 2009</a></li>
	<li><a href='../date/2009/07/index.html' title='Июль 2009'>Июль 2009</a></li>
	<li><a href='../date/2009/06.html' title='Июнь 2009'>Июнь 2009</a></li>
	<li><a href='../date/2009/05.html' title='Май 2009'>Май 2009</a></li>
	<li><a href='../date/2009/04.html' title='Апрель 2009'>Апрель 2009</a></li>
	<li><a href='../date/2009/03.html' title='Март 2009'>Март 2009</a></li>
	<li><a href='../date/2009/02.html' title='Февраль 2009'>Февраль 2009</a></li>
	<li><a href='../date/2009/01.html' title='Январь 2009'>Январь 2009</a></li>
	<li><a href='../date/2008/12.html' title='Декабрь 2008'>Декабрь 2008</a></li>
	<li><a href='../date/2008/11.html' title='Ноябрь 2008'>Ноябрь 2008</a></li>
	<li><a href='../date/2008/10.html' title='Октябрь 2008'>Октябрь 2008</a></li>
	<li><a href='../date/2008/09.html' title='Сентябрь 2008'>Сентябрь 2008</a></li>
	<li><a href='../date/2008/08.html' title='Август 2008'>Август 2008</a></li>
	<li><a href='../date/2008/03.html' title='Март 2008'>Март 2008</a></li>
	<li><a href='../date/2008/02.html' title='Февраль 2008'>Февраль 2008</a></li>
	<li><a href='../date/2007/12.html' title='Декабрь 2007'>Декабрь 2007</a></li>
	<li><a href='../date/2007/11.html' title='Ноябрь 2007'>Ноябрь 2007</a></li>
	<li><a href='../date/2007/10.html' title='Октябрь 2007'>Октябрь 2007</a></li>
	<li><a href='../date/2007/09.html' title='Сентябрь 2007'>Сентябрь 2007</a></li>
	<li><a href='../date/2007/08.html' title='Август 2007'>Август 2007</a></li>
	<li><a href='../date/2007/07/index.html' title='Июль 2007'>Июль 2007</a></li>
	<li><a href='../date/2007/06.html' title='Июнь 2007'>Июнь 2007</a></li>
	<li><a href='../date/2007/05.html' title='Май 2007'>Май 2007</a></li>
				</ul>
			</li>

			
					</ul>
	</div>

</div> <!-- wrapper -->
<div id="footer">
	<a href="../../feed">Entries (RSS)</a> and <a href="../../comments/feed">Comments (RSS)</a>. Valid <a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional"><abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a> and <a href="http://jigsaw.w3.org/css-validator/check/referer"><abbr title="Cascading Style Sheets">CSS</abbr></a>.<br />
	Powered by <a href="http://wordpress.org/" title="Powered by WordPress.">WordPress</a> and <a href="http://srinig.com/wordpress/themes/fluid-blue/">Fluid Blue theme</a>.<br />
	<!-- 15 queries. 0.094 seconds. -->
	</div>
</div> <!-- page -->
</body>
</html>
