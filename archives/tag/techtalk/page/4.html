<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>about NetApp   &raquo; techtalk</title>

<link rel="stylesheet" href="../../../../wp-content/themes/fluid-blue/style.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../wp-content/themes/fluid-blue/print.css" type="text/css" media="print" />
<link rel="alternate" type="application/rss+xml" title="about NetApp RSS Feed" href="../../../../feed" />
<link rel="pingback" href="../../../../xmlrpc.php.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 2.6" />

</head>

<body>
<div id="page">
<div id="header">
	<div id="headertitle">
		<h1><a href="../../../../index.html" title="about NetApp: Системы хранения данных как предмет разговора">about NetApp</a></h1>
		<p>Системы хранения данных как предмет разговора</p>
	</div> 
	<!-- Search box (If you prefer having search form as a sidebar widget, remove this block) -->
	<div class="search">
		<form method="get" id="searchform" action="../../../../index.html">
<input type="text" size="20" name="s" id="s" value="Поиск..."  onblur="if(this.value=='') this.value='Поиск...';" onfocus="if(this.value=='Поиск...') this.value='';"/>
</form>
	</div> 
	<!-- Search ends here-->
		
</div>

<div id="navbar">
<ul id="nav">
	<li><a href="../../../../index.html">Home</a></li>
	<li class="page_item page-item-153"><a href="../../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul>
</div>
<div id="wrapper">

	<div id="content">

	
			<p>Posts tagged &#8216;techtalk&#8217;</p>

	 		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"><a href="3.html">Next Entries &raquo;</a></div>
		</div>

						
			<div class="post" id="post-158">
				<h2 class="posttitle"><a href="../../../158/trackback.html" rel="bookmark" title="Permanent Link to VMware на NFS: экзотика или новый хит?">VMware на NFS: экзотика или новый хит?</a></h2>
				<div class="postmetadata">1 Сентябрь 2008, 11:11 <!-- от  --></div>
				<div class="postentry">
					<p>Начиная с версии 3.0 флагманский продукт компании VMware - ESX Server поддерживает три типа подключения внешней дисковой системы: FC, iSCSI и NFS.<br />
На сегодняшний день примерно 90% инсталляций VMware используют FC. В оставшихся 10% царит iSCSI, а на долю NFS пока приходится совсем малое количество систем.<br />
Отчего так?</p>
<p>Причин я вижу две. Во первых, поддержка подключения дисковых систем хранения по NFS появилась только в ESX 3, то есть сравнительно недавно. А enterprise-сисадмины существа подозрительные, недоверчивые, злопамятные и консервативные (привет, коллеги!).<br />
?? во вторых, в среде IT все еще довлеет мнение, что NAS &#8220;это что-то такое несерьезное, коробка от списанного сервера под столом, с виндой или линуксом, для хранения экселевских файлов нашей бухгалтерии и mp3-шек&#8221;, устройство, с обычным названием, хорошо отражающим отношение к ней сисадмина - &#8220;файлопомойка&#8221;. Какое там enterprise, работает и ладно.<br />
Однако с известных пор, и стараниями известной вам компании, все это уже не совсем так.</p>
<p><strong>Как это сделано:</strong></p>
<p>Если у вас есть NAS работающий по NFS, например любой NetApp, или, возможно, EMC Celerra (хотя, как вы догадываетесь, и не все NAS &#8220;одинаково полезны&#8221;), то вы можете подключить созданный на нем дисковый ресурс как &#8220;сетевой диск&#8221; по протоколу NFS.</p>
<p><img src="/pics/nfs1.png"></p>
<p><img src="/pics/nfs2.png"></p>
<p>При этом вы <strong>НЕ </strong>используете VMFS (собственную файловю систему VMware для ее datastores), вы <strong>НЕ </strong>создаете LUN и <strong>НЕ </strong>монтируете эти LUNы ни в ESX (традиционный способ VMFS/LUN), ни в виртуальную машину (способ RDM/LUN - Raw Disk Mapping).<br />
Вы получаете для своего ESX &#8220;сетевой диск&#8221;, и просто размещаете на нем файлы виртуальных дисков  vmdk и vmx так, как будто это локальный диск вашего ESX, отформатированный в VMFS.</p>
<p>Странно и необычно? Только на первый взгляд. Просто воспринимайте этот &#8220;NFS-диск&#8221; как локальный. &#8220;А как же VMFS?&#8221;. Такие ее ключевые функции как, например, &#8220;кластерность&#8221;, то есть множественный доступ к ее разделу с разных виртуальных машин - обычная и традиционная функция NFS как сетевой файловой системы.</p>
<p>?? все? ?? все.</p>
<p><strong>Чем вы платите:</strong></p>
<p>1. Примерно, в среднем, 5% производительности на дисковых операциях. </p>
<p>2. Примерно, в среднем, 5% большей загрузкой процессоров хост-серверов ESX.</p>
<p>?? то и другое приведено на максимально возможной и максимально тяжелой тестировочной нагрузке, заметно превышающей существующую в реальной жизни.<br />
Официальные результаты сравнения быстродействия протоколов от VMware тут: <nofollow><a href="http://www.vmware.com/files/pdf/storage_protocol_perf.pdf">http://www.vmware.com/files/pdf/storage_protocol_perf.pdf</a></nofollow><br />
Там много интересных подробностей, но если лень читать - примите вышеприведенные цифры.<br />
Чуть более подробный документ, совместное исследование той же темы NetApp-ом и VMware тут: <nofollow><a href="http://media.netapp.com/documents/tr-3697.pdf">http://media.netapp.com/documents/tr-3697.pdf</a></nofollow></p>
<p><strong>Что вы получаете (плюсы):</strong></p>
<p>1. Простое и эффективное использование всех фич NetApp, таких как thin provisioning (динамическое выделение пространства тому по мере его потребности в месте, а не сразу в момент нарезки тома или LUN), дедупликация, снэпшоты. Почему, и за счет чего это так, я остановлюсь отдельно.</p>
<p>2. Эффективное &#8220;умное&#8221; кэширование, в том числе и с использованием PAM (Performance Acceleration Module).</p>
<p>3. Легкое управление: создание, удаление, перенос, резервное копирование и восстановление.</p>
<p>4. Отказоустойчивость и &#8220;многопутевость&#8221; подключения, обеспечиваемая отказоустойчивостью IP.</p>
<p>5. В ближайшей перспективе возможность использования 10Gb Ethernet. (Ну, как &#8220;в перспективе&#8221;. Купить 10Gb, в том числе и порты расширения этого стандарта в NetApp вы можете уже сейчас, разве что это пока все же дороговато. Хотя, наверное, не намного дороже, чем перейти на 8Gb FC. А то может и дешевле уже.)</p>
<p>6. В еще большей перспективе вы можете использовать сверхвысокопроизводительную многоузловую grid-систему Data ONTAP GX, которая сейчас уже доступна и работает в качестве NFS NAS (но пока очень ограниченно применима как SAN).</p>
<p><strong>Что вы не получаете (минусы):</strong></p>
<p>1. Вы, скорее всего не сможете использовать VCB (VMware Consolidated Backup) - автономную бэкап-систему VMware ESX.<br />
Довольно сомнительный на мой взгляд недостаток, учитывая примитивность самого VCB, с учетом наличия при этом, как альтернативы, снэпшотов и SMVI. Но вдруг кто-то себе жизни не видит без него.<br />
Также в блоге Ника Триантоса <nofollow><a href="http://storagefoo.blogspot.com/2007/09/vmware-on-nfs-backup-tricks.html">описывается остроумный способ</a></nofollow> &#8220;псевдо-VCB&#8221; - просто смонтировать файлы vmdk как разделы в linux-машине и, при наличии утилиты чтения NTFS, вы сможете делать пофайловый бэкап содержимого даже и windows-разделов.<br />
<font=1>Также обратите внимание, что работа по NFS, с недавних пор, стала доступна для VCB, входящего в версию 3.5, но есть ограничения.</font></p>
<p>2. Вы не сможете использовать внутри виртуальных машин MSCS - Microsoft Cluster Services - кластерную систему Microsoft. Ей нужны RDM(Raw Disk Mapping)-диски, то есть LUN-ы подключеные внутрь VM как raw-диски. Зачем нужен MSCS при наличии VMotion, HA и DRS? Ну может MSCS у нас бесплатен (в составе MS Windows Server Enterprise), а лицензия VMware HA за деньги, или мы по каким-то внутренним причинам переносим без изменений в виртуальную инфраструктуру физическую серверную систему на MSCS, почем знать.</p>
<p>В обоих этих случаях вы можете совместить NFS и LUN-ы SAN. Выбор одного варианта не отбирает и не запрещает вам второй.</p>
<p>Частый вопрос:<br />
<strong>Q:</strong> &#8220;Будет ли это все работать у меня, если мои виртуальные сервера - Windows?&#8221;<br />
<strong>A:</strong> &#8220;Да, к NAS, с дисками по NFS, подключается не &#8220;гостевая&#8221; виртуальная OS, а сам ESX. А для гостевых OS диски, получаемые ESX-ом c системы хранения, выглядят как локальное пространство дисков ESX-сервера, и с NFS как таковым виртуальные машины дела не имеют, все для них уже сделал ESX. Ваша виртуальная машина создает диск, и вы получаете на NFS-томе обычные файлы vmdk, словно это локальный диск ESX под VMFS&#8221;.</p>
<p>Характерный комментарий к одному из постов на эту тему:<br />
<em>&#8220;Dan Pancamo said:<br />
950 VMs across 35 ESX servers. ALL on Netapp over NFS for more than a year now. FC/iSCSI? No thanks!&#8221;</em></p>
<p>Ну что, убедил посмотреть тему повнимательнее и пересмотреть предубеждения?</p>
<p><strong>Еще почитать на тему:</strong></p>
<p>Nick Triantos, один из разработчиков NetApp<br />
<nofollow><a href="http://storagefoo.blogspot.com/2007/09/vmware-over-nfs.html">VMware over NFS (07.09.2007)</a></nofollow></p>
<p>Обзор Gartner:<br />
<nofollow><a href="http://mediaproducts.gartner.com/gc/webletter/netapp/issue18/gartner5.html">Choosing Network-Attached Storage for VMware: What You Should Know</a></nofollow></p>
<p>Mark Mayo<br />
<nofollow><a href="http://www.vmunix.com/mark/blog/archives/2006/08/17/vmware-server-and-nfs-am-i-alone/">VMware Server and NFS? Am I alone?</a></nofollow></p>
<p>Chuck Hollis, Вице-президент EMC по технологическим альянсам, вечный оппонент Хитца, который никогда не упустит в своем блоге возможности злобно куснуть NetApp ;), придерживается того же мнения:<br />
<nofollow><a href="http://chucksblog.typepad.com/chucks_blog/2007/12/storage-protoco.html">Storage Protocols and VMware </a></nofollow>(4.12.2007)<br />
<nofollow><a href="http://chucksblog.typepad.com/chucks_blog/2006/12/vmware_virtual_.html">VMware Virtual Infrastructure 3 – Climbing The Mountain</a></nofollow> (21.12.2006)</p>
<p>Ничего удивительного, ведь NAS продают и EMC.<br />
<nofollow><a href="http://www.vmware.com/files/pdf/VMware_VI3_and_EMC_Celerra_IP.pdf">Using EMC Celerra IP Storage with VI3 over iSCSI and NFS.</a></nofollow></p>
<p>Dan Pancamo<br />
<nofollow><a href="http://viroptics.blogspot.com/2007/11/why-vmware-over-netapp-nfs.html">Why VMware over Netapp NFS</a> </nofollow></p>
<p>Ну и наконец еще раз упомяну на мой взгляд интереснейший, полезнейший и очень активно пополняющийся <nofollow><a href="http://www.vm4.ru/">блог Михаила Михеева</a></nofollow>, преподавателя по теме VMware VI в УЦ Микроинформ. Если вы занимаетесь VMware, то имеет смысл на него подписаться, множество важной и интересной информации собранной &#8220;на просторах&#8221; там публикуется.<br />
Вот, например, все о теме NFS: <nofollow><a href="http://www.vm4.ru/search?q=NFS">http://www.vm4.ru/search?q=NFS</a></nofollow></p>
<p>Ну что-ж. Так и не уложил в один пост всю тему. To be continued.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../../nfs/index.html" rel="tag">nfs</a>, <a href="../index.html" rel="tag">techtalk</a>, <a href="../../vmware/index.html" rel="tag">vmware</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../158/trackback.html#comments" title="Комментарий к записи VMware на NFS: экзотика или новый хит?">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-157">
				<h2 class="posttitle"><a href="../../../157/trackback.html" rel="bookmark" title="Permanent Link to Дедупликация. Новости и слухи.">Дедупликация. Новости и слухи.</a></h2>
				<div class="postmetadata">29 Август 2008, 13:34 <!-- от  --></div>
				<div class="postentry">
					<p><em>Мне в очередной раз на хвосте мышко притащила свежие слухи о ближайшем будущем этой темы.</em></p>
<p>Во первых, многие заметили, произошел отказ от аббревиатуры <strong>A-SIS</strong>, в пользу более понятного <strong>NetApp Dedupe </strong>и просто <strong>Deduplication</strong>. Шаг естественный. Немногие сходу вспомнят, что A-SIS это <em>Advanced Single Instance Store</em>, еще меньше - поймут о чем речь. Переход от &#8220;инженерной&#8221; аббревиатуры к &#8220;самоописывающему&#8221; названию есть вполне правильный путь.</p>
<p>Во вторых, проект &#8220;Дедупликация&#8221; скоро будет иметь две ветви: <strong>FAS Deduplication</strong> (ныне существует), и <strong>VTL Deduplication</strong>, ожидаемый давно, и обещаемый в первом ограниченно доступном для клиентов виде в конце этого года (сейчас она проходит ограниченное бета-тестирование).<br />
Казалось бы, что за труд внедрить уже работающую технологию на параллельной линейке той же компании? Однако же как оказалось не все так просто. По сути под названием <strong>VTL Deduplication </strong>мы будем иметь некий принципиально новый продукт.<br />
Не зря официальные лица так настойчиво повторяли весь год про &#8220;backup-oriented&#8221; и &#8220;stream optimized&#8221;.</p>
<p>Прежде всего, это действительно, в отличие от FAS Deduplication, ориентированного более на General Purpose применение, будет специализированное решение для дискового бэкапа, специально для этого заточенное. Причем заточенное настолько, что, как у меня сложилось впечатление, это будет принципиально иной по своему &#8220;коду&#8221; продукт под уже &#8220;раскрученным&#8221; названием. В пользу этого говорит и то, насколько долго с ним возятся.</p>
<p>Так, например, в VTL Dedupe, кроме уже известного режима <strong>post-process</strong>, который сохранился, добавится и некий <strong>inline</strong>. То есть система будет пытаться проводить дедупликацию в том числе и непосредственно &#8220;в онлайне&#8221;, в процессе поступления данных на диски, аналогично online compression. </p>
<blockquote><p>Практический кейс: У меня есть 100 идентичных образов виртуальных машин по 1GB каждая (ну например 100 установленных Windows XP, отличающихся только несколькими байтами hostname). Я бэкаплю их на диски NetApp со включенной дедупликацией. Сколько понадобится выделить под это места? Нет, не 1GB. Даже несмотря на дедупликацию сперва нам нужно будет все 100GB, а затем 99GB нам вернутся, когда система завершит цикл дедупликации, происходящий в постпроцессе, в &#8220;оффлайне&#8221;.<br />
В случае VTL Dedupe скорее всего какая-то часть дедупликации пройдет уже в процессе записи. </p></blockquote>
<p>Второй момент, натолкнувший меня на мысль о принципиально ином продукте, был сведениями о том, что VTL Dedupe будет оперировать переменными размерами блока.</p>
<p>Напомню вкратце принцип работы FAS Deduplication.<br />
Система хранения NetApp FAS устроена таким образом, что для каждого блока данных WAFL &#8220;внутри системы&#8221; вычисляется и хранится некая хэш-строка. Она довольно давно используется для дополнительного контроля целостности данных при их обработке в системе. Как я понимаю, для дедупликации просто воспользовались уже существующей в системе возможностью. Следствием стало то, что включение дедупликации как таковой, почти никак не затрагивает производительность самой системы. Ведь система и так уже эту функцию имела, добавился только некий процесс с существующими данными, осуществляемый в фоне, с низким приоритетом. Это позволило использовать дедупликацию в том числе и для систем хранения &#8220;общего применения&#8221;, что на сегодня не предлагает ни один из конкурентов.</p>
<p>??так, каждый 4kb-блок WAFL сопровождается хэш-строкой, идентифицирующей, с той или иной степенью достоверности, его уникальность. Если мы находим два идентичных хэша, то мы можем предположить, что соответствующие им блоки данных также иденичны. Для того, чтобы избежать так называемой &#8220;hash collision&#8221;, когда по какой-то причине один и тот же хэш соответствует разным блокам, такое возможно при не слишком сложном алгоритме вычисления хэша (который применяется в NetApp, дабы не грузить излишне систему) система проводит для таких блоков &#8220;контрольную проверку&#8221; путем простого побайтного сравнения этих 4kb-блоков. Если блоки действительно совпали, то один из них освобождается, а в таблице размещения указатель на него переставляется на оставшийся.</p>
<p>Однако тут мы сталкиваемся с неприятной особенностью. Так как файловая система оперирует с фиксированными блоками, то смещение в блоке идентичных данных даже на один байт сделает их хэши полностью различными, и дедупликация эти блоки как дубликаты уже не найдет.</p>
<p>Это является основной причиной иногда наблюдаемой на практике невысокой эффективности дедупликации. Так, например, в случае VMFS-файлов VMware, обычно строго выровненных относительно границы блока, эффективность дедупликации будет высока. Однако, например, файлы резервных копий, создаваемых системами резервного копирования, часто имеют внутри себя то или иное смещение, при том, что физически содержимое их может быть и идентично.<br />
<i>??льдар, похоже это вот как раз твой случай.</i></p>
<p>Так вот, повторюсь, по слухам, VTL Deduplication будет не только уметь производить поиск дубликатов в окне переменной длины, но и знать некоторые популярные форматы бэкапных данных, и учитывать их свойства при работе. Это может весьма положительно сказаться на эффективности для именно бэкапных приложений.    </p>
<p>Однако, как и в случае с FAS Deduplication, NetApp сохранил очень приятную для нас, &#8220;конечников&#8221;, модель с бесплатной лицензией. То есть лицензия-то все равно есть, и для включения дедупликации она все равно нужна, но она бесплатна. Нужно ее только заказать через вашего партнера. То есть ситуация как с лицензией для iSCSI. Она есть, но она бесплатна.</p>
<blockquote><p><font color="#A0A0A0" size=1>?? еще несколько слов в заключение. Уважаемые ребята из московского представительства: Роман, Роман, Саша :). Я знаю, что вы меня читаете ;) Бога ради, если вы считаете, что я вдруг опять ненароком тут засветил какую-то Страшно Охраняемую Военную Тайну, которую Рано Показывать Публике - свяжитесь со мной, что-нибудь придумаем, исключительно из соображений доброй воли. Угум?</font></p></blockquote>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../fas.html" rel="tag">FAS</a>, <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../../technology.html" rel="tag">technology</a>, <a href="../index.html" rel="tag">techtalk</a>, <a href="../../vtl.html" rel="tag">VTL</a>, <a href="../../deduplikaciya.html" rel="tag">дедупликация</a>, <a href="../../sluxi.html" rel="tag">слухи</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../157/trackback.html#comments" title="Комментарий к записи Дедупликация. Новости и слухи.">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-155">
				<h2 class="posttitle"><a href="../../../155/trackback.html" rel="bookmark" title="Permanent Link to «Передний край» – iWARP">«Передний край» – iWARP</a></h2>
				<div class="postmetadata">20 Август 2008, 7:43 <!-- от  --></div>
				<div class="postentry">
					<p><strong>Что есть что на горизонте.</strong></p>
<p>Стремительное продвижение технологий в повседневность IT-служб иногда поразительно. Сегодня, когда интерфейсы Gigabit Ethernet устанавливаются уже даже в ноутбуки, реальностью становится 10Gigabit Ethernet, который еще пару лет назад был чем-то из области лабораторных изысканий. Что же принесет нам этот виток скоростной гонки интерфейсов – давайте посмотрим.</p>
<p><strong>RDMA</strong></p>
<p><strong>RDMA </strong>это <strong>Remote DMA</strong>. Для тех, кто за заботами сегодняшнего дня забыл об основах, позволю себе немного поликбезничать.<br />
<strong>DMA</strong>, или <strong>Direct Memory Access</strong>, это классическая технология ввода-вывода данных с помощью специального программируемого контроллера DMA – прямого доступа к памяти.</p>
<p>Ввод-вывод данных, одна из основных операций в вычислительной системе, может осуществляться разными путями. Например путем процессорных операций. Процессор берет байт из порта ввода и заносит его в ячейку памяти. ??ли наоборот, считывает его из ячейки памяти и отправляет в порт вывода. Ясно видно, что эти операции чрезвычайно загружают собой процессор, ведь такое действие надо совершить с каждым байтом (или вернее «словом», оно может быть и многобайтным).</p>
<p>Проблема с загрузкой процессора при вводе-выводе была решена использованием процедуры DMA – Direct Memory Access. Процессор единожды сообщает специальному контроллеру DMA, с какого или в какой адрес в памяти он желает осуществить перемещение данных, а контроллер исполняет, по завершении уведомляя процессор об исполнении. Получает или передает байты жестким дискам, выводит массивы данных в видеоконтроллер или превращает «цифру» в звук.<br />
Результат обычно весьма впечатляющ. IT-шники со стажем должны помнить, какой эффект давал переход жестких дисков персональных компьютеров с режима PIO (Programmed Input-Output) к DMA (и в дальнейшем к UltraDMA), степень загрузки процессора на интенсивных дисковых операциях снижалась в разы.</p>
<p>Но DMA это лишь локальные операции, проще говоря, возможные только в области памяти и устройств одного компьютера. А что если сделать технологию DMA возможной для разных и между компьютерами?<br />
Так родилась идея <strong>RDMA </strong>– <strong>Remote Direct Memory Access</strong>.</p>
<p>Технология эта отнюдь не нова. За ее разработкой следит представительный <nofollow><a href="http://www.rdmaconsortium.org/home">RDMA Consortium</a></nofollow>, куда входят многие гранды индустрии, такие как IBM, Cisco, NetApp, EMC, HP, Intel, Microsoft, общим числом около 50. Она шумела как новинка еще в 1998 году, а в 2003 году RDMA Consortium объявил о завершении всех запланированных спецификаций. Однако множество проблем в реализации ограничили ее применение high-end HPC (high-performance computing) системами. RDMA той или иной форме применялась на системах Cray, Silicon Graphics и ряде других, столь же легендарных «небожителей».<br />
Однако шли годы, и то, что было уделом экспериментальных и сверхвысокопроизводительных вычислений стало нашей повседневностью, вот и до 10G Ethernet очередь дошла.</p>
<p>Основной идеей, родившей и развивающей RDMA как концепцию, была «размещать нужные данные непосредственно в память приложения», минуя многочисленное каскадное буферирование «из буферов сетевого адаптера в буфера сетевого протокола, из него в буфера OS, из них в буфера дисков, и так далее». ??менно поэтому в приложении к RDMA часто используется термин «zero-copy», то есть «отсутствие копирования», имея ввиду, конечно же, вот такое вот многократное промежуточное копирование между источником и получателем данных.</p>
<p>Наиболее известной реализацией RDMA и его «zero-copy» в применении к системам передачи данных на сегодняшний день является Infiniband, разработанный в соответствии с этими требованиями. На сегодняшний день это наиболее известная сетевая система для высокопроизводительных кластерных интерконнектов, в свое время, за счет своей открытости и меньшей цены, вытеснившая из этой области проперитарный Myrinet. </p>
<p><strong>iSCSI – SCSI over IP</strong><br />
Я уже не раз писал о iSCSI, и останавливаться подробно наверное нет смысла. Сегодня уже все так или иначе находящиеся в теме систем хранения знают что это. <strong>iSCSI </strong>это способ передавать обычные и привычные SCSI-пакеты «упакованными» (модное словечко: «инкапсулированными») в IP-пакеты, и транспортировать их в любой среде передачи IP, например по Ethernet-сети. Тем самым между сервером и его жесткими дисками может находиться не традиционный 68-жильный кабель WideSCSI, а сетевые карты, ethernet-коммутаторы, провода Cat5, СКС, и прочие привычные скорее для «сетевиков» вещи. В наше время, когда в области передачи данных все явственнее происходит конвергенция «все в Ethernet-провод», когда даже будущее такого консервативного протокола как FibreChannel его основным локомотивом, компанией Bocade, видится, по ее заявлениям, в виде <strong>FCoE – FibreChannel-over-Ethernet</strong>, ничего удивительного, что iSCSI нашел себе сегодня широчайшее применение. </p>
<p><strong>TOE – TCP Offload Engine</strong><br />
iSCSI, как протокол в целом, состоит, по сути, из двух независимых частей. Также отдельно они, как правило, и реализуются в оборудовании. Одна часть – «SCSI», и все относящееся к этому протоколу. Вторая – «i» - TCP/IP и все касающееся его.<br />
Как известно, iSCSI может быть реализован полностью программно, и, в ряде случаев это совсем неплохой выбор, недорогой и исключительно гибкий. При этом задачи поддержки протокола осуществляет специальная программа – <strong>iSCSI Initiator</strong>, которые сейчас существуют во всех распространенных операционных системах. Эта программа создает в системе «виртуальный SCSI-адаптер», с которым могут обычным образом взаимодействовать прикладные программы. В дальнейшем она производит на центральном процессоре системы собственно задачи инкапсуляции SCSI-пакетов в IP-пакеты и отправку их драйверу сетевого интерфейса Ethernet, как обычное приложение или драйвер.</p>
<p>Такая модель дает нам беспрецедентную гибкость реализации, однако, очевидно, создает дополнительную нагрузку на центральный процессор, которую, при скоростях вплоть до Gigabit Ethernet еще можно обычно игнорировать, но на скоростях 10Gigabit Ethernet это уже становится сложно. Поэтому для 10GigE-систем как правило применяются те или иные «аппаратные» реализации.</p>
<p>«Аппаратизация» iSCSI может быть осуществлена раздельно по рассмотренным выше частям. Мы можем сделать сетевую карту, которая будет самостоятельно производить всю TCP/IP-шную рутину, такую как расчет контрольных сумм и сборка фрагментов, такое устройство называется <strong>TCP Offload Engine – TOE</strong>. При этом «SCSI-адаптер» в системе у нас остается виртуальным. </p>
<p>Либо сделать полную реализацию обоих частей протокола, то есть аппаратный SCSI-адаптер, на выходе которого будет не WideSCSI-разъем, а сетевой интерфейс, медный или оптический. Реализация же самого протокола для системы и ее приложений, как и ранее, будет для приложения и операционной системы полностью скрыта.</p>
<p>Как правило адаптеры 10Gbit Ethernet имеют в себе либо TCP Offload Engine, сохраняя программную реализацию SCSI, на CPU системы, в драйвере. Либо полную аппаратную реализацию. Такие адаптеры принято называть, как и в FibreChannel-системах – <strong>HBA – Host Bus Adapter</strong>.</p>
<p><strong>iWARP</strong><br />
<strong>iWARP </strong>это <strong>Internet Wide Area RDMA Protocol </strong>– протокол работы RDMA по IP-сетям, основанный на концепциях Virtual Inerface Architecture, и, в определенном смысле, может рассматриваться как некий «Infiniband-over-IP».</p>
<p>С того момента, когда возросшие скорости Ethernet-сетей стали явной проблемой для чисто программной реализации TCP/IP, разработчики задумались над методами разгрузки процессоров, и одним из них стал TOE – TCP Offload Engine – аппаратная реализация TCP/IP на микросхеме контроллера ethernet-адаптера. Такое решение значительно разгружает центральный процессор от задач поддержки передачи данных, которая теперь, в значительной мере, может осуществляться самим контроллером сети. Особенно это стало важно при увеличении скорости и переходе к 10Gbit Ethernet, работа над такими объемами может серьезно нагрузить и довольно мощный современный процессор. А ведь у него есть и другие задачи, кроме как считать контрольные суммы IP-пакетов. </p>
<p>Чаще всего с помощью iWARP передаются такие «вышележащие» протоколы, как <strong>SCSI RDMA Protocol </strong>(SRP), <strong>iSCSI Extensions for RDMA</strong> (iSER), <strong>Sockets Direct Protocol</strong> (SDP) и <strong>NFS-over-RDMA</strong>.<br />
Как видите, интерес Network Appliance к данной технологии понятен и объясним.</p>
<p><strong>iSER – iSCSI Extensions for RDMA</strong> - это расширение протокола iSCSI, позволяющее ему работать по сетям, предоставляющим RDMA-сервис, например по Infiniband или iWARP. Он позволяет передавать данные непосредственно из и в буфер данных SCSI, минуя многочисленные промежуточные копирования данные из одного буфера в другой при традиционной обработке и передаче данных.<br />
Целью создания <strong>iSER </strong>была попытка избежать проблемы фрагментации TCP при работе «классического» iSCSI, который, как вы помните, унаследовал от TCP/IP сетей, кроме массы полезного, и неприятную проблему фрагментации, которая, на больших скоростях передачи, характерных для 10Gbit Ethernet может приводить к заметному ухудшению latency. Суть проблемы заключается в том, что, при передаче, согласно природе TCP, пакеты могут приходить получателю в произвольном порядке, и дело получателя расставить их в нужном порядке, прежде чем передавать на обработку. Однако, пока получателю не придет пакет «номер два», он не может передать в SCSI буфер уже принятые пакеты номер «один», «три», «четыре» … «десять», которые вынуждены дожидаться прихода заплутавшего по сети «второго».<br />
Вследствие этого возможны плохопредсказуемые задержки, которые были незначительны на небольших скоростях, но уже не могут игнорироваться на высоких.<br />
Для решения этой проблемы <strong>iSER </strong>использует «zero-copy»-возможности RDMA вместо обычного способа инкапсуляции в TCP.<br />
В качестве протокола передачи на транспортном уровне может использоваться, кроме «нативного» <strong><nofollow><a href="http://en.wikipedia.org/wiki/Sockets_Direct_Protocol">SDP </a></nofollow></strong>– Socket Direct Protocol, и специально разработанный для потоковых передач протокол <strong><nofollow><a href="http://en.wikipedia.org/wiki/Stream_Control_Transmission_Protocol">SCTP </a></nofollow></strong>– Stream Control Transmission Protocol (RFC4960), являющийся функционально объединяющим преимущества TCP и UDP для целей передачи «потоковых» данных. </p>
<p>Первоначально этот протокол разрабатывался для целей передачи телефонии через IP, но прекрасно подошел и для других потоковых нужд современной Сети. Поддержка SCTP широко присутствует во множестве распространенных операционных системах, например IBM AIX v5, Cisco IOS v12, FreeBSD v7, Linux 2.4/2.6, HP-UX, Sun Solaris 10.<br />
RDMA и NetApp</p>
<p>Компанию <strong>NetApp </strong>и <strong>RDMA </strong>связывает многое. NetApp является одним из учредителей вышеупомянутого <strong>RDMA Consortium</strong>, и еще в 2002 году начала продавать любопытный продукт для своих систем хранения - <strong>DAFS Database Accelerator</strong>, решение, базирующееся на протоколе <strong>DAFS – Direct Access File System</strong>. Это RDMA-based протокол, ориентированный на работу с высокопроизводительными базами данных.<br />
Однако, несмотря на хорошие бенчмарки, согласно которым доступ к сетевому хранилищу NFSv4 через сетевой интерфейс (использовалась специальная карта Emulex VirtualInterface) превосходил по параметрам доступ к локальным дискам системы, продукт не стал бестселлером, и вскоре незаметно исчез из прайс-листа, по видимому придя на рынок слишком рано.</p>
<p>Но сегодня продукты c RDMA появляются на рынке, используя уже широко и активно распространяющиеся 10Gbit Ethernet-системы. Среди их производителей стоит назвать, например, такие имена, как <strong>Chelsio Communications</strong>, производящий такой интересный продукт, как <strong>Chelsio S310SR</strong> – 10G-адаптер с TCP Offload Engine, аппаратным iSCSI, виртуализацией и RDMA. Причем цена за пару, в так называемом <nofollow><a href="http://chelsio.com/products_10g_adapters.html">Evaluation Kit </a></nofollow>на сайте производителя, показана ниже чем 2000$ за карты с SR optical interface и ниже 1500$ за карты с «медным» CX4.<br />
Существуют и версии в «мезонинном» исполнении, для установки в blade-системы, например в HP Type II Blade Systems или IBM Blade Center H.</p>
<p>Любопытно будет также ознакомиться с тестами и бенчмарками. Они, хотя и «вендорские бенчмарки», относиться к которым надо достаточно осмотрительно, но показывают потенциальные возможности новой технологии.</p>
<p><strong><nofollow><a href="http://www.chelsio.com/assetlibrary/products/NFS_RDMA_IB_iWARP.pdf">Experiences with NFS over IB and iWARP RDMA</a></nofollow></strong><br />
<em>OpenFabric Workshop, Sonoma, CA<br />
May 1, 2007</em></p>
<p><strong><nofollow><a href="http://www.chelsio.com/assetlibrary/products/Cluster_Symposium_2005_Presenta.pdf">InfiniBand and 10-Gigabit Ethernet for I/O in Cluster Computing</a></nofollow></strong><br />
<em>July 26-28 Cluster Symposium 2005</em></p>
<p><strong><nofollow><a href="http://www.chelsio.com/assetlibrary/products/HotInterconnect_2005.pdf">Performance Characterization of a 10-Gigabit Ethernet TOE</a></nofollow></strong></p>
<p><strong><nofollow><a href="http://www.chelsio.com/assetlibrary/products/Cluster_2005_Techical_Report_OS.pdf">Head-to-TOE Evaluation of High-Performance Sockets over Protocol Ofﬂoad Engines</a></nofollow></strong></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../10g.html" rel="tag">10G</a>, <a href="../../iscsi/index.html" rel="tag">iscsi</a>, <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../../rdma.html" rel="tag">rdma</a>, <a href="../../technology.html" rel="tag">technology</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../155/trackback.html#comments" title="Комментарий к записи «Передний край» – iWARP">Комментарии (8)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-40">
				<h2 class="posttitle"><a href="../../../40/trackback.html" rel="bookmark" title="Permanent Link to Data ONTAP Simulator">Data ONTAP Simulator</a></h2>
				<div class="postmetadata">27 Август 2007, 16:17 <!-- от  --></div>
				<div class="postentry">
					<p>Вполне возможно мне уже удалось заинтересовать некоторых моих читателей возможностями систем хранения Network Appliance. Однако одно дело слушать рассказы, а совсем другое - попробовать самому, ибо &#8220;даже маленькая практика стоит большой теории&#8221;.</p>
<p>?? тут я хотел бы рассказать о существовании поистине уникального для рынка систем хранения продукта - Симуляторе системы хранения NetApp. </p>
<p>Пожалуй самым правильным будет процитировать тут <a href="http://blogs.netapp.com/dave/2006/11/simulate_netapp.html">заметку Dave Hitz</a> в блоге NetApp об этом продукте:</p>
<blockquote><p>Несколько лет назад мы начали получать жалобы от системных администраторов, которые использовали системы NetApp, примерно такого вида:</p>
<p><em>&#8220;Мне хочется попробовать новые возможности вашего нового релиза Data ONTAP, но все мои системы в продакшне, а мой босс не хочет покупать &#8220;железо&#8221; для моих экспериментов&#8221;</em></p>
<p>Чтобы решить эту проблему мы выпустили &#8220;ONTAP Simulator&#8221;. Симулятор это полная версия Data ONTAP, которая работает как процесс под Linux. Вместо реальных жестких дисков она открывает файлы с именами disk.1, disk.2 и так далее. Вместо физической сетевой карты она перехватывает raw-пакеты из Linux ethernet-драйвера.</p>
<p>Это отличный инструмент для обучения нашему Data ONTAP. Попробуйте новые возможности, или, например, убедитесь, что комбинация возможностей работает так как обещано. Вы можете удалить один из файлов дисков, чтобы увидеть, что произойдет в случае выхода из строя диска, или отредактировать дисковый файл в двоичном редакторе, чтобы увидеть что получается в случае дисковых ошибок.</p>
<p>Мы также используем симулятор в наших учебных классах. Нам больше не нужно держать 30 систем для 30 студентов. Мы используем несколько физических систем для того чтобы показать, например, процедуру замены жесткого диска, когда безусловно нужно видеть реальное &#8220;железо&#8221;, но большинство учащихся используют симулятор. Это уменьшает шум, сберегает электричество и снижает затраты на транспорт при выездном обучении.</p>
<p>Сперва люди только игрались им, но некоторые пользователи вскоре сумели сделать кое-что посерьезнее. Они используют симулятор для тестирования сложных конфигураций, включающих в себя системы с кластеризацией, удаленным реплицированием и долговременным архивированием информации, все с помощью нескольких симуляторов в одной Linux PC. Пользователи сообщали мне, что оказалось гораздо проще и быстрее найти ошибки конфигурации на симуляторе, чем если бы это было на реальном оборудовании, и это могло быть сделано еще до того как это реальное оборудование было куплено, привезено и установлено.<br />
Пользователи используют симулятор также для того, например, чтобы познакомиться с новой версией OS Data ONTAP до апгрейда, для проверки как это заработает в их сетевой структуре и для отладки скриптов управления. Пользователям даже удалось выловить несколько багов Data ONTAP. За исключением низкоуровневых драйверов, симулятор <strong>в точности тот же самый код</strong>, что работает в реальном Data ONTAP, так что вы видите ровно то, как поведет себя реальная система. <em>(С некоторыми исключениями: симулятор медленнее, у него жесткий лимит по доступной дисковой емкости, и мы не эмулируем FС, так что блочный доступ может быть только iSCSI).</em></p>
<p>Симулятор также &#8220;взросл&#8221; как и сам ONTAP. Когда мы были маленькой компанией-стартапом, мы сделали симулятор еще до того, как получили реальное &#8220;железо&#8221;. Позже инженеры обнаружили, что чаще быстрее и проще запускать эмулятор, чем загружать новую OS в реальную систему. Кроме этого инструменты дебаггинга удобнее работали в локальном процессе, чем в &#8220;железном&#8221; устройстве. Мы использовали симулятор в разработке почти 10 лет, прежде чем придумали, что это может быть также отличным инструментом для пользователей.</p>
<p>На этот момент многие тысячи пользователей скачали симулятор. Может конечно мы и не продали несколько &#8220;железных&#8221; систем в результате, но я уверен, что большинство из этих людей просто не могут себе позволить купить дополнительное оборудование только чтобы &#8220;поиграться&#8221;. ??ными словами я думаю, что все, что позволит системным администраторам чуствовать комфорт при работе с нашими системами это наша выгода в долгосрочной перспективе, даже если мы теряем несколько продаж в краткосрочной.</p>
</blockquote>
<p>В принципе загрузка симулятора доступна только действующим клиентам и партнерам компании, однако для настойчивого и умелого интернетчика, умеющего <a href="http://www.google.ru/search?hl=ru&amp;q=Data+ONTAP+Simulator+ISO&amp;lr=">пользоваться поиском </a>нет <a href="http://rapidshare.com/users/F5JY14">проблем найти</a> его и <a href="http://keriomail.googlepages.com/">в свободном доступе</a>.</p>
<p>Симулятор снабжен документацией и инструкцией по установке. Там есть несколько тонких моментов, поэтому убедитесь, что вы прочли инструкцию до конца и поняли ее.</p>
<p>При необходимости можно даже установить &#8220;симулятор в симуляторе&#8221;, например я на своем рабочем ноутбуке использую ONTAP Simulator запущенный внутри виртуальной машины с установленным Linux-ом, работающей на бесплатном VMware Player. Конечно быстродействие такой системы оставляет желать лучшего, однако это вполне работоспособное решение при наличии досточного количества памяти на хост-машине.<br />
Разнообразные готовые &#8220;виртуальные машины&#8221; с установленным Linux можно свободно скачать <a target="_blank" href="http://www.vmware.com/appliances/directory/cat/45">с вебсайта VMware</a>.</p>
<p>Хочу напоследок также привлечь ваше внимание к тому факту, что если у вас есть по настоящему серьезный интерес к системам NetApp, и вы хотите не просто поэкспериментировать с конфигурированием, но и включить в свою реальную IT-систему настоящую систему хранения, например для оценки производительности или для тестирования в &#8220;боевых условиях&#8221;, то все партнеры компании имеют (должны иметь по крайней мере, если это настоящие, серьезные партнеры NetApp) демо-оборудование, которое можно получить на тестирование.</p>
<p>Что еще почитать:<br />
<a href="http://www.oracle.com/technology/pub/articles/garg-netapp-simulator.html"><strong>Learning Oracle RAC with the NetApp Simulator</strong></a><br />
<em>by Sachin Garg</em></p>
<p><a href="http://blog.scottlowe.org/2006/06/27/netapp-ontap-simulator-and-esx-server/"><strong>NetApp ONTAP Simulator and ESX Server</strong></a><br />
<em>blog.scottlowe.org</em></p>
<p><a href="http://blog.scottlowe.org/2006/07/10/iscsi-and-esx-server-3/"><strong>iSCSI and ESX Server 3</strong></a><br />
<em>blog.scottlowe.org</em></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../../simulator.html" rel="tag">simulator</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../40/trackback.html#comments" title="Комментарий к записи Data ONTAP Simulator">Комментарии (4)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-37">
				<h2 class="posttitle"><a href="../../../37/trackback.html" rel="bookmark" title="Permanent Link to Тестирование с помощью IOmeter">Тестирование с помощью IOmeter</a></h2>
				<div class="postmetadata">10 Август 2007, 19:42 <!-- от  --></div>
				<div class="postentry">
					<p>Одним из наиболее популярных т.н. &#8220;синтетических&#8221; тестов является программа IOmeter. ??значально эту программу разработали в Intel, но когда процесс разработки остановился, то были открыты исходные коды и в настоящий момент тест поддерживается энтузиастами OpenSource. ??зредка программа обновляется. В настоящий момент основные вебсайты программы это <a href="http://www.iometer.org">www.iometer.org</a> и страница разработки на SourceForge.</p>
<p>К сожалению каких-либо материалов начального уровня, позволяющих сразу разобраться в работе IOmeter, в сети не найдено, поэтому пришлось сделать это самому, а на будущее написать шпаргалку. В значительной мере эта шпаргалка является описанием конкретно моего случая тестирования, поэтому она опускает некоторые возможности, которыми я не пользовался.<br />
Думаю освоив то, что описано здесь, можно разобраться и с остальным.</p>
<p><strong>Описания методики тестирования системы хранения с помощью программы IOmeter (версия 2006.07.27)</strong></p>
<p>Программа состоит из GUI-фронтенда iometer.exe (есть только под windows) и генератора нагрузки dynamo.exe (бывает под windows, linux, solaris, netware), управляемого из GUI по сети.</p>
<p>Запускаем на сервере, к которому подключен тестируемый раздел на системе хранения, программу dynamo из комплекта поставки iometer, она будет осуществлять нагрузку для тестирования.<br />
dynamo бывает под windows, linux, может быть собрана под solaris.</p>
<p>Ключи запуска выводятся по /?</p>
<p>Указывается компьютер (имя или ip), на котором установлен GUI frontend IOmeter. (/i )</p>
<p>Указывается имя &#8220;менеджера&#8221;, на котором запущен dynamo (/n ), будет показано в GUI.</p>
<p>Указывается имя (ip-адрес) компьютера &#8220;менеджера&#8221; для коммуникации с ним по сети. (/m )</p>
<p>Указывается номер порта для связи dynamo и GUI, если не указан, то будет взят по умолчанию 1066. Должен быть свободно пропущен через межсетевые экраны и файрволлы для обеспечения взаимодействия dynamo и IOmeter GUI.</p>
<p>Если небходимо, можно назначить исполнение на конкретном CPU (см. подсказку по /?).</p>
<blockquote><p>Пример:</p>
<p>dynamo /i testadmin /m 192.168.0.10 /n generator001</p>
<p>testadmin - имя (или ip-адрес) компьютера где будет работать iometer<br />
192.168.0.1 - адрес (можно dns-имя) сервера нагрузки (где исполняется dynamo)<br />
generator001 - произвольное имя генератора нагрузки, показываемое в iometer GUI.</p>
</blockquote>
<p>Если dynamo уже запущен, то при старте Iometer тот найдет присутствующие в сети Managers, покажет их и разрешит использование. При отсутствии удаленных dynamo будет запущен локальный dynamo, для тестирования локальных ресурсов.</p>
<p>Каждый процессор менеджера тестирования с запущенным dynamo представлен отдельным worker. На каждый worker можно назначить свой тест.<br />
Worker это процесс, который будет исполнять тест. По умолчанию количество workers равно количеству процессоров (ядер, HyperThreading pseudo-CPUs). Но можно создать дополнительные workers кнопкой на тулбаре.<br />
Дополнительно могут быть добавлены workers для тестирования интерфейсов локальной сети (см. тулбар).<br />
Сброс workers и реконнект к менеджерам там же, на тулбаре.</p>
<p>В Iometer открываем конфигурационный файл, отключаем в параметрах открытия Managers and Workers, чтобы не искало чужих managers, настроенных в конфигурационном файле. В дальнейшем, если записать конфигурационный файл на своей тестировочной инфраструктуре, можно открывать и с настройками workers.</p>
<p>Выбираем нужного нам manager и его worker<br />
В закладке Disk Targets выбираем объект, например смонтированный LUN системы хранения.<br />
<em><strong>Желтым цветом </strong></em>показаны логические дисковые разделы с файловой системой, <strong>ДОСТУПНЫЕ НА ЗАП??СЬ.</strong><br />
<em><strong>Голубым</strong></em> - физические разделы без партиции на них.<br />
<em><strong>Перечеркнутый значок </strong></em>означает, что на диске не найден тестовый файл.<br />
Отмечаем нужный крестиком слева. На данном LUNе (в случае использования файловой системы) будет при первом запуске создан тестовый файл iobw.tst. Операции при тестировании будут проводиться с ним.<br />
<strong>ВН??МАН??Е: по умолчанию этот файл будет занимать все свободное место на диске!</strong><br />
Это может занять продолжительное время при первом запуске. Ожидайте. По завершении создания файла начнется тест. При необходимости тестовый файл может быть обычным образом скопирован на другие разделы, чтобы не создавать его там заново.</p>
<p>Для того, чтобы ограничить размер тестирования введите размер файла в 512b-блоках в поле Maximum Disk Size. Например: &#8220;16777216&#8243; sectors (8GiB).</p>
<p>Starting disk Sector, Outstanding IOs и Test Connection rate оставляем в состоянии по умолчанию.</p>
<p>В закладке Access Specifications в правой панели перечислены импортированные из конфигурационного файла преконфигурированные паттерны.<br />
Выбираем worker у менеджера и добавляем для него из правой в левую панель необходимый паттерн.<br />
Патернов одновременно может быть назначено несколько.<br />
Каждый worker может иметь свои паттерны.<br />
В конкретном случае добавляем только один только одному worker-у.</p>
<p>На закладке Results Display будем наблюдать ход теста.<br />
Варианты вывода: Start of test - накопительный, или Last Update - последний замер. Период замера показывает движок Update Frequency (от 1 секунды до &#8220;бесконечности&#8221;). <em>В случае &#8220;бесконечности&#8221; результаты отображаться не будут.</em><br />
<em><strong>ВН??МАН??Е:</strong></em> это влияет только на отображение результатов, само тестирование непрерывно и в записанном результате будет показано наивысшее значение.</p>
<p>В группе Display назначены по умолчанию 6 индикаторов (от Total I/O per second до Interrupts per second). ??ндикаторы могут быть изменены нажатием на кнопку их имени. Оставим по умолчанию.</p>
<p>В закладке Test Setup указываем имя теста в поле Test Description (это будет занесено в лог тестирования для опознания результатов). Например &#8216;fc dbpattern&#8217;.<br />
Поле Run Time - время исполнения теста. Если тест состоит из нескольких запусков, то это длительность ОДНОГО запуска. Устанавливаем 1 минута.<br />
Поле Ramp Up Time это время &#8220;разгона&#8221; системы перед началом замера. Устанавливаем 15 секунд.<br />
Остальные поля оставляем по умолчанию.</p>
<p>В Cycling Option выбираем из выпадающего списка<br />
<em>&#8220;Cycle # Outstanding IOs &#8212; &#8230;&#8221;<br />
</em>Это установит тестирование с прогрессивно увеличивающимся количеством потоков выполнения (Outstanding IOs).<br />
В поле # of Outstanding IOs указываем<br />
<em>Start:1 End:256 Power:2 Exponential Stepping.</em><br />
При этом количество потоков будет увеличиваться экспоненциально: 1,2,4 &#8230; 128,256.<br />
Значение Outstanding IOs от 1 до 8 относится к очень &#8220;легким&#8221; программам, 128 и 256 - очень &#8220;тяжелым&#8221;. Целиком тест покажет нагрузочную способность в зависимости от интенсивности ввода-вывода от сервера.<br />
Также можно увеличивать количество параллельно работающих workers, не забудьте предварительно их создать и назначить им паттерны нагрузки!<br />
При выборе соответствующих вариантов тестирования становятся доступны поля ввода значений для этих режимов.<br />
Каждый из таких потоков будет исполняться 1 минуту, итого 9 минут (+15 секунд ramp up на каждый тест) на полный тест паттерна.</p>
<p>Все готово.</p>
<p>Нажимаем на Start Tests (зеленый флажок в тулбаре). Если тестовый файл не был создан, то ожидаем, пока он будет создан, после чего начнется тестирование. Будет запрошено имя и раcположение файла результатов (по умолчанию results.csv). Желательно дать имя соответствующее профилю тестирования, например &#8216;fc dbpattern.csv&#8217; для упрощения дальнейшего разбора.<br />
Запустив тест пожно пойти посмотреть текущие результаты на &#8220;градусниках&#8221; в закладке Results Display.<br />
В statusbar внизу программы отображается прогресс выполнения группы тестов.</p>
<p>По завершению тестирования одного паттерна перейти в Access Specifications и поменять паттерн. ??зменить описание теста в Test Setup и запустить новый цикл.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../iometer.html" rel="tag">iometer</a>, <a href="../../performance/index.html" rel="tag">performance</a>, <a href="../index.html" rel="tag">techtalk</a>, <a href="../../testing.html" rel="tag">testing</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../37/trackback.html#comments" title="Комментарий к записи Тестирование с помощью IOmeter">Комментарии (5)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-29">
				<h2 class="posttitle"><a href="../../../29/trackback.html" rel="bookmark" title="Permanent Link to Что такое репликация и какая она бывает.">Что такое репликация и какая она бывает.</a></h2>
				<div class="postmetadata">16 Июль 2007, 18:39 <!-- от  --></div>
				<div class="postentry">
					<p><strong>Синхронная</strong><br />
Синхронная репликация - это зеркалирование данных на две системы хранения или два дисковых раздела внутри одной системы.<br />
Популярный RAID-1 («зеркало») для дисковых контроллеров есть по сути просто синхронная репликация на два диска, выполняемая контроллером диска. При этом каждый блок данных записывается более или менее одновременно, параллельно, на оба устройства. Аналогичным образом это осуществляется на два «диска» в разных дисковых системах хранения.<br />
Это «идеальная репликация», обе копии данных полностью идентичны, потому что пока данные не будут гарантированно записаны на оба устройства, оно не может приступить к записи следующего блока.<br />
Однако теоретическая идеальность в реальной жизни оказывается ограничением.</p>
<p><img src="http://blog.aboutnetapp.ru/pics/ReplicationN.jpg" style="width: 372px; height: 291px" height="291" width="372" /></p>
<p><img src="http://blog.aboutnetapp.ru/pics/ReplicationS.jpg" style="width: 372px; height: 291px" height="291" width="372" /></p>
<p>Как мы видим, общая скорость системы ограничена самым узким каналом передачи данных. Если мы соединены с системой хранения FC-каналом в 4GB/s, а система хранения синхронно реплицируется на удаленную систему по каналу в 10MB/s, то скорость обмена по FC-каналу 4GB/s будет 10MB/s и ни байтом больше.</p>
<p><strong>Асинхронная</strong><br />
Асинхронной называют репликацию, которая осуществляется не в тот же момент, когда осуществляется запись оригинального блока данных, а в «удобное время». Это позволяет преодолеть вышеописанный недостаток синхронной репликации, поскольку процесс записи данных и процесс их переноса на «реплику» разделены и не связаны больше.</p>
<p><img src="http://blog.aboutnetapp.ru/pics/ReplicationA.jpg" style="width: 372px; height: 291px" height="291" width="372" /></p>
<p>При этом сама репликация может быть осуществлена более оптимальным путем, можно провести дополнительную оптимизацию процесса, она может осуществляться по гораздо более дешевым и менее быстродействующим каналам, но… копия данных, создаваемая асинхронной репликацией (в отличие от cинхронной), строго говоря, никогда не будет полностью абсолютно идентичной оригиналу, хотя и будет постоянно стремиться к этому соответствию.</p>
<p><strong>«Полусинхронная»</strong><br />
Вариантом, сочетающим в себе возможности синхронной и асинхронной репликации, является так называемая «semi-synchronous» репликация, или «полусинхронная».<br />
В этом случае репликация проводится синхронной до тех пор, пока это позволяет быстродействие системы или канала связи. А затем, вместо замедления и остановки операций записи, временно переключается в асинхронный режим, продолжая обрабатывать поступающие данные без задержек, отправляя данные репликации в асинхронном режиме до тех пор, пока не возникнет возможность восстановить синхронный режим.</p>
<p><strong>Проблемы консистентности</strong><br />
Для любой репликации отличной от синхронной серьезной проблемой является также &#8220;проблема консистентности&#8221;. Рассмотрим ее на простом примере.<br />
Узел хранения А асинхронно реплицирует данные на узел хранения Б.<br />
На устройстве хранения работает база данных, которая обрабатывает запросы, например финансовой системы.</p>
<p>В процессе проводки операции продажи база данных при продаже декрементирует счетчик количества товара и добавляет в базу сумму продажи (то есть я утрирую и огрубляю, но примерный принцип таков). Но это две различных операции над базой (разными базами) данных.<br />
Если у нас работает асинхронная репликация, то может случиться так, что разрыв репликации в результате отказа может произойти в момент, когда первая операция уже прошла, а вторая еще не началась.<br />
В результате мы имеем нарушение консистентности базы, которое довольно непросто выловить, ведь транзакции-то как таковые завершились успешно, но нарушилась бизнес-связность группы транзакций.<br />
Поэтому с точки зрения целостности базы будет лучше, если мы &#8220;откатим&#8221; всю операцию продажи, сохранив консистентность, а не только отдельную транзакцию.<br />
Эту проблему в репликации каждый вендор решает по-своему, обычно путем реализации так называемых consistency groups, для которых операции репликации производятся связно.</p>
<p>Если вы работаете с базами данных и используете асинхронную или semi-synchronous репликацию, то не забывайте об этой особенности асинхронности в применимости к репликации баз данных и подобных им задач.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../replication.html" rel="tag">replication</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../29/trackback.html#respond" title="Комментарий к записи Что такое репликация и какая она бывает.">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-22">
				<h2 class="posttitle"><a href="../../../22/trackback.html" rel="bookmark" title="Permanent Link to RAID - что это и чем отличается от средства против комаров. ;)">RAID - что это и чем отличается от средства против комаров. ;)</a></h2>
				<div class="postmetadata">3 Июль 2007, 20:53 <!-- от  --></div>
				<div class="postentry">
					<p>??нтересной особенностью систем хранения NetApp является использование необычного типа RAID - Type 4.</p>
<p>Для того чтобы понять, что это и чем необычно, давайте вкратце рассмотрим, что такое RAID и все используемые в нем типы.</p>
<p><strong><em>RAID</em></strong> - аббревиатура, расшифровываемая как <em>Redundant Array of Independent Disks</em> - &#8220;отказоустойчивый массив из независимых дисков&#8221; (раньше иногда вместо Independent использовалось слово Inexpensive). Концепция структуры, состоящей из нескольких дисков, объединенных в группу, обеспечивающую отказоустойчивость родилась в 1987 году в основополагающей работе Паттерсона, Гибсона и Катца.</p>
<p><strong>??сходные типы RAID-массивов</strong></p>
<p><strong><em>RAID-0<br />
</em></strong>Если мы считаем, что RAID это &#8220;отказоустойчивость&#8221;(<em>Redundant&#8230;</em>), то RAID-0 это &#8220;нулевая отказоустойчивость&#8221;, отсутствие ее. Структура RAID-0 это &#8220;массив дисков с чередованием&#8221;. Блоки данных поочередно записываются на все входящие в массив диски, по порядку. Это повышает быстродействие, в идеале во столько раз, сколько дисков входит в массив, так как запись распараллеливается между несколькими устройствами.<br />
Однако во столько же раз снижается надежность, поскольку данные будут потеряны при выходе из строя любого из входящих в массив дисков.</p>
<p><strong><em>RAID-1<br />
</em></strong>Это так называемое &#8220;зеркало&#8221;. Операции записи производятся на два диска параллельно. Надежность такого массива выше, чем у одиночного диска, однако быстродействие повышается незначительно (или не повышается вовсе).</p>
<p><strong><em>RAID-10<br />
</em></strong>Попытка объединить достоинства двух типов RAID и лишить их присущих им недостатков. Если взять группу RAID-0 с повышенной производительностью, и придать каждому из них (или массиву целиком) &#8220;зеркальные&#8221; диски для защиты данных от потери в результате выхода из строя, мы получим отказоустойчивый массив с повышенным, в результате использования чередования, быстродействием.<br />
На сегодняшний день &#8220;в живой природе&#8221; это один из наиболее популярных типов RAID.<br />
Минусы - мы платим за все вышеперечисленные достоинства половиной суммарной емкости входящих в массив дисков.</p>
<p><strong><em>RAID-2</em></strong><br />
Остался полностью теоретическим вариантом. Это массив, в котором данные кодируются помехоустойчивым кодом Хэмминга, позволяющим восстанавливать отдельные сбойные фрагменты за счет его избыточности. Кстати различные модификации кода Хэмминга, а также его наследников, используются в процессе считывания данных с магнитных головок жестких дисков и оптических считывателей CD/DVD.</p>
<p><strong><em>RAID-3</em></strong> и <strong><em>4<br />
</em></strong>&#8220;Творческое развитие&#8221; идеи защиты данных избыточным кодом. Код Хэмминга незаменим в случае &#8220;постоянно недостоверного&#8221; потока, насыщенного непрерывными слабопредсказуемыми ошибками, такого, например, как зашумленный эфирный канал связи. Однако в случае жестких дисков основная проблема не в ошибках считывания (мы считаем, что данные выдаются жесткими дисками в том виде, в каком мы их записали, если уж он работает), а в выходе из строя целиком диска.<br />
Для таких условий можно скомбинировать схему с чередованием (RAID-0) и для защиты от выхода из строя одного из дисков дополнить записываемую информацию избыточностью, которая позволит восстановить данные при потере какой-то ее части, выделив под это дополнительный диск.<br />
При потере любого из дисков данных мы можем восстановить хранившиеся на нем данные путем несложных математических операций над данными избыточности, в случае выходя из строя диска с данными избыточности мы все равно имеем данные, считываемые с дискового массива типа RAID-0.<br />
Варианты RAID-3 и RAID-4 отличаются тем, что в первом случае чередуются отдельные байты, а во втором - группы байт, &#8220;блоки&#8221;.<br />
Основным недостатком этих двух схем является крайне низкая скорость записи на массив, поскольку каждая операция записи вызывает обновление &#8220;контрольной суммы&#8221;, блока избыточности для записанной информации. Очевидно, что, несмотря на структуру с чередованием, производительность массива RAID-3 и RAID-4 ограничена производительностью одного диска, того, на котором лежит &#8220;блок избыточности&#8221;.</p>
<p><strong><em>RAID-5<br />
</em></strong>Попытка обойти это ограничение породила следующий тип RAID, в настоящее время он получил, наряду с RAID-10, наибольшее распространение. Если запись на диск &#8220;блока избыточности&#8221; ограничивает весь массив, давайте его тоже размажем по дискам массива, сделаем для этой информации невыделенный диск, тем самым операции обновления избыточности окажутся распределенными по всем дискам массива. То есть мы также как и в случае RAID-3(4) берем дисков для хранения N информации в количестве N + 1 диск, но в отличие от Type 3 и 4 этот диск также используется для хранения данных вперемешку с данными избыточности, как и остальные N.<br />
Недостатки? А как же без них. Проблема с медленной записью отчасти была решена, но все же не полностью. Запись на массив RAID-5 осуществляется, тем не менее, медленнее, чем на массив RAID-10. Зато RAID-5 более &#8220;экономически эффективен&#8221;. Для RAID-10 мы платим за отказоустойчивость ровно половиной дисков, а в случае RAID-5 это всего один диск.</p>
<p>Однако скорость записи снижается пропорционально увеличению количества дисков в массиве (в отличие от RAID-0, где она только растет). Это связано с тем, что при записи блока данных массиву нужно заново рассчитать блок избыточности, для чего прочитать остальные &#8220;горизонтальные&#8221; блоки и пересчитать в соответствии с их даными блок избыточности. То есть на одну операцию записи массив из 8 дисков (7 дисков данных + 1 дополнительный) будет делать 6 операций чтения в кэш (остальные блоки данных со всех дисков, чтобы рассчитать блок избыточности), вычислять из этих блоков блок избыточности, и делать 2 записи (запись блока записываемых данных и перезапись блока избыточности). В современных системах частично острота снимается за счет кэширования, но тем не менее удлиннение группы RAID-5 хотя и вызывает пропорциональное увеличение скорости чтения, но также и соответственное ему снижение скорости записи.<br />
Ситуация со снижением производительности при записи на RAID-5 иногда порождает любопытный экстремизм, например, <a href="http://www.baarf.com/">http://www.baarf.com/</a> ;)</p>
<p>Тем не менее, поскольку RAID-5 есть наиболее эффективная RAID-структура с точки зрения расхода дисков на &#8220;погонный мегабайт&#8221; он широко используется там, где снижение скорости записи не является решающим параметром, например для долговременного хранения данных или для данных, преимущественно считываемых.<br />
Отдельно следует упомянуть, что расширение дискового массива RAID-5 добавлением дополнительного диска вызывает полное пересчитывание всего RAID, что может занимать часы, а в отдельных случаях и дни, во время которых производительность массива катастрофически падает.</p>
<p><strong><em>RAID-6<br />
</em></strong>Дальнейшее развитие идеи RAID-5. Если мы рассчитаем дополнительную избыточность по иному нежели применяемому в RAID-5 закону, то мы сможем сохранить доступ к данным при отказе двух дисков массива.<br />
Платой за это является дополнительный диск под данные второго &#8220;блока избыточности&#8221;. То есть для хранения данных равных объему N дисков нам нужно будет взять N + 2 диска.Усложняется &#8220;математика&#8221; вычисления блоков избыточности, что вызывает еще большее снижение скорости записи по сравнению с RAID-5, зато повышается надежность. Причем в ряде случаев она даже превышает уровень надежности RAID-10. Нетрудно увидеть, что RAID-10 тоже выдерживает выход из строя двух дисков в массиве, однако в том случае, если эти диски принадлежат одному &#8220;зеркалу&#8221; или разным, но при этом не двум зеркальным дискам. А вероятность именно такой ситуации никак нельзя сбрасывать со счета.</p>
<p>Дальнейшее увеличение номеров типов RAID происходит за счет &#8220;гибридизации&#8221;, так появляются RAID-0+1 ставший уже рассмотренным RAID-10, или всяческие химерические RAID-51 и так далее.<br />
В живой природе к счастью не встречаются, обычно оставаясь &#8220;сном разума&#8221; (ну, кроме уже описанного выше RAID-10).</p>
<p>&#8220;Но тут наступило утро, и Шахеразада прекратило дозволенные речи&#8221;.</p>
<p>Как именно в NetApp используется необычный тип RAID, каким образом удалось обойти присущие этому типу недостатки и чем вызван такой &#8220;особый путь&#8221; данной системы хранения - смотрите в следующей серии!</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../basics.html" rel="tag">basics</a>, <a href="../../raid.html" rel="tag">raid</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../22/trackback.html#comments" title="Комментарий к записи RAID - что это и чем отличается от средства против комаров. ;)">1 комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-19">
				<h2 class="posttitle"><a href="../../../19/trackback.html" rel="bookmark" title="Permanent Link to WAFL">WAFL</a></h2>
				<div class="postmetadata">21 Июнь 2007, 23:51 <!-- от  --></div>
				<div class="postentry">
					<p>Одним из камней, лежащих в основании системы хранения NetApp, наряду с <a href="../../../12/trackback.html" title="DataONTAP">собственной версией</a> UNIX-подобной OS, является внутренняя файловая система, собственная разработка компани, под названием WAFL - Write Anywhere File Layout - &#8220;Файловая система с записью повсюду&#8221; :)</p>
<p>Откуда такое название, и что она дает системам хранения Network Appliance?</p>
<p>Прежде всего следует объяснить, в чем состоит &#8220;запись повсюду&#8221;.<br />
В файловой системе WAFL принята остроумная схема, при которой единожды записанные блоки данных в дальнейшем не перезаписываются, а при необходимости перезаписи блока данных внутри файла, из пула свободных блоков файловой системы выделяется пустой блок, в который и направляется запись, после чего в &#8220;таблице размещения файлов&#8221; переставляется указатель со старого блока на новый.</p>
<p>Такая схема организации записи позволила использовать очень простую и эффективную схему создания снэпшотов, то есть мгновенных &#8220;снимков состояния&#8221; данных. Поскольку блоки данных для какого-либо файла <strong>вообще никогда не перезаписываются </strong>(только дописываются и освобождаются все целиком после удаления самого файла), то, как нетрудно видеть, сохранение состояния таблицы размещения файлов (правильнее &#8220;таблицы inodes&#8221;) полностью сохраняет и всю записанную на дисках информацию, без какой-либо дополнительной защиты или копирования, просто by design.</p>
<p>Вторым преимуществом такой схемы является то, что &#8220;произвольная запись&#8221; (random write) становится для этой файловой системы &#8220;последовательной записью&#8221; (sequental write), что, обычно, очень хорошо сказывается на производительности приложений, для которых характерна именно &#8220;произвольная запись&#8221;, например преимущественно такой характер носит запись для баз данных.<br />
Образующаяся со временем &#8220;фрагментация&#8221; физического размещения данных успешно &#8220;дефрагментируется&#8221; специальным фоновым процессом, во время пониженной загрузки системы хранения.</p>
<p>К особенностям &#8220;программно-аппаратной&#8221; реализации файловой системы следует также отнести и &#8220;аппаратный журнал&#8221; - NVRAM. В отличие от журналируемых файловых систем &#8220;обычного типа&#8221;, в которых журнал вместе с данными хранится на том же самом диске (обычно в особой области данных), журнал в WAFL размещен в специальном аппаратном устройстве, которым оснащены все системы хранения NetApp - устройстве Non-Volatile RAM, модуле оперативной памяти с батарейным питанием.</p>
<p>Несмотря на то, что блок NVRAM внутри NetApp <a href="http://flickr.com/photos/romx/97542926/in/set-72157600210534237/" target="_blank" title="NVRAM in FAS960">выглядит очень похоже</a> на Write-back cache у большинства вендоров систем хранения и серверов (плата с модулями DRAM и батареей резервного питания), функция его полностью иная.</p>
<p>Ну и, наконец, важной особенностью и отличием от широкоизвестных журналируемых файловых систем является параллельная поддержка двух схем разграничения доступа, т.н. &#8220;UNIX-style&#8221; и ACL(Access Control List) или &#8220;Windows-style&#8221;. Это связано с необходимостью поддержки на одном устройстве как файлов UNIX-&#8221;мира&#8221;, так и Windows-систем.<br />
Таким образом, работая как NAS, устройства NetApp могут обслуживать как UNIX- так и Windows-машины, обращающиеся к одним и тем же файлам. Взаимное соответствие пользователей двух &#8220;миров&#8221; настраивается через таблицы взаимных соответствий пользователей, при этом система хранения понимает, что пользователь jmith подключающийся по NFS и DOMAIN\JohnSmith (или johnsmith@domain.local) это один и тот же человек, и соответствующим образом разрешает ему доступ к данным вне зависимости от того, как он в систему хранения попадает, через NFS или CIFS.</p>
<p>Таким образом, выбор специальной файловой системы позволил не только получить уникальный функционал &#8220;снимков данных&#8221; (кстати NetApp и является изобретателем этой технологии, впоследствии активно воспроизводившейся в различных видах у конкурентов), но и получить черезвычайно эффективную технологию записи, заметно превосходящую по производительности решения конкурентов.</p>
<p>Подробнее (и по-английски) об устройстве файловой системы WAFL можно подсмотреть тут:<br />
<strong>File System Design for an NFS File Server Appliance<br />
</strong><em>Dave Hitz, James Lau, &amp; Michael Malcolm | Network Appliance | TR 3002 </em><a href="http://www.netapp.com/library/tr/3002.pdf">http://www.netapp.com/library/tr/3002.pdf</a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../filesystems.html" rel="tag">filesystems</a>, <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../index.html" rel="tag">techtalk</a>, <a href="../../wafl/index.html" rel="tag">wafl</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../19/trackback.html#respond" title="Комментарий к записи WAFL">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-15">
				<h2 class="posttitle"><a href="../../../15/trackback.html" rel="bookmark" title="Permanent Link to О производительности: IOPS vs. MB/s">О производительности: IOPS vs. MB/s</a></h2>
				<div class="postmetadata">4 Июнь 2007, 23:35 <!-- от  --></div>
				<div class="postentry">
					<p>Тема измерения производительности столь велика и непроста, что стоит отдельной статьи только на эту тему. Однако без элементарных знаний, которые можно попробовать изложить кратко, для понимания рассматриваемой темы эффективной системы хранения не обойтись.</p>
<p>Для начала следует определить два основных общепринятых понятия, используемых для измерения производительности.<br />
Первый из них – <strong>Input-Output Operations Per Second</strong> – <strong>IOPS</strong> - показывает количество операций ввода-вывода в секунду, которые способно обработать устройство. Этот параметр прежде всего характеризует скорость обработки коротких запросов, и наиболее часто применим для оценки таких задач, как <em>OLTP-база данных</em> и близких к ней.<br />
Операции базы данных как правило характеризуются обменом относительно небольшими блоками (как правило 4-8KB). Каждая такая операция по считыванию или записи блока является одним IOPS-ом. Таким образом, чем выше показатель производительности в IOPS, тем выше производительность базы данных.</p>
<p>Другим параметром, характеризующим производительность, является <strong>Скорость передачи данных</strong>, так называемый <strong><em>traffic throughput</em></strong>, измеряемый в MB/s, то есть количеством мегабайт, проходящих по интерфейсу ввода-вывода в секунду.<br />
Этот параметр характеризует скорость обработки в случае больших блоков, классическая задача, для которой критичен именно параметр MB/s, это <em>аудио-видео обработка, резервное копирование и DSS-базы данных</em>.</p>
<p>Какой же из этих параметров более «правильный», какой более важен? Разумеется оба.<br />
Однако следует понимать, что оба этих параметра связаны между собой «обратно пропорционально». Увеличение величины в IOPS вызывает снижение величины в MB/s и наоборот.</p>
<p>Чтобы понять почему так, нужно рассмотреть простой пример и аналогию.<br />
По дороге следует переместить из А в Б большое количество человек. Возможно два варианта: мы можем перевозить их в их личных автомобилях или же усадить в автобусы. Пропускная способность дороги конечно же будет выше в случае перевозки людей автобусами, то есть «большими блоками». Однако методы общественного транспорта обычно вступают в конфликт с индивидуальными целями и маршрутами. Хорошо если в Б у нас огромный завод, на который устремлен основной поток из А. Можно погрузить все «байты» в один большой пакет-автобус на входе, и выгрузить его на остановке у завода, куда собственно и направляются все наши «байты».<br />
Однако если наши байты не едут на завод, а разъезжаются по индивидуальным и независимым делам-«операциям», каждый имея индивидуальный маршрут, то доставка их «автобусом»-большим пакетом приведет напротив к большим потерям времени. В этом случае транспортировка индивидуальными автомобилями будет более выгодна. Однако общий пропускной объем дороги заполненной индивидуальными «пакетами»-авомобилями везущими по нескольку байт каждый, разумеется будет ниже, чем при перевозке большим пакетом-«автобусом».<br />
Таким образом <strong><em>увеличение пропускной способности в MB/s за счет укрупнения пакетов приводит к снижению IOPS, и наоборот</em></strong>, рост операций в секунду «доставленных к цели пассажиров» нашей дороги-интерфейса, запруженной автомобилями, приводит к снижению ее пропускной способности в MB/s. <strong><em>Нельзя одновременно достичь высоких показателей в IOPS и в MB/s просто по физическим свойствам существующего оборудования.<br />
</em></strong>Либо большие пакеты-«автобусы» и их мало («операций в секунду»), либо маленькие индивидуальные пакеты-«автомобили», каждый осуществляющий индивидуальную «операцию» по доставке данных, но заполняющие всю дорогу, и общий human traffic в результате невелик.</p>
<p><img src="/pics/traffic.jpg" /></p>
<p>Отсюда видно, что широко разрекламированная величина пропускной способности интерфейса SATA-II дисков в 300MB/s далеко не всегда (а чаще и вообще никогда) не будет достижима на практике. Более того, в случае использования таких дисков для операций с базой данных OLTP роль будет играть не столько потоковая производительность интерфейса, сколько гораздо реже публикуемая максмальная величина IOPS диска, в настоящий момент равная для SATA 7200rpm примерно 50 IOPS, и в случае OLTP-нагрузки выиграет не диск с самыми высокими данными по мегабайтам в секунду, а самый быстродействующий по IOPS - параметру, напрямую связанному с рассмотренной выше «латентностью», такой как, например, диск с интерфейсом FC и скоростью вращения 15Krpm, для которого величина IOPS достигает 200. При прочих равных диски SATA всегда проиграют в случае работы с базой данных не только дискам FC, но и традиционным SCSI.<br />
Однако в случае использования дисков на задачах считывания и записи аудио-видеоданных, или резервного копирования, характеризующихся большим и постоянным потоком данных большими блоками, диски SATA вполне могут быть не хуже значительно более дорогостоящих FC или SCSI, легко выигрывая у них за счет цены за хранимый мегабайт.</p>
<p>Как мы видим, точное понимание решаемых задач безусловно необходимое требование при выборе того или иного решения дисковой системы хранения.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../iops.html" rel="tag">iops</a>, <a href="../../performance/index.html" rel="tag">performance</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../15/trackback.html#respond" title="Комментарий к записи О производительности: IOPS vs. MB/s">Комментарий</a>									 </div>
			</div>
	
		
		<div class="navigation">
			<div class="alignleft"></div>
			<div class="alignright"><a href="3.html">Next Entries &raquo;</a></div>
		</div>
		
	
	</div>
	<div id="sidebar">
		<ul>
			
			
			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Автор</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			<li class="pagenav"><h2>Страницы</h2><ul><li class="page_item page-item-153"><a href="../../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul></li>
			<li><h2>Рубрики</h2>
				<ul>
					<li class="cat-item cat-item-89"><a href="../../../category/commands/index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;">commands</a>
</li>
	<li class="cat-item cat-item-37"><a href="../../../category/howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;">howto</a>
</li>
	<li class="cat-item cat-item-52"><a href="../../../category/justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;">justread</a>
</li>
	<li class="cat-item cat-item-51"><a href="../../../category/review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;">review</a>
</li>
	<li class="cat-item cat-item-3"><a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;">techtalk</a>
</li>
	<li class="cat-item cat-item-71"><a href="../../../category/tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;">tricks</a>
</li>
	<li class="cat-item cat-item-95"><a href="../../../category/utilities/index.html" title="Просмотреть все записи в рубрике &laquo;utilities&raquo;">utilities</a>
</li>
	<li class="cat-item cat-item-44"><a href="../../../category/whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;">whoisho</a>
</li>
	<li class="cat-item cat-item-1"><a href="../../../category/news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;">новости</a>
</li>
	<li class="cat-item cat-item-387"><a href="../../../category/opros.html" title="Просмотреть все записи в рубрике &laquo;опрос&raquo;">опрос</a>
</li>
	<li class="cat-item cat-item-8"><a href="../../../category/translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;">переводы</a>
</li>
	<li class="cat-item cat-item-40"><a href="../../../category/citaty/index.html" title="Просмотреть все записи в рубрике &laquo;цитаты&raquo;">цитаты</a>
</li>
				</ul>
			</li>

			<li><h2>Архивы</h2>
				<ul>
					<li><a href='../../../date/2018/01.html' title='Январь 2018'>Январь 2018</a></li>
	<li><a href='../../../date/2015/10.html' title='Октябрь 2015'>Октябрь 2015</a></li>
	<li><a href='../../../date/2015/04.html' title='Апрель 2015'>Апрель 2015</a></li>
	<li><a href='../../../date/2015/03.html' title='Март 2015'>Март 2015</a></li>
	<li><a href='../../../date/2015/01.html' title='Январь 2015'>Январь 2015</a></li>
	<li><a href='../../../date/2014/12.html' title='Декабрь 2014'>Декабрь 2014</a></li>
	<li><a href='../../../date/2014/11.html' title='Ноябрь 2014'>Ноябрь 2014</a></li>
	<li><a href='../../../date/2014/10.html' title='Октябрь 2014'>Октябрь 2014</a></li>
	<li><a href='../../../date/2014/09.html' title='Сентябрь 2014'>Сентябрь 2014</a></li>
	<li><a href='../../../date/2014/08.html' title='Август 2014'>Август 2014</a></li>
	<li><a href='../../../date/2014/07.html' title='Июль 2014'>Июль 2014</a></li>
	<li><a href='../../../date/2014/06.html' title='Июнь 2014'>Июнь 2014</a></li>
	<li><a href='../../../date/2014/05.html' title='Май 2014'>Май 2014</a></li>
	<li><a href='../../../date/2014/04.html' title='Апрель 2014'>Апрель 2014</a></li>
	<li><a href='../../../date/2014/03.html' title='Март 2014'>Март 2014</a></li>
	<li><a href='../../../date/2014/02.html' title='Февраль 2014'>Февраль 2014</a></li>
	<li><a href='../../../date/2014/01.html' title='Январь 2014'>Январь 2014</a></li>
	<li><a href='../../../date/2013/12.html' title='Декабрь 2013'>Декабрь 2013</a></li>
	<li><a href='../../../date/2013/11.html' title='Ноябрь 2013'>Ноябрь 2013</a></li>
	<li><a href='../../../date/2013/10.html' title='Октябрь 2013'>Октябрь 2013</a></li>
	<li><a href='../../../date/2013/09.html' title='Сентябрь 2013'>Сентябрь 2013</a></li>
	<li><a href='../../../date/2013/08.html' title='Август 2013'>Август 2013</a></li>
	<li><a href='../../../date/2013/07.html' title='Июль 2013'>Июль 2013</a></li>
	<li><a href='../../../date/2013/06.html' title='Июнь 2013'>Июнь 2013</a></li>
	<li><a href='../../../date/2013/05.html' title='Май 2013'>Май 2013</a></li>
	<li><a href='../../../date/2013/04.html' title='Апрель 2013'>Апрель 2013</a></li>
	<li><a href='../../../date/2013/03.html' title='Март 2013'>Март 2013</a></li>
	<li><a href='../../../date/2013/02.html' title='Февраль 2013'>Февраль 2013</a></li>
	<li><a href='../../../date/2013/01.html' title='Январь 2013'>Январь 2013</a></li>
	<li><a href='../../../date/2012/12.html' title='Декабрь 2012'>Декабрь 2012</a></li>
	<li><a href='../../../date/2012/11.html' title='Ноябрь 2012'>Ноябрь 2012</a></li>
	<li><a href='../../../date/2012/10.html' title='Октябрь 2012'>Октябрь 2012</a></li>
	<li><a href='../../../date/2012/09.html' title='Сентябрь 2012'>Сентябрь 2012</a></li>
	<li><a href='../../../date/2012/08.html' title='Август 2012'>Август 2012</a></li>
	<li><a href='../../../date/2012/07.html' title='Июль 2012'>Июль 2012</a></li>
	<li><a href='../../../date/2012/06.html' title='Июнь 2012'>Июнь 2012</a></li>
	<li><a href='../../../date/2012/05.html' title='Май 2012'>Май 2012</a></li>
	<li><a href='../../../date/2012/04.html' title='Апрель 2012'>Апрель 2012</a></li>
	<li><a href='../../../date/2012/03.html' title='Март 2012'>Март 2012</a></li>
	<li><a href='../../../date/2012/02.html' title='Февраль 2012'>Февраль 2012</a></li>
	<li><a href='../../../date/2012/01.html' title='Январь 2012'>Январь 2012</a></li>
	<li><a href='../../../date/2011/12.html' title='Декабрь 2011'>Декабрь 2011</a></li>
	<li><a href='../../../date/2011/11.html' title='Ноябрь 2011'>Ноябрь 2011</a></li>
	<li><a href='../../../date/2011/10/index.html' title='Октябрь 2011'>Октябрь 2011</a></li>
	<li><a href='../../../date/2011/09/index.html' title='Сентябрь 2011'>Сентябрь 2011</a></li>
	<li><a href='../../../date/2011/08.html' title='Август 2011'>Август 2011</a></li>
	<li><a href='../../../date/2011/07/index.html' title='Июль 2011'>Июль 2011</a></li>
	<li><a href='../../../date/2011/06/index.html' title='Июнь 2011'>Июнь 2011</a></li>
	<li><a href='../../../date/2011/05/index.html' title='Май 2011'>Май 2011</a></li>
	<li><a href='../../../date/2011/04/index.html' title='Апрель 2011'>Апрель 2011</a></li>
	<li><a href='../../../date/2011/03/index.html' title='Март 2011'>Март 2011</a></li>
	<li><a href='../../../date/2011/02.html' title='Февраль 2011'>Февраль 2011</a></li>
	<li><a href='../../../date/2011/01.html' title='Январь 2011'>Январь 2011</a></li>
	<li><a href='../../../date/2010/12.html' title='Декабрь 2010'>Декабрь 2010</a></li>
	<li><a href='../../../date/2010/11/index.html' title='Ноябрь 2010'>Ноябрь 2010</a></li>
	<li><a href='../../../date/2010/10/index.html' title='Октябрь 2010'>Октябрь 2010</a></li>
	<li><a href='../../../date/2010/09/index.html' title='Сентябрь 2010'>Сентябрь 2010</a></li>
	<li><a href='../../../date/2010/08.html' title='Август 2010'>Август 2010</a></li>
	<li><a href='../../../date/2010/07/index.html' title='Июль 2010'>Июль 2010</a></li>
	<li><a href='../../../date/2010/06.html' title='Июнь 2010'>Июнь 2010</a></li>
	<li><a href='../../../date/2010/05.html' title='Май 2010'>Май 2010</a></li>
	<li><a href='../../../date/2010/04/index.html' title='Апрель 2010'>Апрель 2010</a></li>
	<li><a href='../../../date/2010/03/index.html' title='Март 2010'>Март 2010</a></li>
	<li><a href='../../../date/2010/02.html' title='Февраль 2010'>Февраль 2010</a></li>
	<li><a href='../../../date/2010/01.html' title='Январь 2010'>Январь 2010</a></li>
	<li><a href='../../../date/2009/12/index.html' title='Декабрь 2009'>Декабрь 2009</a></li>
	<li><a href='../../../date/2009/11/index.html' title='Ноябрь 2009'>Ноябрь 2009</a></li>
	<li><a href='../../../date/2009/10.html' title='Октябрь 2009'>Октябрь 2009</a></li>
	<li><a href='../../../date/2009/09.html' title='Сентябрь 2009'>Сентябрь 2009</a></li>
	<li><a href='../../../date/2009/08/index.html' title='Август 2009'>Август 2009</a></li>
	<li><a href='../../../date/2009/07/index.html' title='Июль 2009'>Июль 2009</a></li>
	<li><a href='../../../date/2009/06.html' title='Июнь 2009'>Июнь 2009</a></li>
	<li><a href='../../../date/2009/05.html' title='Май 2009'>Май 2009</a></li>
	<li><a href='../../../date/2009/04.html' title='Апрель 2009'>Апрель 2009</a></li>
	<li><a href='../../../date/2009/03.html' title='Март 2009'>Март 2009</a></li>
	<li><a href='../../../date/2009/02.html' title='Февраль 2009'>Февраль 2009</a></li>
	<li><a href='../../../date/2009/01.html' title='Январь 2009'>Январь 2009</a></li>
	<li><a href='../../../date/2008/12.html' title='Декабрь 2008'>Декабрь 2008</a></li>
	<li><a href='../../../date/2008/11.html' title='Ноябрь 2008'>Ноябрь 2008</a></li>
	<li><a href='../../../date/2008/10.html' title='Октябрь 2008'>Октябрь 2008</a></li>
	<li><a href='../../../date/2008/09.html' title='Сентябрь 2008'>Сентябрь 2008</a></li>
	<li><a href='../../../date/2008/08.html' title='Август 2008'>Август 2008</a></li>
	<li><a href='../../../date/2008/03.html' title='Март 2008'>Март 2008</a></li>
	<li><a href='../../../date/2008/02.html' title='Февраль 2008'>Февраль 2008</a></li>
	<li><a href='../../../date/2007/12.html' title='Декабрь 2007'>Декабрь 2007</a></li>
	<li><a href='../../../date/2007/11.html' title='Ноябрь 2007'>Ноябрь 2007</a></li>
	<li><a href='../../../date/2007/10.html' title='Октябрь 2007'>Октябрь 2007</a></li>
	<li><a href='../../../date/2007/09.html' title='Сентябрь 2007'>Сентябрь 2007</a></li>
	<li><a href='../../../date/2007/08.html' title='Август 2007'>Август 2007</a></li>
	<li><a href='../../../date/2007/07/index.html' title='Июль 2007'>Июль 2007</a></li>
	<li><a href='../../../date/2007/06.html' title='Июнь 2007'>Июнь 2007</a></li>
	<li><a href='../../../date/2007/05.html' title='Май 2007'>Май 2007</a></li>
				</ul>
			</li>

			
					</ul>
	</div>

</div> <!-- wrapper -->
<div id="footer">
	<a href="../../../../feed">Entries (RSS)</a> and <a href="../../../../comments/feed">Comments (RSS)</a>. Valid <a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional"><abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a> and <a href="http://jigsaw.w3.org/css-validator/check/referer"><abbr title="Cascading Style Sheets">CSS</abbr></a>.<br />
	Powered by <a href="http://wordpress.org/" title="Powered by WordPress.">WordPress</a> and <a href="http://srinig.com/wordpress/themes/fluid-blue/">Fluid Blue theme</a>.<br />
	<!-- 15 queries. 0.113 seconds. -->
	</div>
</div> <!-- page -->
</body>
</html>
