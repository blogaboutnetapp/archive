<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>about NetApp   &raquo; techtalk</title>

<link rel="stylesheet" href="../../../../wp-content/themes/fluid-blue/style.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../wp-content/themes/fluid-blue/print.css" type="text/css" media="print" />
<link rel="alternate" type="application/rss+xml" title="about NetApp RSS Feed" href="../../../../feed" />
<link rel="pingback" href="../../../../xmlrpc.php.html" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 2.6" />

</head>

<body>
<div id="page">
<div id="header">
	<div id="headertitle">
		<h1><a href="../../../../index.html" title="about NetApp: Системы хранения данных как предмет разговора">about NetApp</a></h1>
		<p>Системы хранения данных как предмет разговора</p>
	</div> 
	<!-- Search box (If you prefer having search form as a sidebar widget, remove this block) -->
	<div class="search">
		<form method="get" id="searchform" action="../../../../index.html">
<input type="text" size="20" name="s" id="s" value="Поиск..."  onblur="if(this.value=='') this.value='Поиск...';" onfocus="if(this.value=='Поиск...') this.value='';"/>
</form>
	</div> 
	<!-- Search ends here-->
		
</div>

<div id="navbar">
<ul id="nav">
	<li><a href="../../../../index.html">Home</a></li>
	<li class="page_item page-item-153"><a href="../../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul>
</div>
<div id="wrapper">

	<div id="content">

	
			<p>Posts tagged &#8216;techtalk&#8217;</p>

	 		
		<div class="navigation">
			<div class="alignleft"><a href="3.html">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="../index.html">Next Entries &raquo;</a></div>
		</div>

						
			<div class="post" id="post-386">
				<h2 class="posttitle"><a href="../../../386/trackback.html" rel="bookmark" title="Permanent Link to Мастер-класс говнилок, или &ldquo;сеанс черной уличной магии&rdquo;">Мастер-класс говнилок, или &ldquo;сеанс черной уличной магии&rdquo;</a></h2>
				<div class="postmetadata">3 Сентябрь 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<ol>
<p>Сегодня я бы хотел провести для вас своеобразный &quot;мастер-класс говнилок&quot;, или, если угодно, &quot;сеанс черной магии&quot;, разумеется &quot;с последующим ее разоблачением&quot;. Я воспользуюсь для этого <a href="http://chucksblog.typepad.com/chucks_blog/2008/08/your-storage-mi.html">статьей небезызвестного блоггера Чака Холлиса</a>, почти официального &quot;говнильщика&quot; компании EMC. В части &quot;разоблачений&quot; мне поможет <a href="http://chucksblog.typepad.com/chucks_blog/2008/08/your-storage-mi.html">Вэл Берковичи, блоггер NetApp</a>, некоторое время назад сделавший показательный разбор одного из постов Чака.</p>
<p>Чак выбрал своей темой сравнительный анализ результатов получения Usable Space из Raw на трех разных платформах хранения - EMC Clariion, HP EVA и NetApp FAS. Ну за EVA, я надеюсь, вступится еще кто-нибудь, я же разберу двух оставшихся, тем более что я по EVA не спец, однако уверен, что и там вполне могут быть схожие &quot;результаты&quot;.</p>
<p>Вэл очень показательно сравнивает манеры, при проведении такого сравнения с поведением фокусника. Сначала нам показывают нечто вполне обычное и привычное. Колоду карт. Кролика и шляпу. Женщину в ящике ;) Мы осматриваем их, и вынуждены согласиться, что да, никакого подвоха тут нет (обычно уже на этом этапе что-то не так, и хитрость уже спрятана, чтобы вовремя сработать).</p>
<p>На втором этапе фокусник превращает рассмотренные нами обычные предметы в что-то необычное. Что-то исчезает, что-то видоизменяется, и так далее. Вы потрясены. </p>
<p>Тут все зависит от того, хотите ли вы быть одураченными. Если да, как обстоит дело в большинстве случаев, вам ничего не остается как согласиться с фокусником: &quot;Да все так, кролик исчезает в шляпе, а женщина перепилена&quot;, даже несмотря на то, что в глубине души вы и понимаете, что вас где-то провели. Но ведь вы внимательно следили!</p>
<p>В свое время, в каждом выпуске журнала “Юный Техник”, известный фокусник Эмиль Кио давал описания какого-нибудь незамысловатого фокуса (ну у него их много в запасе было), с объяснениями &quot;как&quot;.</p>
<p>Попробую и я показать вам в каком месте у Чака начинается &quot;ловкость рук&quot;.</p>
<p>??так, начало, The Pledge, &quot;предъявление предметов&quot;. </p>
<p>Чак предлагает нам сравнить величины Usable Space на каком-нибудь простом и знакомом примере. Например инфраструктура хранения для MS Exchange.</p>
<p>Возьмем для примера <strike>шляпу</strike> диски FC 146GB, определим, что мы хотим получить на выходе пространство, равное емкости 120 дисков (около 17,5TB), и посчитаем, сколько дисков нам придется купить для системы, чтобы эти условия соблюсти.</p>
<p>Мы берем руководства Best Practices по установке для соответствующих систем, и начинаем, оперируя ими, рассчитывать пространство, &quot;делать сайзинг&quot; как это называется у нас.</p>
<p>Повторюсь, я не слишком большой спец в области конфигурирования EMC, поэтому я просто возьму анализ для CX4 самого Чака. Я не стану переписывать тут весь его пост, за подробностями можно пройти непосредственно к нему, покажу лишь сам принцип. ??так, перед нами стоит задача получить на выходе usable-емкость 120 дисков на 146GB. Что добавится к этой величине?</p>
<p><strong>Диски hotspare</strong> - EMC рекомендует иметь 1 диск hot spare на каждые 30 дисков данных.</p>
<p><strong>Пространство для snapshots</strong> - возьмем эту величину равной 10% от usable</p>
<p><strong>Секторный оверхед</strong> - Clariion также как NetApp FAS использует увеличенный до 520 байт сектор, то есть примерно 1.5% к пространству usable.</p>
<p>Но что это? Внимательный взгляд уже видит первую ловкость. Отчего это Чак берет в качестве типа RAID для такой большой системы - RAID-5? </p>
<p>Даже если вас не убедила моя &quot;дюжина ножей&quot;(<a href="../../../345/trackback.html">пост раз</a> и <a href="../../../373/trackback.html">пост два</a>) в спину RAID-5, довольно будет и того, что это не рекомендует даже сам EMC в тех самых Best Practices, на которые сам же Чак Холлис и ссылается:</p>
<p>страница 15, документ #H4060, Oct. 2007:</p>
<blockquote><p>It is generally accepted that RAID 1/0 is a better choice for random-write environments like Exchange</p>
</blockquote>
<p>В том числе это так и для DMX (стр. 7-49):</p>
<p><a href="http://www.emc.com/collateral/hardware/solution-overview/h4067-microsoft-exchange-server-symmetrix.pdf">http://www.emc.com/collateral/hardware/solution-overview/h4067-microsoft-exchange-server-symmetrix.pdf</a></p>
<blockquote><p>As a matter of Best Practice, EMC generally recommends RAID1 to be the primary choice in RAID configuration for reasons of reliability and availability and performance for high-end deployments of Microsoft Exchange Server.</p>
</blockquote>
<p>Вот он, трюк. Сейчас посмотрим, что получится в результате.</p>
<p>Кроме этого, Чак еще пару раз &quot;забывает&quot; о некоторых моментах, так, например, говоря о рекомендации делать right sizing на 10% для дисков в RAID на NetApp, для того, чтобы, при необходимости, можно было ввести в RAID диск слегка отличающийся по &quot;геометрии&quot;, например спустя несколько лет, если поставляемые на замену диски отличаются от оригинальных в количестве секторов, он напрочь &quot;забывает&quot; это учесть в своем расчете для CX4, несмотря на то, что на это прямо указывается в Best Practices EMC.</p>
<p>Также не забудем и про пресловутый Vault на первых 5 дисках. Если в случае использования RAID-5 у нас были шансы использовать этот маленький пятидисковый RAID-5 в составе системы, также целиком выполненной в RAID-5, то в случае RAID-10 деть этот небольшой RAID-5 нам некуда, придется не использовать его для данной задачи вовсе.</p>
<p>??спользовать же эти 5 дисков в составе большого RAID-10 нельзя, так как Vault на них уменьшает их &quot;аппаратную геометрию&quot;, и они становятся &quot;несовместимыми&quot; по размерам с остальными дисками системы. То есть минус 5 дисков целиком.</p>
<p>Но для нашей большой системы это уже детали в единицы процентов (для системы меньшего размера они уже не будут столь незначительными). Оставим их, учтя в общем расчете, и только.</p>
<p>Что же у нас получилось?</p>
<p>А вот что:</p>
<p><a href="/pics//clip-image001.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image001" border="0" alt="clip_image001" src="/pics//clip-image001-thumb.png" width="371" height="244" /></a></p>
<p><a href="/pics//clip-image002.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image002" border="0" alt="clip_image002" src="/pics//clip-image002-thumb.png" width="396" height="244" /></a></p>
<p>Разительная разница по сравнению с цифрами, приведенными у Чака, не правда ли?</p>
<p><em>&quot;Ловкость рук, и никакого мошенства&quot;.</em></p>
<p><a href="/pics//clip-image003.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image003" border="0" alt="clip_image003" src="/pics//clip-image003-thumb.png" width="451" height="235" /></a></p>
<p><a href="/pics//clip-image004.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image004" border="0" alt="clip_image004" src="/pics//clip-image004-thumb.png" width="228" height="231" /></a></p>
<p>&#160;</p>
<p>Теперь займемся нашим NetApp FAS.</p>
<p>??сходные данные те же.</p>
<p>120 дисков по 146GB емкости в Usable, сколько должно быть в Raw?</p>
<p>??сходный ход расчета Чака оставим без изменений, но будем опять внимательно смотреть &quot;за руками&quot;. </p>
<p>Вот оно! </p>
<blockquote><p>One thing is extremely clear &#8212; running out of snap reserve looks to be a very bad thing in a NetApp environment &#8212; there&#8217;s no place to put an incoming write, usually resulting in catastrophic application failure.&#160; By comparison, other approaches (e.g. CX4 and EVA) simply stop trying to capture before-write data if you run out of reserve &#8212; the application itself continues to run. </p>
<p>&#8230;</p>
<p>It is recommended to have a 100% space reservation value set for volumes hosting LUNs containing Exchange data. </p>
</blockquote>
<p>Разумеется в таком анализе не обойдется без традиционной спекуляции на тему 100% LUN space reservation. Как-то даже слишком предсказуемо.</p>
<p>Обязателен, неизбежен и абсолютно необходим ли 100% space reservation, как необходимо отдать 100% от объема data disks при создании RAID-10?</p>
<p><strong>НЕТ.</strong></p>
<p>Вы не можете уменьшить количество дисков, уходящих под &quot;зеркало&quot; в RAID-10, в котором Usable еще до всех &quot;вычетов&quot; всегда будет менее 50% от Raw.</p>
<p>Однако можете уменьшить количество места, отдаваемое под fractional LUN reservation в NetApp FAS, так как его уменьшение не ведет к неработоспособности.</p>
<p>Я уже <a href="../../../233/trackback.html">останавливался ранее</a> на том, что же скрывается за fractional (LUN space) reservation.</p>
<p>Скажу честно, тема непроста, но понять ее можно. Вот, если вкратце, на пальцах:</p>
<p>LUN space reservation это место, выделяемое и резервируемое на томе в том случае, если вы планируете использовать snapshot для LUN,и есть риск, что значительная часть объема этого LUN будет перезаписана. В этом случае резервирование пространства размером с весь LUN гарантирует нам то, что можно будет создать snapshot с этого LUN и место для нормальной работы с этим LUN-ом еще останется.</p>
<p>По умолчанию, руководствуясь правилом &quot;прежде всего - не навреди&quot; Data ONTAP действительно предлагает наиболее &quot;консервативную&quot; установку, в виде 100% reserve, гарантирующую, что даже если админ совсем ничего не понимает, и ставит систему Enter-ом, соглашаясь со всеми дефолтными настройками, то ничего смертельно опасного для его данных при работе не произойдет.</p>
<p>Означает ли это, что никаких других возможностей не предусматривается? <strong>Нет, не означает</strong>.</p>
<p>Можно ли не использовать 100% LUN space reservation, и чтобы при это все работало? <strong>Да, запросто</strong>.</p>
<p>Какие еще возможности есть? Можно, например, автоматически увеличивать размер тома, на котором расположен LUN, с тем, чтобы места хватало и на LUN, и на создаваемые Snapshots. А можно настроить автоматическое удаление старых снэпшотов, при создании более новых, если им не хватает места.</p>
<p>Ну и, наконец, если места не хватило, то предусмотрена возможность корректного автоматического размонтирования LUN-а, на котором невозможно продолжать запись.</p>
<p>?? все это - без необходимости резервировать 100% от usable space под LUN space reservation.</p>
<p>Давайте посчитаем по нашей методике raw space, взяв желаемый usable добавим к нему все &quot;вычеты&quot;, &quot;оверхеды&quot; и &quot;резервации&quot;, добавим диски parity RAID из расчета 2 диска на каждые 14 дисков (RAID-DP), и, наконец, hot spare (два на первые 100, и по два на каждые следующие 84), и посмотрим что получилось (все дробные величины округлялись в большую сторону до целочисленных значений, указанные на диаграмме значения показывают доли секторов диаграммы и не всегда равны процентам в таблице).</p>
<p><a href="/pics//clip-image005.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image005" border="0" alt="clip_image005" src="/pics//clip-image005-thumb.png" width="347" height="244" /></a></p>
<p><a href="/pics//clip-image006.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image006" border="0" alt="clip_image006" src="/pics//clip-image006-thumb.png" width="405" height="244" /></a></p>
<p>Для желающих поиграться - прикладываю мою табличку, где я все это рисовал.</p>
<p><a href="/docs/EMC_vs._NetApp.xlsx">EMC_vs._NetApp.xlsx</a></p>
<p>??так, резюмируя прочитанное. Для того, чтобы провести правильный сеанс &quot;говнения&quot; конкурента, необходимо следующее:</p>
<li>Представить себя как &quot;независимое лицо&quot;, незаинтересованное в определенном &quot;предвзятом&quot; результате. Например проведите сравнение параллельно для нескольких вендоров. </li>
<li>Продемонстрировать все исходные материалы, упирая на их доступность. </li>
<li>Всегда аппелировать к вендорским Best Practices, пусть даже отдельные части их и будут проигнорированы, а сами они могут быть &quot;outdated&quot;, устаревшими. Мало кто полезет проверять все подробности в 150-страничном PDF-е, в лучшем случае прочтет указываемое вами предложение в тексте, зачастую без контекстной связи. </li>
<li>Всегда сравнивать системы в выгодном для себя контексте. Ваша система имеет низкую производительность? Сравнивайте на задачах архивного хранения и резервного копирования. Система высокопроизводительна, но дорогостояща? Сконфигурируйте минимально возможную, пусть и неприменимую в реальной жизни конфигурацию. Малопроизводительна, но дешева? Активно пользуйтесь сравнением соотношения price/performance. Владея инициативой при написании документа - заставьте противника обороняться на неудобном для него поле. </li>
<li>Не забудьте о психологическом давлении и субъективности восприятия. Хорошее название для сравнительного документа &quot;Вся правда о…&quot;. Почаще упоминайте &quot;свободность&quot; и &quot;открытость&quot; (“хорошо!”) в пику &quot;проперитарности&quot; и &quot;закрытости&quot; (“плохо!”). </li>
<li>Проводя в тексте нужный трюк, постарайтесь отвлечь от него внимание, например ссылками на какие-либо документы, или цитаты авторитетов. Актуальность их обычно не проверяется. Хорошо работают графики таблицы, иллюстрирующие ваши выводы, тем боле, что чаще всего перепроверять данные никто не полезет. </li>
<li>Отлично работают: “правильная” группировка результатов, а также маленькие хитрости, типа смешивания единиц измерения, неуказание единиц, нелинейная шкала отображения для графиков, и так далее. </li>
</ol>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../emc/index.html" rel="tag">emc</a>, <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../386/trackback.html#comments" title="Комментарий к записи Мастер-класс говнилок, или &ldquo;сеанс черной уличной магии&rdquo;">Комментарии (9)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-373">
				<h2 class="posttitle"><a href="../../../373/trackback.html" rel="bookmark" title="Permanent Link to Надежность RAID 5, качество SATA, и Дед Мороз.">Надежность RAID 5, качество SATA, и Дед Мороз.</a></h2>
				<div class="postmetadata">31 Август 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Сокращенный перевод <a href="http://blogs.netapp.com/msenviro/2009/08/raid-5-reliability-sata-quality-and-the-easter-bunny.html">поста</a> Chris Lionetti, Reference Architect – Microsoft Solutions Engineering</p>
<p>Этот пост рассматривает проблему Unrecoverable Error Rate (UER), «Уровня невосстановимых ошибок» на жестких дисках. </p>
<p>Диски типа SATA оптимизируются по соотношению GB/$ и GB/Watt, в то время, как диски с интерфейсом FC и SAS по параметрам IOPS/$ и IOPS/Watt. Это означает, что в плане плотности записи и механики, диски типа SATA решительно отличаются от дисков FC/SAS <strong>*1</strong>. Диски FC/SAS трехлетней давности имеют Unrecoverable Error Rate равный одному блоку на 10^15 бит данных (UER15). Диски SATA имеют этот параметр равный 1 блоку на 10^14 бит данных (UER14), что означает, что один блок (512Bytes) может быть потерян в среднем каждые 11TB считанных данных. Для UER15 это означает 1 блок каждые 110TB данных, и UER16 значит 1 блок каждые 1100TB пространства.</p>
<p>Давайте используем те же 9-дисковые наборы, что и в первой части поста. Берем 9-дисковый RAID 5 (8+1), 10-дисковый RAID DP/6 (8+2), и 16-дисковый RAID 10 (8+8). Предполагаем, что мы используем ту же инфраструктурную схему, при которой используется суммарно 800 дисков с данными. </p>
<p>Также возьмем за предположение величину отказа в 3%. Это означает 27 ребилдов для RAID 5 (см. <a href="../../../345/trackback.html">предыдущую статью</a> почему так). Допустим, что мы используем диски на 1TB, что означает, что когда в нашей дисковой инфраструктуре случается отказ (по нашим расчетам это может происходить до 27 раз в год) у меня есть шанс 8 из 11 (72% вероятность) что я получу ошибочно прочитанный UER-блок во время ребилда. Так как в случае&#160; возникновения UER она воздействует на весь страйп в наборе RAID 5, она влияет на объем данных, равный <strong>Stripe Element size * stripe size</strong>. Это означает, что вы можете получить до <strong>64KB x 8 = 512KB</strong> поврежденных данных посреди вашего датасета, не узнав об этом. Хорошая новость в том, что, скорее всего, вы используете более надежные диски. </p>
<p>Если вы используете так называемые «enterprise class» диски вместо недорогих дисков «Desktop class SATA», то вы получаете диски с уровнем UER15. Такие более высококачественные диски, с более высоким UER, будут повреждать данные всего в 7.2% случаев во время каждого ребилда. В случае использования дисков FC 15K/10K, эта величина понизится до 0.72% во время каждого ребилда.</p>
<p>В случае RAID10, опасность гораздо ниже, так как ребилд производится всего с одного диска, а не с целой их группы. Смотрите таблицу. </p>
<p>Данные в таблице берут за основу параметры: 3% AFR, 8 дисков данных, и рассматривают вероятность для каждой операции ребилда. </p>
<table border="0" cellspacing="0" cellpadding="2" width="600">
<tbody>
<tr>
<td valign="top" width="166">Вероятность повреждения</td>
<td valign="top" width="166">RAID-5 (8+1)</td>
<td valign="top" width="166">RAID-10 (8+8)</td>
</tr>
<tr>
<td valign="top" width="200">1 блок на 10^14 бит</td>
<td valign="top" width="200">72,7%</td>
<td valign="top" width="200">9,1%</td>
</tr>
<tr>
<td valign="top" width="200">1 блок на 10^15 бит</td>
<td valign="top" width="200">7,3%</td>
<td valign="top" width="200">0,9%</td>
</tr>
<tr>
<td valign="top" width="200">1 блок на 10^16 бит</td>
<td valign="top" width="200">0,7%</td>
<td valign="top" width="200">0,1%</td>
</tr>
<tr>
<td valign="top" width="200">Величина поврежденного участка</td>
<td valign="top" width="200">512KByte</td>
<td valign="top" width="200">64KByte</td>
</tr>
</tbody>
</table>
<p>&#160;</p>
<p>Диски типа Enterprise SATA обычно приближаются к величине UER15, в то время, как в случае дисков FC и SAS 15K RPM всегда говорят о UER16.</p>
<p><strong>Скрытые проблемы на Enterprise SATA</strong>.     <br />Аргумент, который всегда приводится, это что SATA имеют теперь тот же уровень ошибок, что и «enterprise drives». SATA на протяжении последних лет постепенно улучшают свои показатели, с UER14 до UER15, но, одновременно с этим, учетверяют свой объем. Стали ли диски боле надежными? Да, но не в 10 раз, как вы могли бы подумать, глядя на техспеки. За то же самое время диски enterprise FC улучшили показатель надежности с UER15 до UER16, достигнув при этом примерно половины емкости от дисков SATA.</p>
<p>Существует также некая возможность в дисках SATA, которая позволяет индустрии дисков SATA достигать уровня UER15. Эта возможность называется «heroic recovery» <strong>*2</strong>. Этот вариант восстановления ошибочно считанных данных при чтении означает, что диск прочитывает очень большой фрагмент данных и пытается восстановить неустойчиво прочтенный блок с использованием избыточности, чтобы потом переписать его куда-нибудь в другое место. Результатом замедления работы при «heroic recovery» может быть то, что диск перестает вовремя отвечать на запросы, и, в результате, вываливается из RAID. </p>
<p>Большинство (если не все) контроллеров RAID выключает на своих дисках «heroic recovery». Вопрос, ответ на который невозможно получить ни от одного вендора жестких дисков, это то, измерен ли UER этих диско с выключенной heroic recovery? Если вы утверждаете, что heroic recovery блока может восстановить данные с 9 из 10 неустойчиво читающихся блоков, то выключение этой возможности означает снижение для диска UER15 до UER14. Я включил в график данные как для UER14, так и для UER15, ваши диски будут располагаться где-то между этими двумя. Этот график показывает как оптимистичные, так и пессимистичные оценки вероятностей в RAID 5 и RAID 10 для объемов ваших данных, могущих быть поврежденными на протяжении года.</p>
<p><a href="/pics//raid5uerrorsrate.jpg"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="RAID5-uerrors-rate" border="0" alt="RAID5-uerrors-rate" src="/pics//raid5uerrorsrate-thumb.jpg" width="539" height="341" /></a> </p>
<p>&#160; <br /><strong>Выводы</strong>     <br />У вас есть две возможности избежать неприятностей. Вы можете либо выбрать использовать RAID6, либо использовать диски с UER16. Этот пост написан не с целью продать вам диски SATA или FC, но лишь только помочь вам осознать опасности использования RAID5, а также опасность использования дисков SATA не имея способ смягчить возможные последствия. Вот в чем смысл нашего сегодняшнего заголовка. Все эти три понятия - сказочные. </p>
<p><em>(прим. romx: долго подмывало вместо Деда Мороза написать Честный Милиционер, или что-то в этом духе. В оригинале был Easter Bunny, «пасхальный кролик»)</em></p>
<p>Самое главное, что вы должны уяснить, дочитав это пост, это то, что больше нельзя доверять RAID 5. У вас есть сравнительно небольшой риск того, что ваши данные будут полностью потеряны, но существует гораздо более высокий риск того, что поврежденные данные приведут к замедлению работы, если попадутся в момент операции ребилда.</p>
<p>&#8211;    <br /><strong>*1 </strong>Willis Whittington – WINHEC05 presentation on enterprise drives     <br /><strong>*2</strong> <a href="http://www.wdc.com/en/products/products.asp?driveid=403">http://www.wdc.com/en/products/products.asp?driveid=403</a> Читайте про time limited recovery. Целых 7 секунд!. Эта проблема существует по всей индустрии SATA, а не только у Western Digital.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../373/trackback.html#respond" title="Комментарий к записи Надежность RAID 5, качество SATA, и Дед Мороз.">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-363">
				<h2 class="posttitle"><a href="../../../363/trackback.html" rel="bookmark" title="Permanent Link to Про Usable Space на примере NetApp FAS2050A">Про Usable Space на примере NetApp FAS2050A</a></h2>
				<div class="postmetadata">24 Август 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Мой любимый нетапповский автор, Костадис Руcсос, который в своем блоге на днях закончил длиииинную десятичастную тему, тоже говорил, что в принципе это bad taste in blogging, устраивать такие “сериалы”, так как внимание даже искушенного и лояльного читателя теряется. Надо как-то стараться писать коротко и ясно. Вот всякий раз, как я начинаю в блоге травить анекдоты, сразу налетает толпа, так, на недавний пост с “автопроизводителями”, за три дня пришло почти треть обычной месячной аудитории блога. А то я все умничаю. Во, народу надо доступных зрелищ, это еще древние римляне понимали. ;)</p>
<p>Поэтому пост будет недлинный, нетрудный, и с картинками :)</p>
<p>Одной из основных проблем, с которыми сталкивается начинающий пользователь и админ NetApp является большой расход пространства дисков на небольших системах. NetApp в этом часто (и отчасти справедливо) упрекают.</p>
<p>Давайте рассмотрим это на примере небольшой и относительно недорогой, а потому особенно популярной в России системы начального уровня FAS2050.</p>
<p><a href="/pics/FAS2050.jpg"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="FAS2050" border="0" alt="FAS2050" src="/pics/FAS2050.jpg" width="500" height="223" /></a> </p>
<p>Это система уровня low-enterprise, вторая с “нижнего конца” (младше ее есть еще FAS2020, предназначенная для совсем небольших инсталляций и систем).</p>
<p>Она представляет собой конструктив&#160; высотой 4U, на 20 дисков 3.5”, вставляемых горизонтально “с лица”, и двумя контроллерами (часто мы называем их на жаргоне “головы” или “filer head”), обеспечивающими отказоустойчивую работу в режиме active-active cluster.</p>
<p><a href="/pics/FAS2050rear.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="FAS2050 rear" border="0" alt="FAS2050 rear" src="/pics/FAS2050rear.png" width="500" height="200" /></a> </p>
<p>Каждая “голова” несет на себе (слева-направо):</p>
<ul>
<li>2 порта 4GB FC, которые могут использоваться как FC-target (по простому – к ним можно подключить сервера SAN-сети, и они смогут использовать LUN-ы на NetApp), а также к ним можно подключать дополнительные дисковые “полки” расширения. Дисковые “полки” едины для всех моделей NetApp, могут нести в себе по 14 дисков SATA или FC (каждый тип полки под свои диски), и подключаются к контроллерам по интерфейсу FC (даже если диски в них SATA). </li>
<li>Разъем последовательного порта для непосредственного консольного доступа (аналогичен такому же порту например на оборудовании Cisco, и некоторых других устройств), использует разъем RJ-45, и выглядит как сетевой, но не перепутайте. </li>
<li>Порт сетевого подключения к BMC – Baseboard Management Control, отдельной управляющей подсистеме, с помощью которой можно организовать отдельную “подсеть” управления, если вы, например по соображениям безопасности, не хотите управлять системой из обычной “общей” LAN. Кроме этого, через BMC можно управлять системой на том уровне, когда обычные сетевые контроллеры еще не работают, например при загрузке системы и Mantenance Mode. </li>
<li>Два независимых порта Gigabit Ethernet. Каждый из этих портов может работать независимо, например можно создать две подсети доступа, или по одному из интерфейсов подключаться как к NAS, по протоколам NFS или CIFS, а ко второму – по iSCSI. Можно также объединить эти порты либо в отказоустойчивую схему, либо в транк, при котором скорость передачи данных удваивается. </li>
<li>Выше ряда разъемов интерфейсов располагается заглушка слота PCIe, в которую могут быть установлены платы расширения NetApp, такие как: дополнительные порты FC, Ethernet, аппаратный iSCSI HBA, и даже UW-SCSI, с помощью которой можно подключить к FAS ленточный накопитель, и делать автономный бэкап его содержимого на ленту. </li>
</ul>
<p>Контроллеры или “головы” полностью автономны, и могут работать независимо, каждая со своим набором дисков. В случае выхода из строя одной из них, или отказа, например, доступа по сети к какому-то из них, система переводит диски такого контроллера, а также все ресурсы (имена файловых шар, IP-адреса для NAS, WWN-ы для SAN) на “выживший” контроллер, и, с точки зрения пользователя, работа в случае такого “cluster takeover” продолжается “прозрачно”, без необходимости ручной перенастройки на серверах и клиентах (хотя, конечно, производительность и падает, ведь теперь один контроллер работает “за двоих”).</p>
<p>Устанавливаемые в базовый конструктив диски могут быть либо SAS, либо SATA. Системы семейства FAS2000 впервые начали использовать диски SAS, так как ранее системы FAS использовали диски FibreChannel (FC). ??спользование дисков с интерфейсом SAS позволило несколько снизить стоимость системы, однако не в ущерб надежности. Опубликованные данные говорят о том, что применяемые диски SAS и такие же FC отличаются лишь контроллером и типом интерфейсного разъема. Надежность и быстродействие их идентичны.</p>
<p>Такая система продается в двух вариантах “набивки”, на 12 дисков, и на 20 дисков.</p>
<p>Предположим, вы выбрали конфигурацию на 12 дисков. К примеру, вы выбрали диски SAS 450GB 15K, и посчитали, что 12 дисков дадут вам 5.4TB пространства, чего вам замечательно как раз на все и хватит, и при этом не обратили внимание на предупреждения продававшего вам систему специалиста NetApp или его партнера.</p>
<p>“Неприятности” начнутся на этапе первоначальной установки.</p>
<p>Так как наша система кластерная, и имеет два независимых контроллера, нам надо разделить диски между контроллерами. Если мы делим их поровну, то каждому контроллеру достается по 6 дисков.</p>
<p>Теперь на этих 6 дисках мы создаем RAID-ы. Допустим мы выбираем тип RAID по умолчанию, так называемый RAID-DP, нетапповский вариант RAID-6, но без потерь производительности и быстродействия, характерных для “обычного” RAID-6. В случае дисков SATA это, на сегодня, единственно приемлемый тип, но и в случае SAS это вполне разумный выбор.</p>
<p>При создании aggregate и RAID из наших 6 дисков вычтется один (в случае RAID-4) или два (в случае RAID-DP) диска на хранение parity. Кроме этого, каждому контроллеру надо выдать один диск hot spare.</p>
<p>??того, мы получаем из 12 дисков два RAID по <strong>3</strong> usable диска в каждом. То есть, в случае выбора дисков SAS 450GB: 3&#215;450GB = 1350GB на каждом из контроллеров. Обратите внимание, объединить их, например, чтобы записать на них 2.7TB “одним куском” не получится, только двумя кусками по 1.35TB.</p>
<p><a href="/pics/RAIDeff1.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="RAID-eff-1" border="0" alt="RAID-eff-1" src="/pics/RAIDeff1.png" width="504" height="319" /></a> </p>
<p>На рисунке коричневым показаны диски parity для контроллеров A и B, зеленым – hot spare, и синим – диски данных. Обведен красным диски контроллера А, синим – контроллера B.</p>
<p>Для новичков в NetApp, а именно к таким обычно и попадают обычно младшие модели NetApp с небольшим базовым количеством дисков, результат неожиданный, и, что уж говорить, если начистоту, не особо приятный.</p>
<p>Тем не менее <em>“Ну ужас, да. Но не “ужас-ужас”</em>, как говорила героиня известного анекдота.</p>
<p>Говоря начистоту, никто из наши конкурентов не рассматривает иные типы RAID кроме RAID-10 в качестве основы для хранения primary data, то есть активных рабочих данных, будь то базы данных SQL, почтовая база Exchange или хранилища виртуальных машин.</p>
<p>Поэтому, гипотетический <strike>простой стиральный порошок</strike> сторадж на 12 дисков, какой-нибудь <em>другой компании</em>, при выборе RAID-10, даст ровно тот же результат в 50% usable от общего объема. При этом, прошу отметить, RAID-DP объективно надежнее, практически такой же быстрый, и мы получаем с ним еще и два hotspare диска.</p>
<p>Но самое интересное получается дальше. </p>
<p>Если мы захотим теперь расширить емкость нашего FAS2050, добив его дополнительными 8 дисками до 20 штук в базовом конструктиве, то мы сможем <strong>все эти диски</strong> добавить как диски данных. </p>
<p>В то время как в “обычном сторадже”с RAID-10, в usable будут снова <strong>только половина</strong>.</p>
<p><a href="/pics/RAIDeff2.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="RAID-eff-2" border="0" alt="RAID-eff-2" src="/pics/RAIDeff2.png" width="504" height="320" /></a> </p>
<p>Как видите, с увеличением количества дисков в системе, эффективность использования пространства дисков у NetApp возрастает.</p>
<p>Но это не предел. </p>
<p>Максимальный размер одного RAID для дисков SAS и FC в системах хранения NetApp допускается до 28 дисков*. Рекомендуемая величина (делать “очень длинный RAID” по разным причинам не самая лучшая идея) – 16 дисков.&#160;&#160;&#160; <br />&#160;<a href="/pics/RAIDeff3.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="RAID-eff-3" border="0" alt="RAID-eff-3" src="/pics/RAIDeff3.png" width="504" height="452" /></a> </p>
</p>
<p>Если мы добавим дисковую “полку” расширения к нашей системе, мы сможем довести соотношение usable к raw до <strong>82%</strong>! ??з 34 купленных дисков, мы можем отдать под данные целых 28! При этом не поступившись ни надежностью, ни быстродействием.&#160; <br />Результат более чем впечатляющий.&#160; </p>
<p><strong>Выводы очевидны</strong>.</p>
<ul>
<li>Чем больше дисков в системе у NetApp, тем выше эффективность их использования. </li>
<li>”Побочный” расход дисков на системах NetApp довольно велик для систем с небольшим количеством дисков, но почти не увеличивается при дальнейшем их добавлении. </li>
<li>??збегайте покупать системы NetApp с дисками “впритык” (особенно небольшие), обязательно при покупке уточните вопрос, сколько в результате получится usable space, чтобы избежать неприятных сюрпризов на этапе пусконаладки.</li>
</ul>
<p>&#160;</p>
<p>&#8211;<br />
 <font size=-1>* Один aggregate (и тома на нем) могут располагаться поверх множества независимых RAID-групп (16+16+16…). В пределах заданного при создании aggregate размера RAID, диски добавляются в него, по достижению заданного размера (например 16 дисков) начинается новый. Текущий лимит на размер aggregate/тома для всех систем под ONTAP 7G (кроме 2020) - 16TB</font></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../363/trackback.html#comments" title="Комментарий к записи Про Usable Space на примере NetApp FAS2050A">Комментарии (5)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-341">
				<h2 class="posttitle"><a href="../../../341/trackback.html" rel="bookmark" title="Permanent Link to Проблемы и решения Usable Space. Часть 5.">Проблемы и решения Usable Space. Часть 5.</a></h2>
				<div class="postmetadata">17 Август 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Предыдущие посты серии:</p>
<p><a href="../../../269/trackback.html">Первый</a><br />
<a href="../../../286/trackback.html">Второй</a><br />
<a href="../../../338/trackback.html">Третий</a><br />
<a href="../../../339/trackback.html">Четвертый</a></p>
<p>??так, aggregate созданы, а на них созданы, в свою очередь, тома (volumes).<br />
&#8220;Том&#8221; (Volume) есть основной элемент структуры хранения NetApp.<br />
Вся информация, и все вышележащие структуры данных, такие как &#8220;сетевые шары&#8221; и LUN-ы располагаются внутри &#8220;тома&#8221;.<br />
В частности именно на том действуют снэпшоты.</p>
<p>На каждом томе можно создать 254 снэпшота. С учетом максимального количества томов, возможных на системе, получается суммарно около 51 тысячи. Впрочем это скорее теоретическая величина, поэтому заостряться на ней не будем, что же касается снэпшотов то вам их, я полагаю, хватит в любом случае. Напомню, что решения, называющие себя &#8220;снэпшот&#8221;, у конкурентов обычно заметно ограничивают их количество<del datetime="2009-08-26T08:46:38+00:00"> в 14-30</del> на всю систему в целом (см. комментарии). Такое ограничение вызвано не в последнюю очередь тем, что использование snapshots у таких систем <a href="http://blogs.netapp.com/databases/WindowsLiveWriter/image_19.png">резко влияет на производительность</a>, и, обычно, снэпшоты на них массово просто не применяются, так как весьма <a href="http://blogs.netapp.com/dave/2008/02/controversy-net.html">значительно &#8220;сажают&#8221; производительность системы в целом</a>.</p>
<p>Раз мы добрались до тома и его снэпшотов, позвольте подробнее остановиться на непростой, и вызывающей множество непонимания теме &#8220;резервирования&#8221; или snapshot reserve.</p>
<p>Когда-то, давным давно, когда NetApp был только NAS системой, было эмпирическим путем определено количество места, которые отводятся и резервируются под снэпшоты, в 20% от общего объема тома. То есть, для простоты понимания на конкретном примере: из тома в 100MB на блоки, зафиксированные в снэпшоте, мы отводим 20MB (на основные данные остается, соответственно, 80MB).</p>
<p>Для правильного понимания того, как работает резервирование, стоит нарисовать вот такой рисунок:</p>
<p><a href="/pics//snapreserve-pic1.png"><img src="/pics//snapreserve-pic1-215x300.png" alt="" title="snapreserve-pic1" width="215" height="300" class="alignnone size-medium wp-image-348" /></a></p>
<p>В ней, для простоты изображения и понимания, данные, записываемые на том, прирастают снизу.</p>
<p>Блоки, попавшие в снэпшоты, прирастают сверху.</p>
<p>Граница &#8220;резерва под снэпшоты&#8221; это линия, отделяющая верхние 20% емкости, в которых прирастают (условно сверху вниз) данные снэпшотов.<br />
При этом, граница эта &#8220;проходима&#8221; сверху вниз, но не снизу вверх. То есть, если случилось так, что снэпшотов создалось больше, чем на 20% резерва, например на 25, то будет заняты &#8220;сверху&#8221; 20, и плюс еще кусочек на 5% &#8220;сверху&#8221; от активного тома.</p>
<p><a href="/pics//snapreserve-pic2.png"><img src="/pics//snapreserve-pic2.png" alt="" title="snapreserve-pic2" width="215" height="300" class="alignnone size-medium wp-image-350" /></a></p>
<p>Однако, когда мы попытаемся записать активных данных больше 80MB на 100MB-том с резервом в 20%, даже если это резерв и не используется снэпшотами, мы получим сообщение о нехватке места. То же самое произойдет и если двигающиеся &#8220;навстречу&#8221; данные &#8220;активной файловой системы&#8221; и снэпшотов встретятся. </p>
<p><a href="/pics//snapreserve-pic3.png"><img src="/pics//snapreserve-pic3-215x300.png" alt="" title="snapreserve-pic3" width="215" height="300" class="alignnone size-medium wp-image-349" /></a></p>
<p>Перед этим система будет сыпать алертами о исчерпании места, например в уже рассмотренном случае, когда снэпшоты &#8220;вылезли&#8221; из пространства резерва, в сообщении будет говориться о &#8220;заполненности тома на 105%&#8221;. Проценты свыше 100 это как раз то, насколько из резерва вылез хвост объема снэпшотов.</p>
<p>Решить проблему можно удалив часть, возможно уже ненужных снэпшотов, при этом блоки, ими занятые, освобождаются, и поступают &#8220;в распоряжение&#8221; активной файловой системы.</p>
<p><em>Можно ли изменять величину снэпрезерва?</em> Разумеется да.<br />
<em>Можно ли поставить ее в 0%?</em> Да.<br />
<em>Отключит ли это возможность создавать снэпшоты на томе?</em> Нет, просто снэпшоты сразу будут занимать место в пространстве &#8220;активной файловой системы&#8221; тома. Представьте, что граница с рисунка поднята до упора вверх, но она по прежнему проходима для снэпшота, растущего сверху вниз.<br />
<em>Чем это грозит?</em> Да по сути ничем, просто вам надо будет либо не пользоваться снэпшотами (опрометчивый, но имеющий право на существование способ использования стораджа NetApp), либо внимательно контролировать заполнение тома и величину пространства, занятую снэпшотами, чтобы они случайно не исчерпали собой доступное для данных место.<br />
Зачем вообще нужно это резервирование? Ну это просто удобно. Сисадмин системы хранения знает, что у него всегда есть специальный запас места для создания снэпшотов, что туда никто кроме них не залезет и не займет, и снэпшоты, пока это место не переполнится, всегда на томе будет где создать. То есть это просто такое средство немного облегчить жизнь и снизить количество мест, которые надо контролировать.
</p>
<p>Традиционно решение ставить snapreserve в 0% применяется при использовании системы NetApp в качестве чистого SAN, когда на volume создается LUN, равный ему по размерам, а создание снэпшотов не используется, и не планируется.<br />
Однако чаще для такой конфигурации, в особенности когда планируется _использовать_ снэпшоты, рекомендуется устанавливать резервирование в 100%. Тогда, даже в самом наихудшем случае, когда все блоки LUN-а изменены, то места на снэпшот хватит.</p>
<p>Я уже писал подробно про этот вопрос в посте про использование <a href="../../../233/trackback.html">&#8220;Fractional Reserve&#8221;</a>.<br />
Там же я рассказывал про другой способ решения проблемы снэпшота для тома с LUN - автоматическое увеличение тома, опция &#8220;autogrow&#8221;, в том случае если на aggregate, где он расположен, есть свободное пространство.<br />
Вы можете не резервировать место при создании тома, а просто в свойствах тома сказать, что, когда понадобится, он может расти, занимая под себя свободное место в aggregate.</p>
<p>??так, мы создали том, и задали ему snapshot reservation ту, какую захотели, например 20, или 15% в случае планов использования данного тома под хранение файлов (NAS), 0 или 100%, или определили fractional reserve, опции autogrow и autodelete, при использовании его для размещения на нем LUN-а.</p>
<p>&#8230;и почти добрались до конца. Теперь давайте посмотрим, что же у нас получилось с usable.<br />
Окончание (надеюсь) в следующий понедельник (надеюсь).</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;" rel="category tag">новости</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../341/trackback.html#comments" title="Комментарий к записи Проблемы и решения Usable Space. Часть 5.">Комментарии (5)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-345">
				<h2 class="posttitle"><a href="../../../345/trackback.html" rel="bookmark" title="Permanent Link to RAID-5 - must die!">RAID-5 - must die!</a></h2>
				<div class="postmetadata">10 Август 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Да уже и не must, а почти что almost.</p>
<p>Еще несколько слов аргументации за переход к RAID-6, тем, у кого он не тормозит, не будем показыват пальцем, но: &#8220;Есть такие вендоры!&#8221; ;).<br />
Да, согласен, RAID-10 тоже вполне может пережить отказ двух дисков, если вам повезет, что это произойдет в разных половинах &#8220;зеркала&#8221;. Но только в этом случае.</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;<br />
RAID 5 появился в 1987 году, и был вполне адекватен решаемым задачам на протяжении следующих 15 лет непрерывного роста. Обычный размер диска в 1987 был всего 21MB, да, именно МЕГАбайта, и скорость вращения была 3600 RPM. На протяжении следующих 20 лет, диски выросли до 1TB (в 50 тысяч раз больше, но только вдвое-вчетверо в скорости вращения). Этот огромный рост привел к проблеме и продемонстрировал ущербность данного уровня RAID. </p>
<p>Проблема заключается во времени, которое уходит на перестроение большого по объему RAID, которое может исчисляться днями. Это может привести вас к проблеме выхода из строя второго диска на том же RAID, в то время, как процесс ребилда еще не завершился. Величина под названием Annual Failure rate (AFR) для дисков становится лучше год от года, но это не устраняет проблему продолжающегося роста времени ребилда. Другая проблема состоит в том, что в процессе ребилда нагрузка на диски существенно возрастает, что, в свою очередь, увеличивает вероятность отказа, так что процесс ребилда сам по себе может быть для дисков еще опаснее<strong>*1</strong> (до 2.5 раз). </p>
<p>Допустим, AFR (Annual Failure Rate, &#8220;вероятность отказа&#8221;) равен 5%<strong>*2</strong>, и время ребилда равно 1 дню. Мы используем 9-дисковый RAID-5 (8+1). Шансы получить второй дисковый отказ за это время равен 1/365 x 5% x 8 x 2.5= 0.25%. Допустим, у нас используется 100 таких групп по 9 дисков в RAID 5 в системе (900 дисков). Я могу ожидать, что получу 45 отказавших дисков в течении года. Во время прохождения ребилда я &#8220;бросаю кости&#8221;. У меня есть 1 шанс из 400 получить за время ребилда отказ второго диска, приводящий к потере данных, и я &#8220;бросаю&#8221; эти кости 45 раз в год. В течении 5 лет срока службы это означает вероятность 225 из 400 получить катастрофический сбой с потерей данных. </p>
<p>Давайте рассмотрим теперь тот же сценарий, но удвоим размер дисков, и понизим  AFR (Annual Failure Rate, &#8220;вероятность отказа&#8221;) с 5% до 4% (имитировав развитие рынка HDD и выход новых боле емких моделей дисков). Теперь у нас уходит два дня на ребилд, так как удвоился объем, и формула выглядит так: 2/365 x 4% x 8 x 2.5= 0.4%. Те же 100 RAID-групп, те же цифры предположений, но риск двойной ошибки вырос до 1 к 200, хотя я &#8220;бросаю кости&#8221; только 36 раз в год. На протяжении пятилетнего срока службы это означает шанс 180 из 200 получить катастрофический отказ. </p>
<p><a href="/pics//raid-failure-rate.jpg"><img src="/pics//raid-failure-rate-300x141.jpg" alt="" title="raid-failure-rate" width="300" height="141" class="alignnone size-medium wp-image-346" /></a></p>
<p>Это выглядит противоречащим здравому смыслу, но тем не менее это так. Да, диски становятся надежнее, но при этом, тем не менее, риск аварии возрастает.</p>
<p>Примечания:<br />
<em><strong>*1</strong>: http://www.snia.org/education/tutorials/2007/fall/storage/WillisWhittington_Deltas_by_Design.pdf, см. слайд 50<br />
<strong>*2</strong>: Официально опубликованный вендорский AFR для дисков всегда ниже 1%Однако множество источников называют размер этой величины вплоть до 12%, Можно считать, что величина &#8220;консенсуса&#8221; в данном вопросе находится обычно между 3% и 5%.</em><br />
&#8212;&#8212;&#8212;&#8212;-<br />
Найдено и переведено там:<br />
<a href="http://blogs.netapp.com/msenviro/2009/08/the-raid-10-upsell-fudbeast.html ">http://blogs.netapp.com/msenviro/2009/08/the-raid-10-upsell-fudbeast.html </a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../raid.html" rel="tag">raid</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;" rel="category tag">новости</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../345/trackback.html#comments" title="Комментарий к записи RAID-5 - must die!">Комментарии (8)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-339">
				<h2 class="posttitle"><a href="../../../339/trackback.html" rel="bookmark" title="Permanent Link to Проблемы и решения Usable Space. Часть 4.">Проблемы и решения Usable Space. Часть 4.</a></h2>
				<div class="postmetadata">3 Август 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Далее переходим к созданию aggregate (вернее создание RAID и aggregate это чаще всего один этап).</p>
<p>Aggregatе это, как я уже рассказывал ранее, некий &#8220;слой виртуализации&#8221;, некий виртуальный &#8220;мета-том&#8221;, в который помещаются все диски, и при создании на нем &#8220;тома&#8221;, тот оказывается распределенным по всем входящим в него RAID, и всем физическим &#8220;шпинделям&#8221;, что объективно повышает общую производительность.</p>
<p>В ряде особых случаев, некоторые рекомендации Best Practices говорят о необходимости создавать отдельные aggregates для сильно различных типов нагрузки, с тем чтобы одна из нагрузок совершенно не влияла на тома с другим типом нагрузки.<br />
Однако в подавляющем количестве случаев, и в случаях, когда диски ваших систем не исчисляются сотнями, рекомендация заводить все физические диски в один aggregate, а уже потом разбивать емкость на отдельные volumes, дает наилучшие результаты.</p>
<p>Часто приходится сталкиваться с мнением, подкрепленным различными, чаще всего устаревшими рекомендациями, в особенности для баз данных, &#8220;делить базу, логи разных типов, и системные файлы, не считая собственно OS в отдельные RAID (да еще и разных типов)&#8221;. На сегодняшний день такие рекомендации (по крайней мере в отношении NetApp) стоит считать устаревшими. Они действительно могут дать результат. Но фактический проигрыш от следования им на малом числе дисков, значительно превосходит потенциальный выигрыш от разделения типа нагрузки. Ведь единая RAID-группа (aggregate), состоящая из, например, 10 дисков будет заведомо быстрее по IOPS, даже на смешанной нагрузке, чем пять групп по 2 диска в каждом, даже несмотря на то, что в последнем случае удастся разделить нагрузку по отдельным дискам. Это уж даже не говоря о совершенно непродуктивном расходе места на дисках, в результате построения такой схемы.</p>
<p>Вдобавок эти рекомендации относятся к достаточно большим и высоконагруженным системам, где этот аспект на самом деле может играть существенную роль. &#8220;Не льстите себе, <del>подойдите ближе</del>&#8221; вряд ли ваша база действительно столь <del>длинна</del> мощна и велика чтобы вышеописанные проблемы со смешением характеров нагрузки на вводе-выводе для дисков были бы для нее реальной проблемой.</p>
<p>Рассматривая аггрегейты, давайте остановимся на нетапповской специфике. Знакомые с системами хранения от EMC и Hitachi уже знают некоторую особенность дисковой организации на таких системах. На нескольких дисках такого стораджа размещается некая &#8220;служебная область&#8221;. Там, например, хранится содержимое внутренней OS системы, туда, например, делается &#8220;слив&#8221; содержимого кэша в случае выключения, и так далее, подробности обычно не объявляются, и область эта закрыта.<br />
Например у EMC Clariion CX4 с каждого из 5 дисков, отведенных системой под эти нужды (так называемый Vault), отнимается по 62GB (в CX3 - 33GB), то есть &#8220;минус 310 MB&#8221; на систему в целом.<br />
Такая схема, кроме всего прочего, заставляет при создании RAID, выделять эти 5 дисков (4 в случае Hitachi модели AMS) в отдельный RAID, так как в противном случае они уменьшат размер всех остальных дисков в этом RAID на те же 62GB, ведь объем всех дисков в RAID должен быть абсолютно равный.</p>
<p>Нечто подобное есть и у NetApp. Он хранит настройки системы (для знакомых с UNIX-ами скажу: раздел /etc UNIX-подобной файловой системы ядра) на самих дисках системы хранения. Остальная OS Data ONTAP находится и грузится с Compact Flash-карты, так как она совсем небольшая, несколько десятков мегабайт на все.</p>
<p>По умолчанию этот /etc хранится на своем собственном aggregate (aggr0), состоящем из двух (в случае RAID-4) или трех (RAID-DP) дисков: диск данных, один или два диска parity. На этом aggregate создается том vol0, на котором и лежит около 200 мегабайт содержимого этого самого /etc: настройки, конфигурационные файлы, прошивки firmware для дисков, и так далее.<br />
Такая схема позволяет, в частности, легко переносить данные между системами хранения, а также, в случае необходимости, заменять и апгрейдить контроллер, так как вся конфигурация конкретной системы, по сути, от ее контроллера отделена. В случае замены &#8220;головы&#8221;, новый контроллер загружает &#8220;конфигурациенезависимое&#8221; ядро, монтирует к нему /etc, прочитывает оттуда конфигурацию текущей системы - и готово.</p>
<p>Все остальное место на этом &#8220;особом&#8221; разделе, в принципе, может быть использовано под какие-то нужды. Например, по умолчанию там создается папка home, которую можно использовать для хранения пользовательских home-директорий.</p>
<p>Для системы с небольшим количеством дисков и невысокой предполагаемой загрузкой бывает жалко отдавать отдельный aggregate и целых два-три диска только под служебную директорию размером в несколько мегабайт, особенно если используются большие диски, например при дисках SATA 1TB вы теряете на первом aggregate 1 или 2 TB на диски parity, и еще один диск под служебный vol0, пусть на нем и можно хранить данные. Все равно это минус 2-3 диска целиком, из общего количества.</p>
<p>В этом случае можно порекомендовать создать единый aggregate, в который войдут все диски системы, и уже на нем выделить vol0 под системный раздел.<br />
В этом случае общая производительность вашего aggregate увеличится на величину <em>2..3 * IOPS одного диска</em>, ведь, как я писал выше, общая нагрузка ввода-вывода в aggregate расделяется поровну по всем входящим в него дискам.</p>
<p>Однако если вы строите систему повышенной готовности, или систему с высокой и специфической нагрузкой, и хотите построить ее &#8220;без компромиссов&#8221;, в особенности если дисков куплено достаточно, то отделяйте системный раздел в отдельный aggregate, чтобы застраховаться от взаимного влияния ввода-вывода системного раздела, и раздела с данными ваших приложений.</p>
<p>Продолжение как всегда следует в следующий понедельник.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../339/trackback.html#comments" title="Комментарий к записи Проблемы и решения Usable Space. Часть 4.">Комментарии (2)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-338">
				<h2 class="posttitle"><a href="../../../338/trackback.html" rel="bookmark" title="Permanent Link to Проблемы и решения Usable Space. Часть 3.">Проблемы и решения Usable Space. Часть 3.</a></h2>
				<div class="postmetadata">27 Июль 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>??так, в предыдущих двух постах этой темы (<a href="../../../269/trackback.html">часть 1</a>, <a href="../../../286/trackback.html">часть 2</a>) я постарался показать, что такое usable space по сравнению с raw space, почему первое всегда меньше чем второе, и почему мы, заплатив за полновесные терабайты получаем на выходе якобы совсем не те терабайты, за которые мы заплатили.</p>
<p>Процесс перехода от raw к usable есть процесс получения из тупых байтов некоего функционала, &#8220;обмен байтов на дополнительные возможности и защиту данных&#8221;. Обычно чем больше мы теряем в байтах, тем больше получаем в функционале (конечно, если это правильная система хранения ;)</p>
<p>Один из блоггеров NetApp, которого я постоянно читаю, <a href="http://blogs.netapp.com/extensible_netapp/">Костадис Руссос</a>, использует в своих постах, в особенности в своих спорах с EMC, термины &#8220;Real Fibre Channel&#8221; (который так любят Наши Уважаемые Конкуренты) и <a href="http://blogs.netapp.com/extensible_netapp/better-than-real-fiber-channel/">&#8220;Better Than Real FibreChannel&#8221;</a> :)</p>
<p>Давайте посмотрим, где же NetApp является &#8220;Better Than Real FibreChannel&#8221;.</p>
<p>Пост планируется длинный, я разбил его на несколько частей, которые будут идти в несколько приемов, так что готовьте кофе ;)</p>
<p>??так, как уменьшается пространство по пути от &#8220;raw data&#8221; к &#8220;usable data + функционал&#8221;?</p>
<p>Первый аспект относится скорее не к нашему случаю, но перечислим и его. Это так называемые &#8220;маркетинговые байты&#8221;. Большинство из читателей знает, что сто лет как существует проблема перевода из &#8220;двоичных&#8221; в &#8220;десятичные&#8221; байты. То есть &#8220;килобайт&#8221; это не 1000 байт, а 1024 байта.</p>
<blockquote><p>
Бородатый анекдот: &#8220;Шофер думает, что в килобайте 1000 байт, а программист - что в километре - 1024 метра&#8221;
</p>
</blockquote>
<p>Так вот, емкость в &#8220;двоичных байтах&#8221; получается больше, что очень нравится маркетерам компаний по производству жестких дисков: <em>&#8220;А в попугаях я гораздо длиннее!&#8221;</em> (с) Удав</p>
<p>Строго говоря уже в обед как сто лет принято решение ISO (International Standartization Organisation) для &#8220;двоичных байт&#8221; использовать специальные приставки, чтобы отличать двоичные и десятичные множители, звучат они непривычно, и немного смешно: не кило- а киби- (би - &#8220;бинарные&#8221;, двоичные единицы), &#8220;мега&#8221; - &#8220;меби&#8221;, и так далее.<br />
Но пока есть что есть, и из диска на один &#8220;терабайт&#8221; (как называет его производитель), который на деле &#8220;тебибайт&#8221;, &#8220;исчезает&#8221; за счет этого почти сто мегабайт.</p>
<p>Аспект номер два - сектор 520 байт на 8 байт больше обычно используемого. Зачем это так сделано я писал <a href="../../../294/trackback.html">тут</a> и <a href="../../../299/trackback.html">тут</a>. Это уменьшает емкость диска примерно на 1/64 долю, повышая надежность хранения и позволяя использовать дедупликацию.</p>
<p>Далее переходим к RAID-ам. Как вы знаете уже, на системах NetApp используется <a href="../../../24/trackback.html"><em>RAID тип 4</em></a> (чередование с четностью, с выделенным диском четности), который имеет емкость X*N-X, где X - это емкость одного диска, а N это число дисков в RAID-группе, то есть на обеспечение отказоустойчивости занимается один диск.<br />
Второй применяемый тип RAID, это вариант RAID-6 под названием <a href="../../../223/trackback.html">RAID-DP</a>, в нем на обеспечение отказоустойчивости занимается два диска (X*N-2X). Такой тип RAID рекомендуется использовать по умолчанию.</p>
<p>Максимальный размер RAID для дисков FC и SAS - 28 дисков. Для SATA - 16. Меньший размер RAID в случае SATA диктуется меньшей надежностью дисков, более высокой вероятностью выхода из строя и ошибок, что потребовало ограничить размер RAID. Кроме того, скорость rebuild на длинном RAID для относительно медленных дисков SATA может быть неприемлимо низкой.<br />
При необходимости использовать большее количество дисков необходио создавать две и более группы, на каждую из которых будет потрачено по 2 диска четности (в случае RAID-DP).<br />
Обратите внимание, что максимальный размер RAID для группы типа RAID-4 в два раза меньше, то есть 16 для SAS и FC, и 8 для SATA! Большая разрешенная длина группы RAID-DP также связана с его более высокой надежностью и отказоустойчивостью.</p>
<p>Следующий этап - диски hot spare. Система NetApp назначает все неиспользуемые в действующих RAID-группах диски в Hot Spare. Затем из пула hotspare-дисков вы можете их забрать, создавая RAID-ы, aggregates  тома.  Более того, эксплуатация системы без Hot Spare дисков вообще - настоятельно не рекомендуется. Это, в принципе, наверное возможно (например какая-нибудь тестовая инсталляция с абсолютно неценными данными, но ограниченная по дисковым ресурсам), но это должно быть осознанное решение, риск которого полностью возлагается на администратора системы. Для отключения весьма надоедливого уведомления о работе без hot spare необходимо установить одну из системных опций в настройках (<em>курите маны, если что - я ни при чем.</em>).<br />
Но это, повторюсь, не рекомендуется, и является нештатным и рискованным режимом.<br />
В нормальном состоянии необходим один hot spare на каждый контроллер кластера, причем для каждого используемого типа дисков.<br />
Например, если у вас &#8220;двухголовая&#8221;, двухконтроллерная кластерная система, в которой используется два типа дисков, например 300GB и 450GB FC, или 300GB SAS и 750GB SATA, то вам нужно будет иметь spare каждого из типов, то есть отдельно 300 и отдельно 450, или отдельно 300 SAS, и 750 SATA.</p>
<p>С некоторых пор Data ONTAP предлагает иметь <em>два</em> hot spare на контроллер <em>минимум</em>.<br />
Это связано <a href="http://www.wafl.co.uk/spares-faq/">с некими внутренними &#8220;маневрами&#8221; системы</a>, и в принципе, как и в случае с работой без hot spare вообще, это может быть отключено в системных опциях ONTAP.<br />
Лично вот мне, как частному лицу, кажется, что держать _четыре_ hot spare на систему (по 2 на контроллер) это уже откровенный перебор, даже для достаточно крупной системы, что уж говорить о наиболее популярных у нас &#8220;голова плюс одна или две полки&#8221;.</p>
<p>* <em>??зменить установку по умолчанию в 2 spare можно установив опцию raid.min_spare_count в 1, однако добавлять диски в aggreate придется в командной строке, так как для FilerView установку в 2 spare для ONTAP выше 7.3 изменить не удается (она просто не даст вам в GUI использовать дисков больше чем &#8220;все диски головы минус два&#8221;).<br />
<code>> aggr add [aggrname] -d [diskname]</code></em></p>
<p>Тем не менее, всякий раз, когда вы меняете настройки принятые по умолчанию - подумайте дважды. ??ли как было написано в &#8220;шапке&#8221; конфигурационного файла одной из линуксных программ: &#8220;Уберите свои руки от наших установок по умолчанию!&#8221;</p>
<p>Продолжение следует.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../338/trackback.html#comments" title="Комментарий к записи Проблемы и решения Usable Space. Часть 3.">Комментарии (7)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-299">
				<h2 class="posttitle"><a href="../../../299/trackback.html" rel="bookmark" title="Permanent Link to Дедупликация - как это работает у NetApp?">Дедупликация - как это работает у NetApp?</a></h2>
				<div class="postmetadata">22 Июнь 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Дедупликация данных, то есть удаление из данных повторяющихся блоков с целью уменьшения объемов хранения, есть довольно горячая тема на сегодня.<br />
Недавно начавшаяся &#8220;титаномахия&#8221; между NetApp и EMC, двумя крупнейшими по размерам производителями систем хранения с дедупликацией, за обладание третьим игроком этого рынка, компанией Data Domain, по очереди получающей от NetApp и EMC все повышающиеся по цене предложения о покупке, показывает интерес индустрии к теме.</p>
<p>Что же такое <strong>дедупликация</strong>, или, как она называлась раньше у NetApp, <em>ASIS - Advanced Single Instance Store</em>? </p>
<p>Не секрет, что хранимая информация часто многократно и ненамеренно &#8220;дублируется&#8221;. Речь даже не о том, что пользовательские &#8220;домашние папки&#8221; сотрудников отдела продаж хранят во множестве экземпляров текущий прайс компании, а регулярно проносящиеся по организации рассылки пользователями друг другу какого-нибудь очередного &#8220;прикольного&#8221; &#8220;вирусного&#8221; видео на ютубе, или свежего &#8220;топа бездны&#8221; заполняют ящики MS Exchange. С такими &#8220;файловыми&#8221; дублированиями уже умели бороться довольно давно, и разными способами, хоть и по прежнему не слишком успешно.</p>
<p>Однако есть другие варианты, наиболее просто демонстрируемый и широко распространенный сегодня - содержимое виртуальных машин. Если у вас есть пять виртуальных машин на базе Windows, то у вас есть, скорее всего, пять полностью идентичных инсталляций Windows, минимум на 2-3 гигабайта каждая, отличающихся на момент их создания, грубо говоря, только &#8220;именем компьютера&#8221; и IP-адресом, лежащих отдельно друг от друга на дисках, и занимающих свои 2-3 гигабайта.<br />
Однако, так как это содержимое хранится внутри файла &#8220;виртуальных дисков&#8221;, то обычными методами мы никак не сможем устранить это дублирование. Ведь файлы этих виртуальных дисков все же не идентичны (на какие-то единицы процентов).<br />
Аналогичный пример - базы данных. Если у нас для записи базы данных для полутора тысяч сотрудников указано &#8220;не женат/не замужем&#8221;, равно как и наоборот, или, например, в поле &#8220;город&#8221; указано &#8220;Москва&#8221;, а предусмотренное архитектурой базы BLOB-поле для хранения фотографии у 90% пустое, то это также будет дублированием.</p>
<p>Может быть просто обидно, хранить на дорогостоящих SAS и FC дисках многократно повторяющиеся, и по сути не нужные, не несущие информацию, избыточные блоки данных. Мы сохранили уникальный блок - все. Нужно его содержимое - берите его там, зачем копировать его по диску в сотнях и тысячах копий!<br />
Так дело обстоит с точки зрения банальной логики.<br />
Мы победили на файловом уровне, с помощью разных средств, рассылальщиков &#8220;башорга&#8221; по конторе, но с дублированием множества копий идентичных данных в виртуальных машинах справиться гораздо сложнее.</p>
<p>Несколькими постами ранее я рассказывал о том, что при хранении информации на дисках NetApp используется &#8220;нестандартный&#8221; сектор, 512 байт обычного сектора дополнены 8 байтами специальных &#8220;контрольных сумм&#8221;, позволяющих контролировать нарушение целостности информации при их передаче.<br />
Однако кроме этого NetApp использует их довольно остроумным способом и в процессе нахождения и устранения дубликатов данных.</p>
<p>Одна из основных задач в процессе дедупликации - нахождение идентичных блоков данных.<br />
Для того, чтобы не устраивать сравнение &#8220;всех со всеми&#8221;, пока не найдешь дубликат, это очень долго и дорого в плане использования памяти и процессора, обычно используется способ вычисления так наываемой &#8220;хэш-функции&#8221;. </p>
<p>&#8220;Хэш-функция&#8221; это некая формула, по которой можно получить более или менее уникальный &#8220;фингерпринт&#8221;, &#8220;цифровой отпечаток пальца&#8221;, некое число, уникальное для данного сочетания байт. Сравнивать такие числа гораздо проще, чем содержимое файлов, от которых они взяты.<br />
Простейший вариант хэш-функции, это так называемая &#8220;контрольная сумма&#8221;. У нас есть набор чисел-байт, давайте просуммируем их, и на выходе получим некое число, зависящее от значения тех, кого мы просуммировали. Проблема использования простейшей контрольной суммы очевидна.<br />
Сумма 5+3+2 дает 10. Но и сумма 4+4+2 дает тоже 10.<br />
Это называется &#8220;хэш-коллизия&#8221;, ситуация, когда разные по содержимому блоки дают идентичный результат хэш-функции. Чем это чревато - нетрудно сообразить. Основываясь только на результате хэша мы можем ошибочно удалить вовсе не идентичные по содержимому данные.</p>
<p>Решение в общем-то очевидно. На самом деле никто не пользуется примитивной контрольной суммой, я ее привел просто в качестве примера, иллюстрирующего проблему.<br />
Для вычисления хэш-функции используются различные математические алгоритмы, более устойчивые к хэш-коллизии, наиболее известны, например, CRC32 или MD5.<br />
Более устойчивые - да, но не абсолютно.<br />
Устроит ли вас результат, что &#8220;ваши данные <em>скорее всего</em>, с высокой степенью вероятности, не будут ошибочно удалены&#8221;? По видимому - нет.</p>
<p>Что же делать? Снова очевидно - усложнять алгоритм, снижая вероятность коллизии.<br />
Однако, возникает проблема накладных расходов. Вычисление сложного алгоритма есть довольно непростая и ресурсоемкая задача. А если учесть, что мы должны проделывать ее для каждого записываемого на систему хранения блока без исключения? Процессорные ресурсы сейчас дешевы, но не настолько же.</p>
<p>??менно это является причиной того, что массивно-дедуплицирующие системы, например такие, как система типа CAS (Content-addressable Storage) EMC Centera, очень, ОЧЕНЬ медленные на запись.</p>
<p>NetApp, представив в 2007 году свое решение той задачи, предсказуемо пошел своим путем.<br />
Как я уже упоминал, системы NetApp хранят результат CRC, это сравнительно простой в вычислении и &#8220;недорогой&#8221;, но недостаточно устойчивый к коллизиям алгоритм вычисления, для каждого 512-байтного блока. Этот CRC достается нам, по сути, бесплатно, он в принципе уже есть на дисках, хотим мы этого, или нет, пользуемся им, или нет.<br />
Но использовать только его для определения дубликатов нельзя.</p>
<p>Файловая структура WAFL, лежащая &#8220;в основе&#8221; всех систем хранения NetApp использует блок данных размером 4KB, то есть 8 таких секторов.<br />
CRC от этих 8 секторов дают нам некий более или менее уникальный fingerprint такого блока.<br />
Эти фингерпринты сводятся в массив внутренней &#8220;базы&#8221;, по которой производится поиск идентичных фингерпринтов. Как вычисление несложного хэша, так и поиск по значениям такого хэша, это, в принципе, не слишком сложная и ресурсоемкая задача, тем более, что, как я написал выше, значительная часть задачи уже и так решена, так как CRC у нас уже есть для всех секторов &#8220;бай дизайн&#8221;, изначально, по умолчанию.<br />
??дентичные фингерпринты <em>являются основанием предполагать</em> идентичность соответствующих им блоков.<br />
Обратите внимание, не &#8220;означают идентичность&#8221;, для этого алгоритм слишком прост.</p>
<p>Теперь, сократив количество подлежащих анализу блоков в сотни и тысячи раз, и обнаружив &#8220;достойных кандидатов&#8221;, мы проводим обычное побайтовое <del>собеседование</del> сравнение этих 4KB блоков, и вот если мы в результате этого сравнения обнаруживаем полную идентичность - вот тогда мы и удаляем, то есть вероятность неправомерного удаления в результате &#8220;хэш-коллизии&#8221; полностью устранена, но при этом, за счет такого двухстадийного процесса, мы обошлись без использования сложного и ресурсоемкого &#8220;устойчивого к коллизиям хэша&#8221;.</p>
<p>Однако у такого метода есть существенная особенность - он не может быть проведен online, в момент собственно записи данных. Это в чистом виде offline-алгоритм. Сперва данные записываются, потом генерируются fingerprint-ы, потом проходит поиск, выявляются кандидаты на дедупликацию, проводится побайтное сравнение дупликатов и принимается решение.</p>
<p>Однако &#8220;чистый offline&#8221; процесса дедупликации дает нам пренебрежимо малое влияние процесса на производительность системы. Конечно многое зависит от мощности системы, характера данных, и так далее, но чаще всего пользователи сообщают о влиянии на производительность от включенной дедупликации в 0% для чтения, и в районе 5-7% при записи, то есть, во многих случаях, пренебрежимо малых величинах.<br />
В результате, системы NetApp могут использовать дедупликацию на ролях так называемых Primary storages, то есть основных, &#8220;боевых&#8221; системах хранения, а не только на хранилищах бэкапов, DR-реплик и резервных, ненагруженных системах.<br />
Хотя применение дедупликации на primary storages и требует соблюдения рада оговорок, оно, как показывает практика прошедших пары лет, вполне работоспособно и широко применяется сегодня. ?? уж точно дедупликация пригодна для разнообразных secondary storages, таких как D2D Backup, реплики данных и резервные системы.</p>
<p>Так как NetApp принял в свое время решение отдавать лицензию на Dedupe бесплатно, на сегоднящний день количество систем хранения со включенным и работающим Deduplication, по отчету техсаппорта компании, получающего эту информацию, превышает на начало года число 37 тысяч систем.<br />
Это подавляюще преимущественное положение на рынке дедупликации на сегодня.</p>
<p><strong>Q: Насколько эффективна дедупликация для хранимых данных?</strong><br />
<strong>А:</strong> NetApp сделал специальный эмпирический калькулятор, с помошью которого можно приблизительно оценить результат для разных типов данных.<br />
<a href="http://www.dedupecalc.com/">http://www.dedupecalc.com/</a></p>
<p><strong>Q: А как бы не приблизительные и эмпирические цифры узнать, а на моих конкретных данных?</strong><br />
<strong>A:</strong> У NetApp есть небольшая программка, которую можно запустить на том данных, она просчитает по нему fingerprint и сообщит ожидаемую эффективность дедупликации. Взять ее можно у партнера NetApp, так как она под определенными ограничениями, не просите ее у меня.<br />
Партнеру скажите, что вам нужна программка SSET под Windows или Linux, он ее может скачать с партнерского раздела.</p>
<p><strong>Q: Я запустил дедупликацию (или SSET) по тому данных, на котором у меня лежит сотня full backup моих данных, и я ожидал получить высокую степень эффективности на таких данных, ведь по сути это полностью одинаковые данные за небольшими изменениями, но получил результат заметно менее ожидаемого, почему так?</strong><br />
<strong>A:</strong> Дело в том, что для дедупликации важна абсолютная идентичность данных в пределах 4KB-блока. Если идентичные данные имеют по какой-то причине смещение между сравниваемыми блоками, хоть на байт (такое часто случается в форматах файлов резервного копирования), они уже будут считаться неидентичными для алгоритма дедупликации FAS, который не умеет обрабатывать смещение данных в блоках. Эта проблема решена в алгоритме дедупликации для систем VTL, лучше подходящих, и специально заточенных под бэкапы.<br />
По этой причине, кстати, дедупликация FAS так эффективна для виртуальных дисков виртуальных машин, обычно виртуальные диски всегда идентично выровнены между собой, и границы блоков для них совпадают.</p>
<p><strong>Q: Как можно получить лицензию для имеющейся системы?</strong><br />
<strong>A:</strong> Свяжитесь с ее продавцом, он закажет для вашей системы лицензию. Она бесплатна, но она нужна. Как правило для всех новых систем она поставляется по умолчанию, как iSCSI, например.</p>
<p><strong>Q: Есть ли какие-то ограничения по использованию?</strong><br />
<strong>A1:</strong> Конечно есть :) Для полного понимания рекмендуется прочесть соответствующий Best Practices на сайте NetApp, а из FAQ-овых вопросов - обязательно посмотрите, какой лимит определен для вашей системы хранения. Он зависит от версии используемой Data ONTAP, и на момент написания этого текста, для 7.3.1 составляет 1TB для FAS2020 (самой младшей), 2TB для 2050 и 3020, 3TB для 3050, 4TB для 3040 и 3140, выше (3070, 3160, 6000) размер тома с включенной дедупликацией может быть равен максимальному размеру тома на системе хранения - 16TB. Это ограничение вызвано нежеланием перегружать возможным процессом не слишком большие объемы памяти и процессоров для этих систем, что могло бы вызвать заметное снижение рабочей производительности системы.<br />
Если вы создали том больше, чем разрешено для данной OS и данного &#8220;железа&#8221;, то дедупликация не запустится. С другой стороны и ничего плохого тоже не произойдет :).<br />
<strong>А2:</strong> Обратите также внимание, что дедупликация производится только для активной файловой системы. Если много блоков данных &#8220;заперто&#8221; в снэпшотах, то степень достигнутой дедупликации будет ниже, так как блоки данных в снэпшотах не обрабатываются. Возможно со временем эту проблему решат, но пока перед началом дедупликации рекомендуется удалять снэпшоты, провести дедупликацию, после чего снэпшоты можно снова брать и использовать. </p>
<p><strong>Q: Велична в 2TB на том данных, подлежащих дедупликации, это объем записываемых в него данных?</strong><br />
<strong>A:</strong> Нет, это именно размер тома. Если у вас на системе ограничение 2TB на том с дедупликацией, и при этом вы пишете на него данные, которые могут быть дедуплицированы вдвое, то после записи 2TB и первого прохода процесса дедупликации, у вас освободится 1TB, который вы, в свою очередь, сможете записать после окончания этого процесса. Далее по этому записанному 1TB также пройдет дедупликация, и после ее окончания вы снова получите свободное место. Но первоначально объем записи равен размеру тома, не забывайте, что это именно оффлайновая дедупликация, даже если вы заливаете 2TB нулей, вы получите эффект только после его обработки.<br />
Однако, если вы включили дедупликацию на томе большего размера, на котором есть всего 2TB и менее данных, то дедупликация просто не включится. Важен именно размер тома.</p>
<p><strong>Q: Могу я вернуть &#8220;как было&#8221; если у меня что-то пойдет &#8220;не так&#8221;?</strong><br />
<strong>A:</strong> Конечно, можно как включить, так и выключить дедупликацию в любой момент, а также вернуть назад &#8220;дупликацию&#8221;, если почему-то что-то не устроит.</p>
<p><strong>Где еще почитать поподробнее по-русски о технических аспектах:</strong><br />
<a href="http://www.netwell.ru/docs/netapp/tr-3505_rus_deduplication_best_practices.pdf">RUS TR-3505 Deduplication for FAS and V-series Best Practices.pdf</a></p>
<p>&#8211;<br />
UPD:<br />
О том, как дедупликация влияет на производительность работы систем хранения NetApp можно прочитать здесь:<br />
<a href="../../../432/trackback.html"><strong>Дедупликация и производительность работы</strong></a></p>
<p>&#8211;<br />
UPD2: Кстати, знаете ли вы, что NetApp <strong>гарантирует</strong> экономию по меньшей мере 50% объема хранения в случае использования дедупликации для данных виртуальных сред (VMware ESX/vSphere, MS Hyper-V/Hyper-V R2, Citrix Xen)?<br />
<a href="http://www.netapp-vi.eu/ru/guarantee.php">http://www.netapp-vi.eu/ru/</a></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../deduplication/index.html" rel="tag">deduplication</a>, <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../299/trackback.html#comments" title="Комментарий к записи Дедупликация - как это работает у NetApp?">Комментарии (8)</a>									 </div>
			</div>
	
						
			<div class="post" id="post-294">
				<h2 class="posttitle"><a href="../../../294/trackback.html" rel="bookmark" title="Permanent Link to Silent Data Corruption - неотслеженное повреждение данных">Silent Data Corruption - неотслеженное повреждение данных</a></h2>
				<div class="postmetadata">15 Июнь 2009, 8:00 <!-- от  --></div>
				<div class="postentry">
					<p>Без технологии защиты, действующей &#8220;от двери и до двери&#8221;, повреждение данных может пройти незамеченным, и тогда процесс восстановления окажется длительным, трудным и дорогостоящим, если и вообще возможным. Без технологии проверки целостности данных на всем протяжении пути данных, такое необнаруженное повреждение может вести к неожиданным и трудноотлавливаемым проблемам.Недавняя статья в PC Magazine (опуликована 25 августа 2008 года) сообщает о произошедшем в реальной жизни инциденте:</p>
<blockquote><p>&#8220;Netflix заметил проблему повреждения базы данных в своей системе отгрузки товара. В течении дня мы начали замечать аналогичные проблемы в прочих базах нашей торговой системы, пока, наконец, вся система не встала.&#8221;</p>
</blockquote>
<p>Причина обнаружилась в сбойном аппаратном компоненте сети передачи данных, но проблема была не столько в нем, сколько в том, что этот компонент при этом не сообщал ни о каких ошибках в своей работе.</p>
<p>Одно из мест, где повреждение данных может произойти, это процесс записи на диск. Есть два основных вида повреждений диска. Первый - так называемый &#8220;latent sector errors&#8221; или &#8220;неустойчивая ошибка чтения сектора&#8221;, который обычно является следствием физического сбоя диска. Примером может служить ошибка чтения, о которой сообщает дисковый массив.<br />
Такой вид ошибки обычно детектируется с помощью ECC или CRC в канале ввода-вывода, и чаще всего исправляется автоматически.</p>
<p>Другой тип ошибки - &#8220;тихая ошибка&#8221;, которая происходит без каких-либо сообщений.<br />
Не существует способа обнаружить и устранить такую ошибку, без наличия полного контроля целостности &#8220;от и до&#8221;, по всему пути данных от диска, до прикладной программы.</p>
<p>Недавнее исследование<sup>1</sup>, проведенное в Университете Висконсина, Университете Торонто и компании NetApp было сосредоточено на &#8220;тихих ошибках&#8221; жестких дисков. ??сследование проводилось в течении 41 месяца, и анализировались ошибки контрольных сумм 1,53 миллионов жестких дисков.</p>
<p>При исследовании использовались данные блоков на уровне файловой системы, чтобы обнаружить ранее необнаруживаемые ошибки контрольны сумм. В течении 41 месяца &#8220;тихие ошибки&#8221; были зарегистрированы на 0.86% из 358000 дисках SATA и 0.065% из 1.17 миллионов дисков Fibre Channel.  Хотя эти величины и невысоки, но они представляют собой необнаруживаемые, и полностью &#8220;тихие ошибки&#8221;, которые могут привести к потере или искажению данных, и, в результате, значительному простою.</p>
<p>&#8211;<br />
<sup>1</sup><br />
<em>L. Bairavasundaram, G. Goodson, B. Schroeder, A. Arpaci-Dusseau, R. Arpaci-Dusseau, “An Analysis of Data Corruption in the Storage Stack “, FAST08</em></p>
<p>Программный стек также становится более сложным, что делает его более уязвимым к повреждению данных. В качестве примера можно привести ошибочный указатель буфера и пропущенные или записанные &#8220;не туда&#8221; данные. Если данные повреждены внутри программного стека, то файловая система имеет очень ограниченные возможности обнаружить и исправить такую ошибку, и, как следствие, возникает потенциальная проблема необнаруженной ошибки.</p>
<p>Еще в 2001 году Oracle выступил с <noindex><nofollow><a href="http://www.oracle.com/technology/deploy/availability/htdocs/HARD.html"> инициативой HARD</a></nofollow></noindex>- Hardware Assisted Resilient Data - программой мер, обеспечивающих сквозной контроль целостности информации от диска до приложения.<br />
Постепенно к этой программе <noindex><nofollow><a href="http://www.oracle.com/technology/deploy/availability/htdocs/hardf.html">присоединяются новые участники</a></nofollow></noindex>, обеспечивающие соответствующий функционал в своих продуктах. С 2003 года существует стандарт (Protection Information) подготовленный группой ANSI T10, с 2007 года в рамках инициативы DII (Data Integrity Initiative) сотрудничают Oracle, Emulex, Seagate и LSI, организована координирующая группа SNIA Data Integrity Working Group. C 2008 соответсвующие средства и поддержка, по инициативе Oracle, внесены в ядро Linux, начиная от 2.6.27.</p>
<p>Возможно интересующиеся темой уже знают, что в дисках NetApp используется специальный размер сектора - 520 байт, вместо стандартных 512. ??менно эти 8 байт на сектор и используются для хранения дополнительной информации для защиты и обнаружения искажения информации на самом нижнем, ниже RAID уровне.</p>
<p>Вот как определяет этот механизм группа ANSI T10:<br />
<img src="/pics/t10sect.png" alt="ANSI T10 PI sector specification" /></p>
<p>Protection Informаtion Standart (PI) это расширение спецификации SCSI Block Command, утвержденного техническим комитетом T10. Спецификация PI относится к коммуникации между контроллером SCSI и устройством хранения. Стандартным образом данные размещаются в 512-байтных блоках. Стандарт DIF определяет дополнительные 8 байт, увеличивающие сектор до 520 байт. Дополнительные байты используются для хранения тегов, которые используются для проверки содержимого 512 байт данных в секторе. </p>
<p>FC HBA (как SCSI-контроллер в данном случае) генерирует соответствующие 8 байт служебных данных, которые записываются вместе с сектором. В дальнейшем это позволить иметь дополнительный &#8220;слой&#8221; защиты в случае ошибочного чтения или записи данных на самом &#8220;низком уровне&#8221;.</p>
<p>В настоящий момент на сайте Oracle <noindex><nofollow><a href="http://www.oracle.com/technology/deploy/availability/htdocs/vendors_hard.html">в списке поддержавших и проверенных тестами Oracle</a></nofollow></noindex> EMC (Symmetrix), NetApp (все модели), Hitachi Data Systems (USP), а также &#8220;братья&#8221; последней, такие как HP XP и Sun StorEdge 99xx, и малоизвестные у нас системы NEC и Fujitsu.</p>
<p>Как видно из списка, среди модульных (не-&#8221;highend&#8221;) систем пока эта технология реализована (с 2004 года) только у NetApp, и у них единственных проходит полный набор тестов HARD, хотя я слышал, что EMC CLARiiON также использует &#8220;нестандартный&#8221; (на самом деле как раз стандартный, в соответствии с новым стандартом ANSI T10) размер сектора, с той же целью.<br />
Соответствующее ПО под названием SnapValidator обеспечивает работу контрольных алгоритмов Oracle внутри системы хранения, и гарантирует полную целостность данных Oracle &#8220;от двери до двери&#8221;, от блока данных в памяти сервера, до сектора данных на &#8220;блине&#8221; жесткого диска.</p>
<p><noindex><nofollow><a href="http://www.netapp.com/us/products/platform-os/snapvalidator.html">SnapValidator на сайте NetApp</a></nofollow></noindex></p>
<p><noindex><nofollow><a href="http://www.t10.org/ftp/t10/document.03/03-224r0.pdf">T10 Committee: End-to-End Data Protection Justification, July 1, 2003.</a></nofollow></noindex></p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../../technology.html" rel="tag">technology</a>, <a href="../index.html" rel="tag">techtalk</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../294/trackback.html#respond" title="Комментарий к записи Silent Data Corruption - неотслеженное повреждение данных">Комментарий</a>									 </div>
			</div>
	
						
			<div class="post" id="post-286">
				<h2 class="posttitle"><a href="../../../286/trackback.html" rel="bookmark" title="Permanent Link to Проблемы и решения Usable Space. Часть 2.">Проблемы и решения Usable Space. Часть 2.</a></h2>
				<div class="postmetadata">11 Май 2009, 13:06 <!-- от  --></div>
				<div class="postentry">
					<p>Теперь давайте посмотрим как на всем этом, рассмотренном в прошлом посте, располагаются пользовательские данные.<br />
Поверх &#8220;слоя виртуализации&#8221; - Aggregate - включающего в себя, как правило, все диски системы, и позволяющего нам распараллеливать ввод-вывод на все имеющиеся &#8220;физические шпиндели&#8221;, находятся собственно элементы доступные пользователю, &#8220;тома&#8221; типа FlexVol или Flexible Volumes.<br />
Непосредственно на этих томах, которые, еще раз напомню, физически &#8220;тонким слоем размазаны&#8221; по всем входящим в aggregate дискам системы, уже можно хранить файлы для NAS-систем, или создавать LUN-ы для SAN.</p>
<p>Однако тут стоит вспомнить о том, что все это разнообразие и богатство обеспечивается нам своеобразной структурой данных, или &#8220;файловой системой&#8221; <a href="../../../19/trackback.html">WAFL</a>, которая и создает базовые структуры данных на дисках, являясь заодно и менеджером томов, и частью &#8220;RAID-контроллера&#8221; системы. Эта необычная &#8220;псевдо-файловая система&#8221; достойна отдельной серии постов, и я уже опубликовал тут мой перевод интереснейшей <a href="../../../282/trackback.html">статьи инженера NetApp Костадиса Руссоса</a>, о том, как устроена WAFL, и почему, по его мнению, не вполне корректно называть WAFL &#8220;файловой системой&#8221;, по крайней мере чтобы не смешивать ее в восприятии с другими файловыми системами.</p>
<p>Не буду вдаваться в детальные подробности ее устройства, тем более, что не далее как несколько постов назад я уже <a href="../../../216/trackback.html">анонсировал подробное описание &#8220;внутренностей&#8221; WAFL от его непосредственных авторов</a>. ??нтересующиеся могут попробовать углубиться в тему прочитав ту статью в техбиблиотеке на сайте одного из дистрибуторов NetApp в России, компании Netwell.<br />
(см. ссылку в правом столбце)</p>
<p>Для нас же важно то, что же нам дает использование поверх raw data этой файловой системы? Будем уж так ее по традиции называть, хотя следует помнить, что это если и файловая система, то в чем-то единственная в своем роде.</p>
<p>Прежде всего, это возможность создавать и хранить <a href="../../../39/trackback.html">снэпшоты</a>, самая, пожалуй, известная особенность NetApp./p  pСнэпшоты, кстати сказать придуманные и впервые реализованные в индустрии систем хранения именно NetApp, работают следующим образом:<br />
<img style="display: inline" title="Snapshots" alt="Snapshots" src="/pics//snapshots.gif" width="462" height="250"></p>
<p>??дея снэпшотов плодотворно питает множество &#8220;фич&#8221; систем хранения NetApp. Многие возможности, такие как SnapMirror (репликация) или FlexClone (виртуальное клонирование), прямо или косвенно выросли из этого свойства WAFL.</p>
<p>Как я уже писал ранее, особенностью реализации снэпшота в NetApp является его &#8220;некопированность&#8221;. При создании NetApp&#8217;s Snapshot &#8482; данные, уже попавшие на диски, не копируются, а только сохраняется дополнительная таблица inodes. Так как WAFL устроена таким образом, что данные на нее не перезаписываются, а всегда только дозаписываются, пока блок хоть где-то использован, это гарантирует нам то, что данные в снэпшоте при таком подходе, останутся неизменными.</p>
<p>Это коренным образом отличается от любого другого подхода создания &#8220;снэпшотов&#8221; у конкурентов, где при его создании данные либо копируются сразу, либо по мере перезаписи &#8220;активной файловой системы&#8221; переносятся на зарезервированное пространство (при этом мы серьезно теряем в производительности системы, так как одна операция записи превращается в четыре, чтение содержимого блока, которое мы изменяем, запись блока в зарезервированное место, запись нового содержимого в блок &#8220;активной файловой системы&#8221;;, и, наконец, изменения в таблице размещения блоков, чтобы изменить указатели на блоки данных в снэпшоте.</p>
<p>Второй особенностью следует назвать необычный тип RAID, RAID-4 (&#8221;ONTAP RAID&#8221;), и необычный способ работы с ним. Почему я рассматриваю RAID на уровне файловой системы? Дело в том, что WAFL, по сути, &#8220;спускается&#8221; в своей работе на уровень RAID- и Volume-manager.<br />
Этот вопрос уже рассматривался в упомянутой ранее статье Костадиса Руссоса. WAFL не имеет ряда принципиальных для других файловых систем средств, например по работе с файловыми и директорными структурами, поиска и извлечения файлов, зато она оперирует на &#8220;низком&#8221; уровне RAID. То есть можно себе представить, что, по сравнению с какой-нибудь NTFS или ext3, WAFL пропорционально смещена &#8220;вниз&#8221; по этой &#8220;иерархии&#8221;. В ней меньше &#8220;высокоуровневых&#8221; средств, которые отданы &#8220;на откуп&#8221; сетевым файловым системам, таким как NFS или CIFS, или средствам блочной работы с LUN-ами, зато она, в большем объеме, чем традиционные файловые системы, работает с уровнем RAID и Volumes, в которые традиционные файловые системы не вмешиваются.</p>
<blockquote><p>Конечно в наше время почти каждая файловая система работает поверх того или иного уровня RAID, но только WAFL с ONTAP RAID знают друг о друге достаточно, чтобы использовать при работе преимущества друг друга.<br />
Costadis Roussos, NetApp</p>
</blockquote>
<p>Обычно производители систем хранения предлагают выбор между двумя-тремя типами RAID: RAID-10 (или RAID-0+1), и RAID-5 (а сейчас к ним добавился набирающий популярность RAID-6). Ранее я писал подробную статью о RAID, и разнице между ними, интересующимся предлагаю сходить туда.<br />
Эти типы RAID, применяемые на подавляющем количестве систем хранения, выбираются для конкретной задачи и используются следующим образом: если нужно хорошее быстродействие на запись, то все рекомендации говорят о использовании RAID-10. Его преимущества - быстрота работы. Его недостаток - мы &#8220;дарим&#8221; системе за это половину всей емкости дисков, Usable Space равно 50% от Raw. Довольно бандитские условия. ;)</p>
<p>Если быстродействие на запись не важно, а важна емкость - RAID-5. При этом на каждую RAID-группу мы теряем один диск под данные &#8220;четности&#8221;, но заметно падает скорость записи (а также скорость восстановления при сбое диска). Такая организация дисков как правило используется для систем долговременного хранения, хранения резервных копий, и тому подобного.</p>
<p>RAID-6 применяется либо при повышенных требованиях к надежности, либо при использовании менее надежных дисков, таких как SATA. При его использовании еще сильнее снижается скорость записи (примерно на 15-20% от скорости RAID-5), так как увеличивается объем вычислений для второго диска &#8220;четности&#8221;</p>
<p>Против всего этого зоопарка NetApp выставляет всего два варианта, а именно: RAID-4 и RAID-DP (вариант RAID-6). Почему?<br />
Очень просто. RAID-4 или RAID-DP, в их реализации у NetApp, практически не проигрывают по быстродействию RAID-10, но при этом столь же экономичны к usable space как RAID-5/6.<br />
А раз так, то зачем другие типы RAID, если те, что есть, полностью удовлетворяют по всем нужным параметрам?</p>
<p>Вот почему NetApp не предлагает &#8220;привычные&#8221; типы RAID. ??х многообразие у традиционных систем хранения просто маскирует принципиальную ущербность &#8220;классических&#8221; типов RAID, среди которых пользователю предлагается выбрать компромисс, либо пожертвовав usable-емкостью в пользу быстродействия (RAID-10), либо быстродействием в пользу емкости (RAID-5), либо и тем и другим в пользу надежности (RAID-6).</p>
<p>Теперь, вооруженные всеми этими знаниями, перейдем к разбору &#8220;классики говнилок&#8221; - тому, &#8220;куда у этого Нетаппа девается место на дисках&#8221;. Продолжим в следующий понедельник.</p>
				</div>
		
				<div class="postmetadata">
					Метки: <a href="../../netapp/index.html" rel="tag">netapp</a>, <a href="../index.html" rel="tag">techtalk</a>, <a href="../../usable-space.html" rel="tag">usable space</a><br />					Раздел: <a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;" rel="category tag">techtalk</a>&nbsp;&nbsp;|&nbsp;
					<a href="../../../286/trackback.html#respond" title="Комментарий к записи Проблемы и решения Usable Space. Часть 2.">Комментарий</a>									 </div>
			</div>
	
		
		<div class="navigation">
			<div class="alignleft"><a href="3.html">&laquo; Previous Entries</a></div>
			<div class="alignright"><a href="../index.html">Next Entries &raquo;</a></div>
		</div>
		
	
	</div>
	<div id="sidebar">
		<ul>
			
			
			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Автор</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			<li class="pagenav"><h2>Страницы</h2><ul><li class="page_item page-item-153"><a href="../../../../about/trackback.html" title="about">about</a></li>
<li class="page_item page-item-215"><a href="../../../../distributory-v-rossii/trackback.html" title="Дистрибуторы в России">Дистрибуторы в России</a></li>
<li class="page_item page-item-1327"><a href="../../../../disti-ua/trackback.html" title="Дистрибуторы в Украине">Дистрибуторы в Украине</a></li>
</ul></li>
			<li><h2>Рубрики</h2>
				<ul>
					<li class="cat-item cat-item-89"><a href="../../../category/commands/index.html" title="Просмотреть все записи в рубрике &laquo;commands&raquo;">commands</a>
</li>
	<li class="cat-item cat-item-37"><a href="../../../category/howto/index.html" title="Просмотреть все записи в рубрике &laquo;howto&raquo;">howto</a>
</li>
	<li class="cat-item cat-item-52"><a href="../../../category/justread/index.html" title="Просмотреть все записи в рубрике &laquo;justread&raquo;">justread</a>
</li>
	<li class="cat-item cat-item-51"><a href="../../../category/review/index.html" title="Просмотреть все записи в рубрике &laquo;review&raquo;">review</a>
</li>
	<li class="cat-item cat-item-3"><a href="../../../category/techtalk/index.html" title="Просмотреть все записи в рубрике &laquo;techtalk&raquo;">techtalk</a>
</li>
	<li class="cat-item cat-item-71"><a href="../../../category/tricks/index.html" title="Просмотреть все записи в рубрике &laquo;tricks&raquo;">tricks</a>
</li>
	<li class="cat-item cat-item-95"><a href="../../../category/utilities/index.html" title="Просмотреть все записи в рубрике &laquo;utilities&raquo;">utilities</a>
</li>
	<li class="cat-item cat-item-44"><a href="../../../category/whoisho/index.html" title="Просмотреть все записи в рубрике &laquo;whoisho&raquo;">whoisho</a>
</li>
	<li class="cat-item cat-item-1"><a href="../../../category/news/index.html" title="Просмотреть все записи в рубрике &laquo;новости&raquo;">новости</a>
</li>
	<li class="cat-item cat-item-387"><a href="../../../category/opros.html" title="Просмотреть все записи в рубрике &laquo;опрос&raquo;">опрос</a>
</li>
	<li class="cat-item cat-item-8"><a href="../../../category/translations/index.html" title="Просмотреть все записи в рубрике &laquo;переводы&raquo;">переводы</a>
</li>
	<li class="cat-item cat-item-40"><a href="../../../category/citaty/index.html" title="Просмотреть все записи в рубрике &laquo;цитаты&raquo;">цитаты</a>
</li>
				</ul>
			</li>

			<li><h2>Архивы</h2>
				<ul>
					<li><a href='../../../date/2018/01.html' title='Январь 2018'>Январь 2018</a></li>
	<li><a href='../../../date/2015/10.html' title='Октябрь 2015'>Октябрь 2015</a></li>
	<li><a href='../../../date/2015/04.html' title='Апрель 2015'>Апрель 2015</a></li>
	<li><a href='../../../date/2015/03.html' title='Март 2015'>Март 2015</a></li>
	<li><a href='../../../date/2015/01.html' title='Январь 2015'>Январь 2015</a></li>
	<li><a href='../../../date/2014/12.html' title='Декабрь 2014'>Декабрь 2014</a></li>
	<li><a href='../../../date/2014/11.html' title='Ноябрь 2014'>Ноябрь 2014</a></li>
	<li><a href='../../../date/2014/10.html' title='Октябрь 2014'>Октябрь 2014</a></li>
	<li><a href='../../../date/2014/09.html' title='Сентябрь 2014'>Сентябрь 2014</a></li>
	<li><a href='../../../date/2014/08.html' title='Август 2014'>Август 2014</a></li>
	<li><a href='../../../date/2014/07.html' title='Июль 2014'>Июль 2014</a></li>
	<li><a href='../../../date/2014/06.html' title='Июнь 2014'>Июнь 2014</a></li>
	<li><a href='../../../date/2014/05.html' title='Май 2014'>Май 2014</a></li>
	<li><a href='../../../date/2014/04.html' title='Апрель 2014'>Апрель 2014</a></li>
	<li><a href='../../../date/2014/03.html' title='Март 2014'>Март 2014</a></li>
	<li><a href='../../../date/2014/02.html' title='Февраль 2014'>Февраль 2014</a></li>
	<li><a href='../../../date/2014/01.html' title='Январь 2014'>Январь 2014</a></li>
	<li><a href='../../../date/2013/12.html' title='Декабрь 2013'>Декабрь 2013</a></li>
	<li><a href='../../../date/2013/11.html' title='Ноябрь 2013'>Ноябрь 2013</a></li>
	<li><a href='../../../date/2013/10.html' title='Октябрь 2013'>Октябрь 2013</a></li>
	<li><a href='../../../date/2013/09.html' title='Сентябрь 2013'>Сентябрь 2013</a></li>
	<li><a href='../../../date/2013/08.html' title='Август 2013'>Август 2013</a></li>
	<li><a href='../../../date/2013/07.html' title='Июль 2013'>Июль 2013</a></li>
	<li><a href='../../../date/2013/06.html' title='Июнь 2013'>Июнь 2013</a></li>
	<li><a href='../../../date/2013/05.html' title='Май 2013'>Май 2013</a></li>
	<li><a href='../../../date/2013/04.html' title='Апрель 2013'>Апрель 2013</a></li>
	<li><a href='../../../date/2013/03.html' title='Март 2013'>Март 2013</a></li>
	<li><a href='../../../date/2013/02.html' title='Февраль 2013'>Февраль 2013</a></li>
	<li><a href='../../../date/2013/01.html' title='Январь 2013'>Январь 2013</a></li>
	<li><a href='../../../date/2012/12.html' title='Декабрь 2012'>Декабрь 2012</a></li>
	<li><a href='../../../date/2012/11.html' title='Ноябрь 2012'>Ноябрь 2012</a></li>
	<li><a href='../../../date/2012/10.html' title='Октябрь 2012'>Октябрь 2012</a></li>
	<li><a href='../../../date/2012/09.html' title='Сентябрь 2012'>Сентябрь 2012</a></li>
	<li><a href='../../../date/2012/08.html' title='Август 2012'>Август 2012</a></li>
	<li><a href='../../../date/2012/07.html' title='Июль 2012'>Июль 2012</a></li>
	<li><a href='../../../date/2012/06.html' title='Июнь 2012'>Июнь 2012</a></li>
	<li><a href='../../../date/2012/05.html' title='Май 2012'>Май 2012</a></li>
	<li><a href='../../../date/2012/04.html' title='Апрель 2012'>Апрель 2012</a></li>
	<li><a href='../../../date/2012/03.html' title='Март 2012'>Март 2012</a></li>
	<li><a href='../../../date/2012/02.html' title='Февраль 2012'>Февраль 2012</a></li>
	<li><a href='../../../date/2012/01.html' title='Январь 2012'>Январь 2012</a></li>
	<li><a href='../../../date/2011/12.html' title='Декабрь 2011'>Декабрь 2011</a></li>
	<li><a href='../../../date/2011/11.html' title='Ноябрь 2011'>Ноябрь 2011</a></li>
	<li><a href='../../../date/2011/10/index.html' title='Октябрь 2011'>Октябрь 2011</a></li>
	<li><a href='../../../date/2011/09/index.html' title='Сентябрь 2011'>Сентябрь 2011</a></li>
	<li><a href='../../../date/2011/08.html' title='Август 2011'>Август 2011</a></li>
	<li><a href='../../../date/2011/07/index.html' title='Июль 2011'>Июль 2011</a></li>
	<li><a href='../../../date/2011/06/index.html' title='Июнь 2011'>Июнь 2011</a></li>
	<li><a href='../../../date/2011/05/index.html' title='Май 2011'>Май 2011</a></li>
	<li><a href='../../../date/2011/04/index.html' title='Апрель 2011'>Апрель 2011</a></li>
	<li><a href='../../../date/2011/03/index.html' title='Март 2011'>Март 2011</a></li>
	<li><a href='../../../date/2011/02.html' title='Февраль 2011'>Февраль 2011</a></li>
	<li><a href='../../../date/2011/01.html' title='Январь 2011'>Январь 2011</a></li>
	<li><a href='../../../date/2010/12.html' title='Декабрь 2010'>Декабрь 2010</a></li>
	<li><a href='../../../date/2010/11/index.html' title='Ноябрь 2010'>Ноябрь 2010</a></li>
	<li><a href='../../../date/2010/10/index.html' title='Октябрь 2010'>Октябрь 2010</a></li>
	<li><a href='../../../date/2010/09/index.html' title='Сентябрь 2010'>Сентябрь 2010</a></li>
	<li><a href='../../../date/2010/08.html' title='Август 2010'>Август 2010</a></li>
	<li><a href='../../../date/2010/07/index.html' title='Июль 2010'>Июль 2010</a></li>
	<li><a href='../../../date/2010/06.html' title='Июнь 2010'>Июнь 2010</a></li>
	<li><a href='../../../date/2010/05.html' title='Май 2010'>Май 2010</a></li>
	<li><a href='../../../date/2010/04/index.html' title='Апрель 2010'>Апрель 2010</a></li>
	<li><a href='../../../date/2010/03/index.html' title='Март 2010'>Март 2010</a></li>
	<li><a href='../../../date/2010/02.html' title='Февраль 2010'>Февраль 2010</a></li>
	<li><a href='../../../date/2010/01.html' title='Январь 2010'>Январь 2010</a></li>
	<li><a href='../../../date/2009/12/index.html' title='Декабрь 2009'>Декабрь 2009</a></li>
	<li><a href='../../../date/2009/11/index.html' title='Ноябрь 2009'>Ноябрь 2009</a></li>
	<li><a href='../../../date/2009/10.html' title='Октябрь 2009'>Октябрь 2009</a></li>
	<li><a href='../../../date/2009/09.html' title='Сентябрь 2009'>Сентябрь 2009</a></li>
	<li><a href='../../../date/2009/08/index.html' title='Август 2009'>Август 2009</a></li>
	<li><a href='../../../date/2009/07/index.html' title='Июль 2009'>Июль 2009</a></li>
	<li><a href='../../../date/2009/06.html' title='Июнь 2009'>Июнь 2009</a></li>
	<li><a href='../../../date/2009/05.html' title='Май 2009'>Май 2009</a></li>
	<li><a href='../../../date/2009/04.html' title='Апрель 2009'>Апрель 2009</a></li>
	<li><a href='../../../date/2009/03.html' title='Март 2009'>Март 2009</a></li>
	<li><a href='../../../date/2009/02.html' title='Февраль 2009'>Февраль 2009</a></li>
	<li><a href='../../../date/2009/01.html' title='Январь 2009'>Январь 2009</a></li>
	<li><a href='../../../date/2008/12.html' title='Декабрь 2008'>Декабрь 2008</a></li>
	<li><a href='../../../date/2008/11.html' title='Ноябрь 2008'>Ноябрь 2008</a></li>
	<li><a href='../../../date/2008/10.html' title='Октябрь 2008'>Октябрь 2008</a></li>
	<li><a href='../../../date/2008/09.html' title='Сентябрь 2008'>Сентябрь 2008</a></li>
	<li><a href='../../../date/2008/08.html' title='Август 2008'>Август 2008</a></li>
	<li><a href='../../../date/2008/03.html' title='Март 2008'>Март 2008</a></li>
	<li><a href='../../../date/2008/02.html' title='Февраль 2008'>Февраль 2008</a></li>
	<li><a href='../../../date/2007/12.html' title='Декабрь 2007'>Декабрь 2007</a></li>
	<li><a href='../../../date/2007/11.html' title='Ноябрь 2007'>Ноябрь 2007</a></li>
	<li><a href='../../../date/2007/10.html' title='Октябрь 2007'>Октябрь 2007</a></li>
	<li><a href='../../../date/2007/09.html' title='Сентябрь 2007'>Сентябрь 2007</a></li>
	<li><a href='../../../date/2007/08.html' title='Август 2007'>Август 2007</a></li>
	<li><a href='../../../date/2007/07/index.html' title='Июль 2007'>Июль 2007</a></li>
	<li><a href='../../../date/2007/06.html' title='Июнь 2007'>Июнь 2007</a></li>
	<li><a href='../../../date/2007/05.html' title='Май 2007'>Май 2007</a></li>
				</ul>
			</li>

			
					</ul>
	</div>

</div> <!-- wrapper -->
<div id="footer">
	<a href="../../../../feed">Entries (RSS)</a> and <a href="../../../../comments/feed">Comments (RSS)</a>. Valid <a href="http://validator.w3.org/check/referer" title="This page validates as XHTML 1.0 Transitional"><abbr title="eXtensible HyperText Markup Language">XHTML</abbr></a> and <a href="http://jigsaw.w3.org/css-validator/check/referer"><abbr title="Cascading Style Sheets">CSS</abbr></a>.<br />
	Powered by <a href="http://wordpress.org/" title="Powered by WordPress.">WordPress</a> and <a href="http://srinig.com/wordpress/themes/fluid-blue/">Fluid Blue theme</a>.<br />
	<!-- 15 queries. 0.126 seconds. -->
	</div>
</div> <!-- page -->
</body>
</html>
